<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width"><meta name=theme-color content="#222" media="(prefers-color-scheme: dark)"><meta name=generator content="Hugo 0.102.3"><link rel="shortcut icon" type=image/x-icon href=/imgs/icons/favicon.ico><link rel=icon type=image/x-icon href=/imgs/icons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=/imgs/icons/favicon_16x16_next.png><link rel=icon type=image/png sizes=32x32 href=/imgs/icons/favicon_32_32_next.png><link rel=apple-touch-icon sizes=180x180 href=/imgs/icons/apple_touch_icon_next.png><meta itemprop=name content="Learn SICP Chapter 2"><meta itemprop=description content="佛系写博客"><meta itemprop=datePublished zgotmplz><meta itemprop=dateModified zgotmplz><meta itemprop=image content="/imgs/avatar.webp"><meta itemprop=keywords content="Scheme,SICP"><meta property="og:type" content="article"><meta property="og:title" content="Learn SICP Chapter 2"><meta property="og:description" content="佛系写博客"><meta property="og:image" content="/imgs/avatar.webp"><meta property="og:image:width" content="312"><meta property="og:image:height" content="312"><meta property="og:image:type" content="image/jpeg/png/svg/jpg"><meta property="og:url" content="/post/sicp/learn-sicp-ch2/"><meta property="og:site_name" content="Baitian's Blog"><meta property="og:locale" content="zh-CN"><meta property="article:author" content="Baitian"><meta property="article:published_time" content="2019-10-08 00:00:00 +0800 +0800"><meta property="article:modified_time" content="2019-10-08 00:00:00 +0800 +0800"><link type=text/css rel=stylesheet href=https://unpkg.com/@fortawesome/fontawesome-free@6.1.2/css/all.min.css><link type=text/css rel=stylesheet href=https://unpkg.com/animate.css@3.1.1/animate.min.css><link rel=stylesheet href=/css/main.min.9471f4000d900cf2ec29bf55bf6a7ba039d4e1ba2e78c3612a6a947f8f44533a.css><style type=text/css>.post-footer,.flinks-list-footer hr:after{content:"~ 我可是有底线的哟 ~"}</style><script class=next-config data-name=page type=application/json>{"comments":true,"isHome":false,"isPage":true,"path":"learn-sicp-ch2","permalink":"/post/sicp/learn-sicp-ch2/","title":"Learn SICP Chapter 2"}</script><script type=text/javascript>document.addEventListener("DOMContentLoaded",()=>{var e=document.createElement("script");e.charset="UTF-8",e.id="LA_COLLECT",e.src="https://sdk.51.la/js-sdk-pro.min.js",e.async="true",e.onload=function(){},document.head.appendChild(e)})</script><link rel=stylesheet href=https://unpkg.com/katex@0.16.0/dist/katex.min.css><script defer src=https://unpkg.com/katex@0.16.0/dist/katex.min.js></script>
<script defer src=https://unpkg.com/katex@0.16.0/dist/contrib/auto-render.min.js onload='renderMathInElement(document.body,JSON.parse("{\u0022delimiters\u0022:[{\u0022display\u0022:true,\u0022left\u0022:\u0022$$\u0022,\u0022right\u0022:\u0022$$\u0022},{\u0022display\u0022:false,\u0022left\u0022:\u0022$\u0022,\u0022right\u0022:\u0022$\u0022},{\u0022display\u0022:false,\u0022left\u0022:\u0022\\\\(\u0022,\u0022right\u0022:\u0022\\\\)\u0022},{\u0022display\u0022:true,\u0022left\u0022:\u0022\\\\[\u0022,\u0022right\u0022:\u0022\\\\]\u0022}]}"))'></script><title>Learn SICP Chapter 2 - Baitian's Blog</title><noscript><link rel=stylesheet href=/css/noscript.css></noscript></head><body itemscope itemtype=http://schema.org/WebPage class=use-motion><div class=headband></div><main class=main><header class=header itemscope itemtype=http://schema.org/WPHeader><div class=header-inner><div class=site-brand-container><div class=site-nav-toggle><div class=toggle aria-label=切换导航栏 role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div></div><div class=site-meta><a href=/ class=brand rel=start><i class=logo-line></i><h1 class=site-title>Baitian's Blog</h1><i class=logo-line></i></a><p class=site-subtitle itemprop=description>零零碎碎的技术分享</p></div><div class=site-nav-right><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class=site-nav><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href=/ class=hvr-icon-pulse rel=section><i class="fa fa-home hvr-icon"></i>首页</a></li><li class="menu-item menu-item-archives"><a href=/archives/ class=hvr-icon-pulse rel=section><i class="fa fa-archive hvr-icon"></i>归档
<span class=badge>7</span></a></li><li class="menu-item menu-item-search"><a role=button class="popup-trigger hvr-icon-pulse"><i class="fa fa-search fa-fw hvr-icon"></i>搜索</a></li></ul></nav><div class=search-pop-overlay><div class="popup search-popup"><div class=search-header><span class=search-icon><i class="fa fa-search"></i></span><div class=search-input-container><input autocomplete=off autocapitalize=off maxlength=80 placeholder=搜索... spellcheck=false type=search class=search-input></div><span class=popup-btn-close role=button><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class=search-result-icon><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></div><div class="toggle sidebar-toggle" role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div><aside class=sidebar><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class=sidebar-nav><li class=sidebar-nav-toc>文章目录</li><li class=sidebar-nav-overview>站点概览</li></ul><div class=sidebar-panel-container><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><nav id=TableOfContents><ul><li><ul><li><ul><li><a href=#练习-1>练习 1</a></li><li><a href=#练习-2>练习 2</a></li><li><a href=#练习-3>练习 3</a></li><li><a href=#练习-4>练习 4</a></li><li><a href=#练习-5>练习 5</a></li><li><a href=#练习-6>练习 6</a></li><li><a href=#练习-7>练习 7</a></li><li><a href=#练习-8>练习 8</a></li><li><a href=#练习-9>练习 9</a></li><li><a href=#练习-10>练习 10</a></li><li><a href=#练习-11>练习 11</a></li><li><a href=#练习-12>练习 12</a></li><li><a href=#练习-13>练习 13</a></li><li><a href=#练习-14>练习 14</a></li><li><a href=#练习-15>练习 15</a></li><li><a href=#练习-16>练习 16</a></li><li><a href=#练习-17>练习 17</a></li><li><a href=#练习-18>练习 18</a></li><li><a href=#练习-19>练习 19</a></li><li><a href=#练习-20>练习 20</a></li><li><a href=#练习-21>练习 21</a></li><li><a href=#练习-22>练习 22</a></li><li><a href=#练习-23>练习 23</a></li><li><a href=#练习-24>练习 24</a></li><li><a href=#练习-25>练习 25</a></li><li><a href=#练习-26>练习 26</a></li><li><a href=#练习-27>练习 27</a></li><li><a href=#练习-28>练习 28</a></li><li><a href=#练习-29>练习 29</a></li><li><a href=#练习-30>练习 30</a></li><li><a href=#练习-31>练习 31</a></li><li><a href=#练习-32>练习 32</a></li><li><a href=#练习-33>练习 33</a></li><li><a href=#练习-34>练习 34</a></li><li><a href=#练习-35>练习 35</a></li><li><a href=#练习-36>练习 36</a></li><li><a href=#练习-37>练习 37</a></li><li><a href=#练习-38>练习 38</a></li><li><a href=#练习-39>练习 39</a></li><li><a href=#练习-40>练习 40</a></li><li><a href=#练习-41>练习 41</a></li><li><a href=#练习-42>练习 42</a></li><li><a href=#练习-43>练习 43</a></li><li><a href=#练习-44>练习 44</a></li><li><a href=#练习-45>练习 45</a></li><li><a href=#练习-46>练习 46</a></li><li><a href=#练习-47>练习 47</a></li><li><a href=#练习-48>练习 48</a></li><li><a href=#练习-49>练习 49</a></li><li><a href=#练习-50>练习 50</a></li><li><a href=#练习-51>练习 51</a></li><li><a href=#练习-52>练习 52</a></li><li><a href=#练习-53>练习 53</a></li><li><a href=#练习-54>练习 54</a></li><li><a href=#练习-55>练习 55</a></li><li><a href=#练习-56>练习 56</a></li><li><a href=#练习-57>练习 57</a></li><li><a href=#练习-58>练习 58</a></li><li><a href=#练习-59>练习 59</a></li><li><a href=#练习-60>练习 60</a></li><li><a href=#练习-61>练习 61</a></li><li><a href=#练习-62>练习 62</a></li><li><a href=#练习-63>练习 63</a></li><li><a href=#练习-64>练习 64</a></li><li><a href=#练习-65>练习 65</a></li><li><a href=#练习-66>练习 66</a></li><li><a href=#练习-67>练习 67</a></li><li><a href=#练习-68>练习 68</a></li><li><a href=#练习-69>练习 69</a></li><li><a href=#练习-70>练习 70</a></li><li><a href=#练习-71>练习 71</a></li><li><a href=#练习-72>练习 72</a></li><li><a href=#练习-73>练习 73</a></li><li><a href=#练习-74>练习 74</a></li><li><a href=#练习-75>练习 75</a></li><li><a href=#练习-76>练习 76</a></li><li><a href=#练习-77>练习 77</a></li><li><a href=#练习-78>练习 78</a></li><li><a href=#练习-79>练习 79</a></li><li><a href=#练习-80>练习 80</a></li><li><a href=#练习-81>练习 81</a></li><li><a href=#练习-82>练习 82</a></li><li><a href=#练习-83>练习 83</a></li><li><a href=#练习-84>练习 84</a></li><li><a href=#练习-85>练习 85</a></li><li><a href=#练习-86>练习 86</a></li><li><a href=#练习-87>练习 87</a></li><li><a href=#练习-88>练习 88</a></li><li><a href=#练习-89>练习 89</a></li><li><a href=#练习-90>练习 90</a></li><li><a href=#练习-91>练习 91</a></li><li><a href=#练习-92>练习 92</a></li></ul></li></ul></li></ul></nav></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author site-overview-item animated" itemprop=author itemscope itemtype=http://schema.org/Person><img class=site-author-image itemprop=image alt=Baitian src=/imgs/avatar.webp><p class=site-author-name itemprop=name>Baitian</p><div class=site-description itemprop=description>佛系写博客</div></div><div class="site-state-wrap site-overview-item animated"><nav class=site-state><div class="site-state-item site-state-posts"><a href=/archives/><span class=site-state-item-count>7</span>
<span class=site-state-item-name>日志</span></a></div><div class="site-state-item site-state-categories"><a href=/categories/><span class=site-state-item-count>3</span>
<span class=site-state-item-name>分类</span></a></div><div class="site-state-item site-state-tags"><a href=/tags/><span class=site-state-item-count>10</span>
<span class=site-state-item-name>标签</span></a></div></nav></div><div class="links-of-social site-overview-item animated"><span class=links-of-social-item><a href=https://github.com/baitian752 title="Github → https://github.com/baitian752" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-github fa-fw hvr-icon"></i>Github</a></span></div><div class="cc-license animated" itemprop=license><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh class=cc-opacity rel=noopener target=_blank title=共享知识><img src=/imgs/cc/big/by_nc_sa.svg alt=共享知识></a></div><div class="links-of-blogroll site-overview-item animated"><div class=links-of-blogroll-title><i class="fa fa-globe fa-fw"></i>友情链接</div><ul class=links-of-blogroll-list><li class=links-of-blogroll-item><a href=https://github.com/hugo-next/hugo-theme-next title=https://github.com/hugo-next/hugo-theme-next target=_blank>Hugo-NexT</a></li></ul></div></div></div></div></aside><div class=sidebar-dimmer></div></header><div class=back-to-top role=button aria-label=返回顶部><i class="fa fa-arrow-up"></i>
<span>0%</span></div><div class=reading-progress-bar></div><noscript><div class=noscript-warning>Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner post posts-expand"><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content lang><link itemprop=mainEntityOfPage href=/post/sicp/learn-sicp-ch2/><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content="/imgs/avatar.webp"><meta itemprop=name content="Baitian"></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="Baitian"><meta itemprop=description content="佛系写博客"></span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="Learn SICP Chapter 2"><meta itemprop=description content="现在到了数学抽象中最关键的一步：让我们忘记这些符号所表示的对象。……（数学家）不应在这里停步，有许多操作可以应用于这些符号，而根本不必考虑它"></span><header class=post-header><h1 class=post-title itemprop="name headline">Learn SICP Chapter 2</h1><div class=post-meta-container><div class=post-meta-items><span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-calendar"></i></span>
<span class=post-meta-item-text>发表于：</span>
<time title="发表于：2019-10-08 00:00:00 +0800 +0800" itemprop="dateCreated datePublished" datetime="2019-10-08 00:00:00 +0800 +0800">2019-10-08</time></span>
<span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-folder-open"></i></span>
<span class=post-meta-item-text>分类于：</span>
<span itemprop=about itemscope itemtype=http://schema.org/Thing><a href=/categories/learn itemprop=url rel=index><span itemprop=name>Learn</span></a></span></span></div><div class=post-meta-items><span class=post-meta-item title=字数><span class=post-meta-item-icon><i class="far fa-file-word"></i></span>
<span class=post-meta-item-text>字数：</span><span>32033</span></span>
<span class=post-meta-item title=阅读><span class=post-meta-item-icon><i class="far fa-clock"></i></span>
<span class=post-meta-item-text>阅读：&ap;</span>
<span>64分钟</span></span></div></div></header><div class=post-body itemprop=articleBody><p><em>现在到了数学抽象中最关键的一步：让我们忘记这些符号所表示的对象。……（数学家）不应在这里停步，有许多操作可以应用于这些符号，而根本不必考虑它们到底代表着什么东西。</em></p><div style=text-align:right>Hermann Weyl, <strong>The Mathematical Way of Thinking</strong><br>（思维的数学方式）</div><h3 id=练习-1>练习 1</h3><p>请定义出 <code>make-rat</code> 的一个更好的版本，使之可以正确处理正数和负数。当有理数为正时，<code>make-rat</code> 应当将其规范化，使它的分子和分母都是正的。如果有理数为负，那么就应只让分子为负。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">47
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">48
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">49
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">50
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">51
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">52
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">53
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">54
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">55
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">56
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">57
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">58
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">59
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">60
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">61
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">62
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">63
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">64
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">65
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">66
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">67
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">68
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">69
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">70
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">71
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">72
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">73
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">74
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">75
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">76
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">77
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">78
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#f92672>#</span>lang sicp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(gcd m n)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>if </span>(= m <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>      n
</span></span><span style=display:flex><span>      (<span style=color:#66d9ef>if </span>(= n <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>          m
</span></span><span style=display:flex><span>          (<span style=color:#66d9ef>if </span>(&gt; m n)
</span></span><span style=display:flex><span>              (gcd (- m n) n)
</span></span><span style=display:flex><span>              (gcd m (- n m))))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>make-rat</span> n d)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>if </span>(= d <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>      (<span style=color:#a6e22e>error</span> <span style=color:#e6db74>&#34;Denom cannot be 0&#34;</span>)
</span></span><span style=display:flex><span>      (<span style=color:#66d9ef>if </span>(= n <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>          (cons <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>          (<span style=color:#66d9ef>if </span>(<span style=color:#66d9ef>and </span>(&lt; n <span style=color:#ae81ff>0</span>) (&lt; d <span style=color:#ae81ff>0</span>))
</span></span><span style=display:flex><span>              (<span style=color:#a6e22e>make-rat</span> (- n) (- d))
</span></span><span style=display:flex><span>              (<span style=color:#66d9ef>if </span>(<span style=color:#66d9ef>and </span>(&lt; n <span style=color:#ae81ff>0</span>) (&gt; d <span style=color:#ae81ff>0</span>))
</span></span><span style=display:flex><span>                  (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>g</span> (gcd (- n) d)))
</span></span><span style=display:flex><span>                    (cons (/ n g) (/ d g)))
</span></span><span style=display:flex><span>                  (<span style=color:#66d9ef>if </span>(<span style=color:#66d9ef>and </span>(&gt; n <span style=color:#ae81ff>0</span>) (&gt; d <span style=color:#ae81ff>0</span>))
</span></span><span style=display:flex><span>                      (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>g</span> (gcd n d)))
</span></span><span style=display:flex><span>                        (cons (/ n g) (/ d g)))
</span></span><span style=display:flex><span>                      (cons (- n) (- d))))))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>number</span> x) (car x))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>denom</span> x) (cdr x))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>add-rat</span> x y)
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>make-rat</span> (+ (* (<span style=color:#a6e22e>number</span> x) (<span style=color:#a6e22e>denom</span> y))
</span></span><span style=display:flex><span>               (* (<span style=color:#a6e22e>number</span> y) (<span style=color:#a6e22e>denom</span> x)))
</span></span><span style=display:flex><span>            (* (<span style=color:#a6e22e>denom</span> x) (<span style=color:#a6e22e>denom</span> y))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>sub-rat</span> x y)
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>make-rat</span> (- (* (<span style=color:#a6e22e>number</span> x) (<span style=color:#a6e22e>denom</span> y))
</span></span><span style=display:flex><span>               (* (<span style=color:#a6e22e>number</span> y) (<span style=color:#a6e22e>denom</span> x)))
</span></span><span style=display:flex><span>            (* (<span style=color:#a6e22e>denom</span> x) (<span style=color:#a6e22e>denom</span> y))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>mul-rat</span> x y)
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>make-rat</span> (* (<span style=color:#a6e22e>number</span> x) (<span style=color:#a6e22e>number</span> y))
</span></span><span style=display:flex><span>            (* (<span style=color:#a6e22e>denom</span> x) (<span style=color:#a6e22e>denom</span> y))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>div-rat</span> x y)
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>make-rat</span> (* (<span style=color:#a6e22e>number</span> x) (<span style=color:#a6e22e>denom</span> y))
</span></span><span style=display:flex><span>            (* (<span style=color:#a6e22e>number</span> y) (<span style=color:#a6e22e>denom</span> x))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>equal-rat?</span> x y)
</span></span><span style=display:flex><span>  (= (* (<span style=color:#a6e22e>number</span> x) (<span style=color:#a6e22e>denom</span> y))
</span></span><span style=display:flex><span>     (* (<span style=color:#a6e22e>number</span> y) (<span style=color:#a6e22e>denom</span> x))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>print-rat</span> x)
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>newline</span>)
</span></span><span style=display:flex><span>  (display (<span style=color:#a6e22e>number</span> x))
</span></span><span style=display:flex><span>  (display <span style=color:#e6db74>&#34;/&#34;</span>)
</span></span><span style=display:flex><span>  (display (<span style=color:#a6e22e>denom</span> x)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (make-rat 2 0)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: Denom cannot be 0</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (print-rat (make-rat 2 4))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: 1/2</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (print-rat (make-rat -2 4))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: -1/2</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (print-rat (make-rat 2 -4))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: -2/4</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (print-rat (make-rat -2 -4))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: 1/2</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (print-rat (add-rat (make-rat 2 4) (make-rat 4 6)))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: 7/6</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (print-rat (sub-rat (make-rat 2 4) (make-rat 4 6)))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: -1/6</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (print-rat (mul-rat (make-rat 2 4) (make-rat 4 6)))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: 1/3</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (print-rat (div-rat (make-rat 2 4) (make-rat 4 6)))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: 3/4</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (equal-rat? (make-rat 32 -128) (make-rat -13 52))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: #t</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=练习-2>练习 2</h3><p>请考虑平面上线段的表示问题。一个线段用一对点表示，它们分别是线段的始点与终点，请定义构造函数 <code>make-segment</code> 和选择函数 <code>start-segment</code>、<code>end-segment</code>，它们基于点定义线段的表示。进而，一个点可以用数的序对表示，序对的两个成分分别表示点的 $x$ 坐标和 $y$ 坐标。请据此进一步给出构造函数 <code>make-point</code> 和选择函数 <code>x-point</code>、<code>y-point</code>，用它们定义出点的这种表示。最后，请基于所定义的构造函数和选择函数，定义出过程 <code>midpoint-segmant</code>，它以一个线段为参数，返回线段的中点（也就是那个坐标值两个端点的平均值的点）。为了试验这些过程，还需要定义一种打印点的方法：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>print-point</span> p)
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>newline</span>)
</span></span><span style=display:flex><span>  (display <span style=color:#e6db74>&#34;(&#34;</span>)
</span></span><span style=display:flex><span>  (display (<span style=color:#a6e22e>x-point</span> p))
</span></span><span style=display:flex><span>  (display <span style=color:#e6db74>&#34;,&#34;</span>)
</span></span><span style=display:flex><span>  (display (<span style=color:#a6e22e>y-point</span> p))
</span></span><span style=display:flex><span>  (display <span style=color:#e6db74>&#34;)&#34;</span>))
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#f92672>#</span>lang sicp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>print-point</span> p)
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>newline</span>)
</span></span><span style=display:flex><span>  (display <span style=color:#e6db74>&#34;(&#34;</span>)
</span></span><span style=display:flex><span>  (display (<span style=color:#a6e22e>x-point</span> p))
</span></span><span style=display:flex><span>  (display <span style=color:#e6db74>&#34;,&#34;</span>)
</span></span><span style=display:flex><span>  (display (<span style=color:#a6e22e>y-point</span> p))
</span></span><span style=display:flex><span>  (display <span style=color:#e6db74>&#34;)&#34;</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>make-point</span> x y)
</span></span><span style=display:flex><span>  (cons x y))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>x-point</span> p)
</span></span><span style=display:flex><span>  (car p))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>y-point</span> p)
</span></span><span style=display:flex><span>  (cdr p))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>make-segment</span> p q)
</span></span><span style=display:flex><span>  (cons p q))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>start-segment</span> s)
</span></span><span style=display:flex><span>  (car s))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>end-segment</span> s)
</span></span><span style=display:flex><span>  (cdr s))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>midpoint-segment</span> s)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>p</span> (<span style=color:#a6e22e>start-segment</span> s))
</span></span><span style=display:flex><span>        (<span style=color:#a6e22e>q</span> (<span style=color:#a6e22e>end-segment</span> s)))
</span></span><span style=display:flex><span>    (cons (/ (+ (<span style=color:#a6e22e>x-point</span> p) (<span style=color:#a6e22e>x-point</span> q)) <span style=color:#ae81ff>2</span>)
</span></span><span style=display:flex><span>          (/ (+ (<span style=color:#a6e22e>y-point</span> p) (<span style=color:#a6e22e>y-point</span> q)) <span style=color:#ae81ff>2</span>))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (define p (make-point 1 2))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (define q (make-point 3 4))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (print-point p)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: (1,2)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (define s (make-segment p q))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (define m (midpoint-segment s))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (print-point m)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: (2,3)</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=练习-3>练习 3</h3><p>请实现一种平面矩形的表示（提示：你有可能借用
<a href=#%e7%bb%83%e4%b9%a0-2 title="练习 2">练习 2</a> 的结果）。基于你的构造函数和选择函数定义几个过程，计算给定矩形的周长和面积等。现在请再为矩形实现另一种表示方式。你应该怎样设计系统，使之能提供适当的抽象屏蔽，使同一个周长或者面积过程对两种不同表示都能工作。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#f92672>#</span>lang sicp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>make-point</span> x y)
</span></span><span style=display:flex><span>  (cons x y))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>x-point</span> p)
</span></span><span style=display:flex><span>  (car p))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>y-point</span> p)
</span></span><span style=display:flex><span>  (cdr p))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>make-rect</span> origin angle width height)
</span></span><span style=display:flex><span>  (cons (cons origin angle) (cons width height)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>origin-rect</span> r)
</span></span><span style=display:flex><span>  (car (car r)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>angle-rect</span> r)
</span></span><span style=display:flex><span>  (cdr (car r)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>width-rect</span> r)
</span></span><span style=display:flex><span>  (car (cdr r)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>height-rect</span> r)
</span></span><span style=display:flex><span>  (cdr (cdr r)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>perimeter-rect</span> r)
</span></span><span style=display:flex><span>  (* <span style=color:#ae81ff>2</span> (+ (<span style=color:#a6e22e>width-rect</span> r)
</span></span><span style=display:flex><span>          (<span style=color:#a6e22e>height-rect</span> r))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>area-rect</span> r)
</span></span><span style=display:flex><span>  (* (<span style=color:#a6e22e>width-rect</span> r) (<span style=color:#a6e22e>height-rect</span> r)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (define r (make-rect (make-point 0 0) 1.57 2 3))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (perimeter-rect r)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: 10</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (area-rect r)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: 6</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">47
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">48
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">49
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">50
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">51
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">52
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">53
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">54
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#f92672>#</span>lang sicp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>make-point</span> x y)
</span></span><span style=display:flex><span>  (cons x y))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>x-point</span> p)
</span></span><span style=display:flex><span>  (car p))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>y-point</span> p)
</span></span><span style=display:flex><span>  (cdr p))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>distance-point</span> p q)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>sqr</span> x) (* x x))
</span></span><span style=display:flex><span>  (sqrt (+ (<span style=color:#a6e22e>sqr</span> (- (<span style=color:#a6e22e>x-point</span> p) (<span style=color:#a6e22e>x-point</span> q)))
</span></span><span style=display:flex><span>           (<span style=color:#a6e22e>sqr</span> (- (<span style=color:#a6e22e>y-point</span> p) (<span style=color:#a6e22e>y-point</span> q))))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>dot-product</span> v1 v2)
</span></span><span style=display:flex><span>  (+ (* (<span style=color:#a6e22e>x-point</span> v1) (<span style=color:#a6e22e>x-point</span> v2))
</span></span><span style=display:flex><span>     (* (<span style=color:#a6e22e>y-point</span> v1) (<span style=color:#a6e22e>y-point</span> v2))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>sub-vector</span> v1 v2)
</span></span><span style=display:flex><span>  (cons (- (car v1) (car v2))
</span></span><span style=display:flex><span>        (- (cdr v1) (cdr v2))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>make-rect</span> p1 p2 p3)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>d</span> (<span style=color:#a6e22e>distance-point</span> p2 p3)))
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>if </span>(<span style=color:#66d9ef>or </span>(&lt; d (<span style=color:#a6e22e>distance-point</span> p1 p2))
</span></span><span style=display:flex><span>            (&lt; d (<span style=color:#a6e22e>distance-point</span> p1 p3)))
</span></span><span style=display:flex><span>        (<span style=color:#a6e22e>error</span> <span style=color:#e6db74>&#34;Points should make a rectangle&#34;</span>)
</span></span><span style=display:flex><span>        (cons p1 (cons p2 p3)))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>width-rect</span> r)
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>distance-point</span> (car r)
</span></span><span style=display:flex><span>                  (car (cdr r))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>height-rect</span> r)
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>distance-point</span> (car r)
</span></span><span style=display:flex><span>                  (cdr (cdr r))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>perimeter-rect</span> r)
</span></span><span style=display:flex><span>  (* <span style=color:#ae81ff>2</span> (+ (<span style=color:#a6e22e>width-rect</span> r)
</span></span><span style=display:flex><span>          (<span style=color:#a6e22e>height-rect</span> r))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>area-rect</span> r)
</span></span><span style=display:flex><span>  (* (<span style=color:#a6e22e>width-rect</span> r) (<span style=color:#a6e22e>height-rect</span> r)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (define r (make-rect</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;               (make-point 0 0)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;               (make-point 2 0)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;               (make-point 0 3)))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt;&gt; (perimeter-rect r)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: 10</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (area-rect r)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: 6</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=练习-4>练习 4</h3><p>下面是序对的另一种过程性表示方法。请针对这一表述验证，对于任意的 <code>x</code> 和 <code>y</code>，<code>(car (cons x y))</code> 都将产生出 <code>x</code>。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(cons x y)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>m</span>) (<span style=color:#a6e22e>m</span> x y)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(car z)
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>z</span> (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>p</span> q) p)))
</span></span></code></pre></td></tr></table></div></div><p>对应的 <code>cdr</code> 应该如何定义？（提示：为了验证这一表示确实能行，请利用 1.1.5 节的代换模型。）</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>(car z)
</span></span><span style=display:flex><span>(<span style=color:#a6e22e>z</span> (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>p</span> q) p))
</span></span><span style=display:flex><span>((cons x y) (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>p</span> q) p))
</span></span><span style=display:flex><span>((<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>m</span>) (<span style=color:#a6e22e>m</span> x y)) (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>p</span> q) p))
</span></span><span style=display:flex><span>((<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>p</span> q) p) x y)
</span></span><span style=display:flex><span>x
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(cdr z)
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>z</span> (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>p</span> q) q)))
</span></span></code></pre></td></tr></table></div></div><h3 id=练习-5>练习 5</h3><p>请证明，如果将 $a$ 和 $b$ 的序对表示为乘积 $2^a 3^b$ 所对应的整数，我们就可以只用非负整数和算术运算表示序对。请给出对应的过程 <code>cons</code>、<code>car</code> 和 <code>cdr</code> 的定义。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#f92672>#</span>lang sicp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>pow</span> b n)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>iter</span> n r)
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>if </span>(= n <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>        r
</span></span><span style=display:flex><span>        (<span style=color:#a6e22e>iter</span> (- n <span style=color:#ae81ff>1</span>) (* b r))))
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>iter</span> n <span style=color:#ae81ff>1</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(cons x y)
</span></span><span style=display:flex><span>  (* (<span style=color:#a6e22e>pow</span> <span style=color:#ae81ff>2</span> x) (<span style=color:#a6e22e>pow</span> <span style=color:#ae81ff>3</span> y)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(car z)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>iter</span> x r)
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>if </span>(odd? x)
</span></span><span style=display:flex><span>        r
</span></span><span style=display:flex><span>        (<span style=color:#a6e22e>iter</span> (/ x <span style=color:#ae81ff>2</span>) (+ r <span style=color:#ae81ff>1</span>))))
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>iter</span> z <span style=color:#ae81ff>0</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(cdr z)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>get-odd</span> x)
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>if </span>(odd? x)
</span></span><span style=display:flex><span>        x
</span></span><span style=display:flex><span>        (<span style=color:#a6e22e>get-odd</span> (/ x <span style=color:#ae81ff>2</span>))))
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>iter</span> x r)
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>if </span>(= x <span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>        r
</span></span><span style=display:flex><span>        (<span style=color:#a6e22e>iter</span> (/ x <span style=color:#ae81ff>3</span>) (+ r <span style=color:#ae81ff>1</span>))))
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>iter</span> (<span style=color:#a6e22e>get-odd</span> z) <span style=color:#ae81ff>0</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (define z (cons 618 991))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (car z)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: 618</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (cdr z)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: 991</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=练习-6>练习 6</h3><p>如果觉得将序对表示为过程还不足以令人如雷灌顶，那么请考虑，在一个可以对过程做各种操作的语言里，我们完全可以没有数（至少在只考虑非负整数的情况下），将 $0$ 和加一操作实现为：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>(<span style=color:#66d9ef>define </span>zero (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>f</span>) (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>x</span>) x)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>add-1</span> n)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>f</span>) (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>x</span>) (<span style=color:#a6e22e>f</span> ((<span style=color:#a6e22e>n</span> f) x)))))
</span></span></code></pre></td></tr></table></div></div><p>这一表示形式称为 Church 计数名字来源于其发明人数理逻辑学家 Alonzo Church（丘奇），$\lambda$ 演算也是他发明的。</p><p>请直接定义 <code>one</code> 和 <code>two</code>（不用 <code>zero</code> 和 <code>add-1</code>）（提示：利用代换去求值（<code>add0-1</code> <code>zero</code>））。请给出加法过程 <code>+</code> 的一个直接定义（不要通过反复应用 <code>add-1</code>）。</p><p>定义 <code>one</code>，直接代入，利用 <code>(add-1 zero)</code>：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#75715e>; (define one (add-1 zero))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>; (define one</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;   (lambda (f) (lambda (x) (f ((zero f) x)))))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>; (define one</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;   (lambda (f) (lambda (x) (f (((lambda (f) (lambda (x) x)) f) x)))))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>; (define one</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;   (lambda (f) (lambda (x) (f ((lambda (x) x) x)))))</span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>one
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>f</span>) (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>x</span>) (<span style=color:#a6e22e>f</span> x))))
</span></span></code></pre></td></tr></table></div></div><p>定义 <code>two</code>，<code>(add-1 one)</code>：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#75715e>; (define two (add-1 one))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>; (define two</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;   (lambda (f) (lambda (x) (f ((one f) x)))))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>; (define two</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;   (lambda (f) (lambda (x) (f (((lambda (f) (lambda (x) (f x))) f) x)))))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>; (define two</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;   (lambda (f) (lambda (x) (f ((lambda (x) (f x)) x)))))</span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>two
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>f</span>) (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>x</span>) (<span style=color:#a6e22e>f</span> (<span style=color:#a6e22e>f</span> x)))))
</span></span></code></pre></td></tr></table></div></div><p><code>n</code> 的定义为 <code>(add-1 n-1)</code>：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#75715e>; (define n</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;   (lambda (f) (lambda (x) (f ((n-1 f) x)))))</span>
</span></span></code></pre></td></tr></table></div></div><p><code>add-2</code> 的定义为 <code>(add-1 (add-1 n))</code>：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#75715e>; (define (add-2 n)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;   (add-1 (add-1 n)))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>; (define (add-2 n)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;   (add-1 (lambda (f) (lambda (x) (f ((n f) x))))))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>; (define (add-2 n)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;   (lambda (f) (lambda (x) (f (((lambda (f) (lambda (x) (f ((n f) x)))) f) x)))))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>; (define (add-2 n)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;   (lambda (f) (lambda (x) (f ((lambda (x) (f ((n f) x))) x)))))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>; (define (add-2 n)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;   (lambda (f) (lambda (x) (f (f ((n f) x))))))</span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>add-2</span> n)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>f</span>) (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>x</span>) ((<span style=color:#a6e22e>two</span> f) ((<span style=color:#a6e22e>n</span> f) x)))))
</span></span></code></pre></td></tr></table></div></div><p>假定 <code>add-m-1</code> 的定义为：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#75715e>; (define (add-m-1 n)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;   (lambda (f) (lambda (x) ((m-1 f) ((n f) x)))))</span>
</span></span></code></pre></td></tr></table></div></div><p><code>add-m</code> 的定义为 <code>(add-1 (add-m-1 n))</code>：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#75715e>; (define (add-m n)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;   (add-1 (add-m-1 n)))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>; (define (add-m n)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;   (add-1 (lambda (f) (lambda (x) ((m-1 f) ((n f) x))))))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>; (define (add-m n)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;   (lambda (f) (lambda (x) (f (((lambda (f) (lambda (x) ((m-1 f) ((n f) x)))) f) x)))))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>; (define (add-m n)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;   (lambda (f) (lambda (x) (f ((lambda (x) ((m-1 f) ((n f) x))) x)))))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>; (define (add-m n)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;   (lambda (f) (lambda (x) (f ((m-1 f) ((n f) x))))))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>; (define (add-m n)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;   (lambda (f) (lambda (x) ((m f) ((n f) x)))))</span>
</span></span></code></pre></td></tr></table></div></div><p><code>+</code> 的定义为：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(+ m n)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>f</span>) (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>x</span>) ((<span style=color:#a6e22e>m</span> f) ((<span style=color:#a6e22e>n</span> f) x)))))
</span></span></code></pre></td></tr></table></div></div><h3 id=练习-7>练习 7</h3><p>Alyssa 的程序是不完整的，因为她还没有确定区间抽象的实现。这里是区间构造符的定义：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>make-interval</span> a b) (cons a b))
</span></span></code></pre></td></tr></table></div></div><p>请定义选择符 <code>upper-bound</code> 和 <code>lower-bound</code>，完成这一实现。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#f92672>#</span>lang sicp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>make-interval</span> a b) (cons a b))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>upper-bound</span> i)
</span></span><span style=display:flex><span>  (max (car i) (cdr i)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>lower-bound</span> i)
</span></span><span style=display:flex><span>  (min (car i) (cdr i)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (define i (make-interval 2 3))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (upper-bound i)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: 3</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (lower-bound i)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: 2</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (define i2 (make-interval 2 -3))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (upper-bound i2)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: 2</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (lower-bound i2)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: -3</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=练习-8>练习 8</h3><p>通过类似于 Alyssa 的推理，说明两个区间的差应该怎样计算。请定义出相应的减法过程 <code>sub-interval</code>。</p><p>把减去区间的两个端点取相反数构造新区间，然后通过加法实现减法。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#f92672>#</span>lang sicp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>make-interval</span> a b) (cons a b))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>upper-bound</span> i)
</span></span><span style=display:flex><span>  (max (car i) (cdr i)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>lower-bound</span> i)
</span></span><span style=display:flex><span>  (min (car i) (cdr i)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>add-interval</span> x y)
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>make-interval</span> (+ (<span style=color:#a6e22e>lower-bound</span> x) (<span style=color:#a6e22e>lower-bound</span> y))
</span></span><span style=display:flex><span>                 (+ (<span style=color:#a6e22e>upper-bound</span> x) (<span style=color:#a6e22e>upper-bound</span> y))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>inv-interval</span> i)
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>make-interval</span> (- (<span style=color:#a6e22e>lower-bound</span> i))
</span></span><span style=display:flex><span>                 (- (<span style=color:#a6e22e>upper-bound</span> i))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>sub-interval</span> x y)
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>add-interval</span> x (<span style=color:#a6e22e>inv-interval</span> y)))
</span></span></code></pre></td></tr></table></div></div><h3 id=练习-9>练习 9</h3><p>区间的宽度就是其上界和下界之差的一半。区间宽度是有关区间所描述的相应数值的非确定性的一种度量。对于某些算术运算，两个区间的组合结果的宽度就是参数区间的宽度的函数，而对其他运算，组合区间的宽度则不是参数区间宽度的函数。证明两个区间的和（与差）的宽度就是被加（或减）的区间的宽度的函数。举例说明，对于乘和除而言，情况并非如此。</p><p>说明：</p><ul><li>$I$ 表示区间</li><li>$u(I)$ 表示 $I$ 的上界</li><li>$l(I)$ 表示 $I$ 的下界</li><li>$w(I)$ 表示 $I$ 的宽度</li><li>$+, -, \times, /$ 可用于区间</li></ul><p>$w(I)$ 的定义如下：</p><p>$$
w(I) = \frac{u(I) - l(I)}{2}
$$</p><p>对于加法：</p><p>$$
u(I_1 + I_2) = u(I_1) + u(I_2)
$$</p><p>$$
l(I_1 + I_2) = l(I_1) + l(I_2)
$$</p><p>因此：</p><p>$$
\begin{aligned}
w(I_1 + I_2) &= \frac{u(I_1 + I_2) - l(I_1 + I_2)}{2} \\
&= \frac{u(I_1) - l(I_1) + u(I_2) - l(I_2)}{2} \\
&= w(I_1) + w(I_2)
\end{aligned}
$$</p><p>对于减法：</p><p>$$
\begin{aligned}
w(I_1 - I_2) &= w(I_1 + (-I_2)) \\
&= \frac{u(I_1 + (-I_2)) - l(I_1 + (-I_2))}{2} \\
&= \frac{u(I_1) - l(I_1) + u(-I_2) - l(-I_2)}{2} \\
&= w(I_1) + w(I_2)
\end{aligned}
$$</p><p>对于乘法，要证明不是被乘区间宽度的函数，只需证明被乘区间宽度确定时，乘积区间的宽度不定。</p><p>不妨取第一个区间为 $[0, 1]$, 第二个区间分别为 $[0, 1]$、$[1, 2]$,此时，乘积区间的宽度分别为 $0.5$、$1$，因此，乘积区间的宽度不是被乘区间宽度的函数。</p><p>对于除法，证明过程与乘法类似。</p><h3 id=练习-10>练习 10</h3><p>Ben Bitdiddle 是个专业程序员，他看了 Alyssa 工作后评论说，除以一个横跨 $0$ 的区间的意义不清楚。请修改 Alyssa 的代码，检查这种情况并在出现这一情况时报错。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#f92672>#</span>lang sicp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>make-interval</span> a b) (cons a b))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>upper-bound</span> i)
</span></span><span style=display:flex><span>  (max (car i) (cdr i)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>lower-bound</span> i)
</span></span><span style=display:flex><span>  (min (car i) (cdr i)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>mul-interval</span> x y)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>p1</span> (* (<span style=color:#a6e22e>lower-bound</span> x) (<span style=color:#a6e22e>lower-bound</span> y)))
</span></span><span style=display:flex><span>        (<span style=color:#a6e22e>p2</span> (* (<span style=color:#a6e22e>lower-bound</span> x) (<span style=color:#a6e22e>upper-bound</span> y)))
</span></span><span style=display:flex><span>        (<span style=color:#a6e22e>p3</span> (* (<span style=color:#a6e22e>upper-bound</span> x) (<span style=color:#a6e22e>upper-bound</span> y)))
</span></span><span style=display:flex><span>        (<span style=color:#a6e22e>p4</span> (* (<span style=color:#a6e22e>upper-bound</span> x) (<span style=color:#a6e22e>lower-bound</span> y))))
</span></span><span style=display:flex><span>    (<span style=color:#a6e22e>make-interval</span> (min p1 p2 p3 p4)
</span></span><span style=display:flex><span>                   (max p1 p2 p3 p4))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>div-interval</span> x y)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>if </span>(<span style=color:#66d9ef>and </span>(&gt; (<span style=color:#a6e22e>upper-bound</span> y) <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>           (&lt; (<span style=color:#a6e22e>lower-bound</span> y) <span style=color:#ae81ff>0</span>))
</span></span><span style=display:flex><span>      (<span style=color:#a6e22e>error</span> <span style=color:#e6db74>&#34;Not support interval cross 0 -- Div-Interval&#34;</span>)
</span></span><span style=display:flex><span>      (<span style=color:#a6e22e>mul-interval</span> x
</span></span><span style=display:flex><span>                    (<span style=color:#a6e22e>make-interval</span> (/ <span style=color:#ae81ff>1.0</span> (<span style=color:#a6e22e>upper-bound</span> y))
</span></span><span style=display:flex><span>                                   (/ <span style=color:#ae81ff>1.0</span> (<span style=color:#a6e22e>lower-bound</span> y))))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (define x (make-interval 1 2))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (define y (make-interval -1 1))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (div-interval x y)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: Not support interval cross 0 -- Div-Interval</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (define x2 (make-interval 1 2))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (define y2 (make-interval 3 4))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (div-interval x2 y2)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: (0.25 . 0.6666666666666666)</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=练习-11>练习 11</h3><p>在看了这些东西之后，Ben 又说出了下面这段有些神秘的话：“通过监测区间的端点，有可能将 <code>mul-interval</code> 分解为 9 中情况，每种情况中所需的乘法都不超过两次”。请根据 Ben 的建议重写这个过程。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#f92672>#</span>lang sicp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>make-interval</span> a b) (cons a b))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>upper-bound</span> i)
</span></span><span style=display:flex><span>  (max (car i) (cdr i)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>lower-bound</span> i)
</span></span><span style=display:flex><span>  (min (car i) (cdr i)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>mul-interval</span> x y)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>ux</span> (<span style=color:#a6e22e>upper-bound</span> x))
</span></span><span style=display:flex><span>        (<span style=color:#a6e22e>lx</span> (<span style=color:#a6e22e>lower-bound</span> x))
</span></span><span style=display:flex><span>        (<span style=color:#a6e22e>uy</span> (<span style=color:#a6e22e>upper-bound</span> y))
</span></span><span style=display:flex><span>        (<span style=color:#a6e22e>ly</span> (<span style=color:#a6e22e>lower-bound</span> y)))
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>if </span>(&lt;= ux <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>        (<span style=color:#66d9ef>cond </span>((&lt;= uy <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>               (<span style=color:#a6e22e>make-interval</span> (* lx ly) (* ux uy)))
</span></span><span style=display:flex><span>              ((&gt;= ly <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>               (<span style=color:#a6e22e>make-interval</span> (* lx uy) (* ux ly)))
</span></span><span style=display:flex><span>              (<span style=color:#a6e22e>else</span>
</span></span><span style=display:flex><span>               (<span style=color:#a6e22e>make-interval</span> (* lx uy) (* lx ly))))
</span></span><span style=display:flex><span>        (<span style=color:#66d9ef>if </span>(&gt;= lx <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>            (<span style=color:#66d9ef>cond </span>((&lt;= uy <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>                   (<span style=color:#a6e22e>make-interval</span> (* lx uy) (* ux ly)))
</span></span><span style=display:flex><span>                  ((&gt;= ly <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>                   (<span style=color:#a6e22e>make-interval</span> (* lx ly) (* ux uy)))
</span></span><span style=display:flex><span>                  (<span style=color:#a6e22e>else</span>
</span></span><span style=display:flex><span>                   (<span style=color:#a6e22e>make-interval</span> (* ux ly) (* ux uy))))
</span></span><span style=display:flex><span>            (<span style=color:#66d9ef>cond </span>((&lt;= uy <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>                   (<span style=color:#a6e22e>make-interval</span> (* lx ly) (* ux ly)))
</span></span><span style=display:flex><span>                  ((&gt;= ly <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>                   (<span style=color:#a6e22e>make-interval</span> (* lx uy) (* ux uy)))
</span></span><span style=display:flex><span>                  (<span style=color:#a6e22e>else</span>
</span></span><span style=display:flex><span>                   (<span style=color:#a6e22e>make-interval</span> (max (* lx ly) (* ux uy))
</span></span><span style=display:flex><span>                                  (min (* lx uy) (* ux ly)))))))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (define x (make-interval 1 2))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (define y (make-interval -1 1))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (mul-interval x y)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: (-2 . 2)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (define x2 (make-interval 1 2))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (define y2 (make-interval 3 4))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (mul-interval x2 y2)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: (3 . 8)</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=练习-12>练习 12</h3><p>请定义一个构造函数 <code>make-center-percent</code>，它以一个中心点和一个百分比为参数，产生出所需要的区间。你还需要定义选择函数 <code>percent</code>，通过它可以得到给定区间的百分数误差，选择函数 <code>center</code> 与前面定义的一样。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#f92672>#</span>lang sicp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>make-interval</span> a b) (cons a b))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>upper-bound</span> i)
</span></span><span style=display:flex><span>  (max (car i) (cdr i)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>lower-bound</span> i)
</span></span><span style=display:flex><span>  (min (car i) (cdr i)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>center</span> i)
</span></span><span style=display:flex><span>  (/ (+ (<span style=color:#a6e22e>lower-bound</span> i) (<span style=color:#a6e22e>upper-bound</span> i)) <span style=color:#ae81ff>2</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>width</span> i)
</span></span><span style=display:flex><span>  (/ (- (<span style=color:#a6e22e>upper-bound</span> i) (<span style=color:#a6e22e>lower-bound</span> i)) <span style=color:#ae81ff>2</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>make-center-percent</span> c p)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>w</span> (* c p)))
</span></span><span style=display:flex><span>    (<span style=color:#a6e22e>make-interval</span> (- c w) (+ c w))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>percent</span> i)
</span></span><span style=display:flex><span>  (/ (<span style=color:#a6e22e>width</span> i) (<span style=color:#a6e22e>center</span> i)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (define i (make-center-percent 2 0.1))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; i</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: (1.8 . 2.2)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (center i)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: 2.0</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (width i)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: 0.2</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (percent i)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: 0.1</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=练习-13>练习 13</h3><p>请证明，在误差为很小的百分数的条件下，存在着一个简单公式，利用它可以从两个被乘区间的误差算出乘积的百分数误差值。你可以假定所有的数为正，以简化这一问题。</p><p>假设所有的数为正，$c_1, c_2, w_1, w_2, p_1, p_2$ 分别为两个被乘区间的中点、宽度、百分比误差，$l, u, w, c$ 分别为乘积区间的下界、上界、宽度、中点，则</p><p>$$
l = (c_1 - w_1)(c_2 - w_2)
$$</p><p>$$
u = (c_1 + w_1)(c_2 + w_2)
$$</p><p>$$
w = \frac{u - l}{2}
$$</p><p>$$
c = \frac{u + l}{2}
$$</p><p>百分比误差：</p><p>$$
\begin{aligned}
p &= \frac{w}{c} \\
&= \frac{u - l}{u + l} \\
&= \frac{c_1w_2 + c_2w_1}{c_1c_2 + w_1w_2} \\
&= \frac{p_1 + p_2}{p_1p_2 + 1} \\
&\approx p_1 + p_2 \quad (p_1 \ll 1, p_2 \ll 1)
\end{aligned}
$$</p><h3 id=练习-14>练习 14</h3><p>请确认 Lem 是对的。请你用各种不同的算术表达式来检查这一系统的行为。请做出两个区间 $A$ 和 $B$，并用它们计算表达式 $A/A$ 和 $B/B$。如果所用区间的宽度相对于中心值取很小百分数，你将会得到更多的知识。请检查对于中心 &mdash; 百分比形式（见
<a href=#%e7%bb%83%e4%b9%a0-12 title="练习 12">练习 12
</a>）进行计算结果。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">47
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">48
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">49
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">50
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">51
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">52
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">53
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">54
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">55
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">56
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">57
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">58
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">59
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">60
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">61
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">62
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">63
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">64
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">65
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">66
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">67
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">68
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">69
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">70
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">71
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">72
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#f92672>#</span>lang sicp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>make-interval</span> a b) (cons a b))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>upper-bound</span> i)
</span></span><span style=display:flex><span>  (max (car i) (cdr i)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>lower-bound</span> i)
</span></span><span style=display:flex><span>  (min (car i) (cdr i)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>add-interval</span> x y)
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>make-interval</span> (+ (<span style=color:#a6e22e>lower-bound</span> x) (<span style=color:#a6e22e>lower-bound</span> y))
</span></span><span style=display:flex><span>                 (+ (<span style=color:#a6e22e>upper-bound</span> x) (<span style=color:#a6e22e>upper-bound</span> y))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>mul-interval</span> x y)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>p1</span> (* (<span style=color:#a6e22e>lower-bound</span> x) (<span style=color:#a6e22e>lower-bound</span> y)))
</span></span><span style=display:flex><span>        (<span style=color:#a6e22e>p2</span> (* (<span style=color:#a6e22e>lower-bound</span> x) (<span style=color:#a6e22e>upper-bound</span> y)))
</span></span><span style=display:flex><span>        (<span style=color:#a6e22e>p3</span> (* (<span style=color:#a6e22e>upper-bound</span> x) (<span style=color:#a6e22e>upper-bound</span> y)))
</span></span><span style=display:flex><span>        (<span style=color:#a6e22e>p4</span> (* (<span style=color:#a6e22e>upper-bound</span> x) (<span style=color:#a6e22e>lower-bound</span> y))))
</span></span><span style=display:flex><span>    (<span style=color:#a6e22e>make-interval</span> (min p1 p2 p3 p4)
</span></span><span style=display:flex><span>                   (max p1 p2 p3 p4))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>div-interval</span> x y)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>if </span>(<span style=color:#66d9ef>and </span>(&gt; (<span style=color:#a6e22e>upper-bound</span> y) <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>           (&lt; (<span style=color:#a6e22e>lower-bound</span> y) <span style=color:#ae81ff>0</span>))
</span></span><span style=display:flex><span>      (<span style=color:#a6e22e>error</span> <span style=color:#e6db74>&#34;Not support interval cross 0 -- Div-Interval&#34;</span>)
</span></span><span style=display:flex><span>      (<span style=color:#a6e22e>mul-interval</span> x
</span></span><span style=display:flex><span>                    (<span style=color:#a6e22e>make-interval</span> (/ <span style=color:#ae81ff>1.0</span> (<span style=color:#a6e22e>upper-bound</span> y))
</span></span><span style=display:flex><span>                                   (/ <span style=color:#ae81ff>1.0</span> (<span style=color:#a6e22e>lower-bound</span> y))))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>center</span> i)
</span></span><span style=display:flex><span>  (/ (+ (<span style=color:#a6e22e>lower-bound</span> i) (<span style=color:#a6e22e>upper-bound</span> i)) <span style=color:#ae81ff>2</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>width</span> i)
</span></span><span style=display:flex><span>  (/ (- (<span style=color:#a6e22e>upper-bound</span> i) (<span style=color:#a6e22e>lower-bound</span> i)) <span style=color:#ae81ff>2</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>make-center-percent</span> c p)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>w</span> (* c p)))
</span></span><span style=display:flex><span>    (<span style=color:#a6e22e>make-interval</span> (- c w) (+ c w))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>percent</span> i)
</span></span><span style=display:flex><span>  (/ (<span style=color:#a6e22e>width</span> i) (<span style=color:#a6e22e>center</span> i)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>par1</span> r1 r2)
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>div-interval</span> (<span style=color:#a6e22e>mul-interval</span> r1 r2)
</span></span><span style=display:flex><span>                (<span style=color:#a6e22e>add-interval</span> r1 r2)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>par2</span> r1 r2)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>one</span> (<span style=color:#a6e22e>make-interval</span> <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>1</span>)))
</span></span><span style=display:flex><span>    (<span style=color:#a6e22e>div-interval</span> one
</span></span><span style=display:flex><span>                  (<span style=color:#a6e22e>add-interval</span> (<span style=color:#a6e22e>div-interval</span> one r1)
</span></span><span style=display:flex><span>                                (<span style=color:#a6e22e>div-interval</span> one r2)))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (define r1 (make-interval 0.9 1.1))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (define r2 (make-interval 0.9 1.1))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (par1 r1 r2)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: (0.3681818181818182 . 0.6722222222222224)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (par2 r1 r2)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: (0.44999999999999996 . 0.55)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (define A (make-center-percent 1.0 0.05))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (define B (make-center-percent 1.0 0.1))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (define q1 (div-interval A A))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (define q2 (div-interval A B))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (center q1)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: 1.0050125313283207</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (percent q1)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: 0.09975062344139651</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (center q2)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: 1.0151515151515151</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (percent q2)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: 0.14925373134328368</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=练习-15>练习 15</h3><p>另一用户 Eva Lu Ator 也注意到了由不同的等价代数表达式计算出的区间的差异。她说，如果一个公式可以写成一种形式，其中具有非准确性的变量不重复出现，那么 Alyssa 的系统产生出的区间的限界更紧一些。她说，因此，在计算并联电阻时，<code>par2</code> 是比 <code>par1</code>“更好的”程序。她说得对吗？</p><p>对，设 $R_1$ 的区间为 $[a_1, b_1] (a_1 \le b_1)$，$R_2$ 的区间为 $[a_2, b_2] (a_2 \le b_2)$，则 <code>par1</code> 的结果为：</p><p>$$
\left[\frac{a_1a_2}{b_1+b_2}, \frac{b_1b_2}{a_1+a_2}\right]
$$</p><p><code>par2</code> 的结果为：</p><p>$$
\left[\frac{a_1a_2}{a_1+a_2}, \frac{b_1b_2}{b_1+b_2}\right]
$$</p><p>显然，<code>par2</code> 计算所得的区间宽度不会大于 <code>par1</code>。</p><h3 id=练习-16>练习 16</h3><p>请给出一个一般性的解释：为什么等价的代数表达式可能导致不同计算结果？你能设计出一个区间算术包，使之没有这种缺陷吗？或者这件事情根本不可能做到？（警告：这个问题非常难。）</p><p>在
<a href=#%e7%bb%83%e4%b9%a0-14 title="练习 14">练习 14</a> 中，$A/A$ 的结果并不是 $1$，原因是对于给定的区间算术运算规则，没有考虑分子和分母的 $A$ 其实是同一个量，始终只能取一样的数值。再比如，将 $\frac{R_1R_2}{R_1 + R_2}$ 中的分母上的 $R_1, R_2$ 分别替换成与 $R_1, R_2$ 相同区间的 $R_3, R_4$，此时</p><p>$$
\frac{R_1R_2}{R_1 + R_2} = \frac{R_1R_2}{R_3 + R_4}
$$</p><p>而 $\frac{R_1R_2}{R_3 + R_4}$ 与 $\frac{1}{1/R_1 + 1/R_2}$ 不存在“等价”关系，便说明了问题。</p><p><em><strong>TODO</strong></em></p><h3 id=练习-17>练习 17</h3><p>请定义出过程 <code>last-pair</code>，它返回只包含给定（非空）表里最后一个元素的表：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>(<span style=color:#a6e22e>last-pair</span> (list <span style=color:#ae81ff>23</span> <span style=color:#ae81ff>72</span> <span style=color:#ae81ff>149</span> <span style=color:#ae81ff>34</span>))
</span></span><span style=display:flex><span>(<span style=color:#ae81ff>34</span>)
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#f92672>#</span>lang sicp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>last-pair</span> l)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>if </span>(null? (cdr l))
</span></span><span style=display:flex><span>      l
</span></span><span style=display:flex><span>      (<span style=color:#a6e22e>last-pair</span> (cdr l))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (last-pair (list 23 72 149 34))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: (34)</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=练习-18>练习 18</h3><p>请定义出过程 <code>reverse</code>，它以一个表为参数，返回的表中所包含的元素与参数表相同，但排列顺序与参数表相反：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>(reverse (list <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>4</span> <span style=color:#ae81ff>9</span> <span style=color:#ae81ff>16</span> <span style=color:#ae81ff>25</span>))
</span></span><span style=display:flex><span>(<span style=color:#ae81ff>25</span> <span style=color:#ae81ff>16</span> <span style=color:#ae81ff>9</span> <span style=color:#ae81ff>4</span> <span style=color:#ae81ff>1</span>)
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#f92672>#</span>lang sicp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(reverse l)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>reverse-iter</span> lst r)
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>if </span>(null? lst)
</span></span><span style=display:flex><span>        r
</span></span><span style=display:flex><span>        (<span style=color:#a6e22e>reverse-iter</span> (cdr lst) (cons (car lst) r))))
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>reverse-iter</span> l nil))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (reverse (list 1 4 9 16 25))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: (25 16 9 4 1)</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=练习-19>练习 19</h3><p>请考虑 1.2.2 节的兑换零钱方式计数程序。如果能够轻而易举地改变程序里所用的兑换币种就更好了。譬如说，那样我们就能计算出 1 英镑的不同兑换方式的数目。在写前面那个程序时，有关币种的知识中有一部分出现在过程 <code>first-denomination</code> 里，另一部分出现在过程里 <code>count-change</code>（它知道有 5 种 U.S. 硬币）。如果能够用一个表来提供可用于兑换的硬币就更好了。</p><p>我们希望重写出过程 <code>cc</code>，使其第二个参数是一个可用硬币的币值表，而不是一个指定可用硬币种类的整数。而后我们就可以针对各种货币定义出一些表：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>(<span style=color:#66d9ef>define </span>us-coins (list <span style=color:#ae81ff>50</span> <span style=color:#ae81ff>25</span> <span style=color:#ae81ff>10</span> <span style=color:#ae81ff>5</span> <span style=color:#ae81ff>1</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>uk-coins (list <span style=color:#ae81ff>100</span> <span style=color:#ae81ff>50</span> <span style=color:#ae81ff>20</span> <span style=color:#ae81ff>10</span> <span style=color:#ae81ff>5</span> <span style=color:#ae81ff>2</span> <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>0.5</span>))
</span></span></code></pre></td></tr></table></div></div><p>然后我们就可以通过如下方式调用 <code>cc</code>：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>(<span style=color:#a6e22e>cc</span> <span style=color:#ae81ff>100</span> us-coins)
</span></span><span style=display:flex><span><span style=color:#ae81ff>292</span>
</span></span></code></pre></td></tr></table></div></div><p>为了做到这件事，我们需要对程序 <code>cc</code> 做一些修改。它仍然具有同样的形式，但将以不同的方式访问自己的第二个参数，如下面所示：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>cc</span> amount coin-values)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>cond </span>((= amount <span style=color:#ae81ff>0</span>) <span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>        ((<span style=color:#66d9ef>or </span>(&lt; amount <span style=color:#ae81ff>0</span>) (<span style=color:#a6e22e>no-more?</span> coin-values)) <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>        (<span style=color:#a6e22e>else</span>
</span></span><span style=display:flex><span>         (+ (<span style=color:#a6e22e>cc</span> amount
</span></span><span style=display:flex><span>                (<span style=color:#a6e22e>except-first-denomination</span> coin-values))
</span></span><span style=display:flex><span>            (<span style=color:#a6e22e>cc</span> (- amount
</span></span><span style=display:flex><span>                   (<span style=color:#a6e22e>first-denomination</span> coin-values))
</span></span><span style=display:flex><span>                coin-values)))))
</span></span></code></pre></td></tr></table></div></div><p>请基于表结构上的基本操作，定义出过程 <code>first-denomination</code>、<code>except-first-denomination</code> 和 <code>no-more?</code>。表 <code>coin-values</code> 的排列顺序会影响 <code>cc</code> 给出的回答吗？为什么？</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#f92672>#</span>lang sicp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>us-coins (list <span style=color:#ae81ff>50</span> <span style=color:#ae81ff>25</span> <span style=color:#ae81ff>10</span> <span style=color:#ae81ff>5</span> <span style=color:#ae81ff>1</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>uk-coins (list <span style=color:#ae81ff>100</span> <span style=color:#ae81ff>50</span> <span style=color:#ae81ff>20</span> <span style=color:#ae81ff>10</span> <span style=color:#ae81ff>5</span> <span style=color:#ae81ff>2</span> <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>0.5</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>cc</span> amount coin-values)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>cond </span>((= amount <span style=color:#ae81ff>0</span>) <span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>        ((<span style=color:#66d9ef>or </span>(&lt; amount <span style=color:#ae81ff>0</span>) (<span style=color:#a6e22e>no-more?</span> coin-values)) <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>        (<span style=color:#a6e22e>else</span>
</span></span><span style=display:flex><span>         (+ (<span style=color:#a6e22e>cc</span> amount
</span></span><span style=display:flex><span>                (<span style=color:#a6e22e>except-first-denomination</span> coin-values))
</span></span><span style=display:flex><span>            (<span style=color:#a6e22e>cc</span> (- amount
</span></span><span style=display:flex><span>                   (<span style=color:#a6e22e>first-denomination</span> coin-values))
</span></span><span style=display:flex><span>                coin-values)))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>except-first-denomination</span> coin-values)
</span></span><span style=display:flex><span>  (cdr coin-values))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>first-denomination</span> coin-values)
</span></span><span style=display:flex><span>  (car coin-values))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>no-more?</span> coin-values)
</span></span><span style=display:flex><span>  (null? coin-values))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (cc 100 us-coins)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: 292</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (cc 100 uk-coins)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: 104561</span>
</span></span></code></pre></td></tr></table></div></div><p>表 <code>coin-values</code> 的排列顺序不会影响 <code>cc</code> 给出的回答，因为 <code>cc</code> 会遍历给定 <code>coin-values</code> 中所有的可能兑换零钱方式。</p><h3 id=练习-20>练习 20</h3><p>过程 <code>+</code>、<code>*</code> 和 <code>list</code> 可以取任意个数的实际参数。定义这类过程的一种方式是采用一种带点尾部记法形式的 <code>define</code>。在一个过程定义中，如果在形式参数表的最后一个参数之前有一个点号，那就表明，当这一过程被实际调用时，前面各个形式参数（如果有的话）将以前面的各个实际参数为值，与平常一样。但最后一个形式参数将以所有剩下的实际参数的表为值。例如，假若我们定义了：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>f</span> x y <span style=color:#f92672>.</span> z) &lt;body&gt;)
</span></span></code></pre></td></tr></table></div></div><p>过程 <code>f</code> 就可以用两个以上的参数调用。如果求值：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>(<span style=color:#a6e22e>f</span> <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>2</span> <span style=color:#ae81ff>3</span> <span style=color:#ae81ff>4</span> <span style=color:#ae81ff>5</span> <span style=color:#ae81ff>6</span>)
</span></span></code></pre></td></tr></table></div></div><p>那么在 <code>f</code> 的体里， <code>x</code> 将是 $1$，<code>y</code> 将是 $2$，而 <code>z</code> 将是表 <code>(3 4 5 6)</code>。给了定义：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>g</span> <span style=color:#f92672>.</span> w) &lt;body&gt;)
</span></span></code></pre></td></tr></table></div></div><p>过程 <code>g</code> 可以用 0 个或多个参数调用。如果求值：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>(<span style=color:#a6e22e>g</span> <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>2</span> <span style=color:#ae81ff>3</span> <span style=color:#ae81ff>4</span> <span style=color:#ae81ff>5</span> <span style=color:#ae81ff>6</span>)
</span></span></code></pre></td></tr></table></div></div><p>那么在 <code>g</code> 的体里，<code>w</code> 将是表 <code>(1 2 3 4 5 6)</code>。</p><p>请采用这种记法形式写出过程 <code>same-parity</code>，它以一个或者多个整数为参数，返回所有与其第一个参数有着同样奇偶性的参数形成的表。例如：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>(<span style=color:#a6e22e>same-parity</span> <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>2</span> <span style=color:#ae81ff>3</span> <span style=color:#ae81ff>4</span> <span style=color:#ae81ff>5</span> <span style=color:#ae81ff>6</span> <span style=color:#ae81ff>7</span>)
</span></span><span style=display:flex><span>(<span style=color:#ae81ff>1</span> <span style=color:#ae81ff>3</span> <span style=color:#ae81ff>5</span> <span style=color:#ae81ff>7</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#a6e22e>same-parity</span> <span style=color:#ae81ff>2</span> <span style=color:#ae81ff>3</span> <span style=color:#ae81ff>4</span> <span style=color:#ae81ff>5</span> <span style=color:#ae81ff>6</span> <span style=color:#ae81ff>7</span>)
</span></span><span style=display:flex><span>(<span style=color:#ae81ff>2</span> <span style=color:#ae81ff>4</span> <span style=color:#ae81ff>6</span>)
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#f92672>#</span>lang sicp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(reverse l)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>reverse-iter</span> lst r)
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>if </span>(null? lst)
</span></span><span style=display:flex><span>        r
</span></span><span style=display:flex><span>        (<span style=color:#a6e22e>reverse-iter</span> (cdr lst) (cons (car lst) r))))
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>reverse-iter</span> l nil))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>same-parity</span> k <span style=color:#f92672>.</span> n)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>iter</span> n r)
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>if </span>(null? n)
</span></span><span style=display:flex><span>        r
</span></span><span style=display:flex><span>        (<span style=color:#a6e22e>iter</span> (cdr n)
</span></span><span style=display:flex><span>              (<span style=color:#66d9ef>if </span>(<span style=color:#66d9ef>or </span>(<span style=color:#66d9ef>and </span>(even? k) (even? (car n)))
</span></span><span style=display:flex><span>                      (<span style=color:#66d9ef>and </span>(odd? k) (odd? (car n))))
</span></span><span style=display:flex><span>                  (cons (car n) r)
</span></span><span style=display:flex><span>                  r))))
</span></span><span style=display:flex><span>  (reverse (<span style=color:#a6e22e>iter</span> n (list k))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (same-parity 1 2 3 4 5 6 7)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: (1 3 5 7)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (same-parity 2 3 4 5 6 7)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: (2 4 6)</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=练习-21>练习 21</h3><p>过程 <code>square-list</code> 以一个数值表为参数，返回每个数的平方构成的表：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>(<span style=color:#a6e22e>square-list</span> (list <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>2</span> <span style=color:#ae81ff>3</span> <span style=color:#ae81ff>4</span>))
</span></span><span style=display:flex><span>(<span style=color:#ae81ff>1</span> <span style=color:#ae81ff>4</span> <span style=color:#ae81ff>9</span> <span style=color:#ae81ff>16</span>)
</span></span></code></pre></td></tr></table></div></div><p>下面是 <code>square-list</code> 的两个定义，请填充其中缺少的表达式以完成它们：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>square-list</span> items)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>if </span>(null? items)
</span></span><span style=display:flex><span>      nil
</span></span><span style=display:flex><span>      (cons &lt;??&gt; &lt;??&gt;)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>square-list</span> items)
</span></span><span style=display:flex><span>  (map &lt;??&gt; &lt;??&gt;))
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#f92672>#</span>lang sicp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>square</span> x) (* x x))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>square-list</span> items)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>if </span>(null? items)
</span></span><span style=display:flex><span>      nil
</span></span><span style=display:flex><span>      (cons (<span style=color:#a6e22e>square</span> (car items))
</span></span><span style=display:flex><span>            (<span style=color:#a6e22e>square-list</span> (cdr items)))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>square-list-2</span> items)
</span></span><span style=display:flex><span>  (map square items))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (square-list (list 1 2 3 4))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: (1 4 9 16)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (square-list-2 (list 1 2 3 4))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: (1 4 9 16)</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=练习-22>练习 22</h3><p>Louis Reasoner 试图重写
<a href=#%e7%bb%83%e4%b9%a0-21 title="练习 21">练习 21</a> 的第一个 <code>square-list</code> 过程，希望使它能生成一个迭代计算过程：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>square-list</span> items)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>iter</span> things answer)
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>if </span>(null? things)
</span></span><span style=display:flex><span>        answer
</span></span><span style=display:flex><span>        (<span style=color:#a6e22e>iter</span> (cdr things)
</span></span><span style=display:flex><span>              (cons (<span style=color:#a6e22e>square</span> (car things))
</span></span><span style=display:flex><span>                    answer))))
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>iter</span> items nil))
</span></span></code></pre></td></tr></table></div></div><p>但是很不幸，在按这种方式定义出的 <code>square-list</code> 产生出的结果表中，元素的顺序正好与我们所需要的相反。为什么？</p><p>Louis 又试着修正其程序，交换了 <code>cons</code> 的参数：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>square-list</span> items)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>iter</span> things answer)
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>if </span>(null? things)
</span></span><span style=display:flex><span>        answer
</span></span><span style=display:flex><span>        (<span style=color:#a6e22e>iter</span> (cdr things)
</span></span><span style=display:flex><span>              (cons answer
</span></span><span style=display:flex><span>                    (<span style=color:#a6e22e>square</span> (car things))))))
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>iter</span> items nil))
</span></span></code></pre></td></tr></table></div></div><p>但还是不行。请解释为什么。</p><p>前者是因为在用 <code>cons</code> 构造 list 的时候，是从最后一个元素开始往前面构造，因此顺序刚好相反。</p><p>后者不符合 <code>cons</code> 构造 list 的规则，<code>cons</code> 构造 list 的话，第一个参数为一个元素，第二个为一个 list（或者 <code>nil</code>）。</p><h3 id=练习-23>练习 23</h3><p>过程 <code>for-each</code> 与 <code>map</code> 类似，它以一个过程和一个元素表为参数，但它并不返回结果测表，只是将这一过程从左到右应用于各个元素，将过程应用于元素得到的值都丢掉不用。<code>for-each</code> 通常用于那些执行了某些动作的过程，如打印等。看下面例子：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>(for-each (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>x</span>) (<span style=color:#a6e22e>newline</span>) (display x))
</span></span><span style=display:flex><span>          (list <span style=color:#ae81ff>57</span> <span style=color:#ae81ff>321</span> <span style=color:#ae81ff>88</span>))
</span></span><span style=display:flex><span><span style=color:#ae81ff>57</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>321</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>88</span>
</span></span></code></pre></td></tr></table></div></div><p>由 <code>for-each</code> 的调用返回的值（上面没有显示）可以是某种任意的东西，例如逻辑值真。请给出一个 <code>for-each</code> 的实现。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#f92672>#</span>lang sicp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(for-each proc items)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>cond </span>((not (null? items))
</span></span><span style=display:flex><span>         (<span style=color:#a6e22e>proc</span> (car items))
</span></span><span style=display:flex><span>         (for-each proc (cdr items)))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (for-each (lambda (x) (newline) (display x))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt;           (list 57 321 88))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;:</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: 57</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: 321</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: 88</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=练习-24>练习 24</h3><p>假定现在要求值表达式 <code>(list 1 (list 2 (list 3 4)))</code>，请给出由解释器打印出的结果，给出与之对应的盒子指针结构，并将它解释为一棵树（参见图 2-6）。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>(<span style=color:#ae81ff>1</span> (<span style=color:#ae81ff>2</span> (<span style=color:#ae81ff>3</span> <span style=color:#ae81ff>4</span>)))
</span></span></code></pre></td></tr></table></div></div><img src=24-1.svg width=80% height=auto alt=24-1.svg>
<img src=24-2.svg width=50% height=auto alt=24-2.svg><h3 id=练习-25>练习 25</h3><p>给出能够从下面各表中取出 7 的 <code>car</code> 和 <code>cdr</code> 组合：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>(<span style=color:#ae81ff>1</span> <span style=color:#ae81ff>3</span> (<span style=color:#ae81ff>5</span> <span style=color:#ae81ff>7</span>) <span style=color:#ae81ff>9</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>((<span style=color:#ae81ff>7</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#ae81ff>1</span> (<span style=color:#ae81ff>2</span> (<span style=color:#ae81ff>3</span> (<span style=color:#ae81ff>4</span> (<span style=color:#ae81ff>5</span> (<span style=color:#ae81ff>6</span> <span style=color:#ae81ff>7</span>))))))
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#f92672>#</span>lang sicp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(car (cdr (car (cdr (cdr (list <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>3</span> (list <span style=color:#ae81ff>5</span> <span style=color:#ae81ff>7</span>) <span style=color:#ae81ff>9</span>))))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(car (car (list (list <span style=color:#ae81ff>7</span>))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(car (cdr (car (cdr (car (cdr (car (cdr (car (cdr (car (cdr (list <span style=color:#ae81ff>1</span> (list <span style=color:#ae81ff>2</span> (list <span style=color:#ae81ff>3</span> (list <span style=color:#ae81ff>4</span> (list <span style=color:#ae81ff>5</span> (list <span style=color:#ae81ff>6</span> <span style=color:#ae81ff>7</span>))))))))))))))))))
</span></span></code></pre></td></tr></table></div></div><h3 id=练习-26>练习 26</h3><p>假定已将 <code>x</code> 和 <code>y</code> 定义为如下的两个表：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>(<span style=color:#66d9ef>define </span>x (list <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>2</span> <span style=color:#ae81ff>3</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>y (list <span style=color:#ae81ff>4</span> <span style=color:#ae81ff>5</span> <span style=color:#ae81ff>6</span>))
</span></span></code></pre></td></tr></table></div></div><p>解释器对于下面各个表达式将打印出什么结果：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>(append x y)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(cons x y)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(list x y)
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>(<span style=color:#ae81ff>1</span> <span style=color:#ae81ff>2</span> <span style=color:#ae81ff>3</span> <span style=color:#ae81ff>4</span> <span style=color:#ae81ff>5</span> <span style=color:#ae81ff>6</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>((<span style=color:#ae81ff>1</span> <span style=color:#ae81ff>2</span> <span style=color:#ae81ff>3</span>) <span style=color:#ae81ff>4</span> <span style=color:#ae81ff>5</span> <span style=color:#ae81ff>6</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>((<span style=color:#ae81ff>1</span> <span style=color:#ae81ff>2</span> <span style=color:#ae81ff>3</span>) (<span style=color:#ae81ff>4</span> <span style=color:#ae81ff>5</span> <span style=color:#ae81ff>6</span>))
</span></span></code></pre></td></tr></table></div></div><h3 id=练习-27>练习 27</h3><p>请修改
<a href=#%e7%bb%83%e4%b9%a0-18 title="练习 18">练习 18</a> 中所做的 <code>reverse</code> 过程，得到一个 <code>deep-reverse</code> 过程。它以一个表为参数，返回另一个表作为值，结果表中的元素反过来，其中的子树也反转。例如：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>(<span style=color:#66d9ef>define </span>x (list <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>2</span>) (list <span style=color:#ae81ff>3</span> <span style=color:#ae81ff>4</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>x
</span></span><span style=display:flex><span>((<span style=color:#ae81ff>1</span> <span style=color:#ae81ff>2</span>) (<span style=color:#ae81ff>3</span> <span style=color:#ae81ff>4</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(reverse x)
</span></span><span style=display:flex><span>((<span style=color:#ae81ff>3</span> <span style=color:#ae81ff>4</span>) (<span style=color:#ae81ff>1</span> <span style=color:#ae81ff>2</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#a6e22e>deep-reverse</span> x)
</span></span><span style=display:flex><span>((<span style=color:#ae81ff>4</span> <span style=color:#ae81ff>3</span>) (<span style=color:#ae81ff>2</span> <span style=color:#ae81ff>1</span>))
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#f92672>#</span>lang sicp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>deep-reverse</span> l)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>iter</span> lst r)
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>cond </span>((null? lst) r)
</span></span><span style=display:flex><span>          ((pair? (car lst)) (<span style=color:#a6e22e>iter</span> (cdr lst) (cons (<span style=color:#a6e22e>iter</span> (car lst) nil) r)))
</span></span><span style=display:flex><span>          (<span style=color:#66d9ef>else </span>(<span style=color:#a6e22e>iter</span> (cdr lst) (cons (car lst) r)))))
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>iter</span> l nil))
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>x (list (list <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>2</span>) (list <span style=color:#ae81ff>3</span> <span style=color:#ae81ff>4</span>)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#a6e22e>deep-reverse</span> x)
</span></span></code></pre></td></tr></table></div></div><h3 id=练习-28>练习 28</h3><p>写一个过程 <code>fringe</code>，它以一个树（表示为表）为参数，返回一个表，表中的元素是这棵树的所有树叶，按照从左到右的顺序。例如：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>(<span style=color:#66d9ef>define </span>x (list (list <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>2</span>) (list <span style=color:#ae81ff>3</span> <span style=color:#ae81ff>4</span>)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#a6e22e>fringe</span> x)
</span></span><span style=display:flex><span>(<span style=color:#ae81ff>1</span> <span style=color:#ae81ff>2</span> <span style=color:#ae81ff>3</span> <span style=color:#ae81ff>4</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#a6e22e>fringe</span> (list x x))
</span></span><span style=display:flex><span>(<span style=color:#ae81ff>1</span> <span style=color:#ae81ff>2</span> <span style=color:#ae81ff>3</span> <span style=color:#ae81ff>4</span> <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>2</span> <span style=color:#ae81ff>3</span> <span style=color:#ae81ff>4</span>)
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#f92672>#</span>lang sicp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>fringe</span> l)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>iter</span> lst r)
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>cond </span>((null? lst) r)
</span></span><span style=display:flex><span>          ((pair? (car lst)) (append (<span style=color:#a6e22e>iter</span> (car lst) nil)
</span></span><span style=display:flex><span>                                     (<span style=color:#a6e22e>iter</span> (cdr lst) r)))
</span></span><span style=display:flex><span>          (<span style=color:#66d9ef>else </span>(<span style=color:#a6e22e>iter</span> (cdr lst) (append r (list (car lst)))))))
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>iter</span> l nil))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (define x (list (list 1 2) (list 3 4)))</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (fringe x)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: (1 2 3 4)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (fringe (list x x))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: (1 2 3 4 1 2 3 4)</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=练习-29>练习 29</h3><p>一个二叉活动体由两个分支组成，一个是左分支，另一个是右分支，每个分支是一个具有确定长度的杆，上面或者吊着一个重量，或者吊着另一个二叉活动体。我们可以用复合数据对象表示这种二叉活动体，将它通过其两个分支构造起来（例如，使用 <code>list</code>）：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>make-mobile</span> left right)
</span></span><span style=display:flex><span>  (list left right))
</span></span></code></pre></td></tr></table></div></div><p>分支可以从一个 <code>length</code>（它应该是一个数）再加上一个 <code>structure</code> 构造出来，这个 <code>structure</code> 或者是一个数（表示一个简单重量），或者是另一个活动体：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>make-branch</span> length structure)
</span></span><span style=display:flex><span>  (list length structure))
</span></span></code></pre></td></tr></table></div></div><p>a) 请写出相应的选择函数 <code>left-branch</code> 和 <code>right-branch</code>，它们分别返回活动体的两个分支。还有 <code>branch-length</code> 和 <code>branch-structure</code>，它们返回一个分支上的成分。</p><p>b) 用你的选择函数定义过程 <code>total-weight</code>，它返回一个活动体的总重量。</p><p>c) 一个活动体称为是平衡的，如果其左分支的力矩等于其右分支的力矩（也就是说，如果其左杆的长度乘以吊在杆上的重量，等于这个活动体右边的同样乘积），而且在其每个分支上吊着的子活动体也都平衡。请设计一个过程，它能检查一个活动体是否平衡。</p><p>d) 假定我们改变活动体的表示，采用下面构造方式：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>make-mobile</span> left right)
</span></span><span style=display:flex><span>  (cons left right))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>make-branch</span> length structure)
</span></span><span style=display:flex><span>  (cons length structure))
</span></span></code></pre></td></tr></table></div></div><p>你需要对自己的程序做多少修改，才能将它改为使用这种新表示？</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">47
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">48
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">49
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">50
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">51
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">52
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">53
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">54
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">55
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">56
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#f92672>#</span>lang sicp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>make-mobile</span> left right)
</span></span><span style=display:flex><span>  (list left right))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>make-branch</span> length structure)
</span></span><span style=display:flex><span>  (list length structure))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>left-branch</span> m)
</span></span><span style=display:flex><span>  (car m))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>right-branch</span> m)
</span></span><span style=display:flex><span>  (car (cdr m)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>branch-length</span> b)
</span></span><span style=display:flex><span>  (car b))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>branch-structure</span> b)
</span></span><span style=display:flex><span>  (car (cdr b)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>total-weight</span> m)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>if </span>(pair? m)
</span></span><span style=display:flex><span>      (+ (<span style=color:#a6e22e>total-weight</span> (<span style=color:#a6e22e>branch-structure</span> (<span style=color:#a6e22e>left-branch</span> m)))
</span></span><span style=display:flex><span>         (<span style=color:#a6e22e>total-weight</span> (<span style=color:#a6e22e>branch-structure</span> (<span style=color:#a6e22e>right-branch</span> m))))
</span></span><span style=display:flex><span>      m))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>mobile-balance?</span> m)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>if </span>(not (pair? m))
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>#t</span>
</span></span><span style=display:flex><span>      (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>lb</span> (<span style=color:#a6e22e>left-branch</span> m))
</span></span><span style=display:flex><span>            (<span style=color:#a6e22e>rb</span> (<span style=color:#a6e22e>right-branch</span> m)))
</span></span><span style=display:flex><span>        (<span style=color:#66d9ef>and </span>(<span style=color:#a6e22e>mobile-balance?</span> (<span style=color:#a6e22e>branch-structure</span> lb))
</span></span><span style=display:flex><span>             (<span style=color:#a6e22e>mobile-balance?</span> (<span style=color:#a6e22e>branch-structure</span> rb))
</span></span><span style=display:flex><span>             (= (* (<span style=color:#a6e22e>branch-length</span> lb)
</span></span><span style=display:flex><span>                   (<span style=color:#a6e22e>total-weight</span> (<span style=color:#a6e22e>branch-structure</span> lb)))
</span></span><span style=display:flex><span>                (* (<span style=color:#a6e22e>branch-length</span> rb)
</span></span><span style=display:flex><span>                   (<span style=color:#a6e22e>total-weight</span> (<span style=color:#a6e22e>branch-structure</span> rb))))))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (define m (make-mobile</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt;            (make-branch 30 10)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt;            (make-branch 10 (make-mobile (make-branch 10 20)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt;                                         (make-branch 20 10)))))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (total-weight m)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: 40</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (mobile-balance? m)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: #t</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (define m2 (make-mobile</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt;             (make-branch 20 (make-mobile (make-branch 20 10)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt;                                          (make-branch 10 30)))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt;             (make-branch 10 (make-mobile (make-branch 10 20)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt;                                          (make-branch 20 10)))))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (total-weight m2)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: 70</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (mobile-balance? m2)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: #f</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#f92672>#</span>lang sicp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>make-mobile</span> left right)
</span></span><span style=display:flex><span>  (cons left right))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>make-branch</span> length structure)
</span></span><span style=display:flex><span>  (cons length structure))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>left-branch</span> m)
</span></span><span style=display:flex><span>  (car m))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>right-branch</span> m)
</span></span><span style=display:flex><span>  (cdr m))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>branch-length</span> b)
</span></span><span style=display:flex><span>  (car b))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>branch-structure</span> b)
</span></span><span style=display:flex><span>  (cdr b))
</span></span></code></pre></td></tr></table></div></div><h3 id=练习-30>练习 30</h3><p>请定义一个与
<a href=#%e7%bb%83%e4%b9%a0-21 title="练习 21">练习 21</a> 中 <code>square-list</code> 过程类似的 <code>square-tree</code> 过程。也就是说，它应该具有下面的行为：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>(<span style=color:#a6e22e>square-tree</span>
</span></span><span style=display:flex><span> (list <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>       (list <span style=color:#ae81ff>2</span> (list <span style=color:#ae81ff>3</span> <span style=color:#ae81ff>4</span>) <span style=color:#ae81ff>5</span>)
</span></span><span style=display:flex><span>       (list <span style=color:#ae81ff>6</span> <span style=color:#ae81ff>7</span>)))
</span></span><span style=display:flex><span>(<span style=color:#ae81ff>1</span> (<span style=color:#ae81ff>4</span> (<span style=color:#ae81ff>9</span> <span style=color:#ae81ff>16</span>) <span style=color:#ae81ff>25</span>) (<span style=color:#ae81ff>36</span> <span style=color:#ae81ff>49</span>))
</span></span></code></pre></td></tr></table></div></div><p>请以两种方式定义 <code>square-tree</code>，直接定义（即不使用任何高阶函数），以及使用 <code>map</code> 和递归定义。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#f92672>#</span>lang sicp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>square-tree</span> tree)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>cond </span>((null? tree) nil)
</span></span><span style=display:flex><span>        ((not (pair? tree)) (* tree tree))
</span></span><span style=display:flex><span>        (<span style=color:#66d9ef>else </span>(cons (<span style=color:#a6e22e>square-tree</span> (car tree))
</span></span><span style=display:flex><span>                    (<span style=color:#a6e22e>square-tree</span> (cdr tree))))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>square-tree2</span> tree)
</span></span><span style=display:flex><span>  (map (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>sub-tree</span>)
</span></span><span style=display:flex><span>         (<span style=color:#66d9ef>if </span>(not (pair? sub-tree))
</span></span><span style=display:flex><span>             (* sub-tree sub-tree)
</span></span><span style=display:flex><span>             (<span style=color:#a6e22e>square-tree2</span> sub-tree)))
</span></span><span style=display:flex><span>       tree))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (square-tree</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt;  (list 1</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt;        (list 2 (list 3 4) 5)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt;        (list 6 7)))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: (1 (4 (9 16) 25) (36 49))</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (square-tree2</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt;  (list 1</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt;        (list 2 (list 3 4) 5)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt;        (list 6 7)))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: (1 (4 (9 16) 25) (36 49))</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=练习-31>练习 31</h3><p>将你在
<a href=#%e7%bb%83%e4%b9%a0-30 title="练习 30">练习 30</a> 做出的解答进一步抽象，做出一个过程，使它的性质保证能以下面形式定义 <code>square-tree</code>：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>square-tree</span> tree) (<span style=color:#a6e22e>tree-map</span> square tree))
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#f92672>#</span>lang sicp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>tree-map</span> proc tree)
</span></span><span style=display:flex><span>  (map (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>sub-tree</span>)
</span></span><span style=display:flex><span>         (<span style=color:#66d9ef>if </span>(not (pair? sub-tree))
</span></span><span style=display:flex><span>             (<span style=color:#a6e22e>proc</span> sub-tree)
</span></span><span style=display:flex><span>             (<span style=color:#a6e22e>tree-map</span> proc sub-tree)))
</span></span><span style=display:flex><span>       tree))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>square</span> x) (* x x))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>square-tree</span> tree) (<span style=color:#a6e22e>tree-map</span> square tree))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (square-tree</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt;  (list 1</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt;        (list 2 (list 3 4) 5)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt;        (list 6 7)))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: (1 (4 (9 16) 25) (36 49))</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=练习-32>练习 32</h3><p>我们可以将一个集合表示为一个元素互不相同的表，因此就可以将一个集合的所有子集表示为表的表。例如，假定集合为 <code>(1 2 3)</code>，它的所有子集的集合就是 <code>(() (3) (2) (2 3) (1) (1 3) (1 2) (1 2 3))</code>。请完成下面的过程定义，它生成出一个集合的所有子集的集合。请解释它为什么能完成这一工作。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>subsets</span> s)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>if </span>(null? s)
</span></span><span style=display:flex><span>      (list nil)
</span></span><span style=display:flex><span>      (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>rest</span> (<span style=color:#a6e22e>subsets</span> (cdr s))))
</span></span><span style=display:flex><span>        (append rest (map &lt;??&gt; rest)))))
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#f92672>#</span>lang sicp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>subsets</span> s)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>if </span>(null? s)
</span></span><span style=display:flex><span>      (list nil)
</span></span><span style=display:flex><span>      (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>rest</span> (<span style=color:#a6e22e>subsets</span> (cdr s))))
</span></span><span style=display:flex><span>        (append rest (<span style=color:#a6e22e>map</span>
</span></span><span style=display:flex><span>                      (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>e</span>) (cons (car s) e))
</span></span><span style=display:flex><span>                      rest)))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (subsets (list 1 2 3))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: (() (3) (2) (2 3) (1) (1 3) (1 2) (1 2 3))</span>
</span></span></code></pre></td></tr></table></div></div><p>首先，<code>rest</code> 表示集合 <code>s</code> 不含 <code>(car s)</code> 的所有子集，而含 <code>(car s)</code> 的子集刚好是 <code>rest</code> 中每个集合添加元素 <code>(car s)</code>，将二者拼接，便得到 <code>s</code> 的所有子集。</p><h3 id=练习-33>练习 33</h3><p>请填充下面缺失的表达式，完成将一些基本的表操作看作累积的定义：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(map p sequence)
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>accumulate</span> (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>x</span> y) &lt;??&gt;) nil sequence))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(append seq1 seq2)
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>accumulate</span> cons &lt;??&gt; &lt;??&gt;))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(length sequence)
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>accumulate</span> &lt;??&gt; <span style=color:#ae81ff>0</span> sequence))
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#f92672>#</span>lang sicp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>accumulate</span> op initial sequence)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>if </span>(null? sequence)
</span></span><span style=display:flex><span>      initial
</span></span><span style=display:flex><span>      (<span style=color:#a6e22e>op</span> (car sequence)
</span></span><span style=display:flex><span>          (<span style=color:#a6e22e>accumulate</span> op initial (cdr sequence)))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(map p sequence)
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>accumulate</span> (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>x</span> y) (cons (<span style=color:#a6e22e>p</span> x) y)) nil sequence))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(append seq1 seq2)
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>accumulate</span> cons seq2 seq1))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(length sequence)
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>accumulate</span> (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>x</span> y) (+ <span style=color:#ae81ff>1</span> y)) <span style=color:#ae81ff>0</span> sequence))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (map (lambda (x) (+ 1 x)) (list 1 2 3))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: (2 3 4)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (append (list 1 2 3) (list 4 5 6))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: (1 2 3 4 5 6)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (length (list 1 2 3))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: 3</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=练习-34>练习 34</h3><p>对于 $x$ 的某个给定值，求出一个多项式在 $x$ 的值，也可以形式化为一种累积。假定需要求下面多项式的值：</p><p>$$
a_nx^n + a_{n-1}x^{n-1} + \cdots + a_1x + a_0
$$</p><p>采用著名的 Horner 规则，可以构造出下面的计算：</p><p>$$
(\cdots (a_nx + a_{n-1})x + \cdots + a_1)x + a_0
$$</p><p>换句话说，我们可以从 $a_n$ 开始，乘以 $x$，再加上 $a_{n-1}$，乘以 $x$，如此下去，知道处理完 $a_0$。请填充下面的模板，做出一个利用 Horner 规则求多项式值的过程。假定多项式的系数安排在一个序列里，从 $a_0$ 直至 $a_n$。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>horner-eval</span> x coefficient-sequence)
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>accumulate</span> (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>this-coeff</span> higher-terms) &lt;??&gt;)
</span></span><span style=display:flex><span>              <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>              coefficient-sequence))
</span></span></code></pre></td></tr></table></div></div><p>例如，为了计算 $1 + 3x + 5x^3 + x^5$ 在 $x = 2$ 的值，你需要求值：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>(<span style=color:#a6e22e>horner-eval</span> <span style=color:#ae81ff>2</span> (list <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>3</span> <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>5</span> <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>1</span>))
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#f92672>#</span>lang sicp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>accumulate</span> op initial sequence)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>if </span>(null? sequence)
</span></span><span style=display:flex><span>      initial
</span></span><span style=display:flex><span>      (<span style=color:#a6e22e>op</span> (car sequence)
</span></span><span style=display:flex><span>          (<span style=color:#a6e22e>accumulate</span> op initial (cdr sequence)))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>horner-eval</span> x coefficient-sequence)
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>accumulate</span> (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>this-coeff</span> higher-terms)
</span></span><span style=display:flex><span>                (+ this-coeff (* x higher-terms)))
</span></span><span style=display:flex><span>              <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>              coefficient-sequence))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (horner-eval 2 (list 1 3 0 5 0 1))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: 79</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=练习-35>练习 35</h3><p>将 2.2.2 节的 <code>count-leaves</code> 重新定义为一个累积：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>count-leaves</span> t)
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>accumulate</span> &lt;??&gt; &lt;??&gt; (map &lt;??&gt; &lt;??&gt;)))
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#f92672>#</span>lang sicp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>accumulate</span> op initial sequence)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>if </span>(null? sequence)
</span></span><span style=display:flex><span>      initial
</span></span><span style=display:flex><span>      (<span style=color:#a6e22e>op</span> (car sequence)
</span></span><span style=display:flex><span>          (<span style=color:#a6e22e>accumulate</span> op initial (cdr sequence)))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>count-leaves</span> t)
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>accumulate</span> (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>x</span> y) (+ x y))
</span></span><span style=display:flex><span>              <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>              (<span style=color:#a6e22e>map</span>
</span></span><span style=display:flex><span>               (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>s</span>)
</span></span><span style=display:flex><span>                 (<span style=color:#66d9ef>if </span>(pair? s)
</span></span><span style=display:flex><span>                     (<span style=color:#a6e22e>count-leaves</span> s)
</span></span><span style=display:flex><span>                     <span style=color:#ae81ff>1</span>))
</span></span><span style=display:flex><span>               t)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#a6e22e>count-leaves</span> (list <span style=color:#ae81ff>1</span> (list <span style=color:#ae81ff>2</span> (list <span style=color:#ae81ff>3</span> <span style=color:#ae81ff>4</span>))))
</span></span></code></pre></td></tr></table></div></div><h3 id=练习-36>练习 36</h3><p>过程 <code>accumulate-n</code> 与 <code>accumulate</code> 类似，除了它的第三个参数是一个序列的序列，假定其中每个序列的元素个数相同。它用指定的累积过程去组合起所有序列的第一个元素，而后是所有序列的第二个元素，并如此做下去，返回得到的所有结果的序列。例如，如果 <code>s</code> 是包含着 4 个序列的序列 <code>((1 2 3) (4 5 6) (7 8 9) (10 11 12))</code>，那么 <code>(accumulate-n + 0 s)</code> 的值就应该是序列 <code>(22 26 30)</code>。请填充下面 <code>accumulate-n</code> 定义中所缺失的表达式：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>accumulate-n</span> op init seqs)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>if </span>(null? (car seqs))
</span></span><span style=display:flex><span>      nil
</span></span><span style=display:flex><span>      (cons (<span style=color:#a6e22e>accumulate</span> op init &lt;??&gt;)
</span></span><span style=display:flex><span>            (<span style=color:#a6e22e>accumulate-n</span> op init &lt;??&gt;))))
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#f92672>#</span>lang sicp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>accumulate</span> op initial sequence)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>if </span>(null? sequence)
</span></span><span style=display:flex><span>      initial
</span></span><span style=display:flex><span>      (<span style=color:#a6e22e>op</span> (car sequence)
</span></span><span style=display:flex><span>          (<span style=color:#a6e22e>accumulate</span> op initial (cdr sequence)))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>accumulate-n</span> op init seqs)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>if </span>(null? (car seqs))
</span></span><span style=display:flex><span>      nil
</span></span><span style=display:flex><span>      (cons (<span style=color:#a6e22e>accumulate</span> op init (map (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>s</span>) (car s)) seqs))
</span></span><span style=display:flex><span>            (<span style=color:#a6e22e>accumulate-n</span> op init (map (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>s</span>) (cdr s)) seqs)))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (define s (list (list 1 2 3) (list 4 5 6) (list 7 8 9) (list 10 11 12)))</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (accumulate-n + 0 s)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: (22 26 30)</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=练习-37>练习 37</h3><p>假定我们将向量 $v = (v_i)$ 表示为数的序列，将矩阵 $m = (m_{ij})$ 表示为向量（矩阵行）的序列。例如，矩阵：</p><p>$$
\begin{bmatrix}
1 & 2 & 3 & 4 \\
4 & 5 & 6 & 6 \\
6 & 7 & 8 & 9
\end{bmatrix}
$$</p><p>用序列 <code>((1 2 3 4) (4 5 6 6) (6 7 8 9))</code> 表示。对于这种表示，我们可以用序列操作简洁地表达基本的矩阵与向量运算。这些运算（任何有关矩阵代数的书里都有描述）如下：</p><p><code>(dot-product v w)</code> | 返回和 $\sum_i v_i w_i$;<br><code>(matrix-*-vector m v)</code> | 返回向量 $t$，其中 $t_i = \sum_j m_{ij} v_j$;<br><code>(matrix-*-matrix m n)</code> | 返回矩阵 $p$，其中 $p_{ij} = \sum_k m_{ik} n_{kj}$;<br><code>(transpose m)</code> | 返回矩阵 $n$，其中 $n_{ij} = m_{ji}$;</p><p>我们可以将点积（dot product）定义为：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>dot-product</span> v w)
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>accumulate</span> + <span style=color:#ae81ff>0</span> (map * v w)))
</span></span></code></pre></td></tr></table></div></div><p>请填充下面过程里缺失的表达式，它们计算出其他的矩阵运算结果（过程 <code>accumulate-n</code> 在
<a href=#%e7%bb%83%e4%b9%a0-36 title="练习 36">练习 36</a> 中定义）。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>matrix-*-vector</span> m v)
</span></span><span style=display:flex><span>  (map &lt;??&gt; m))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>transpose</span> mat)
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>accumulate-n</span> &lt;??&gt; &lt;??&gt; mat))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>matrix-*-matrix</span> m n)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>cols</span> (<span style=color:#a6e22e>transpose</span> n)))
</span></span><span style=display:flex><span>    (map &lt;??&gt; m)))
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#f92672>#</span>lang sicp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>accumulate</span> op initial sequence)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>if </span>(null? sequence)
</span></span><span style=display:flex><span>      initial
</span></span><span style=display:flex><span>      (<span style=color:#a6e22e>op</span> (car sequence)
</span></span><span style=display:flex><span>          (<span style=color:#a6e22e>accumulate</span> op initial (cdr sequence)))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>accumulate-n</span> op init seqs)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>if </span>(null? (car seqs))
</span></span><span style=display:flex><span>      nil
</span></span><span style=display:flex><span>      (cons (<span style=color:#a6e22e>accumulate</span> op init (map (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>s</span>) (car s)) seqs))
</span></span><span style=display:flex><span>            (<span style=color:#a6e22e>accumulate-n</span> op init (map (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>s</span>) (cdr s)) seqs)))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>dot-product</span> v w)
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>accumulate</span> + <span style=color:#ae81ff>0</span> (map * v w)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>matrix-*-vector</span> m v)
</span></span><span style=display:flex><span>  (map (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>row</span>) (<span style=color:#a6e22e>dot-product</span> row v)) m))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>transpose</span> mat)
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>accumulate-n</span> cons nil mat))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>matrix-*-matrix</span> m n)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>cols</span> (<span style=color:#a6e22e>transpose</span> n)))
</span></span><span style=display:flex><span>    (map (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>row</span>) (<span style=color:#a6e22e>matrix-*-vector</span> cols row)) m)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (define v (list 1 2 3 4))</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (define w (list 5 6 7 8))</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (define m (list (list 1 2 3 4) (list 4 5 6 6) (list 6 7 8 9)))</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (dot-product v w)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: 70</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (matrix-*-vector m v)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: (30 56 80)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (matrix-*-matrix m (transpose m))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: ((30 56 80) (56 113 161) (80 161 230))</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (matrix-*-matrix (transpose m) m)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: ((53 64 75 82) (64 78 92 101) (75 92 109 120) (82 101 120 133))</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=练习-38>练习 38</h3><p>过程 <code>accumulate</code> 也称为 <code>fold-right</code>，因为它将序列的第一个元素组合到右边所有元素的组合结果上。也有一个 <code>fold-left</code>，它与 <code>fold-right</code> 类似，但却是按照相反方向去操作各个元素：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>fold-left</span> op initial sequence)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>iter</span> result rest)
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>if </span>(null? rest)
</span></span><span style=display:flex><span>        result
</span></span><span style=display:flex><span>        (<span style=color:#a6e22e>iter</span> (<span style=color:#a6e22e>op</span> result (car rest))
</span></span><span style=display:flex><span>              (cdr rest))))
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>iter</span> initial sequence))
</span></span></code></pre></td></tr></table></div></div><p>下面表达式的值是什么？</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>(<span style=color:#a6e22e>fold-right</span> / <span style=color:#ae81ff>1</span> (list <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>2</span> <span style=color:#ae81ff>3</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#a6e22e>fold-left</span> / <span style=color:#ae81ff>1</span> (list <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>2</span> <span style=color:#ae81ff>3</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#a6e22e>fold-right</span> list nil (list <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>2</span> <span style=color:#ae81ff>3</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#a6e22e>fold-left</span> list nil (list <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>2</span> <span style=color:#ae81ff>3</span>))
</span></span></code></pre></td></tr></table></div></div><p>如果要求用某个 <code>op</code> 时保证 <code>fold-right</code> 和 <code>fold-left</code> 对任何序列都产生同样的结果，请给出 <code>op</code> 应该满足的性质。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#ae81ff>3</span>/2
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>1</span>/6
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#ae81ff>3</span> (<span style=color:#ae81ff>2</span> (<span style=color:#ae81ff>1</span> ())))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(((() <span style=color:#ae81ff>1</span>) <span style=color:#ae81ff>2</span>) <span style=color:#ae81ff>3</span>)
</span></span></code></pre></td></tr></table></div></div><p>要求用某个 <code>op</code> 时保证 <code>fold-right</code> 和 <code>fold-left</code> 对任何序列都产生同样的结果的话，<code>op</code> 应满足交换律，即 <code>(op a b) = (op b a)</code>。</p><h3 id=练习-39>练习 39</h3><p>基于
<a href=#%e7%bb%83%e4%b9%a0-38 title="练习 38">练习 38</a> 的 <code>fold-right</code> 和 <code>fold-left</code> 完成 <code>reverse</code> （
<a href=#%e7%bb%83%e4%b9%a0-18 title="练习 18">练习 18
</a>）下面的定义：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(reverse sequence)
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>fold-right</span> (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>x</span> y) &lt;??&gt;) nil sequence))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(reverse sequence)
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>fold-left</span> (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>x</span> y) &lt;??&gt;) nil sequence))
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#f92672>#</span>lang sicp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>fold-left</span> op initial sequence)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>iter</span> result rest)
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>if </span>(null? rest)
</span></span><span style=display:flex><span>        result
</span></span><span style=display:flex><span>        (<span style=color:#a6e22e>iter</span> (<span style=color:#a6e22e>op</span> result (car rest))
</span></span><span style=display:flex><span>              (cdr rest))))
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>iter</span> initial sequence))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>fold-right</span> op initial sequence)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>iter</span> result rest)
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>if </span>(null? rest)
</span></span><span style=display:flex><span>        result
</span></span><span style=display:flex><span>        (<span style=color:#a6e22e>iter</span> (<span style=color:#a6e22e>op</span> (car rest) result)
</span></span><span style=display:flex><span>              (cdr rest))))
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>iter</span> initial sequence))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(reverse sequence)
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>fold-right</span> (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>x</span> y) (cons x y)) nil sequence))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>reverse2</span> sequence)
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>fold-left</span> (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>x</span> y) (cons y x)) nil sequence))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (reverse (list 1 2 3 4))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: (4 3 2 1)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (reverse2 (list 1 2 3 4))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: (4 3 2 1)</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=练习-40>练习 40</h3><p>请定义过程 <code>unique-pairs</code>，给它整数 $n$，它产生出序列 $(i, j)$，其中 $1 \le j \lt i \le n$。请用 <code>unique-pairs</code> 去简化上面 <code>prime-sum-pairs</code> 的定义。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#f92672>#</span>lang sicp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>filter</span> predicate sequence)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>cond </span>((null? sequence) nil)
</span></span><span style=display:flex><span>        ((<span style=color:#a6e22e>predicate</span> (car sequence))
</span></span><span style=display:flex><span>         (cons (car sequence)
</span></span><span style=display:flex><span>               (<span style=color:#a6e22e>filter</span> predicate (cdr sequence))))
</span></span><span style=display:flex><span>        (<span style=color:#66d9ef>else </span>(<span style=color:#a6e22e>filter</span> predicate (cdr sequence)))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>enumerate-interval</span> m n)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>if </span>(&gt; m n)
</span></span><span style=display:flex><span>      nil
</span></span><span style=display:flex><span>      (cons m (<span style=color:#a6e22e>enumerate-interval</span> (+ <span style=color:#ae81ff>1</span> m) n))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>unique-pairs</span> n)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>if </span>(&lt;= n <span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>      nil
</span></span><span style=display:flex><span>      (append (map (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>j</span>) (list n j))
</span></span><span style=display:flex><span>                   (<span style=color:#a6e22e>enumerate-interval</span> <span style=color:#ae81ff>1</span> (- n <span style=color:#ae81ff>1</span>)))
</span></span><span style=display:flex><span>              (<span style=color:#a6e22e>unique-pairs</span> (- n <span style=color:#ae81ff>1</span>)))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>prime?</span> n)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>smallest-divisor</span> n)
</span></span><span style=display:flex><span>    (<span style=color:#a6e22e>find-divisor</span> n <span style=color:#ae81ff>2</span>))
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>find-divisor</span> n test-divisor)
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>cond </span>((&gt; (<span style=color:#a6e22e>square</span> test-divisor) n) n)
</span></span><span style=display:flex><span>          ((<span style=color:#a6e22e>divides?</span> test-divisor n) test-divisor)
</span></span><span style=display:flex><span>          (<span style=color:#66d9ef>else </span>(<span style=color:#a6e22e>find-divisor</span> n (+ test-divisor <span style=color:#ae81ff>1</span>)))))
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>square</span> x) (* x x))
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>divides?</span> a b)
</span></span><span style=display:flex><span>    (= (remainder b a) <span style=color:#ae81ff>0</span>))
</span></span><span style=display:flex><span>  (= (<span style=color:#a6e22e>smallest-divisor</span> n) n))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>prime-sum-pairs</span> n)
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>filter</span> (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>p</span>)
</span></span><span style=display:flex><span>            (<span style=color:#a6e22e>prime?</span> (+ (car p) (cadr p))))
</span></span><span style=display:flex><span>          (<span style=color:#a6e22e>unique-pairs</span> n)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (prime-sum-pairs 6)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: ((6 1) (6 5) (5 2) (4 1) (4 3) (3 2) (2 1))</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=练习-41>练习 41</h3><p>请写出一个过程，它能产生出所有小于等于给定整数 $n$ 的正的相异整数 $i$、$j$ 和 $k$ 的有序三元组，使每个三元组的三个元素之和等于给定的整数 $s$。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">47
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">48
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">49
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">50
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">51
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">52
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">53
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">54
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">55
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">56
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">57
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">58
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#f92672>#</span>lang sicp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>filter</span> predicate sequence)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>cond </span>((null? sequence) nil)
</span></span><span style=display:flex><span>        ((<span style=color:#a6e22e>predicate</span> (car sequence))
</span></span><span style=display:flex><span>         (cons (car sequence)
</span></span><span style=display:flex><span>               (<span style=color:#a6e22e>filter</span> predicate (cdr sequence))))
</span></span><span style=display:flex><span>        (<span style=color:#66d9ef>else </span>(<span style=color:#a6e22e>filter</span> predicate (cdr sequence)))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>accumulate</span> op initial sequence)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>if </span>(null? sequence)
</span></span><span style=display:flex><span>      initial
</span></span><span style=display:flex><span>      (<span style=color:#a6e22e>op</span> (car sequence)
</span></span><span style=display:flex><span>          (<span style=color:#a6e22e>accumulate</span> op initial (cdr sequence)))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>flatmap</span> proc seq)
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>accumulate</span> append nil (map proc seq)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>enumerate-interval</span> m n)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>if </span>(&gt; m n)
</span></span><span style=display:flex><span>      nil
</span></span><span style=display:flex><span>      (cons m (<span style=color:#a6e22e>enumerate-interval</span> (+ <span style=color:#ae81ff>1</span> m) n))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>unique-triples</span> n)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>if </span>(&lt;= n <span style=color:#ae81ff>2</span>)
</span></span><span style=display:flex><span>      nil
</span></span><span style=display:flex><span>      (append (<span style=color:#a6e22e>flatmap</span> (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>j</span>)
</span></span><span style=display:flex><span>                         (map (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>k</span>) (list n j k))
</span></span><span style=display:flex><span>                              (<span style=color:#a6e22e>enumerate-interval</span> <span style=color:#ae81ff>1</span> (- j <span style=color:#ae81ff>1</span>))))
</span></span><span style=display:flex><span>                       (<span style=color:#a6e22e>enumerate-interval</span> <span style=color:#ae81ff>2</span> (- n <span style=color:#ae81ff>1</span>)))
</span></span><span style=display:flex><span>              (<span style=color:#a6e22e>unique-triples</span> (- n <span style=color:#ae81ff>1</span>)))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>permute-triples</span> seqs)
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>flatmap</span> (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>seq</span>)
</span></span><span style=display:flex><span>             (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>a</span> (car seq))
</span></span><span style=display:flex><span>                   (<span style=color:#a6e22e>b</span> (cadr seq))
</span></span><span style=display:flex><span>                   (<span style=color:#a6e22e>c</span> (caddr seq)))
</span></span><span style=display:flex><span>               (list (list a b c)
</span></span><span style=display:flex><span>                     (list a c b)
</span></span><span style=display:flex><span>                     (list b c a)
</span></span><span style=display:flex><span>                     (list b a c)
</span></span><span style=display:flex><span>                     (list c a b)
</span></span><span style=display:flex><span>                     (list c b a))))
</span></span><span style=display:flex><span>           seqs))
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>triple-sum</span> n s)
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>permute-triples</span> (<span style=color:#a6e22e>filter</span> (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>triple</span>)
</span></span><span style=display:flex><span>                             (= s
</span></span><span style=display:flex><span>                                (+ (car triple)
</span></span><span style=display:flex><span>                                   (cadr triple)
</span></span><span style=display:flex><span>                                   (caddr triple))))
</span></span><span style=display:flex><span>                           (<span style=color:#a6e22e>unique-triples</span> n))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (triple-sum 10 7)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: ((4 2 1) (4 1 2) (2 1 4) (2 4 1) (1 4 2) (1 2 4))</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (triple-sum 10 9)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: ((6 2 1) (6 1 2) (2 1 6) (2 6 1) (1 6 2) (1 2 6) (5 3 1) (5 1 3) (3 1 5) (3 5 1) (1 5 3) (1 3 5) (4 3 2) (4 2 3) (3 2 4) (3 4 2) (2 4 3) (2 3 4))</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=练习-42>练习 42</h3><p>“八皇后谜题”问的是怎样将八个皇后摆在国际象棋棋盘上，使得任意一个皇后都不能攻击另一个皇后（也就是说，任意两个皇后都不在同一行、同一列或者同一对角线上）。一个可能的解如下图所示。解决这一谜题的一种方法按一个方向处理棋盘，每次在每一列里放一个皇后，如果现在已经放好了 $k-1$ 个皇后，第 $k$ 个皇后就必须放在不会被已在棋盘上的任何皇后攻击的位置上。我们可以递归地描述这一过程：假定我们已经生成了在棋盘的前 $k-1$ 列中放置 $k-1$ 个皇后的所有可能方式，现在需要的就是对于其中的每种方式，生成出将下一个皇后放在第 $k$ 列中每一行的扩充集合。而后过滤它们，只留下能使位于第 $k$ 列的皇后与其他皇后相安无事的那些扩充。这样就能产生出将 $k$ 个皇后放置在前 $k$ 列的所有格局的序列。继续这一过程，我们将能产生出这一谜题的所有解，而不是一个解。</p><p>将这一解法实现为一个过程 <code>queens</code>，令它返回在 $n\times n$ 棋盘上放 $n$ 个皇后的所有解的序列。<code>queens</code> 内部的过程 <code>queen-cols</code>，返回在棋盘的前 $k$ 列中放皇后的所有格局的序列。</p><img src=42.svg width=50% height=auto alt=42.svg><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>queens</span> board-size)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>queen-cols</span> k)
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>if </span>(= k <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>        (list empty-board)
</span></span><span style=display:flex><span>        (<span style=color:#a6e22e>filter</span>
</span></span><span style=display:flex><span>         (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>positions</span>) (<span style=color:#a6e22e>safe?</span> k positions))
</span></span><span style=display:flex><span>         (<span style=color:#a6e22e>flatmap</span>
</span></span><span style=display:flex><span>          (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>rest-of-queens</span>)
</span></span><span style=display:flex><span>            (map (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>new-row</span>)
</span></span><span style=display:flex><span>                   (<span style=color:#a6e22e>adjoin-position</span> new-row k rest-of-queens))
</span></span><span style=display:flex><span>                 (<span style=color:#a6e22e>enumerate-interval</span> <span style=color:#ae81ff>1</span> board-size)))
</span></span><span style=display:flex><span>          (<span style=color:#a6e22e>queen-cols</span> (- k <span style=color:#ae81ff>1</span>))))))
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>queen-cols</span> board-size))
</span></span></code></pre></td></tr></table></div></div><p>这个过程里的 <code>rest-of-queens</code> 是在前 $k-1$ 列放置 $k-1$ 个皇后的一种方式，<code>new-row</code> 是在第 $k$ 列放置所考虑的行编号。请完成这一程序，为此需要实现一种棋盘格局集合的表示方法；还要实现过程 <code>adjoin-position</code>，它将一个新的行列格局加入一个格局集合中，在第 $k$ 列的皇后相对于其他列的皇后是否为安全的（请注意，我们只需检查新皇后是否安全 &mdash; 其他皇后已经保证相安无事了）。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 29
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 30
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 31
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 32
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 33
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 34
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 35
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 36
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 37
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 38
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 39
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 40
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 41
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 42
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 43
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 44
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 45
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 46
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 47
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 48
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 49
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 50
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 51
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 52
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 53
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 54
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 55
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 56
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 57
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 58
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 59
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 60
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 61
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 62
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 63
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 64
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 65
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 66
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 67
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 68
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 69
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 70
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 71
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 72
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 73
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 74
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 75
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 76
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 77
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 78
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 79
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 80
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 81
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 82
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 83
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 84
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 85
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 86
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 87
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 88
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 89
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 90
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 91
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 92
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 93
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 94
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 95
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 96
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 97
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 98
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 99
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">100
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">101
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">102
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">103
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">104
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">105
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">106
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">107
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">108
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">109
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">110
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">111
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">112
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">113
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">114
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">115
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">116
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">117
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">118
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">119
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">120
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">121
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">122
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">123
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">124
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">125
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">126
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">127
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">128
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">129
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">130
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">131
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">132
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">133
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">134
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">135
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">136
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">137
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">138
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">139
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">140
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">141
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">142
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">143
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">144
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">145
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">146
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">147
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">148
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">149
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">150
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">151
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">152
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">153
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">154
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#f92672>#</span>lang sicp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(reverse sequence)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>if </span>(null? sequence)
</span></span><span style=display:flex><span>      nil
</span></span><span style=display:flex><span>      (append (reverse (cdr sequence))
</span></span><span style=display:flex><span>              (list (car sequence)))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>filter</span> predicate sequence)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>cond </span>((null? sequence) nil)
</span></span><span style=display:flex><span>        ((<span style=color:#a6e22e>predicate</span> (car sequence))
</span></span><span style=display:flex><span>         (cons (car sequence)
</span></span><span style=display:flex><span>               (<span style=color:#a6e22e>filter</span> predicate (cdr sequence))))
</span></span><span style=display:flex><span>        (<span style=color:#66d9ef>else </span>(<span style=color:#a6e22e>filter</span> predicate (cdr sequence)))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>accumulate</span> op initial sequence)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>if </span>(null? sequence)
</span></span><span style=display:flex><span>      initial
</span></span><span style=display:flex><span>      (<span style=color:#a6e22e>op</span> (car sequence)
</span></span><span style=display:flex><span>          (<span style=color:#a6e22e>accumulate</span> op initial (cdr sequence)))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>flatmap</span> proc seq)
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>accumulate</span> append nil (map proc seq)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>enumerate-interval</span> m n)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>if </span>(&gt; m n)
</span></span><span style=display:flex><span>      nil
</span></span><span style=display:flex><span>      (cons m (<span style=color:#a6e22e>enumerate-interval</span> (+ <span style=color:#ae81ff>1</span> m) n))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>empty-board nil)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>adjoin-position</span> new-row k rest-of-queens)
</span></span><span style=display:flex><span>  (cons new-row rest-of-queens))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>safe?</span> k positions)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>row</span> (car positions))
</span></span><span style=display:flex><span>        (<span style=color:#a6e22e>sum-row-col</span> (+ (car positions) k))
</span></span><span style=display:flex><span>        (<span style=color:#a6e22e>diff-row-col</span> (- (car positions) k)))
</span></span><span style=display:flex><span>    (<span style=color:#a6e22e>accumulate</span>
</span></span><span style=display:flex><span>     (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>a</span> b) (<span style=color:#66d9ef>and </span>a b))
</span></span><span style=display:flex><span>     <span style=color:#66d9ef>#t</span>
</span></span><span style=display:flex><span>     (map (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>pos</span> col)
</span></span><span style=display:flex><span>            (<span style=color:#66d9ef>and </span>(not (= row pos))
</span></span><span style=display:flex><span>                 (not (= sum-row-col (+ pos col)))
</span></span><span style=display:flex><span>                 (not (= diff-row-col (- pos col)))))
</span></span><span style=display:flex><span>          (cdr positions) (reverse (<span style=color:#a6e22e>enumerate-interval</span> <span style=color:#ae81ff>1</span> (- k <span style=color:#ae81ff>1</span>)))))))
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>queens</span> board-size)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>queen-cols</span> k)
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>if </span>(= k <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>        (list empty-board)
</span></span><span style=display:flex><span>        (<span style=color:#a6e22e>filter</span>
</span></span><span style=display:flex><span>         (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>positions</span>) (<span style=color:#a6e22e>safe?</span> k positions))
</span></span><span style=display:flex><span>         (<span style=color:#a6e22e>flatmap</span>
</span></span><span style=display:flex><span>          (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>rest-of-queens</span>)
</span></span><span style=display:flex><span>            (map (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>new-row</span>)
</span></span><span style=display:flex><span>                   (<span style=color:#a6e22e>adjoin-position</span> new-row k rest-of-queens))
</span></span><span style=display:flex><span>                 (<span style=color:#a6e22e>enumerate-interval</span> <span style=color:#ae81ff>1</span> board-size)))
</span></span><span style=display:flex><span>          (<span style=color:#a6e22e>queen-cols</span> (- k <span style=color:#ae81ff>1</span>))))))
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>queen-cols</span> board-size))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (queens 8)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: ((4 2 7 3 6 8 5 1)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;:  (5 2 4 7 3 8 6 1)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;:  (3 5 2 8 6 4 7 1)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;:  (3 6 4 2 8 5 7 1)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;:  (5 7 1 3 8 6 4 2)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;:  (4 6 8 3 1 7 5 2)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;:  (3 6 8 1 4 7 5 2)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;:  (5 3 8 4 7 1 6 2)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;:  (5 7 4 1 3 8 6 2)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;:  (4 1 5 8 6 3 7 2)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;:  (3 6 4 1 8 5 7 2)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;:  (4 7 5 3 1 6 8 2)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;:  (6 4 2 8 5 7 1 3)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;:  (6 4 7 1 8 2 5 3)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;:  (1 7 4 6 8 2 5 3)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;:  (6 8 2 4 1 7 5 3)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;:  (6 2 7 1 4 8 5 3)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;:  (4 7 1 8 5 2 6 3)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;:  (5 8 4 1 7 2 6 3)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;:  (4 8 1 5 7 2 6 3)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;:  (2 7 5 8 1 4 6 3)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;:  (1 7 5 8 2 4 6 3)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;:  (2 5 7 4 1 8 6 3)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;:  (4 2 7 5 1 8 6 3)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;:  (5 7 1 4 2 8 6 3)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;:  (6 4 1 5 8 2 7 3)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;:  (5 1 4 6 8 2 7 3)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;:  (5 2 6 1 7 4 8 3)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;:  (6 3 7 2 8 5 1 4)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;:  (2 7 3 6 8 5 1 4)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;:  (7 3 1 6 8 5 2 4)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;:  (5 1 8 6 3 7 2 4)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;:  (1 5 8 6 3 7 2 4)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;:  (3 6 8 1 5 7 2 4)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;:  (6 3 1 7 5 8 2 4)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;:  (7 5 3 1 6 8 2 4)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;:  (7 3 8 2 5 1 6 4)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;:  (5 3 1 7 2 8 6 4)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;:  (2 5 7 1 3 8 6 4)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;:  (3 6 2 5 8 1 7 4)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;:  (6 1 5 2 8 3 7 4)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;:  (8 3 1 6 2 5 7 4)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;:  (2 8 6 1 3 5 7 4)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;:  (5 7 2 6 3 1 8 4)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;:  (3 6 2 7 5 1 8 4)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;:  (6 2 7 1 3 5 8 4)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;:  (3 7 2 8 6 4 1 5)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;:  (6 3 7 2 4 8 1 5)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;:  (4 2 7 3 6 8 1 5)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;:  (7 1 3 8 6 4 2 5)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;:  (1 6 8 3 7 4 2 5)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;:  (3 8 4 7 1 6 2 5)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;:  (6 3 7 4 1 8 2 5)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;:  (7 4 2 8 6 1 3 5)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;:  (4 6 8 2 7 1 3 5)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;:  (2 6 1 7 4 8 3 5)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;:  (2 4 6 8 3 1 7 5)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;:  (3 6 8 2 4 1 7 5)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;:  (6 3 1 8 4 2 7 5)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;:  (8 4 1 3 6 2 7 5)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;:  (4 8 1 3 6 2 7 5)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;:  (2 6 8 3 1 4 7 5)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;:  (7 2 6 3 1 4 8 5)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;:  (3 6 2 7 1 4 8 5)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;:  (4 7 3 8 2 5 1 6)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;:  (4 8 5 3 1 7 2 6)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;:  (3 5 8 4 1 7 2 6)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;:  (4 2 8 5 7 1 3 6)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;:  (5 7 2 4 8 1 3 6)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;:  (7 4 2 5 8 1 3 6)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;:  (8 2 4 1 7 5 3 6)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;:  (7 2 4 1 8 5 3 6)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;:  (5 1 8 4 2 7 3 6)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;:  (4 1 5 8 2 7 3 6)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;:  (5 2 8 1 4 7 3 6)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;:  (3 7 2 8 5 1 4 6)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;:  (3 1 7 5 8 2 4 6)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;:  (8 2 5 3 1 7 4 6)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;:  (3 5 2 8 1 7 4 6)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;:  (3 5 7 1 4 2 8 6)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;:  (5 2 4 6 8 3 1 7)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;:  (6 3 5 8 1 4 2 7)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;:  (5 8 4 1 3 6 2 7)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;:  (4 2 5 8 6 1 3 7)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;:  (4 6 1 5 2 8 3 7)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;:  (6 3 1 8 5 2 4 7)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;:  (5 3 1 6 8 2 4 7)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;:  (4 2 8 6 1 3 5 7)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;:  (6 3 5 7 1 4 2 8)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;:  (6 4 7 1 3 5 2 8)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;:  (4 7 5 2 6 1 3 8)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;:  (5 7 2 6 3 1 4 8))</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=练习-43>练习 43</h3><p>Louis Reasoner 在做
<a href=#%e7%bb%83%e4%b9%a0-42 title="练习 42">练习 42</a> 时遇到了麻烦，他的 <code>queens</code> 过程看起来能行，但却运行得极慢（Louis 居然无法忍耐到它解 $6\times 6$ 棋盘的问题）。当 Louis 请 Eva Lu Ator 帮忙时，她指出他在 <code>flatmap</code> 里交换了嵌套映射的顺序，将它写成了：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>(<span style=color:#a6e22e>flatmap</span>
</span></span><span style=display:flex><span> (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>new-row</span>)
</span></span><span style=display:flex><span>   (map (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>rest-of-queens</span>)
</span></span><span style=display:flex><span>          (<span style=color:#a6e22e>adjoin-position</span> new-row k rest-of-queens))
</span></span><span style=display:flex><span>        (<span style=color:#a6e22e>queen-cols</span> (- k <span style=color:#ae81ff>1</span>))))
</span></span><span style=display:flex><span> (<span style=color:#a6e22e>enumerate-interval</span> <span style=color:#ae81ff>1</span> board-size))
</span></span></code></pre></td></tr></table></div></div><p>请解释一下，为什么这样交换顺序会使程序运行得非常慢。估计一下，用 Louis 的程序去解决八皇后问题大约需要多少时间，假定
<a href=#%e7%bb%83%e4%b9%a0-42 title="练习 42">练习 42</a> 中的程序需要时间 $T$ 求解这一难题。</p><p>嵌套顺序调换后，<code>flatmap</code> 在映射 <code>(enumerate-interval 1 board-size)</code> 的每一个元素时，都要重复计算 <code>(queen-cols (- k 1))</code>，由于 <code>board-size</code> 为 8，所需时间大约为 $8T$。</p><h3 id=练习-44>练习 44</h3><p>请定义出 <code>corner-split</code> 里使用的过程 <code>up-split</code>，它与 <code>right-split</code> 类似，除在其中交换了 <code>below</code> 和 <code>beside</code> 的角色之外。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#f92672>#</span>lang sicp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>up-split</span> painter n)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>if </span>(= n <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>      painter
</span></span><span style=display:flex><span>      (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>smaller</span> (<span style=color:#a6e22e>up-split</span> painter (- n <span style=color:#ae81ff>1</span>))))
</span></span><span style=display:flex><span>        (<span style=color:#a6e22e>below</span> painter (<span style=color:#a6e22e>beside</span> smaller smaller)))))
</span></span></code></pre></td></tr></table></div></div><h3 id=练习-45>练习 45</h3><p>可以将 <code>right-split</code> 和 <code>up-split</code> 表述为某种广义划分操作的实例。请定义一个过程 <code>split</code>，使它具有如下性质，求值：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>(<span style=color:#66d9ef>define </span>right-split (<span style=color:#a6e22e>split</span> beside below))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>up-split (<span style=color:#a6e22e>split</span> below beside))
</span></span></code></pre></td></tr></table></div></div><p>产生过程 <code>right-split</code> 和 <code>up-split</code>，其行为与前面定义的过程一样。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#f92672>#</span>lang sicp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>split</span> orient1 orient2)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>iter</span> painter n)
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>if </span>(= n <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>        painter
</span></span><span style=display:flex><span>        (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>smaller</span> (<span style=color:#a6e22e>iter</span> painter (- n <span style=color:#ae81ff>1</span>))))
</span></span><span style=display:flex><span>          (<span style=color:#a6e22e>orient1</span> painter (<span style=color:#a6e22e>orient2</span> smaller smaller)))))
</span></span><span style=display:flex><span>  iter)
</span></span></code></pre></td></tr></table></div></div><h3 id=练习-46>练习 46</h3><p>从原点出发的一个两维向量 $\bm{v}$ 可以用一个由 $x$ 坐标和 $y$ 坐标构成的序列表示。请为这样的向量实现一个数据抽象：给出一个构造函数 <code>make-vect</code>，以及对应的选择函数 <code>xcor-vect</code> 和 <code>ycor-vect</code>。借助于你给出的构造函数和选择函数，实现过程 <code>add-vect</code>、<code>sub-vect</code> 和 <code>scale-vect</code>，它们能完成向量加法、向量减法和向量的伸缩。</p><p>$$
(x_1, y_1) + (x_2, y_2) = (x_1 + x_2, y_1 + y_2)
$$
$$
(x_1, y_1) - (x_2, y_2) = (x_1 - x_2, y_1 - y_2)
$$
$$
s \cdot (x, y) = (sx, sy)
$$</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#f92672>#</span>lang sicp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>make-vect</span> x y)
</span></span><span style=display:flex><span>  (cons x y))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>xcor-vect</span> v)
</span></span><span style=display:flex><span>  (car v))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>ycor-vect</span> v)
</span></span><span style=display:flex><span>  (cdr v))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>add-vect</span> v1 v2)
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>make-vect</span> (+ (<span style=color:#a6e22e>xcor-vect</span> v1) (<span style=color:#a6e22e>xcor-vect</span> v2))
</span></span><span style=display:flex><span>             (+ (<span style=color:#a6e22e>ycor-vect</span> v1) (<span style=color:#a6e22e>ycor-vect</span> v2))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>sub-vect</span> v1 v2)
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>make-vect</span> (- (<span style=color:#a6e22e>xcor-vect</span> v1) (<span style=color:#a6e22e>xcor-vect</span> v2))
</span></span><span style=display:flex><span>             (- (<span style=color:#a6e22e>ycor-vect</span> v1) (<span style=color:#a6e22e>ycor-vect</span> v2))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>scale-vect</span> s v)
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>make-vect</span> (* s (<span style=color:#a6e22e>xcor-vect</span> v))
</span></span><span style=display:flex><span>             (* s (<span style=color:#a6e22e>ycor-vect</span> v))))
</span></span></code></pre></td></tr></table></div></div><h3 id=练习-47>练习 47</h3><p>下面是实现框架的两个可能的过程函数：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>make-frame</span> origin edge1 edge2)
</span></span><span style=display:flex><span>  (list origin edge1 edge2))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>make-frame</span> origin edge1 edge2)
</span></span><span style=display:flex><span>  (cons (<span style=color:#a6e22e>origin</span>) (cons edge1 edge2)))
</span></span></code></pre></td></tr></table></div></div><p>请为每个构造函数提供适当的选择函数，为框架做出相应的实现。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#f92672>#</span>lang sicp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>make-frame</span> origin edge1 edge2)
</span></span><span style=display:flex><span>  (list origin edge1 edge2))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>origin-frame</span> frame)
</span></span><span style=display:flex><span>  (car frame))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>edge1-frame</span> frame)
</span></span><span style=display:flex><span>  (cadr frame))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>edge2-frame</span> frame)
</span></span><span style=display:flex><span>  (caddr frame))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>; (define (make-frame origin edge1 edge2)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;   (cons origin (cons edge1 edge2)))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>; (define (origin-frame frame)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;   (car frame))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>; (define (edge1-frame frame)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;   (cadr frame))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>; (define (edge2-frame frame)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;   (cddr frame))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=练习-48>练习 48</h3><p>平面上的一条直线可以用一对向量表示 &mdash; 从原点到线段起点的向量，以及从原点到线段终点的向量。请用你在
<a href=#%e7%bb%83%e4%b9%a0-46 title="练习 46">练习 46</a> 做出的向量表示定义一种线段表示，其中用构造函数 <code>make-segment</code> 以及选择函数 <code>start-segment</code> 和 <code>end-segment</code>。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#f92672>#</span>lang sicp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>make-vect</span> x y)
</span></span><span style=display:flex><span>  (cons x y))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>xcor-vect</span> v)
</span></span><span style=display:flex><span>  (car v))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>ycor-vect</span> v)
</span></span><span style=display:flex><span>  (cdr v))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>make-segment</span> v1 v2)
</span></span><span style=display:flex><span>  (cons v1 v2))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>start-segment</span> s)
</span></span><span style=display:flex><span>  (car s))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>end-segment</span> s)
</span></span><span style=display:flex><span>  (cdr s))
</span></span></code></pre></td></tr></table></div></div><h3 id=练习-49>练习 49</h3><p>利用 <code>segments->painter</code> 定义下面的基本画家：</p><p>a) 画出给定框架边界的画家。</p><p>b) 通过连接框架两对角画出一个大叉子的画家。</p><p>c) 通过连接框架各边的中点画出一个菱形的画家。</p><p>d) 画家 <code>wave</code>。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">47
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">48
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">49
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#f92672>#</span>lang sicp
</span></span><span style=display:flex><span>(<span style=color:#f92672>#</span>%require sicp-pict)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>edges-&gt;painter</span> frame)
</span></span><span style=display:flex><span>  ((<span style=color:#a6e22e>segments-&gt;painter</span>
</span></span><span style=display:flex><span>    (<span style=color:#a6e22e>list</span>
</span></span><span style=display:flex><span>     (<span style=color:#a6e22e>make-segment</span> (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>0</span>) (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>0</span>))
</span></span><span style=display:flex><span>     (<span style=color:#a6e22e>make-segment</span> (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>0</span>) (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>1</span>))
</span></span><span style=display:flex><span>     (<span style=color:#a6e22e>make-segment</span> (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>1</span>) (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>1</span>))
</span></span><span style=display:flex><span>     (<span style=color:#a6e22e>make-segment</span> (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>1</span>) (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>0</span>))))
</span></span><span style=display:flex><span>   frame))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>diags-&gt;painter</span> frame)
</span></span><span style=display:flex><span>  ((<span style=color:#a6e22e>segments-&gt;painter</span>
</span></span><span style=display:flex><span>    (<span style=color:#a6e22e>list</span>
</span></span><span style=display:flex><span>     (<span style=color:#a6e22e>make-segment</span> (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>0</span>) (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>1</span>))
</span></span><span style=display:flex><span>     (<span style=color:#a6e22e>make-segment</span> (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>0</span>) (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>1</span>))))
</span></span><span style=display:flex><span>   frame))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>midpoints-&gt;painter</span> frame)
</span></span><span style=display:flex><span>  ((<span style=color:#a6e22e>segments-&gt;painter</span>
</span></span><span style=display:flex><span>    (<span style=color:#a6e22e>list</span>
</span></span><span style=display:flex><span>     (<span style=color:#a6e22e>make-segment</span> (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>0.5</span> <span style=color:#ae81ff>0</span>) (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>0.5</span>))
</span></span><span style=display:flex><span>     (<span style=color:#a6e22e>make-segment</span> (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>0.5</span>) (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>0.5</span> <span style=color:#ae81ff>1</span>))
</span></span><span style=display:flex><span>     (<span style=color:#a6e22e>make-segment</span> (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>0.5</span> <span style=color:#ae81ff>1</span>) (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>0.5</span>))
</span></span><span style=display:flex><span>     (<span style=color:#a6e22e>make-segment</span> (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>0.5</span>) (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>0.5</span> <span style=color:#ae81ff>0</span>))))
</span></span><span style=display:flex><span>   frame))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>wave-&gt;painter</span> frame)
</span></span><span style=display:flex><span>  ((<span style=color:#a6e22e>segments-&gt;painter</span>
</span></span><span style=display:flex><span>    (<span style=color:#a6e22e>list</span>
</span></span><span style=display:flex><span>     (<span style=color:#a6e22e>make-segment</span> (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>0.20</span> <span style=color:#ae81ff>0.00</span>) (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>0.35</span> <span style=color:#ae81ff>0.50</span>))
</span></span><span style=display:flex><span>     (<span style=color:#a6e22e>make-segment</span> (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>0.35</span> <span style=color:#ae81ff>0.50</span>) (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>0.30</span> <span style=color:#ae81ff>0.60</span>))
</span></span><span style=display:flex><span>     (<span style=color:#a6e22e>make-segment</span> (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>0.30</span> <span style=color:#ae81ff>0.60</span>) (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>0.15</span> <span style=color:#ae81ff>0.45</span>))
</span></span><span style=display:flex><span>     (<span style=color:#a6e22e>make-segment</span> (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>0.15</span> <span style=color:#ae81ff>0.45</span>) (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>0.00</span> <span style=color:#ae81ff>0.60</span>))
</span></span><span style=display:flex><span>     (<span style=color:#a6e22e>make-segment</span> (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>0.00</span> <span style=color:#ae81ff>0.80</span>) (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>0.15</span> <span style=color:#ae81ff>0.65</span>))
</span></span><span style=display:flex><span>     (<span style=color:#a6e22e>make-segment</span> (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>0.15</span> <span style=color:#ae81ff>0.65</span>) (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>0.30</span> <span style=color:#ae81ff>0.70</span>))
</span></span><span style=display:flex><span>     (<span style=color:#a6e22e>make-segment</span> (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>0.30</span> <span style=color:#ae81ff>0.70</span>) (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>0.40</span> <span style=color:#ae81ff>0.70</span>))
</span></span><span style=display:flex><span>     (<span style=color:#a6e22e>make-segment</span> (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>0.40</span> <span style=color:#ae81ff>0.70</span>) (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>0.35</span> <span style=color:#ae81ff>0.85</span>))
</span></span><span style=display:flex><span>     (<span style=color:#a6e22e>make-segment</span> (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>0.35</span> <span style=color:#ae81ff>0.85</span>) (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>0.40</span> <span style=color:#ae81ff>1.00</span>))
</span></span><span style=display:flex><span>     (<span style=color:#a6e22e>make-segment</span> (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>0.60</span> <span style=color:#ae81ff>1.00</span>) (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>0.65</span> <span style=color:#ae81ff>0.85</span>))
</span></span><span style=display:flex><span>     (<span style=color:#a6e22e>make-segment</span> (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>0.65</span> <span style=color:#ae81ff>0.85</span>) (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>0.60</span> <span style=color:#ae81ff>0.70</span>))
</span></span><span style=display:flex><span>     (<span style=color:#a6e22e>make-segment</span> (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>0.60</span> <span style=color:#ae81ff>0.70</span>) (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>0.75</span> <span style=color:#ae81ff>0.70</span>))
</span></span><span style=display:flex><span>     (<span style=color:#a6e22e>make-segment</span> (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>0.75</span> <span style=color:#ae81ff>0.70</span>) (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>1.00</span> <span style=color:#ae81ff>0.40</span>))
</span></span><span style=display:flex><span>     (<span style=color:#a6e22e>make-segment</span> (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>1.00</span> <span style=color:#ae81ff>0.20</span>) (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>0.60</span> <span style=color:#ae81ff>0.48</span>))
</span></span><span style=display:flex><span>     (<span style=color:#a6e22e>make-segment</span> (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>0.60</span> <span style=color:#ae81ff>0.48</span>) (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>0.80</span> <span style=color:#ae81ff>0.00</span>))
</span></span><span style=display:flex><span>     (<span style=color:#a6e22e>make-segment</span> (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>0.40</span> <span style=color:#ae81ff>0.00</span>) (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>0.50</span> <span style=color:#ae81ff>0.30</span>))
</span></span><span style=display:flex><span>     (<span style=color:#a6e22e>make-segment</span> (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>0.50</span> <span style=color:#ae81ff>0.30</span>) (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>0.60</span> <span style=color:#ae81ff>0.00</span>))))
</span></span><span style=display:flex><span>   frame))
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>(<span style=color:#a6e22e>paint</span> edges-&gt;painter <span style=color:#f92672>#</span>:height <span style=color:#ae81ff>512</span> <span style=color:#f92672>#</span>:width <span style=color:#ae81ff>512</span>)
</span></span></code></pre></td></tr></table></div></div><img src=49-1.png width=30% height=auto alt=49-1.png><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>(<span style=color:#a6e22e>paint</span> diags-&gt;painter <span style=color:#f92672>#</span>:height <span style=color:#ae81ff>512</span> <span style=color:#f92672>#</span>:width <span style=color:#ae81ff>512</span>)
</span></span></code></pre></td></tr></table></div></div><img src=49-2.png width=30% height=auto alt=49-2.png><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>(<span style=color:#a6e22e>paint</span> midpoints-&gt;painter <span style=color:#f92672>#</span>:height <span style=color:#ae81ff>512</span> <span style=color:#f92672>#</span>:width <span style=color:#ae81ff>512</span>)
</span></span></code></pre></td></tr></table></div></div><img src=49-3.png width=30% height=auto alt=49-3.png><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>(<span style=color:#a6e22e>paint</span> wave-&gt;painter <span style=color:#f92672>#</span>:height <span style=color:#ae81ff>512</span> <span style=color:#f92672>#</span>:width <span style=color:#ae81ff>512</span>)
</span></span></code></pre></td></tr></table></div></div><img src=49-4.png width=30% height=auto alt=49-4.png><h3 id=练习-50>练习 50</h3><p>请定义变换 <code>flip-horiz</code>，它能在水平方向上反转画家。再定义出对画家做反时针方向 180 度和 270 度旋转的变换。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#f92672>#</span>lang sicp
</span></span><span style=display:flex><span>(<span style=color:#f92672>#</span>%require sicp-pict)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>flip-horiz</span> painter)
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>transform-painter</span> painter
</span></span><span style=display:flex><span>                     (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>1.0</span> <span style=color:#ae81ff>0.0</span>)
</span></span><span style=display:flex><span>                     (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>0.0</span> <span style=color:#ae81ff>0.0</span>)
</span></span><span style=display:flex><span>                     (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>1.0</span> <span style=color:#ae81ff>1.0</span>)))
</span></span></code></pre></td></tr></table></div></div><h3 id=练习-51>练习 51</h3><p>定义对画家的 <code>below</code> 操作，它以两个画家为参数。在给定了一个框架后，由 <code>below</code> 得到的画家将要求第一个画家在框架的下部画图，要求第二个画家在框架的上部画图。请按两种方式定义 <code>below</code>：首先写出一个类似于上面 <code>beside</code> 的过程：另一个则直接通过 <code>beside</code> 和适当的旋转操作（来自
<a href=#%e7%bb%83%e4%b9%a0-50 title="练习 50">练习 50
</a>）完成有关工作。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#f92672>#</span>lang sicp
</span></span><span style=display:flex><span>(<span style=color:#f92672>#</span>%require sicp-pict)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>below</span> painter1 painter2)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>split-point</span> (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>0.0</span> <span style=color:#ae81ff>0.5</span>)))
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>paint-below</span>
</span></span><span style=display:flex><span>           (<span style=color:#a6e22e>transform-painter</span> painter1
</span></span><span style=display:flex><span>                              (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>0.0</span> <span style=color:#ae81ff>0.0</span>)
</span></span><span style=display:flex><span>                              (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>1.0</span> <span style=color:#ae81ff>0.0</span>)
</span></span><span style=display:flex><span>                              split-point))
</span></span><span style=display:flex><span>          (<span style=color:#a6e22e>paint-up</span>
</span></span><span style=display:flex><span>           (<span style=color:#a6e22e>transform-painter</span> painter2
</span></span><span style=display:flex><span>                              split-point
</span></span><span style=display:flex><span>                              (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>1.0</span> <span style=color:#ae81ff>0.5</span>)
</span></span><span style=display:flex><span>                              (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>0.0</span> <span style=color:#ae81ff>1.0</span>))))
</span></span><span style=display:flex><span>      (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>frame</span>)
</span></span><span style=display:flex><span>        (<span style=color:#a6e22e>paint-below</span> frame)
</span></span><span style=display:flex><span>        (<span style=color:#a6e22e>paint-up</span> frame)))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#;(define (below painter1 painter2)
</span></span></span><span style=display:flex><span><span style=color:#75715e>  (rotate270 (beside (rotate90 painter2)
</span></span></span><span style=display:flex><span><span style=color:#75715e>                     (rotate90 painter1))))</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=练习-52>练习 52</h3><p>在上面描述的各个层次上工作，修改图 2-9 中所示的方块的限制。特别是：</p><p>a) 给
<a href=#%e7%bb%83%e4%b9%a0-49 title="练习 49">练习 49</a> 的基本 wave 画家加入某些线段（例如，加上一个笑脸）。</p><p>b) 修改 <code>corner-split</code> 的构造模式（例如，只用 <code>up-split</code> 和 <code>right-split</code> 的图像的各一个副本，而不是两个）。</p><p>c) 修改 <code>square-limit</code>，换一种使用 <code>square-of-four</code> 的方式，以另一种不同模式组合起各个角区（例如，你可以让大的 Rogers 先生从正方形的每个角向外看）。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">47
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">48
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">49
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">50
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">51
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">52
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">53
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">54
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">55
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">56
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">57
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">58
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">59
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">60
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">61
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">62
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">63
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#f92672>#</span>lang sicp
</span></span><span style=display:flex><span>(<span style=color:#f92672>#</span>%require sicp-pict)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>wave-smile-&gt;painter</span> frame)
</span></span><span style=display:flex><span>  ((<span style=color:#a6e22e>segments-&gt;painter</span>
</span></span><span style=display:flex><span>    (<span style=color:#a6e22e>list</span>
</span></span><span style=display:flex><span>     (<span style=color:#a6e22e>make-segment</span> (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>0.20</span> <span style=color:#ae81ff>0.00</span>) (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>0.35</span> <span style=color:#ae81ff>0.50</span>))
</span></span><span style=display:flex><span>     (<span style=color:#a6e22e>make-segment</span> (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>0.35</span> <span style=color:#ae81ff>0.50</span>) (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>0.30</span> <span style=color:#ae81ff>0.60</span>))
</span></span><span style=display:flex><span>     (<span style=color:#a6e22e>make-segment</span> (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>0.30</span> <span style=color:#ae81ff>0.60</span>) (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>0.15</span> <span style=color:#ae81ff>0.45</span>))
</span></span><span style=display:flex><span>     (<span style=color:#a6e22e>make-segment</span> (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>0.15</span> <span style=color:#ae81ff>0.45</span>) (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>0.00</span> <span style=color:#ae81ff>0.60</span>))
</span></span><span style=display:flex><span>     (<span style=color:#a6e22e>make-segment</span> (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>0.00</span> <span style=color:#ae81ff>0.80</span>) (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>0.15</span> <span style=color:#ae81ff>0.65</span>))
</span></span><span style=display:flex><span>     (<span style=color:#a6e22e>make-segment</span> (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>0.15</span> <span style=color:#ae81ff>0.65</span>) (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>0.30</span> <span style=color:#ae81ff>0.70</span>))
</span></span><span style=display:flex><span>     (<span style=color:#a6e22e>make-segment</span> (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>0.30</span> <span style=color:#ae81ff>0.70</span>) (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>0.40</span> <span style=color:#ae81ff>0.70</span>))
</span></span><span style=display:flex><span>     (<span style=color:#a6e22e>make-segment</span> (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>0.40</span> <span style=color:#ae81ff>0.70</span>) (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>0.35</span> <span style=color:#ae81ff>0.85</span>))
</span></span><span style=display:flex><span>     (<span style=color:#a6e22e>make-segment</span> (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>0.35</span> <span style=color:#ae81ff>0.85</span>) (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>0.40</span> <span style=color:#ae81ff>1.00</span>))
</span></span><span style=display:flex><span>     (<span style=color:#a6e22e>make-segment</span> (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>0.60</span> <span style=color:#ae81ff>1.00</span>) (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>0.65</span> <span style=color:#ae81ff>0.85</span>))
</span></span><span style=display:flex><span>     (<span style=color:#a6e22e>make-segment</span> (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>0.65</span> <span style=color:#ae81ff>0.85</span>) (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>0.60</span> <span style=color:#ae81ff>0.70</span>))
</span></span><span style=display:flex><span>     (<span style=color:#a6e22e>make-segment</span> (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>0.60</span> <span style=color:#ae81ff>0.70</span>) (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>0.75</span> <span style=color:#ae81ff>0.70</span>))
</span></span><span style=display:flex><span>     (<span style=color:#a6e22e>make-segment</span> (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>0.75</span> <span style=color:#ae81ff>0.70</span>) (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>1.00</span> <span style=color:#ae81ff>0.40</span>))
</span></span><span style=display:flex><span>     (<span style=color:#a6e22e>make-segment</span> (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>1.00</span> <span style=color:#ae81ff>0.20</span>) (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>0.60</span> <span style=color:#ae81ff>0.48</span>))
</span></span><span style=display:flex><span>     (<span style=color:#a6e22e>make-segment</span> (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>0.60</span> <span style=color:#ae81ff>0.48</span>) (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>0.80</span> <span style=color:#ae81ff>0.00</span>))
</span></span><span style=display:flex><span>     (<span style=color:#a6e22e>make-segment</span> (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>0.40</span> <span style=color:#ae81ff>0.00</span>) (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>0.50</span> <span style=color:#ae81ff>0.30</span>))
</span></span><span style=display:flex><span>     (<span style=color:#a6e22e>make-segment</span> (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>0.50</span> <span style=color:#ae81ff>0.30</span>) (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>0.60</span> <span style=color:#ae81ff>0.00</span>))
</span></span><span style=display:flex><span>     (<span style=color:#a6e22e>make-segment</span> (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>0.40</span> <span style=color:#ae81ff>0.90</span>) (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>0.425</span> <span style=color:#ae81ff>0.95</span>))
</span></span><span style=display:flex><span>     (<span style=color:#a6e22e>make-segment</span> (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>0.425</span> <span style=color:#ae81ff>0.95</span>) (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>0.45</span> <span style=color:#ae81ff>0.90</span>))
</span></span><span style=display:flex><span>     (<span style=color:#a6e22e>make-segment</span> (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>0.55</span> <span style=color:#ae81ff>0.90</span>) (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>0.575</span> <span style=color:#ae81ff>0.95</span>))
</span></span><span style=display:flex><span>     (<span style=color:#a6e22e>make-segment</span> (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>0.575</span> <span style=color:#ae81ff>0.95</span>) (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>0.60</span> <span style=color:#ae81ff>0.90</span>))
</span></span><span style=display:flex><span>     (<span style=color:#a6e22e>make-segment</span> (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>0.47</span> <span style=color:#ae81ff>0.80</span>) (<span style=color:#a6e22e>make-vect</span> <span style=color:#ae81ff>0.53</span> <span style=color:#ae81ff>0.80</span>))))
</span></span><span style=display:flex><span>   frame))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>split</span> orient1 orient2)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>iter</span> painter n)
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>if </span>(= n <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>        painter
</span></span><span style=display:flex><span>        (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>smaller</span> (<span style=color:#a6e22e>iter</span> painter (- n <span style=color:#ae81ff>1</span>))))
</span></span><span style=display:flex><span>          (<span style=color:#a6e22e>orient1</span> painter (<span style=color:#a6e22e>orient2</span> smaller smaller)))))
</span></span><span style=display:flex><span>  iter)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>right-split (<span style=color:#a6e22e>split</span> beside below))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>up-split (<span style=color:#a6e22e>split</span> below beside))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>corner-split</span> painter n)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>if </span>(= n <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>      painter
</span></span><span style=display:flex><span>      (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>up</span> (<span style=color:#a6e22e>up-split</span> painter (- n <span style=color:#ae81ff>1</span>)))
</span></span><span style=display:flex><span>            (<span style=color:#a6e22e>right</span> (<span style=color:#a6e22e>right-split</span> painter (- n <span style=color:#ae81ff>1</span>))))
</span></span><span style=display:flex><span>        (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>top-left</span> up)
</span></span><span style=display:flex><span>              (<span style=color:#a6e22e>bottom-right</span> right)
</span></span><span style=display:flex><span>              (<span style=color:#a6e22e>corner</span> (<span style=color:#a6e22e>corner-split</span> painter (- n <span style=color:#ae81ff>1</span>))))
</span></span><span style=display:flex><span>          (<span style=color:#a6e22e>beside</span> (<span style=color:#a6e22e>below</span> painter top-left)
</span></span><span style=display:flex><span>                  (<span style=color:#a6e22e>below</span> bottom-right corner))))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>square-of-four</span> tl tr bl br)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>painter</span>)
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>top</span> (<span style=color:#a6e22e>beside</span> (<span style=color:#a6e22e>tl</span> painter) (<span style=color:#a6e22e>tr</span> painter)))
</span></span><span style=display:flex><span>          (<span style=color:#a6e22e>bottom</span> (<span style=color:#a6e22e>beside</span> (<span style=color:#a6e22e>bl</span> painter) (<span style=color:#a6e22e>br</span> painter))))
</span></span><span style=display:flex><span>      (<span style=color:#a6e22e>below</span> bottom top))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>square-limit</span> painter n)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>combine4</span> (<span style=color:#a6e22e>square-of-four</span> identity flip-horiz
</span></span><span style=display:flex><span>                                  flip-vert rotate180)))
</span></span><span style=display:flex><span>    (<span style=color:#a6e22e>combine4</span> (<span style=color:#a6e22e>corner-split</span> painter n))))
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>(<span style=color:#a6e22e>paint</span> wave-smile-&gt;painter <span style=color:#f92672>#</span>:height <span style=color:#ae81ff>512</span> <span style=color:#f92672>#</span>:width <span style=color:#ae81ff>512</span>)
</span></span></code></pre></td></tr></table></div></div><img src=52-1.png width=30% height=auto alt=52-1.png><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>(<span style=color:#a6e22e>paint</span> (<span style=color:#a6e22e>corner-split</span> wave-smile-&gt;painter <span style=color:#ae81ff>3</span>) <span style=color:#f92672>#</span>:height <span style=color:#ae81ff>512</span> <span style=color:#f92672>#</span>:width <span style=color:#ae81ff>512</span>)
</span></span></code></pre></td></tr></table></div></div><img src=52-2.png width=30% height=auto alt=52-2.png><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>(<span style=color:#a6e22e>paint</span> (<span style=color:#a6e22e>square-limit</span> einstein <span style=color:#ae81ff>3</span>) <span style=color:#f92672>#</span>:height <span style=color:#ae81ff>512</span> <span style=color:#f92672>#</span>:width <span style=color:#ae81ff>512</span>)
</span></span></code></pre></td></tr></table></div></div><img src=52-3.jpg width=30% height=auto alt=52-3.jpg><h3 id=练习-53>练习 53</h3><p>解释器在求值下面的各个表达式时将打印出什么？</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>(list <span style=color:#e6db74>&#39;a</span> <span style=color:#e6db74>&#39;b</span> <span style=color:#e6db74>&#39;c</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(list (list <span style=color:#e6db74>&#39;george</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(cdr <span style=color:#f92672>&#39;</span>((<span style=color:#a6e22e>x1</span> x2) (<span style=color:#a6e22e>y1</span> y2)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(cadr <span style=color:#f92672>&#39;</span>((<span style=color:#a6e22e>x1</span> x2) (<span style=color:#a6e22e>y1</span> y2)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(pair? (car <span style=color:#f92672>&#39;</span>(a short list)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(memq <span style=color:#e6db74>&#39;red</span> <span style=color:#f92672>&#39;</span>((<span style=color:#a6e22e>red</span> shoes) (<span style=color:#a6e22e>blue</span> socks)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(memq <span style=color:#e6db74>&#39;red</span> <span style=color:#f92672>&#39;</span>(red shoes blue socks))
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#f92672>#</span>lang sicp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(list <span style=color:#e6db74>&#39;a</span> <span style=color:#e6db74>&#39;b</span> <span style=color:#e6db74>&#39;c</span>)
</span></span><span style=display:flex><span><span style=color:#75715e>;: (a b c)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(list (list <span style=color:#e6db74>&#39;george</span>))
</span></span><span style=display:flex><span><span style=color:#75715e>;: ((george))</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(cdr <span style=color:#f92672>&#39;</span>((<span style=color:#a6e22e>x1</span> x2) (<span style=color:#a6e22e>y1</span> y2)))
</span></span><span style=display:flex><span><span style=color:#75715e>;: ((y1 y2))</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(cadr <span style=color:#f92672>&#39;</span>((<span style=color:#a6e22e>x1</span> x2) (<span style=color:#a6e22e>y1</span> y2)))
</span></span><span style=display:flex><span><span style=color:#75715e>;: (y1 y2)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(pair? (car <span style=color:#f92672>&#39;</span>(a short list)))
</span></span><span style=display:flex><span><span style=color:#75715e>;: #f</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(memq <span style=color:#e6db74>&#39;red</span> <span style=color:#f92672>&#39;</span>((<span style=color:#a6e22e>red</span> shoes) (<span style=color:#a6e22e>blue</span> socks)))
</span></span><span style=display:flex><span><span style=color:#75715e>;: #f</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(memq <span style=color:#e6db74>&#39;red</span> <span style=color:#f92672>&#39;</span>(red shoes blue socks))
</span></span><span style=display:flex><span><span style=color:#75715e>;: (red shoes blue socks)</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=练习-54>练习 54</h3><p>如果两个表包含着同样元素，这些元素也按同样顺序排列，那么就称这两个表 <code>equal?</code>。例如：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>(equal? <span style=color:#f92672>&#39;</span>(this is a list) <span style=color:#f92672>&#39;</span>(this is a list))
</span></span></code></pre></td></tr></table></div></div><p>是真；而</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>(equal? <span style=color:#f92672>&#39;</span>(this is a list) <span style=color:#f92672>&#39;</span>(this (<span style=color:#a6e22e>is</span> a) list))
</span></span></code></pre></td></tr></table></div></div><p>是假。说得更准确些，我们可以从符号相等的基本 <code>eq?</code> 出发，以递归方式定义出 <code>equal?</code>。<code>a</code> 和 <code>b</code> 是 <code>equal?</code> 的，如果它们都是符号，而且这两个符号满足 <code>eq?</code>；或者它们都是表，而且 <code>(car a)</code> 和 <code>(car b)</code> 相互 <code>equal?</code>，它们的 <code>(cdr a)</code> 和 <code>(cdr b)</code> 也是 <code>equal?</code>。请利用这一思路定义出 <code>equal?</code> 过程。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#f92672>#</span>lang sicp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(equal? a b)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>if </span>(null? a)
</span></span><span style=display:flex><span>      (<span style=color:#66d9ef>if </span>(null? b)
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>#t</span>
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>#f</span>)
</span></span><span style=display:flex><span>      (<span style=color:#66d9ef>if </span>(null? b)
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>#f</span>
</span></span><span style=display:flex><span>          (<span style=color:#66d9ef>if </span>(not (pair? (car a)))
</span></span><span style=display:flex><span>              (<span style=color:#66d9ef>if </span>(not (pair? (car b)))
</span></span><span style=display:flex><span>                  (<span style=color:#66d9ef>and </span>(eq? (car a) (car b))
</span></span><span style=display:flex><span>                       (equal? (cdr a) (cdr b)))
</span></span><span style=display:flex><span>                  <span style=color:#66d9ef>#f</span>)
</span></span><span style=display:flex><span>              (<span style=color:#66d9ef>if </span>(not (pair? (car b)))
</span></span><span style=display:flex><span>                  <span style=color:#66d9ef>#f</span>
</span></span><span style=display:flex><span>                  (<span style=color:#66d9ef>and </span>(equal? (car a) (car b))
</span></span><span style=display:flex><span>                       (equal? (cdr a) (cdr b))))))))
</span></span></code></pre></td></tr></table></div></div><h3 id=练习-55>练习 55</h3><p>Eva Lu Ator 输入了表达式：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>(car <span style=color:#f92672>&#39;</span><span style=color:#e6db74>&#39;abracadabra</span>)
</span></span></code></pre></td></tr></table></div></div><p>令她吃惊的是解释器打印出的是 <code>quote</code>。请解释这一情况。</p><p>由于 <code>'</code> 实际是 <code>quote</code> 过程，即 <code>'abracadabra</code> 为 <code>(quote abracadabra)</code>，因此 <code>(car ''abracadabra)</code> 为 <code>(car '(quote abracadabra))</code>，会输出 <code>quote</code>。</p><h3 id=练习-56>练习 56</h3><p>请说明如何扩充基本求导规则，以便能够处理更多种类的表达式。例如，通过给程序 <code>deriv</code> 增加一个新子句，并以适当方式定义过程 <code>exponentiation?</code>、<code>base</code>、<code>exponent</code> 和 <code>make-exponentiation</code> 的方式，实现下述求导规则（你可以考虑用符号 <code>**</code> 表示乘幂）：</p><p>$$
\frac{\mathrm{d}(u^n)}{\mathrm{d}x} = nu^{n-1}\left(\frac{\mathrm{d}u}{\mathrm{d}x}\right)
$$</p><p>请将如下规则也构造到程序里：任何东西的 $0$ 次幂都是 $1$，而它们的 $1$ 次幂都是其自身。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">47
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">48
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">49
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">50
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">51
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">52
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">53
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">54
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">55
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">56
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">57
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">58
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">59
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">60
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">61
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">62
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">63
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">64
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">65
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">66
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">67
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">68
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">69
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">70
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">71
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">72
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">73
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">74
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">75
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">76
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">77
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">78
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">79
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">80
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">81
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#f92672>#</span>lang sicp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>=number?</span> exp num)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>and </span>(number? exp) (= exp num)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>**</span> base exponent)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>iter</span> exponent r)
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>if </span>(= exponent <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>        r
</span></span><span style=display:flex><span>        (<span style=color:#a6e22e>iter</span> (- exponent <span style=color:#ae81ff>1</span>) (* r base))))
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>iter</span> exponent <span style=color:#ae81ff>1</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>deriv</span> exp var)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>cond </span>((number? exp) <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>        ((<span style=color:#a6e22e>variable?</span> exp)
</span></span><span style=display:flex><span>         (<span style=color:#66d9ef>if </span>(<span style=color:#a6e22e>same-variable?</span> exp var) <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>0</span>))
</span></span><span style=display:flex><span>        ((<span style=color:#a6e22e>sum?</span> exp)
</span></span><span style=display:flex><span>         (<span style=color:#a6e22e>make-sum</span> (<span style=color:#a6e22e>deriv</span> (<span style=color:#a6e22e>addend</span> exp) var)
</span></span><span style=display:flex><span>                   (<span style=color:#a6e22e>deriv</span> (<span style=color:#a6e22e>augend</span> exp) var)))
</span></span><span style=display:flex><span>        ((<span style=color:#a6e22e>product?</span> exp)
</span></span><span style=display:flex><span>         (<span style=color:#a6e22e>make-sum</span>
</span></span><span style=display:flex><span>          (<span style=color:#a6e22e>make-product</span> (<span style=color:#a6e22e>multiplier</span> exp)
</span></span><span style=display:flex><span>                        (<span style=color:#a6e22e>deriv</span> (<span style=color:#a6e22e>multiplicand</span> exp) var))
</span></span><span style=display:flex><span>          (<span style=color:#a6e22e>make-product</span> (<span style=color:#a6e22e>deriv</span> (<span style=color:#a6e22e>multiplier</span> exp) var)
</span></span><span style=display:flex><span>                        (<span style=color:#a6e22e>multiplicand</span> exp))))
</span></span><span style=display:flex><span>        ((<span style=color:#a6e22e>exponentiation?</span> exp)
</span></span><span style=display:flex><span>         (<span style=color:#a6e22e>make-product</span>
</span></span><span style=display:flex><span>          (<span style=color:#a6e22e>make-product</span>
</span></span><span style=display:flex><span>           (<span style=color:#a6e22e>exponent</span> exp)
</span></span><span style=display:flex><span>           (<span style=color:#a6e22e>make-exponentiation</span> (<span style=color:#a6e22e>base</span> exp) (- (<span style=color:#a6e22e>exponent</span> exp) <span style=color:#ae81ff>1</span>)))
</span></span><span style=display:flex><span>          (<span style=color:#a6e22e>deriv</span> (<span style=color:#a6e22e>base</span> exp) var)))
</span></span><span style=display:flex><span>        (<span style=color:#a6e22e>else</span>
</span></span><span style=display:flex><span>         (<span style=color:#a6e22e>error</span> <span style=color:#e6db74>&#34;unknow expression type --- DERIV&#34;</span> exp))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>variable?</span> x) (symbol? x))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>same-variable?</span> v1 v2)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>and </span>(<span style=color:#a6e22e>variable?</span> v1) (<span style=color:#a6e22e>variable?</span> v2) (eq? v1 v2)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>make-sum</span> a1 a2)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>cond </span>((<span style=color:#a6e22e>=number?</span> a1 <span style=color:#ae81ff>0</span>) a2)
</span></span><span style=display:flex><span>        ((<span style=color:#a6e22e>=number?</span> a2 <span style=color:#ae81ff>0</span>) a1)
</span></span><span style=display:flex><span>        ((<span style=color:#66d9ef>and </span>(number? a1) (number? a2)) (+ a1 a2))
</span></span><span style=display:flex><span>        (<span style=color:#66d9ef>else </span>(list <span style=color:#e6db74>&#39;+</span> a1 a2))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>make-product</span> m1 m2)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>cond </span>((<span style=color:#66d9ef>or </span>(<span style=color:#a6e22e>=number?</span> m1 <span style=color:#ae81ff>0</span>) (<span style=color:#a6e22e>=number?</span> m2 <span style=color:#ae81ff>0</span>)) <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>        ((<span style=color:#a6e22e>=number?</span> m1 <span style=color:#ae81ff>1</span>) m2)
</span></span><span style=display:flex><span>        ((<span style=color:#a6e22e>=number?</span> m2 <span style=color:#ae81ff>1</span>) m1)
</span></span><span style=display:flex><span>        ((<span style=color:#66d9ef>and </span>(number? m1) (number? m2)) (* m1 m2))
</span></span><span style=display:flex><span>        (<span style=color:#66d9ef>else </span>(list <span style=color:#e6db74>&#39;*</span> m1 m2))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>sum?</span> x)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>and </span>(pair? x) (eq? (car x) <span style=color:#e6db74>&#39;+</span>)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>addend</span> s) (cadr s))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>augend</span> s) (caddr s))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>product?</span> x)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>and </span>(pair? x) (eq? (car x) <span style=color:#e6db74>&#39;*</span>)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>multiplier</span> p) (cadr p))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>multiplicand</span> p) (caddr p))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>make-exponentiation</span> b e)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>cond </span>((<span style=color:#a6e22e>=number?</span> e <span style=color:#ae81ff>0</span>) <span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>        ((<span style=color:#a6e22e>=number?</span> e <span style=color:#ae81ff>1</span>) b)
</span></span><span style=display:flex><span>        ((<span style=color:#66d9ef>and </span>(number? b) (number? e)) (<span style=color:#a6e22e>**</span> b e))
</span></span><span style=display:flex><span>        (<span style=color:#66d9ef>else </span>(list <span style=color:#e6db74>&#39;**</span> b e))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>exponentiation?</span> x)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>and </span>(pair? x) (eq? (car x) <span style=color:#e6db74>&#39;**</span>)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>base</span> e) (cadr e))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>exponent</span> e) (caddr e))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (deriv &#39;(* (** x 3) y) &#39;x)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: (* (* 3 (** x 2)) y)</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=练习-57>练习 57</h3><p>请扩充求导程序，使之能处理任意项（两项或者更多项）的和与乘积。这样，上面的最后一个例子就可以表示为：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>(<span style=color:#a6e22e>deriv</span> <span style=color:#f92672>&#39;</span>(* x y (+ x <span style=color:#ae81ff>3</span>)) <span style=color:#e6db74>&#39;x</span>)
</span></span></code></pre></td></tr></table></div></div><p>设法通过只修改和与乘积的表示，而完全不修改过程 <code>deriv</code> 的方式完成这一扩充。例如，让一个和式的 <code>addend</code> 是它的第一项，而其 <code>augend</code> 是和式中的其余项。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 29
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 30
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 31
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 32
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 33
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 34
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 35
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 36
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 37
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 38
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 39
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 40
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 41
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 42
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 43
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 44
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 45
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 46
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 47
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 48
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 49
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 50
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 51
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 52
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 53
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 54
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 55
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 56
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 57
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 58
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 59
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 60
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 61
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 62
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 63
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 64
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 65
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 66
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 67
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 68
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 69
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 70
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 71
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 72
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 73
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 74
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 75
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 76
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 77
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 78
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 79
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 80
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 81
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 82
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 83
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 84
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 85
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 86
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 87
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 88
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 89
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 90
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 91
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 92
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 93
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 94
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 95
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 96
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 97
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 98
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 99
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">100
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">101
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">102
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">103
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">104
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">105
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">106
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">107
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">108
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">109
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">110
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">111
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">112
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">113
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">114
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">115
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">116
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">117
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">118
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">119
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">120
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">121
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">122
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">123
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">124
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#f92672>#</span>lang sicp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(length l)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>iter</span> l r)
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>if </span>(null? l)
</span></span><span style=display:flex><span>        r
</span></span><span style=display:flex><span>        (<span style=color:#a6e22e>iter</span> (cdr l) (+ r <span style=color:#ae81ff>1</span>))))
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>iter</span> l <span style=color:#ae81ff>0</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>filter</span> predicate sequence)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>cond </span>((null? sequence) nil)
</span></span><span style=display:flex><span>        ((<span style=color:#a6e22e>predicate</span> (car sequence))
</span></span><span style=display:flex><span>         (cons (car sequence)
</span></span><span style=display:flex><span>               (<span style=color:#a6e22e>filter</span> predicate (cdr sequence))))
</span></span><span style=display:flex><span>        (<span style=color:#66d9ef>else </span>(<span style=color:#a6e22e>filter</span> predicate (cdr sequence)))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>=number?</span> exp num)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>and </span>(number? exp) (= exp num)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>**</span> base exponent)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>iter</span> exponent r)
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>if </span>(= exponent <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>        r
</span></span><span style=display:flex><span>        (<span style=color:#a6e22e>iter</span> (- exponent <span style=color:#ae81ff>1</span>) (* r base))))
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>iter</span> exponent <span style=color:#ae81ff>1</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>deriv</span> exp var)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>cond </span>((number? exp) <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>        ((<span style=color:#a6e22e>variable?</span> exp)
</span></span><span style=display:flex><span>         (<span style=color:#66d9ef>if </span>(<span style=color:#a6e22e>same-variable?</span> exp var) <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>0</span>))
</span></span><span style=display:flex><span>        ((<span style=color:#a6e22e>sum?</span> exp)
</span></span><span style=display:flex><span>         (<span style=color:#a6e22e>make-sum</span> (<span style=color:#a6e22e>deriv</span> (<span style=color:#a6e22e>addend</span> exp) var)
</span></span><span style=display:flex><span>                   (<span style=color:#a6e22e>deriv</span> (<span style=color:#a6e22e>augend</span> exp) var)))
</span></span><span style=display:flex><span>        ((<span style=color:#a6e22e>product?</span> exp)
</span></span><span style=display:flex><span>         (<span style=color:#a6e22e>make-sum</span>
</span></span><span style=display:flex><span>          (<span style=color:#a6e22e>make-product</span> (<span style=color:#a6e22e>multiplier</span> exp)
</span></span><span style=display:flex><span>                        (<span style=color:#a6e22e>deriv</span> (<span style=color:#a6e22e>multiplicand</span> exp) var))
</span></span><span style=display:flex><span>          (<span style=color:#a6e22e>make-product</span> (<span style=color:#a6e22e>deriv</span> (<span style=color:#a6e22e>multiplier</span> exp) var)
</span></span><span style=display:flex><span>                        (<span style=color:#a6e22e>multiplicand</span> exp))))
</span></span><span style=display:flex><span>        ((<span style=color:#a6e22e>exponentiation?</span> exp)
</span></span><span style=display:flex><span>         (<span style=color:#a6e22e>make-product</span>
</span></span><span style=display:flex><span>          (<span style=color:#a6e22e>make-product</span>
</span></span><span style=display:flex><span>           (<span style=color:#a6e22e>exponent</span> exp)
</span></span><span style=display:flex><span>           (<span style=color:#a6e22e>make-exponentiation</span> (<span style=color:#a6e22e>base</span> exp) (- (<span style=color:#a6e22e>exponent</span> exp) <span style=color:#ae81ff>1</span>)))
</span></span><span style=display:flex><span>          (<span style=color:#a6e22e>deriv</span> (<span style=color:#a6e22e>base</span> exp) var)))
</span></span><span style=display:flex><span>        (<span style=color:#a6e22e>else</span>
</span></span><span style=display:flex><span>         (<span style=color:#a6e22e>error</span> <span style=color:#e6db74>&#34;unknow expression type --- DERIV&#34;</span> exp))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>variable?</span> x) (symbol? x))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>same-variable?</span> v1 v2)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>and </span>(<span style=color:#a6e22e>variable?</span> v1) (<span style=color:#a6e22e>variable?</span> v2) (eq? v1 v2)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>make-sum</span> a1 <span style=color:#f92672>.</span> a2)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>a3</span> (<span style=color:#a6e22e>filter</span>
</span></span><span style=display:flex><span>             (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>x</span>) (<span style=color:#66d9ef>or </span>(pair? x) (not (<span style=color:#a6e22e>=number?</span> x <span style=color:#ae81ff>0</span>))))
</span></span><span style=display:flex><span>             a2)))
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>cond </span>((= (length a3) <span style=color:#ae81ff>0</span>) a1)
</span></span><span style=display:flex><span>          ((= (length a3) <span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>           (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>a</span> (car a3)))
</span></span><span style=display:flex><span>             (<span style=color:#66d9ef>cond </span>((<span style=color:#a6e22e>=number?</span> a1 <span style=color:#ae81ff>0</span>) a)
</span></span><span style=display:flex><span>                   ((<span style=color:#a6e22e>=number?</span> a <span style=color:#ae81ff>0</span>) a1)
</span></span><span style=display:flex><span>                   ((<span style=color:#66d9ef>and </span>(number? a1) (number? a)) (+ a1 a))
</span></span><span style=display:flex><span>                   (<span style=color:#66d9ef>else </span>(list <span style=color:#e6db74>&#39;+</span> a1 a)))))
</span></span><span style=display:flex><span>          (<span style=color:#a6e22e>else</span>
</span></span><span style=display:flex><span>           (<span style=color:#66d9ef>if </span>(<span style=color:#a6e22e>=number?</span> a1 <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>               (cons <span style=color:#e6db74>&#39;+</span> a3)
</span></span><span style=display:flex><span>               (cons <span style=color:#e6db74>&#39;+</span> (cons a1 a3)))))))
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>make-product</span> m1 <span style=color:#f92672>.</span> m2)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>m3</span> (<span style=color:#a6e22e>filter</span>
</span></span><span style=display:flex><span>             (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>x</span>) (<span style=color:#66d9ef>or </span>(pair? x) (not (<span style=color:#a6e22e>=number?</span> x <span style=color:#ae81ff>1</span>))))
</span></span><span style=display:flex><span>             m2)))
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>cond </span>((&gt; (length (<span style=color:#a6e22e>filter</span>
</span></span><span style=display:flex><span>                      (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>x</span>) (<span style=color:#66d9ef>and </span>(not (pair? x)) (<span style=color:#a6e22e>=number?</span> x <span style=color:#ae81ff>0</span>)))
</span></span><span style=display:flex><span>                      m3)) <span style=color:#ae81ff>0</span>) <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>          ((= (length m3) <span style=color:#ae81ff>0</span>) m1)
</span></span><span style=display:flex><span>          ((= (length m3) <span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>           (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>m</span> (car m3)))
</span></span><span style=display:flex><span>             (<span style=color:#66d9ef>cond </span>((<span style=color:#66d9ef>or </span>(<span style=color:#a6e22e>=number?</span> m1 <span style=color:#ae81ff>0</span>) (<span style=color:#a6e22e>=number?</span> m <span style=color:#ae81ff>0</span>)) <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>                   ((<span style=color:#a6e22e>=number?</span> m1 <span style=color:#ae81ff>1</span>) m)
</span></span><span style=display:flex><span>                   ((<span style=color:#a6e22e>=number?</span> m <span style=color:#ae81ff>1</span>) m1)
</span></span><span style=display:flex><span>                   ((<span style=color:#66d9ef>and </span>(number? m1) (number? m)) (* m1 m))
</span></span><span style=display:flex><span>                   (<span style=color:#66d9ef>else </span>(list <span style=color:#e6db74>&#39;*</span> m1 m)))))
</span></span><span style=display:flex><span>          (<span style=color:#a6e22e>else</span>
</span></span><span style=display:flex><span>           (<span style=color:#66d9ef>cond </span>((<span style=color:#a6e22e>=number?</span> m1 <span style=color:#ae81ff>0</span>) <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>                 ((<span style=color:#a6e22e>=number?</span> m1 <span style=color:#ae81ff>1</span>) (cons <span style=color:#e6db74>&#39;*</span> m3))
</span></span><span style=display:flex><span>                 (<span style=color:#66d9ef>else </span>(cons <span style=color:#e6db74>&#39;*</span> (cons m1 m3))))))))
</span></span><span style=display:flex><span>               
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>sum?</span> x)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>and </span>(pair? x) (eq? (car x) <span style=color:#e6db74>&#39;+</span>)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>addend</span> s) (cadr s))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>augend</span> s)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>if </span>(= (length s) <span style=color:#ae81ff>3</span>)
</span></span><span style=display:flex><span>      (caddr s)
</span></span><span style=display:flex><span>      (cons <span style=color:#e6db74>&#39;+</span> (cddr s))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>product?</span> x)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>and </span>(pair? x) (eq? (car x) <span style=color:#e6db74>&#39;*</span>)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>multiplier</span> p) (cadr p))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>multiplicand</span> p)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>if </span>(= (length p) <span style=color:#ae81ff>3</span>)
</span></span><span style=display:flex><span>      (caddr p)
</span></span><span style=display:flex><span>      (cons <span style=color:#e6db74>&#39;*</span> (cddr p))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>make-exponentiation</span> b e)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>cond </span>((<span style=color:#a6e22e>=number?</span> e <span style=color:#ae81ff>0</span>) <span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>        ((<span style=color:#a6e22e>=number?</span> e <span style=color:#ae81ff>1</span>) b)
</span></span><span style=display:flex><span>        ((<span style=color:#66d9ef>and </span>(number? b) (number? e)) (<span style=color:#a6e22e>**</span> b e))
</span></span><span style=display:flex><span>        (<span style=color:#66d9ef>else </span>(list <span style=color:#e6db74>&#39;**</span> b e))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>exponentiation?</span> x)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>and </span>(pair? x) (eq? (car x) <span style=color:#e6db74>&#39;**</span>)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>base</span> e) (cadr e))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>exponent</span> e) (caddr e))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (deriv &#39;(* x y (+ x 3)) &#39;x)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: (+ (* x y) (* y (+ x 3)))</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=练习-58>练习 58</h3><p>假定我们希望修改求导程序，使它能用于常规数学公式，其中 <code>+</code> 和 <code>*</code> 采用的是中缀运算符而不是前缀。由于求导程序使基于抽象数据定义的，要修改它，使之能用于另一种不同的表达式表示，我们只需要换一套工作在新的、求导程序需要使用的代数表达式的表示形式上的谓词、选择函数和构造函数。</p><p>a) 请说明怎样做出这些过程，以便完成在中缀表示形式（例如 <code>(x + (3 * (x + (y + 2))))</code> 上的代数表达式求导。为了简化有关的工作，现在可以假定 <code>+</code> 和 <code>*</code> 总是取两个参数，而且表达式中已经加上了所有的括号。</p><p>b) 如果允许标准的代数写法，例如 <code>(x + 3 * (x + y + 2))</code>，问题就会变得更困难许多。在这种表达式里可能不写不必要的括号。并要假定乘法应该在加法之前完成。你还能为这种表示方式设计好适当的谓词、选择函数和构造函数，使我们的求导程序仍然能工作吗？</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">47
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">48
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">49
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">50
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">51
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">52
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">53
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">54
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">55
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">56
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">57
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">58
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">59
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">60
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">61
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">62
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">63
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">64
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">65
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">66
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">67
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">68
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">69
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">70
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">71
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">72
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">73
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">74
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">75
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">76
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">77
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">78
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#f92672>#</span>lang sicp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>deriv</span> exp var)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>cond </span>((number? exp) <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>        ((<span style=color:#a6e22e>variable?</span> exp)
</span></span><span style=display:flex><span>         (<span style=color:#66d9ef>if </span>(<span style=color:#a6e22e>same-variable?</span> exp var) <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>0</span>))
</span></span><span style=display:flex><span>        ((<span style=color:#a6e22e>sum?</span> exp)
</span></span><span style=display:flex><span>         (<span style=color:#a6e22e>make-sum</span> (<span style=color:#a6e22e>deriv</span> (<span style=color:#a6e22e>addend</span> exp) var)
</span></span><span style=display:flex><span>                   (<span style=color:#a6e22e>deriv</span> (<span style=color:#a6e22e>augend</span> exp) var)))
</span></span><span style=display:flex><span>        ((<span style=color:#a6e22e>product?</span> exp)
</span></span><span style=display:flex><span>         (<span style=color:#a6e22e>make-sum</span>
</span></span><span style=display:flex><span>          (<span style=color:#a6e22e>make-product</span> (<span style=color:#a6e22e>multiplier</span> exp)
</span></span><span style=display:flex><span>                        (<span style=color:#a6e22e>deriv</span> (<span style=color:#a6e22e>multiplicand</span> exp) var))
</span></span><span style=display:flex><span>          (<span style=color:#a6e22e>make-product</span> (<span style=color:#a6e22e>deriv</span> (<span style=color:#a6e22e>multiplier</span> exp) var)
</span></span><span style=display:flex><span>                        (<span style=color:#a6e22e>multiplicand</span> exp))))
</span></span><span style=display:flex><span>        ((<span style=color:#a6e22e>exponentiation?</span> exp)
</span></span><span style=display:flex><span>         (<span style=color:#a6e22e>make-product</span>
</span></span><span style=display:flex><span>          (<span style=color:#a6e22e>make-product</span>
</span></span><span style=display:flex><span>           (<span style=color:#a6e22e>exponent</span> exp)
</span></span><span style=display:flex><span>           (<span style=color:#a6e22e>make-exponentiation</span> (<span style=color:#a6e22e>base</span> exp) (- (<span style=color:#a6e22e>exponent</span> exp) <span style=color:#ae81ff>1</span>)))
</span></span><span style=display:flex><span>          (<span style=color:#a6e22e>deriv</span> (<span style=color:#a6e22e>base</span> exp) var)))
</span></span><span style=display:flex><span>        (<span style=color:#a6e22e>else</span>
</span></span><span style=display:flex><span>         (<span style=color:#a6e22e>error</span> <span style=color:#e6db74>&#34;unknow expression type --- DERIV&#34;</span> exp))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>**</span> base exponent)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>iter</span> exponent r)
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>if </span>(= exponent <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>        r
</span></span><span style=display:flex><span>        (<span style=color:#a6e22e>iter</span> (- exponent <span style=color:#ae81ff>1</span>) (* r base))))
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>iter</span> exponent <span style=color:#ae81ff>1</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>=number?</span> exp num)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>and </span>(number? exp) (= exp num)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>variable?</span> v) (symbol? v))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>same-variable?</span> v1 v2)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>and </span>(<span style=color:#a6e22e>variable?</span> v1) (<span style=color:#a6e22e>variable?</span> v2) (eq? v1 v2)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>make-sum</span> a1 a2)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>cond </span>((<span style=color:#a6e22e>=number?</span> a1 <span style=color:#ae81ff>0</span>) a2)
</span></span><span style=display:flex><span>        ((<span style=color:#a6e22e>=number?</span> a2 <span style=color:#ae81ff>0</span>) a1)
</span></span><span style=display:flex><span>        ((<span style=color:#66d9ef>and </span>(number? a1) (number? a2)) (+ a1 a2))
</span></span><span style=display:flex><span>        (<span style=color:#66d9ef>else </span>(list a1 <span style=color:#e6db74>&#39;+</span> a2))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>sum?</span> x) (eq? (cadr x) <span style=color:#e6db74>&#39;+</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>addend</span> s) (car s))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>augend</span> s) (caddr s))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>make-product</span> m1 m2)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>cond </span>((<span style=color:#66d9ef>or </span>(<span style=color:#a6e22e>=number?</span> m1 <span style=color:#ae81ff>0</span>) (<span style=color:#a6e22e>=number?</span> m2 <span style=color:#ae81ff>0</span>)) <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>        ((<span style=color:#a6e22e>=number?</span> m1 <span style=color:#ae81ff>1</span>) m2)
</span></span><span style=display:flex><span>        ((<span style=color:#a6e22e>=number?</span> m2 <span style=color:#ae81ff>1</span>) m1)
</span></span><span style=display:flex><span>        ((<span style=color:#66d9ef>and </span>(number? m1) (number? m2)) (* m1 m2))
</span></span><span style=display:flex><span>        (<span style=color:#66d9ef>else </span>(list m1 <span style=color:#e6db74>&#39;*</span> m2))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>product?</span> x) (eq? (cadr x) <span style=color:#e6db74>&#39;*</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>multiplier</span> p) (car p))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>multiplicand</span> p) (caddr p))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>make-exponentiation</span> b e)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>cond </span>((<span style=color:#a6e22e>=number?</span> e <span style=color:#ae81ff>0</span>) <span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>        ((<span style=color:#a6e22e>=number?</span> e <span style=color:#ae81ff>1</span>) b)
</span></span><span style=display:flex><span>        ((<span style=color:#66d9ef>and </span>(number? b) (number? e)) (<span style=color:#a6e22e>**</span> b e))
</span></span><span style=display:flex><span>        (<span style=color:#66d9ef>else </span>(list b <span style=color:#e6db74>&#39;**</span> e))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>exponentiation?</span> x) (eq? (cadr x) <span style=color:#e6db74>&#39;**</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>base</span> e) (car e))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>exponent</span> e) (caddr e))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (deriv &#39;(x + (3 * (x + (y + 2)))) &#39;x)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: 4</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 29
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 30
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 31
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 32
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 33
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 34
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 35
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 36
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 37
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 38
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 39
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 40
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 41
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 42
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 43
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 44
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 45
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 46
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 47
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 48
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 49
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 50
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 51
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 52
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 53
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 54
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 55
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 56
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 57
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 58
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 59
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 60
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 61
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 62
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 63
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 64
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 65
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 66
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 67
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 68
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 69
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 70
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 71
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 72
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 73
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 74
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 75
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 76
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 77
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 78
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 79
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 80
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 81
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 82
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 83
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 84
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 85
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 86
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 87
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 88
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 89
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 90
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 91
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 92
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 93
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 94
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 95
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 96
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 97
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 98
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 99
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">100
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">101
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">102
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">103
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">104
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">105
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">106
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">107
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">108
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">109
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">110
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">111
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">112
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">113
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">114
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">115
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">116
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">117
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#f92672>#</span>lang sicp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>deriv</span> exp var)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>cond </span>((number? exp) <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>        ((<span style=color:#a6e22e>variable?</span> exp)
</span></span><span style=display:flex><span>         (<span style=color:#66d9ef>if </span>(<span style=color:#a6e22e>same-variable?</span> exp var) <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>0</span>))
</span></span><span style=display:flex><span>        ((<span style=color:#a6e22e>sum?</span> exp)
</span></span><span style=display:flex><span>         (<span style=color:#a6e22e>make-sum</span> (<span style=color:#a6e22e>deriv</span> (<span style=color:#a6e22e>addend</span> exp) var)
</span></span><span style=display:flex><span>                   (<span style=color:#a6e22e>deriv</span> (<span style=color:#a6e22e>augend</span> exp) var)))
</span></span><span style=display:flex><span>        ((<span style=color:#a6e22e>product?</span> exp)
</span></span><span style=display:flex><span>         (<span style=color:#a6e22e>make-sum</span>
</span></span><span style=display:flex><span>          (<span style=color:#a6e22e>make-product</span> (<span style=color:#a6e22e>multiplier</span> exp)
</span></span><span style=display:flex><span>                        (<span style=color:#a6e22e>deriv</span> (<span style=color:#a6e22e>multiplicand</span> exp) var))
</span></span><span style=display:flex><span>          (<span style=color:#a6e22e>make-product</span> (<span style=color:#a6e22e>deriv</span> (<span style=color:#a6e22e>multiplier</span> exp) var)
</span></span><span style=display:flex><span>                        (<span style=color:#a6e22e>multiplicand</span> exp))))
</span></span><span style=display:flex><span>        ((<span style=color:#a6e22e>exponentiation?</span> exp)
</span></span><span style=display:flex><span>         (<span style=color:#a6e22e>make-product</span>
</span></span><span style=display:flex><span>          (<span style=color:#a6e22e>make-product</span>
</span></span><span style=display:flex><span>           (<span style=color:#a6e22e>exponent</span> exp)
</span></span><span style=display:flex><span>           (<span style=color:#a6e22e>make-exponentiation</span> (<span style=color:#a6e22e>base</span> exp) (- (<span style=color:#a6e22e>exponent</span> exp) <span style=color:#ae81ff>1</span>)))
</span></span><span style=display:flex><span>          (<span style=color:#a6e22e>deriv</span> (<span style=color:#a6e22e>base</span> exp) var)))
</span></span><span style=display:flex><span>        (<span style=color:#a6e22e>else</span>
</span></span><span style=display:flex><span>         (<span style=color:#a6e22e>error</span> <span style=color:#e6db74>&#34;unknow expression type --- DERIV&#34;</span> exp))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>**</span> base exponent)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>iter</span> exponent r)
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>if </span>(= exponent <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>        r
</span></span><span style=display:flex><span>        (<span style=color:#a6e22e>iter</span> (- exponent <span style=color:#ae81ff>1</span>) (* r base))))
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>iter</span> exponent <span style=color:#ae81ff>1</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>=number?</span> exp num)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>and </span>(number? exp) (= exp num)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>variable?</span> v) (symbol? v))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>same-variable?</span> v1 v2)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>and </span>(<span style=color:#a6e22e>variable?</span> v1) (<span style=color:#a6e22e>variable?</span> v2) (eq? v1 v2)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>make-sum</span> a1 a2)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>cond </span>((<span style=color:#a6e22e>=number?</span> a1 <span style=color:#ae81ff>0</span>) a2)
</span></span><span style=display:flex><span>        ((<span style=color:#a6e22e>=number?</span> a2 <span style=color:#ae81ff>0</span>) a1)
</span></span><span style=display:flex><span>        ((<span style=color:#66d9ef>and </span>(number? a1) (number? a2)) (+ a1 a2))
</span></span><span style=display:flex><span>        (<span style=color:#66d9ef>else </span>(list a1 <span style=color:#e6db74>&#39;+</span> a2))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>sum?</span> x)
</span></span><span style=display:flex><span>  (pair? (memq <span style=color:#e6db74>&#39;+</span> x)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>addend</span> s)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>x</span> (reverse (cdr (memq <span style=color:#e6db74>&#39;+</span> (reverse s))))))
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>if </span>(null? (cdr x))
</span></span><span style=display:flex><span>        (car x)
</span></span><span style=display:flex><span>        x)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>augend</span> s)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>iter</span> rs r)
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>if </span>(eq? (car rs) <span style=color:#e6db74>&#39;+</span>)
</span></span><span style=display:flex><span>        r
</span></span><span style=display:flex><span>        (<span style=color:#a6e22e>iter</span> (cdr rs) (cons (car rs) r))))
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>x</span> (<span style=color:#a6e22e>iter</span> (reverse s) nil)))
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>if </span>(null? (cdr x))
</span></span><span style=display:flex><span>        (car x)
</span></span><span style=display:flex><span>        x)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>make-product</span> m1 m2)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>cond </span>((<span style=color:#66d9ef>or </span>(<span style=color:#a6e22e>=number?</span> m1 <span style=color:#ae81ff>0</span>) (<span style=color:#a6e22e>=number?</span> m2 <span style=color:#ae81ff>0</span>)) <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>        ((<span style=color:#a6e22e>=number?</span> m1 <span style=color:#ae81ff>1</span>) m2)
</span></span><span style=display:flex><span>        ((<span style=color:#a6e22e>=number?</span> m2 <span style=color:#ae81ff>1</span>) m1)
</span></span><span style=display:flex><span>        ((<span style=color:#66d9ef>and </span>(number? m1) (number? m2)) (* m1 m2))
</span></span><span style=display:flex><span>        (<span style=color:#66d9ef>else </span>(list m1 <span style=color:#e6db74>&#39;*</span> m2))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>product?</span> x)
</span></span><span style=display:flex><span>  (pair? (memq <span style=color:#e6db74>&#39;*</span> x)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>multiplier</span> p)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>x</span> (reverse (cdr (memq <span style=color:#e6db74>&#39;*</span> (reverse p))))))
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>if </span>(null? (cdr x))
</span></span><span style=display:flex><span>        (car x)
</span></span><span style=display:flex><span>        x)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>multiplicand</span> p)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>iter</span> rp r)
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>if </span>(eq? (car rp) <span style=color:#e6db74>&#39;*</span>)
</span></span><span style=display:flex><span>        r
</span></span><span style=display:flex><span>        (<span style=color:#a6e22e>iter</span> (cdr rp) (cons (car rp) r))))
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>x</span> (<span style=color:#a6e22e>iter</span> (reverse p) nil)))
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>if </span>(null? (cdr x))
</span></span><span style=display:flex><span>        (car x)
</span></span><span style=display:flex><span>        x)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>make-exponentiation</span> b e)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>cond </span>((<span style=color:#a6e22e>=number?</span> e <span style=color:#ae81ff>0</span>) <span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>        ((<span style=color:#a6e22e>=number?</span> e <span style=color:#ae81ff>1</span>) b)
</span></span><span style=display:flex><span>        ((<span style=color:#66d9ef>and </span>(number? b) (number? e)) (<span style=color:#a6e22e>**</span> b e))
</span></span><span style=display:flex><span>        (<span style=color:#66d9ef>else </span>(list b <span style=color:#e6db74>&#39;**</span> e))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>exponentiation?</span> x)
</span></span><span style=display:flex><span>  (pair? (memq <span style=color:#e6db74>&#39;**</span> x)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>base</span> e)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>x</span> (reverse (cdr (memq <span style=color:#e6db74>&#39;**</span> (reverse e))))))
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>if </span>(null? (cdr x))
</span></span><span style=display:flex><span>        (car x)
</span></span><span style=display:flex><span>        x)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>exponent</span> e)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>iter</span> re r)
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>if </span>(eq? (car re) <span style=color:#e6db74>&#39;**</span>)
</span></span><span style=display:flex><span>        r
</span></span><span style=display:flex><span>        (<span style=color:#a6e22e>iter</span> (cdr re) (cons (car re) r))))
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>x</span> (<span style=color:#a6e22e>iter</span> (reverse e) nil)))
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>if </span>(null? (cdr x))
</span></span><span style=display:flex><span>        (car x)
</span></span><span style=display:flex><span>        x)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (deriv &#39;(x + 3 * (x + y + 2)) &#39;x)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: 4</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=练习-59>练习 59</h3><p>请为采用未排序表的集合实现定义 <code>union-set</code> 操作。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#f92672>#</span>lang sicp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>element-of-set?</span> x set)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>cond </span>((null? set) <span style=color:#66d9ef>#f</span>)
</span></span><span style=display:flex><span>        ((equal? x (car set)) <span style=color:#66d9ef>#t</span>)
</span></span><span style=display:flex><span>        (<span style=color:#66d9ef>else </span>(<span style=color:#a6e22e>element-of-set?</span> x (cdr set)))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>union-set</span> set1 set2)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>cond </span>((null? set1) set2)
</span></span><span style=display:flex><span>        ((null? set2) set1)
</span></span><span style=display:flex><span>        ((<span style=color:#a6e22e>element-of-set?</span> (car set1) set2)
</span></span><span style=display:flex><span>         (<span style=color:#a6e22e>union-set</span> (cdr set1) set2))
</span></span><span style=display:flex><span>        (<span style=color:#66d9ef>else </span>(cons (car set1)
</span></span><span style=display:flex><span>                    (<span style=color:#a6e22e>union-set</span> (cdr set1) set2)))))
</span></span></code></pre></td></tr></table></div></div><h3 id=练习-60>练习 60</h3><p>我们前面说明了如何将集合表示为没有重复元素的表。现在假定允许重复，例如，集合 ${1, 2, 3}$ 可能被表示为表 <code>(2 3 2 1 3 2 2)</code>。请为在这种表示上的操作设计过程 <code>element-of-set?</code>、<code>adjoin-set</code>、<code>union-set</code>、和 <code>intersection-set</code>。与前面不重复表示里的相应操作相比，现在各个操作的效率怎么样？在什么样的应用中你更倾向于使用这种表示，而不是前面那种无重复的表示？</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#f92672>#</span>lang sicp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>element-of-set?</span> x set)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>cond </span>((null? set) <span style=color:#66d9ef>#f</span>)
</span></span><span style=display:flex><span>        ((equal? x (car set)) <span style=color:#66d9ef>#t</span>)
</span></span><span style=display:flex><span>        (<span style=color:#66d9ef>else </span>(<span style=color:#a6e22e>element-of-set?</span> x (cdr set)))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>adjoin-set</span> x set)
</span></span><span style=display:flex><span>  (cons x set))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>intersection-set</span> set1 set2)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>cond </span>((<span style=color:#66d9ef>or </span>(null? set1) (null? set2)) <span style=color:#f92672>&#39;</span>())
</span></span><span style=display:flex><span>        ((<span style=color:#a6e22e>element-of-set?</span> (car set1) set2)
</span></span><span style=display:flex><span>         (cons (car set1)
</span></span><span style=display:flex><span>               (<span style=color:#a6e22e>intersection-set</span> (cdr set1) set2)))
</span></span><span style=display:flex><span>        (<span style=color:#66d9ef>else </span>(<span style=color:#a6e22e>intersection-set</span> (cdr set1) set2))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>union-set</span> set1 set2)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>cond </span>((null? set1) set2)
</span></span><span style=display:flex><span>        ((null? set2) set1)
</span></span><span style=display:flex><span>        (<span style=color:#66d9ef>else </span>(cons (car set1)
</span></span><span style=display:flex><span>                    (<span style=color:#a6e22e>union-set</span> (cdr set1) set2)))))
</span></span></code></pre></td></tr></table></div></div><p>允许重复的情况下，过程 <code>element-of-set?</code> 的效率变化无法确定；由于过程 <code>adjoin-set</code> 和 <code>union-set</code> 不再需要使用 <code>element-of-set?</code>，因此效率会提高；而 <code>intersection-set</code> 由于需要处理更长的表，效率会下降。在需要添加元素或是取并频繁的应用中使用这种表示效率更高。</p><h3 id=练习-61>练习 61</h3><p>请给出采用排序表示时 <code>adjoin-set</code> 的实现。通过类似 <code>element-of-set?</code> 的方式说明，可以如何利用排序的优势得到一个过程，其平均所需的步数是采用未排序表示时的一半。</p><p>将待插入元素依次与集合中元素比较，如果待插入元素大于当前元素，继续比较下一个；如果等于当前元素，不必插入；如果小于当前元素，插入到该位置。该表示下平均所需的步数是采用未排序表示时的一半。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#f92672>#</span>lang sicp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>adjoin-set</span> x set)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>cond </span>((null? set) (list x))
</span></span><span style=display:flex><span>        ((&lt; (car set) x)
</span></span><span style=display:flex><span>         (cons (car set) (<span style=color:#a6e22e>adjoin-set</span> x (cdr set))))
</span></span><span style=display:flex><span>        ((= (car set) x)
</span></span><span style=display:flex><span>         set)
</span></span><span style=display:flex><span>        (<span style=color:#66d9ef>else </span>(cons x set))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (adjoin-set -10 (list 1 5 7 13))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: (-10 1 5 7 13)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (adjoin-set 5 (list 1 5 7 13))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: (1 5 7 13)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (adjoin-set 8 (list 1 5 7 13))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: (1 5 7 8 13)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (adjoin-set 991 (list 1 5 7 13))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: (1 5 7 13 991)</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=练习-62>练习 62</h3><p>请给出在集合的排序表示上 <code>union-set</code> 的一个 $\Theta(n)$ 实现。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#f92672>#</span>lang sicp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>union-set</span> set1 set2)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>cond </span>((null? set1) set2)
</span></span><span style=display:flex><span>        ((null? set2) set1)
</span></span><span style=display:flex><span>        (<span style=color:#a6e22e>else</span>
</span></span><span style=display:flex><span>         (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>x1</span> (car set1)) (<span style=color:#a6e22e>x2</span> (car set2)))
</span></span><span style=display:flex><span>          (<span style=color:#66d9ef>cond </span>((= x1 x2)
</span></span><span style=display:flex><span>                 (cons x1 (<span style=color:#a6e22e>union-set</span> (cdr set1) (cdr set2))))
</span></span><span style=display:flex><span>                ((&lt; x1 x2)
</span></span><span style=display:flex><span>                 (cons x1 (<span style=color:#a6e22e>union-set</span> (cdr set1) set2)))
</span></span><span style=display:flex><span>                (<span style=color:#a6e22e>else</span>
</span></span><span style=display:flex><span>                 (cons x2 (<span style=color:#a6e22e>union-set</span> set1 (cdr set2)))))))))
</span></span></code></pre></td></tr></table></div></div><h3 id=练习-63>练习 63</h3><p>下面两个过程都能将树变换为表：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#f92672>#</span>lang sicp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>tree-&gt;list-1</span> tree)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>if </span>(null? tree)
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#39;</span>()
</span></span><span style=display:flex><span>      (append (<span style=color:#a6e22e>tree-&gt;list-1</span> (<span style=color:#a6e22e>left-branch</span> tree))
</span></span><span style=display:flex><span>              (cons (<span style=color:#a6e22e>entry</span> tree)
</span></span><span style=display:flex><span>                    (<span style=color:#a6e22e>tree-&gt;list-1</span> (<span style=color:#a6e22e>right-branch</span> tree))))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>tree-&gt;list-2</span> tree)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>copy-to-list</span> tree result-list)
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>if </span>(null? tree)
</span></span><span style=display:flex><span>        result-list
</span></span><span style=display:flex><span>        (<span style=color:#a6e22e>copy-to-list</span> (<span style=color:#a6e22e>left-branch</span> tree)
</span></span><span style=display:flex><span>                      (cons (<span style=color:#a6e22e>entry</span> tree)
</span></span><span style=display:flex><span>                            (<span style=color:#a6e22e>copy-to-list</span> (<span style=color:#a6e22e>right-branch</span> tree)
</span></span><span style=display:flex><span>                                          result-list)))))
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>copy-to-list</span> tree <span style=color:#f92672>&#39;</span>()))
</span></span></code></pre></td></tr></table></div></div><p>a) 这两个过程对所有的树都产生同样结果吗？如果不是，它们产生出的结果有什么不同？它们对图 2-16 中的那些树产生什么样的表？</p><p>b) 将 $n$ 个结点的平衡树变换为表时，这两个过程所需的步数具有同样量级的增长速度吗？如果不一样，哪个过程增长得慢一些？</p><p>结果相同，对图 2-16 中的树产生的表均为 <code>(1 3 5 7 9 11)</code>。</p><p>不同，<code>tree->list-1</code> 慢一些。因为 <code>tree->list-1</code> 中的 <code>append</code> 会将复杂度提升 $n$ 倍。</p><h3 id=练习-64>练习 64</h3><p>下面过程 <code>list->tree</code> 将一个有序表变换为一棵平衡二叉树。其中的辅助函数 <code>partial-tree</code> 以整数 $n$ 和一个至少包含 $n$ 个元素的表为参数，构造出一棵包含这个表的前 $n$ 个元素的平衡树。由 <code>partial-tree</code> 返回的结果是一个序对（用 <code>cons</code> 构造），其 <code>car</code> 是构造出的树，其 <code>cdr</code> 是没有包含在树种那些元素的表。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>list-&gt;tree</span> elements)
</span></span><span style=display:flex><span>  (car (<span style=color:#a6e22e>partial-tree</span> elements (length elements))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>partial-tree</span> elts n)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>if </span>(= n <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>      (cons <span style=color:#f92672>&#39;</span>() elts)
</span></span><span style=display:flex><span>      (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>left-size</span> (quotient (- n <span style=color:#ae81ff>1</span>) <span style=color:#ae81ff>2</span>)))
</span></span><span style=display:flex><span>        (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>left-result</span> (<span style=color:#a6e22e>partial-tree</span> elts left-size)))
</span></span><span style=display:flex><span>          (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>left-tree</span> (car left-result))
</span></span><span style=display:flex><span>                (<span style=color:#a6e22e>non-left-elts</span> (cdr left-result))
</span></span><span style=display:flex><span>                (<span style=color:#a6e22e>right-size</span> (- n (+ left-size <span style=color:#ae81ff>1</span>))))
</span></span><span style=display:flex><span>            (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>this-entry</span> (car non-left-elts))
</span></span><span style=display:flex><span>                  (<span style=color:#a6e22e>right-result</span> (<span style=color:#a6e22e>partial-tree</span> (cdr non-left-elts)
</span></span><span style=display:flex><span>                                              right-size)))
</span></span><span style=display:flex><span>              (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>right-tree</span> (car right-result))
</span></span><span style=display:flex><span>                    (<span style=color:#a6e22e>remaining-elts</span> (cdr right-result)))
</span></span><span style=display:flex><span>                (cons (<span style=color:#a6e22e>make-tree</span> this-entry left-tree right-tree)
</span></span><span style=display:flex><span>                      remaining-elts))))))))
</span></span></code></pre></td></tr></table></div></div><p>a) 请简要地并尽可能清楚地解释为什么 <code>partial-tree</code> 能完成工作。请画出将 <code>list->tree</code> 用于表 <code>(1 3 5 7 9 11)</code> 产生出的树。</p><p>b) 过程 <code>list->tree</code> 转换 $n$ 个元素的表所需的步数以什么量级增长？</p><p>对于一个 <code>list</code>，首先计算出构造左子树和右子树需要的结点数，然后用所需结点递归地调用 <code>partial-tree</code> 构造子树，最后用生成的子树和根结点构造树。<code>list->tree</code> 用于表 <code>(1 3 5 7 9 11)</code> 产生出的树为：</p><img src=64.svg width=20% height=auto alt=64.svg><p><code>partial-tree</code> 访问每个结点恰好一次，将其设置为跟结点，其余操作均为常数级复杂度，因此步数为 $\Theta(n)$。</p><h3 id=练习-65>练习 65</h3><p>利用
<a href=#%e7%bb%83%e4%b9%a0-63 title="练习 63">练习 63</a> 和
<a href=#%e7%bb%83%e4%b9%a0-64 title="练习 64">练习 64</a> 的结果，给出对采用（平衡）二叉树方式实现的集合的 <code>union-set</code> 和 <code>intersection-set</code> 操作的 $\Theta(n)$ 实现。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">47
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">48
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">49
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">50
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">51
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">52
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">53
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">54
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">55
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">56
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">57
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">58
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">59
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">60
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">61
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">62
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">63
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">64
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">65
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">66
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">67
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">68
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">69
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">70
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">71
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">72
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">73
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">74
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">75
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">76
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">77
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">78
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">79
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#f92672>#</span>lang sicp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>make-tree</span> entry left right)
</span></span><span style=display:flex><span>  (list entry left right))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>entry</span> tree) (car tree))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>left-branch</span> tree) (cadr tree))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>right-branch</span> tree) (caddr tree))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>tree-&gt;list</span> tree)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>copy-to-list</span> tree result-list)
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>if </span>(null? tree)
</span></span><span style=display:flex><span>        result-list
</span></span><span style=display:flex><span>        (<span style=color:#a6e22e>copy-to-list</span> (<span style=color:#a6e22e>left-branch</span> tree)
</span></span><span style=display:flex><span>                      (cons (<span style=color:#a6e22e>entry</span> tree)
</span></span><span style=display:flex><span>                            (<span style=color:#a6e22e>copy-to-list</span> (<span style=color:#a6e22e>right-branch</span> tree)
</span></span><span style=display:flex><span>                                          result-list)))))
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>copy-to-list</span> tree <span style=color:#f92672>&#39;</span>()))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>list-&gt;tree</span> elements)
</span></span><span style=display:flex><span>  (car (<span style=color:#a6e22e>partial-tree</span> elements (length elements))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>partial-tree</span> elts n)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>if </span>(= n <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>      (cons <span style=color:#f92672>&#39;</span>() elts)
</span></span><span style=display:flex><span>      (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>left-size</span> (quotient (- n <span style=color:#ae81ff>1</span>) <span style=color:#ae81ff>2</span>)))
</span></span><span style=display:flex><span>        (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>left-result</span> (<span style=color:#a6e22e>partial-tree</span> elts left-size)))
</span></span><span style=display:flex><span>          (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>left-tree</span> (car left-result))
</span></span><span style=display:flex><span>                (<span style=color:#a6e22e>non-left-elts</span> (cdr left-result))
</span></span><span style=display:flex><span>                (<span style=color:#a6e22e>right-size</span> (- n (+ left-size <span style=color:#ae81ff>1</span>))))
</span></span><span style=display:flex><span>            (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>this-entry</span> (car non-left-elts))
</span></span><span style=display:flex><span>                  (<span style=color:#a6e22e>right-result</span> (<span style=color:#a6e22e>partial-tree</span> (cdr non-left-elts)
</span></span><span style=display:flex><span>                                              right-size)))
</span></span><span style=display:flex><span>              (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>right-tree</span> (car right-result))
</span></span><span style=display:flex><span>                    (<span style=color:#a6e22e>remaining-elts</span> (cdr right-result)))
</span></span><span style=display:flex><span>                (cons (<span style=color:#a6e22e>make-tree</span> this-entry left-tree right-tree)
</span></span><span style=display:flex><span>                      remaining-elts))))))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>union-set</span> set1 set2)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>union-set-list</span> set1 set2)
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>cond </span>((null? set1) set2)
</span></span><span style=display:flex><span>          ((null? set2) set1)
</span></span><span style=display:flex><span>          (<span style=color:#a6e22e>else</span>
</span></span><span style=display:flex><span>           (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>x1</span> (car set1)) (<span style=color:#a6e22e>x2</span> (car set2)))
</span></span><span style=display:flex><span>             (<span style=color:#66d9ef>cond </span>((= x1 x2)
</span></span><span style=display:flex><span>                    (cons x1 (<span style=color:#a6e22e>union-set-list</span> (cdr set1) (cdr set2))))
</span></span><span style=display:flex><span>                   ((&lt; x1 x2)
</span></span><span style=display:flex><span>                    (cons x1 (<span style=color:#a6e22e>union-set-list</span> (cdr set1) set2)))
</span></span><span style=display:flex><span>                   (<span style=color:#a6e22e>else</span>
</span></span><span style=display:flex><span>                    (cons x2 (<span style=color:#a6e22e>union-set-list</span> set1 (cdr set2)))))))))
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>list-&gt;tree</span> (<span style=color:#a6e22e>union-set-list</span> (<span style=color:#a6e22e>tree-&gt;list</span> set1) (<span style=color:#a6e22e>tree-&gt;list</span> set2))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>intersection-set</span> set1 set2)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>intersection-set-list</span> set1 set2)
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>if </span>(<span style=color:#66d9ef>or </span>(null? set1) (null? set2))
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#39;</span>()
</span></span><span style=display:flex><span>        (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>x1</span> (car set1)) (<span style=color:#a6e22e>x2</span> (car set2)))
</span></span><span style=display:flex><span>          (<span style=color:#66d9ef>cond </span>((= x1 x2)
</span></span><span style=display:flex><span>                 (<span style=color:#a6e22e>cons</span>
</span></span><span style=display:flex><span>                  x1
</span></span><span style=display:flex><span>                  (<span style=color:#a6e22e>intersection-set-list</span> (cdr set1) (cdr set2))))
</span></span><span style=display:flex><span>                ((&lt; x1 x2)
</span></span><span style=display:flex><span>                 (<span style=color:#a6e22e>intersection-set-list</span> (cdr set1) set2))
</span></span><span style=display:flex><span>                (<span style=color:#a6e22e>else</span>
</span></span><span style=display:flex><span>                 (<span style=color:#a6e22e>intersection-set-list</span> set1 (cdr set2)))))))
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>list-&gt;tree</span> (<span style=color:#a6e22e>intersection-set-list</span>
</span></span><span style=display:flex><span>               (<span style=color:#a6e22e>tree-&gt;list</span> set1)
</span></span><span style=display:flex><span>               (<span style=color:#a6e22e>tree-&gt;list</span> set2))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (define s1 (list-&gt;tree &#39;(1 2 3 5 6 8 10 11)))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (define s2 (list-&gt;tree &#39;(2 4 6 8 11 13)))</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (tree-&gt;list (union-set s1 s2))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: (1 2 3 4 5 6 8 10 11 13)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (tree-&gt;list (intersection-set s1 s2))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: (2 6 8 11)</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=练习-66>练习 66</h3><p>假设记录的集合采用二叉树实现，按照其中作为键值的数值排序。请实现相应的 <code>lookup</code> 过程。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#f92672>#</span>lang sicp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>key</span> record) (car record))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>left-branch</span> tree) (cadr tree))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>right-branch</span> tree) (caddr tree))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>lookup</span> given-key set-of-records)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>cond </span>((null? set-of-records) false)
</span></span><span style=display:flex><span>        ((&lt; given-key (<span style=color:#a6e22e>key</span> (car set-of-records)))
</span></span><span style=display:flex><span>         (<span style=color:#a6e22e>lookup</span> given-key (<span style=color:#a6e22e>left-branch</span> set-of-records)))
</span></span><span style=display:flex><span>        ((= given-key (<span style=color:#a6e22e>key</span> (car set-of-records)))
</span></span><span style=display:flex><span>         (car set-of-records))
</span></span><span style=display:flex><span>        (<span style=color:#a6e22e>else</span>
</span></span><span style=display:flex><span>         (<span style=color:#a6e22e>lookup</span> given-key (<span style=color:#a6e22e>right-branch</span> set-of-records)))))
</span></span></code></pre></td></tr></table></div></div><h3 id=练习-67>练习 67</h3><p>请定义一棵编码树和一个样例消息：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>(<span style=color:#66d9ef>define </span>sample-tree
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>make-code-tree</span> (<span style=color:#a6e22e>make-leaf</span> <span style=color:#e6db74>&#39;A</span> <span style=color:#ae81ff>4</span>)
</span></span><span style=display:flex><span>                  (<span style=color:#a6e22e>make-code-tree</span>
</span></span><span style=display:flex><span>                   (<span style=color:#a6e22e>make-leaf</span> <span style=color:#e6db74>&#39;B</span> <span style=color:#ae81ff>2</span>)
</span></span><span style=display:flex><span>                   (<span style=color:#a6e22e>make-code-tree</span> (<span style=color:#a6e22e>make-leaf</span> <span style=color:#e6db74>&#39;D</span> <span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>                                   (<span style=color:#a6e22e>make-leaf</span> <span style=color:#e6db74>&#39;C</span> <span style=color:#ae81ff>1</span>)))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>sample-message <span style=color:#f92672>&#39;</span>(<span style=color:#ae81ff>0</span> <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>0</span>))
</span></span></code></pre></td></tr></table></div></div><p>然后用过程 <code>decode</code> 完成该消息的编码，给出编码的结果。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">47
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">48
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">49
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">50
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">51
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">52
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">53
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">54
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">55
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">56
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">57
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">58
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">59
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">60
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#f92672>#</span>lang sicp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>make-leaf</span> symbol weight)
</span></span><span style=display:flex><span>  (list <span style=color:#e6db74>&#39;leaf</span> symbol weight))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>leaf?</span> object)
</span></span><span style=display:flex><span>  (eq? (car object) <span style=color:#e6db74>&#39;leaf</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>symbol-leaf</span> x) (cadr x))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>weight-leaf</span> x) (caddr x))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>make-code-tree</span> left right)
</span></span><span style=display:flex><span>  (list left
</span></span><span style=display:flex><span>        right
</span></span><span style=display:flex><span>        (append (<span style=color:#a6e22e>symbols</span> left) (<span style=color:#a6e22e>symbols</span> right))
</span></span><span style=display:flex><span>        (+ (<span style=color:#a6e22e>weight</span> left) (<span style=color:#a6e22e>weight</span> right))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>left-branch</span> tree) (car tree))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>right-branch</span> tree) (cadr tree))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>symbols</span> tree)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>if </span>(<span style=color:#a6e22e>leaf?</span> tree)
</span></span><span style=display:flex><span>      (list (<span style=color:#a6e22e>symbol-leaf</span> tree))
</span></span><span style=display:flex><span>      (caddr tree)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>weight</span> tree)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>if </span>(<span style=color:#a6e22e>leaf?</span> tree)
</span></span><span style=display:flex><span>      (<span style=color:#a6e22e>weight-leaf</span> tree)
</span></span><span style=display:flex><span>      (cadddr tree)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>decode</span> bits tree)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>decode-1</span> bits current-branch)
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>if </span>(null? bits)
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#39;</span>()
</span></span><span style=display:flex><span>        (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>next-branch</span>
</span></span><span style=display:flex><span>               (<span style=color:#a6e22e>choose-branch</span> (car bits) current-branch)))
</span></span><span style=display:flex><span>          (<span style=color:#66d9ef>if </span>(<span style=color:#a6e22e>leaf?</span> next-branch)
</span></span><span style=display:flex><span>              (cons (<span style=color:#a6e22e>symbol-leaf</span> next-branch)
</span></span><span style=display:flex><span>                    (<span style=color:#a6e22e>decode-1</span> (cdr bits) tree))
</span></span><span style=display:flex><span>              (<span style=color:#a6e22e>decode-1</span> (cdr bits) next-branch)))))
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>decode-1</span> bits tree))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>choose-branch</span> bit branch)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>cond </span>((= bit <span style=color:#ae81ff>0</span>) (<span style=color:#a6e22e>left-branch</span> branch))
</span></span><span style=display:flex><span>        ((= bit <span style=color:#ae81ff>1</span>) (<span style=color:#a6e22e>right-branch</span> branch))
</span></span><span style=display:flex><span>        (<span style=color:#66d9ef>else </span>(<span style=color:#a6e22e>error</span> <span style=color:#e6db74>&#34;bad bit -- CHOOSE-BRANCH&#34;</span> bit))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#;(define sample-tree
</span></span></span><span style=display:flex><span><span style=color:#75715e>  (make-code-tree (make-leaf &#39;A 4)
</span></span></span><span style=display:flex><span><span style=color:#75715e>                  (make-code-tree
</span></span></span><span style=display:flex><span><span style=color:#75715e>                   (make-leaf &#39;B 2)
</span></span></span><span style=display:flex><span><span style=color:#75715e>                   (make-code-tree (make-leaf &#39;D 1)
</span></span></span><span style=display:flex><span><span style=color:#75715e>                                   (make-leaf &#39;C 1)))))</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (define sample-message &#39;(0 1 1 0 0 1 0 1 0 1 1 1 0))</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (decode sample-message sample-tree)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: (A D A B B C A)</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=练习-68>练习 68</h3><p>过程 <code>encode</code> 以一个消息和一棵树为参数，产生出被编码消息所对应的二进制位的表：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>encode</span> message tree)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>if </span>(null? message)
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#39;</span>()
</span></span><span style=display:flex><span>      (append (<span style=color:#a6e22e>encode-symbol</span> (car message) tree)
</span></span><span style=display:flex><span>              (<span style=color:#a6e22e>encode</span> (cdr message) tree))))
</span></span></code></pre></td></tr></table></div></div><p>其中的 <code>encode-symbol</code> 是需要你写出的过程，它能根据给定的树产生出给定符号的二进制位表。你所设计的 <code>encode-symbol</code> 在遇到未出现在树中的符号时应报告错误。请用在 <strong>练习 2.67</strong> 中得到的结果检查所实现的过程，工作中用同样一棵树，看看得到的结果是不是原来那个消息。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">47
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">48
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">49
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">50
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">51
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">52
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">53
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">54
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">55
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">56
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">57
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">58
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#f92672>#</span>lang sicp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>make-leaf</span> symbol weight)
</span></span><span style=display:flex><span>  (list <span style=color:#e6db74>&#39;leaf</span> symbol weight))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>leaf?</span> object)
</span></span><span style=display:flex><span>  (eq? (car object) <span style=color:#e6db74>&#39;leaf</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>symbol-leaf</span> x) (cadr x))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>weight-leaf</span> x) (caddr x))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>make-code-tree</span> left right)
</span></span><span style=display:flex><span>  (list left
</span></span><span style=display:flex><span>        right
</span></span><span style=display:flex><span>        (append (<span style=color:#a6e22e>symbols</span> left) (<span style=color:#a6e22e>symbols</span> right))
</span></span><span style=display:flex><span>        (+ (<span style=color:#a6e22e>weight</span> left) (<span style=color:#a6e22e>weight</span> right))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>left-branch</span> tree) (car tree))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>right-branch</span> tree) (cadr tree))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>symbols</span> tree)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>if </span>(<span style=color:#a6e22e>leaf?</span> tree)
</span></span><span style=display:flex><span>      (list (<span style=color:#a6e22e>symbol-leaf</span> tree))
</span></span><span style=display:flex><span>      (caddr tree)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>weight</span> tree)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>if </span>(<span style=color:#a6e22e>leaf?</span> tree)
</span></span><span style=display:flex><span>      (<span style=color:#a6e22e>weight-leaf</span> tree)
</span></span><span style=display:flex><span>      (cadddr tree)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>encode</span> message tree)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>if </span>(null? message)
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#39;</span>()
</span></span><span style=display:flex><span>      (append (<span style=color:#a6e22e>encode-symbol</span> (car message) tree)
</span></span><span style=display:flex><span>              (<span style=color:#a6e22e>encode</span> (cdr message) tree))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>encode-symbol</span> symbol tree)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>cond </span>((not (memq symbol (<span style=color:#a6e22e>symbols</span> tree)))
</span></span><span style=display:flex><span>         (<span style=color:#a6e22e>error</span> <span style=color:#e6db74>&#34;bad symbol -- ENCODE-SYMBOL&#34;</span> symbol))
</span></span><span style=display:flex><span>        ((<span style=color:#a6e22e>leaf?</span> tree) <span style=color:#f92672>&#39;</span>())
</span></span><span style=display:flex><span>        (<span style=color:#a6e22e>else</span>
</span></span><span style=display:flex><span>         (<span style=color:#66d9ef>if </span>(memq symbol (<span style=color:#a6e22e>symbols</span> (<span style=color:#a6e22e>left-branch</span> tree)))
</span></span><span style=display:flex><span>             (cons <span style=color:#e6db74>&#39;0</span> (<span style=color:#a6e22e>encode-symbol</span> symbol (<span style=color:#a6e22e>left-branch</span> tree)))
</span></span><span style=display:flex><span>             (cons <span style=color:#e6db74>&#39;1</span> (<span style=color:#a6e22e>encode-symbol</span> symbol (<span style=color:#a6e22e>right-branch</span> tree)))))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#;(define sample-tree
</span></span></span><span style=display:flex><span><span style=color:#75715e>  (make-code-tree (make-leaf &#39;A 4)
</span></span></span><span style=display:flex><span><span style=color:#75715e>                  (make-code-tree
</span></span></span><span style=display:flex><span><span style=color:#75715e>                   (make-leaf &#39;B 2)
</span></span></span><span style=display:flex><span><span style=color:#75715e>                   (make-code-tree (make-leaf &#39;D 1)
</span></span></span><span style=display:flex><span><span style=color:#75715e>                                   (make-leaf &#39;C 1)))))</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (define sample-message &#39;(A D A B B C A))</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (encode sample-message sample-tree)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: (0 1 1 0 0 1 0 1 0 1 1 1 0)</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=练习-69>练习 69</h3><p>下面过程以一个符号 &mdash; 频度对偶表为参数（其中没有任何符号出现在多于一个对偶中），并根据 Huffman 算法生成出 Huffman 编码树。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>generate-huffman-tree</span> pairs)
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>successive-merge</span> (<span style=color:#a6e22e>make-leaf-set</span> pairs)))
</span></span></code></pre></td></tr></table></div></div><p>其中的 <code>make-leaf-set</code> 是前面给出的过程，它将对偶表转换为叶的有序集，<code>successive-merge</code> 是需要你写的过程，它使用 <code>make-code-tree</code> 反复归并集合中具有最小权重的元素，直至集合里只剩下一个元素为止。这个元素就是我们所需要的 Huffman 树。（这一过程稍微有点技巧性，但并不很复杂。如果你正在设计的过程变得复杂，那么几乎可以肯定是在什么地方搞错了。你应该尽可能地利用有序集合表示这一事实。）</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">47
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">48
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">49
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">50
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">51
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">52
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">53
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">54
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">55
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">56
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">57
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">58
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">59
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">60
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">61
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">62
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">63
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#f92672>#</span>lang sicp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>make-leaf</span> symbol weight)
</span></span><span style=display:flex><span>  (list <span style=color:#e6db74>&#39;leaf</span> symbol weight))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>leaf?</span> object)
</span></span><span style=display:flex><span>  (eq? (car object) <span style=color:#e6db74>&#39;leaf</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>symbol-leaf</span> x) (cadr x))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>weight-leaf</span> x) (caddr x))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>make-code-tree</span> left right)
</span></span><span style=display:flex><span>  (list left
</span></span><span style=display:flex><span>        right
</span></span><span style=display:flex><span>        (append (<span style=color:#a6e22e>symbols</span> left) (<span style=color:#a6e22e>symbols</span> right))
</span></span><span style=display:flex><span>        (+ (<span style=color:#a6e22e>weight</span> left) (<span style=color:#a6e22e>weight</span> right))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>left-branch</span> tree) (car tree))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>right-branch</span> tree) (cadr tree))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>symbols</span> tree)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>if </span>(<span style=color:#a6e22e>leaf?</span> tree)
</span></span><span style=display:flex><span>      (list (<span style=color:#a6e22e>symbol-leaf</span> tree))
</span></span><span style=display:flex><span>      (caddr tree)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>weight</span> tree)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>if </span>(<span style=color:#a6e22e>leaf?</span> tree)
</span></span><span style=display:flex><span>      (<span style=color:#a6e22e>weight-leaf</span> tree)
</span></span><span style=display:flex><span>      (cadddr tree)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>adjoin-set</span> x set)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>cond </span>((null? set) (list x))
</span></span><span style=display:flex><span>        ((&lt; (<span style=color:#a6e22e>weight</span> x) (<span style=color:#a6e22e>weight</span> (car set))) (cons x set))
</span></span><span style=display:flex><span>        (<span style=color:#66d9ef>else </span>(cons (car set)
</span></span><span style=display:flex><span>                    (<span style=color:#a6e22e>adjoin-set</span> x (cdr set))))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>make-leaf-set</span> pairs)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>if </span>(null? pairs)
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#39;</span>()
</span></span><span style=display:flex><span>      (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>pair</span> (car pairs)))
</span></span><span style=display:flex><span>        (<span style=color:#a6e22e>adjoin-set</span> (<span style=color:#a6e22e>make-leaf</span> (car pair)
</span></span><span style=display:flex><span>                               (cadr pair))
</span></span><span style=display:flex><span>                    (<span style=color:#a6e22e>make-leaf-set</span> (cdr pairs))))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>generate-huffman-tree</span> pairs)
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>successive-merge</span> (<span style=color:#a6e22e>make-leaf-set</span> pairs)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>successive-merge</span> tree-set)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>if </span>(= (length tree-set) <span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>      (car tree-set)
</span></span><span style=display:flex><span>      (<span style=color:#a6e22e>successive-merge</span> (<span style=color:#a6e22e>adjoin-set</span>
</span></span><span style=display:flex><span>                         (<span style=color:#a6e22e>make-code-tree</span>
</span></span><span style=display:flex><span>                          (car tree-set) (cadr tree-set))
</span></span><span style=display:flex><span>                         (cddr tree-set)))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (generate-huffman-tree &#39;((A 4) (B 2) (C 1) (D 1)))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#;
</span></span></span><span style=display:flex><span><span style=color:#75715e>((leaf A 4)
</span></span></span><span style=display:flex><span><span style=color:#75715e> ((leaf B 2) ((leaf D 1) (leaf C 1) (D C) 2) (B D C) 4)
</span></span></span><span style=display:flex><span><span style=color:#75715e> (A B D C)
</span></span></span><span style=display:flex><span><span style=color:#75715e> 8)</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=练习-70>练习 70</h3><p>下面带有相对频度的 8 个符号的字母表，是为了有效编码 20 世纪 50 年代的摇滚歌曲中的词语而设计的。（请注意，“字母表”中的“符号”不必是单个字母。）</p><p>A | 2 | NA | 16<br>BOOM | 1 | SHA | 3<br>GET | 2 | YIP | 9<br>JOB | 2 | WAH | 1</p><p>请用（
<a href=#%e7%bb%83%e4%b9%a0-69 title="练习 69">练习 69</a> 的）<code>generate-huffman-tree</code> 过程生成对应的 Huffman 树，用（
<a href=#%e7%bb%83%e4%b9%a0-68 title="练习 68">练习 68</a> 的）<code>encode</code> 过程编码下面的消息：</p><p>Get a job<br>Sha na na na na na na na na<br>Get a job<br>Sha na na na na na na na na<br>Wah yip yip yip yip yip yip yip yip yip<br>Sha boom</p><p>这一编码需要多少个二进制位？如果对这 8 个符号的字母表采用定长编码，完成这个歌曲的编码最少需要多少个二进制位？</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">47
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">48
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">49
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">50
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">51
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">52
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">53
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">54
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">55
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">56
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">57
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">58
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">59
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">60
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">61
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">62
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">63
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">64
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">65
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">66
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">67
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">68
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">69
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">70
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">71
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">72
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">73
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">74
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">75
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">76
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">77
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">78
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">79
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">80
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">81
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">82
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">83
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">84
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">85
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">86
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">87
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">88
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">89
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">90
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">91
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">92
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">93
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">94
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">95
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">96
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">97
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#f92672>#</span>lang sicp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>make-leaf</span> symbol weight)
</span></span><span style=display:flex><span>  (list <span style=color:#e6db74>&#39;leaf</span> symbol weight))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>leaf?</span> object)
</span></span><span style=display:flex><span>  (eq? (car object) <span style=color:#e6db74>&#39;leaf</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>symbol-leaf</span> x) (cadr x))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>weight-leaf</span> x) (caddr x))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>make-code-tree</span> left right)
</span></span><span style=display:flex><span>  (list left
</span></span><span style=display:flex><span>        right
</span></span><span style=display:flex><span>        (append (<span style=color:#a6e22e>symbols</span> left) (<span style=color:#a6e22e>symbols</span> right))
</span></span><span style=display:flex><span>        (+ (<span style=color:#a6e22e>weight</span> left) (<span style=color:#a6e22e>weight</span> right))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>left-branch</span> tree) (car tree))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>right-branch</span> tree) (cadr tree))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>symbols</span> tree)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>if </span>(<span style=color:#a6e22e>leaf?</span> tree)
</span></span><span style=display:flex><span>      (list (<span style=color:#a6e22e>symbol-leaf</span> tree))
</span></span><span style=display:flex><span>      (caddr tree)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>weight</span> tree)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>if </span>(<span style=color:#a6e22e>leaf?</span> tree)
</span></span><span style=display:flex><span>      (<span style=color:#a6e22e>weight-leaf</span> tree)
</span></span><span style=display:flex><span>      (cadddr tree)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>encode</span> message tree)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>if </span>(null? message)
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#39;</span>()
</span></span><span style=display:flex><span>      (append (<span style=color:#a6e22e>encode-symbol</span> (car message) tree)
</span></span><span style=display:flex><span>              (<span style=color:#a6e22e>encode</span> (cdr message) tree))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>encode-symbol</span> symbol tree)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>cond </span>((not (memq symbol (<span style=color:#a6e22e>symbols</span> tree)))
</span></span><span style=display:flex><span>         (<span style=color:#a6e22e>error</span> <span style=color:#e6db74>&#34;bad symbol -- ENCODE-SYMBOL&#34;</span> symbol))
</span></span><span style=display:flex><span>        ((<span style=color:#a6e22e>leaf?</span> tree) <span style=color:#f92672>&#39;</span>())
</span></span><span style=display:flex><span>        (<span style=color:#a6e22e>else</span>
</span></span><span style=display:flex><span>         (<span style=color:#66d9ef>if </span>(memq symbol (<span style=color:#a6e22e>symbols</span> (<span style=color:#a6e22e>left-branch</span> tree)))
</span></span><span style=display:flex><span>             (cons <span style=color:#e6db74>&#39;0</span> (<span style=color:#a6e22e>encode-symbol</span> symbol (<span style=color:#a6e22e>left-branch</span> tree)))
</span></span><span style=display:flex><span>             (cons <span style=color:#e6db74>&#39;1</span> (<span style=color:#a6e22e>encode-symbol</span> symbol (<span style=color:#a6e22e>right-branch</span> tree)))))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>adjoin-set</span> x set)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>cond </span>((null? set) (list x))
</span></span><span style=display:flex><span>        ((&lt; (<span style=color:#a6e22e>weight</span> x) (<span style=color:#a6e22e>weight</span> (car set))) (cons x set))
</span></span><span style=display:flex><span>        (<span style=color:#66d9ef>else </span>(cons (car set)
</span></span><span style=display:flex><span>                    (<span style=color:#a6e22e>adjoin-set</span> x (cdr set))))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>make-leaf-set</span> pairs)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>if </span>(null? pairs)
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#39;</span>()
</span></span><span style=display:flex><span>      (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>pair</span> (car pairs)))
</span></span><span style=display:flex><span>        (<span style=color:#a6e22e>adjoin-set</span> (<span style=color:#a6e22e>make-leaf</span> (car pair)
</span></span><span style=display:flex><span>                               (cadr pair))
</span></span><span style=display:flex><span>                    (<span style=color:#a6e22e>make-leaf-set</span> (cdr pairs))))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>generate-huffman-tree</span> pairs)
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>successive-merge</span> (<span style=color:#a6e22e>make-leaf-set</span> pairs)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>successive-merge</span> tree-set)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>if </span>(= (length tree-set) <span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>      (car tree-set)
</span></span><span style=display:flex><span>      (<span style=color:#a6e22e>successive-merge</span> (<span style=color:#a6e22e>adjoin-set</span>
</span></span><span style=display:flex><span>                         (<span style=color:#a6e22e>make-code-tree</span>
</span></span><span style=display:flex><span>                          (car tree-set) (cadr tree-set))
</span></span><span style=display:flex><span>                         (cddr tree-set)))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#;
</span></span></span><span style=display:flex><span><span style=color:#75715e>(define sample-pairs &#39;((A 2) (NA 16) (BOOM 1) (SHA 3)
</span></span></span><span style=display:flex><span><span style=color:#75715e>                       (GET 2) (YIP 9) (JOB 2) (WAH 1)))</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#;
</span></span></span><span style=display:flex><span><span style=color:#75715e>(define sample-message &#39;(GET A JOB SHA NA NA NA NA NA NA NA NA
</span></span></span><span style=display:flex><span><span style=color:#75715e>                         GET A JOB SHA NA NA NA NA NA NA NA NA
</span></span></span><span style=display:flex><span><span style=color:#75715e>                         WAH YIP YIP YIP YIP YIP YIP YIP YIP YIP
</span></span></span><span style=display:flex><span><span style=color:#75715e>                         SHA BOOM))</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (generate-huffman-tree sample-pairs)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#;
</span></span></span><span style=display:flex><span><span style=color:#75715e>((leaf NA 16)
</span></span></span><span style=display:flex><span><span style=color:#75715e> ((leaf YIP 9)
</span></span></span><span style=display:flex><span><span style=color:#75715e>  (((leaf A 2) ((leaf WAH 1) (leaf BOOM 1) (WAH BOOM) 2) (A WAH BOOM) 4)
</span></span></span><span style=display:flex><span><span style=color:#75715e>   ((leaf SHA 3) ((leaf JOB 2) (leaf GET 2) (JOB GET) 4) (SHA JOB GET) 7)
</span></span></span><span style=display:flex><span><span style=color:#75715e>   (A WAH BOOM SHA JOB GET)
</span></span></span><span style=display:flex><span><span style=color:#75715e>   11)
</span></span></span><span style=display:flex><span><span style=color:#75715e>  (YIP A WAH BOOM SHA JOB GET)
</span></span></span><span style=display:flex><span><span style=color:#75715e>  20)
</span></span></span><span style=display:flex><span><span style=color:#75715e> (NA YIP A WAH BOOM SHA JOB GET)
</span></span></span><span style=display:flex><span><span style=color:#75715e> 36)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (encode sample-message (generate-huffman-tree sample-pairs))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: (1 1 1 1 1 1 1 0 0 1 1 1 1 0 1 1 1 0 0 0 0 0 0 0 0 0 1 1 1 1 1 1 1 0 0 1 1 1 1 0 1 1 1 0 0 0 0 0 0 0 0 0 1 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 1 1 0 1 1 0 1 1)</span>
</span></span></code></pre></td></tr></table></div></div><p>Huffman 编码需要 84 个二进制位，采用定长编码，每个单词至少需要 3 个二进制位，总共 36 个单词，供 108 位。</p><h3 id=练习-71>练习 71</h3><p>假定我们有一棵 $n$ 个符号的字母表的 Huffman 树，其中各符号的相对频度分别是 $1, 2, 4, \cdots, 2^{n-1}$。请对 $n=5$ 和 $n=10$ 勾勒出有关的树的样子。对于这样的树（对于一般的 $n$），编码出现最频繁的符号用多少个二进制位？最不频繁的符号呢？</p><p>树的每个非叶结点至少有一棵子树为叶结点，最频繁的符号用 $1$ 个二进制位，最不频繁的符号用 $n-1$ 个二进制位。</p><h3 id=练习-72>练习 72</h3><p>考虑你在
<a href=#%e7%bb%83%e4%b9%a0-68 title="练习 68">练习 68</a> 中设计的编码过程。对于一个符号的编码，计算步数的增长速率是什么？请注意，这时需要把在每个结点中检查符号表所需的步数包括在内。一般性地回答这一问题是非常困难的。现在考虑一类特殊情况，其中的 $n$ 个符号的相对频度如
<a href=#%e7%bb%83%e4%b9%a0-71 title="练习 71">练习 71</a> 所描述的。请给出编码最频繁的符号所需的步数和最不频繁的符号所需的步数的增长速度（作为 $n$ 的函数）。</p><p>判断符号在编码树中 $\Theta(n)$，树的平均深度 $\log(n)$，增长速率 $\Theta(n\log(n))$。</p><p>在
<a href=#%e7%bb%83%e4%b9%a0-71 title="练习 71">练习 71</a> 中，最好的情况下，搜索深度为 $1$，最坏的情况为 $n-1$，因此所需的步数分别为 $\Theta(n)$、$\Theta(n^2)$。</p><h3 id=练习-73>练习 73</h3><p>2.3.2 节描述了一个执行符号求导的程序：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>deriv</span> exp var)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>cond </span>((number? exp) <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>        ((<span style=color:#a6e22e>variable?</span> exp)
</span></span><span style=display:flex><span>         (<span style=color:#66d9ef>if </span>(<span style=color:#a6e22e>same-variable?</span> exp var) <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>0</span>))
</span></span><span style=display:flex><span>        ((<span style=color:#a6e22e>sum?</span> exp)
</span></span><span style=display:flex><span>         (<span style=color:#a6e22e>make-sum</span> (<span style=color:#a6e22e>deriv</span> (<span style=color:#a6e22e>addend</span> exp) var)
</span></span><span style=display:flex><span>                   (<span style=color:#a6e22e>deriv</span> (<span style=color:#a6e22e>augend</span> exp) var)))
</span></span><span style=display:flex><span>        ((<span style=color:#a6e22e>product?</span> exp)
</span></span><span style=display:flex><span>         (<span style=color:#a6e22e>make-sum</span>
</span></span><span style=display:flex><span>          (<span style=color:#a6e22e>make-product</span> (<span style=color:#a6e22e>multiplier</span> exp)
</span></span><span style=display:flex><span>                        (<span style=color:#a6e22e>deriv</span> (<span style=color:#a6e22e>multiplicand</span> exp) var))
</span></span><span style=display:flex><span>          (<span style=color:#a6e22e>make-product</span> (<span style=color:#a6e22e>deriv</span> (<span style=color:#a6e22e>multiplier</span> exp) var)
</span></span><span style=display:flex><span>                        (<span style=color:#a6e22e>multiplicand</span> exp))))
</span></span><span style=display:flex><span>        (<span style=color:#a6e22e>else</span>
</span></span><span style=display:flex><span>         (<span style=color:#a6e22e>error</span> <span style=color:#e6db74>&#34;unknown exporession type -- DERIV&#34;</span> exp))))
</span></span></code></pre></td></tr></table></div></div><p>可以认为，这个程序是在执行一种基于被求导表达式类型的分派工作。在这里，数据的“类型标志”就是代数运算符（例如 <code>+</code>），需要执行的操作是 <code>deriv</code>。我们也可以将这一程序变换到数据导向的风格，将基本求导过程重新写成：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>deriv</span> exp var)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>cond </span>((number? exp) <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>        ((<span style=color:#a6e22e>variable?</span> exp) (<span style=color:#66d9ef>if </span>(<span style=color:#a6e22e>same-variable?</span> exp var) <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>0</span>))
</span></span><span style=display:flex><span>        (<span style=color:#66d9ef>else </span>((<span style=color:#a6e22e>get</span> <span style=color:#e6db74>&#39;deriv</span> (<span style=color:#a6e22e>operator</span> exp)) (<span style=color:#a6e22e>operands</span> exp)
</span></span><span style=display:flex><span>                                           var))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>operator</span> exp) (car exp))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>operands</span> exp) (cdr exp))
</span></span></code></pre></td></tr></table></div></div><p>a) 请解释上面究竟做了些什么。为什么我们无法将相近的谓词 <code>number?</code> 和 <code>same-variable?</code> 也加入数据导向分派中？</p><p>b) 请写出针对和式与积式的求导过程，并把它们安装到表格里，以便上面程序使用所需要的辅助性代码。</p><p>c) 请选择一些你希望包括的求导规则，例如对乘幂（<strong>练习 2.56</strong>）求导等等，并将它们安装到这一数据导向的系统里。</p><p>d) 在这一简单的代数运算器中，表达式的类型就是构造起它们来的代数运算符。假定我们想以另一种相反的方式做索引，使得 <code>deriv</code> 里完成分派的代码行像下面这样：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>((<span style=color:#a6e22e>get</span> (<span style=color:#a6e22e>operator</span> exp) <span style=color:#e6db74>&#39;deriv</span>) (<span style=color:#a6e22e>operands</span> exp) var)
</span></span></code></pre></td></tr></table></div></div><p>求导系统里还需要做哪些相应的改动？</p><p>上面的代码根据表达式的类型选择相应的求导过程处理表达式。<code>number?</code> 和 <code>same-variable?</code> 由于没有运算符，无法判断表达式类型，即无法调用 <code>operator</code> 过程，需要单独处理。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 29
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 30
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 31
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 32
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 33
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 34
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 35
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 36
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 37
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 38
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 39
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 40
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 41
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 42
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 43
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 44
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 45
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 46
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 47
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 48
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 49
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 50
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 51
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 52
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 53
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 54
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 55
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 56
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 57
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 58
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 59
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 60
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 61
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 62
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 63
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 64
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 65
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 66
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 67
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 68
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 69
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 70
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 71
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 72
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 73
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 74
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 75
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 76
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 77
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 78
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 79
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 80
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 81
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 82
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 83
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 84
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 85
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 86
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 87
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 88
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 89
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 90
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 91
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 92
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 93
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 94
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 95
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 96
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 97
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 98
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 99
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">100
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">101
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">102
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">103
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">104
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">105
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">106
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">107
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">108
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">109
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">110
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">111
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">112
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">113
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">114
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">115
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">116
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">117
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">118
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">119
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">120
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">121
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">122
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">123
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">124
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">125
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">126
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">127
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">128
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">129
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">130
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#f92672>#</span>lang sicp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>make-table</span>)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>local-table</span> (list <span style=color:#e6db74>&#39;*table*</span>)))
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>lookup</span> key-1 key-2)
</span></span><span style=display:flex><span>      (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>subtable</span> (assoc key-1 (cdr local-table))))
</span></span><span style=display:flex><span>        (<span style=color:#66d9ef>if </span>subtable
</span></span><span style=display:flex><span>            (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>record</span> (assoc key-2 (cdr subtable))))
</span></span><span style=display:flex><span>              (<span style=color:#66d9ef>if </span>record
</span></span><span style=display:flex><span>                  (cdr record)
</span></span><span style=display:flex><span>                  false))
</span></span><span style=display:flex><span>            false)))
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>insert!</span> key-1 key-2 value)
</span></span><span style=display:flex><span>      (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>subtable</span> (assoc key-1 (cdr local-table))))
</span></span><span style=display:flex><span>        (<span style=color:#66d9ef>if </span>subtable
</span></span><span style=display:flex><span>            (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>record</span> (assoc key-2 (cdr subtable))))
</span></span><span style=display:flex><span>              (<span style=color:#66d9ef>if </span>record
</span></span><span style=display:flex><span>                  (set-cdr! record value)
</span></span><span style=display:flex><span>                  (set-cdr! subtable
</span></span><span style=display:flex><span>                            (cons (cons key-2 value)
</span></span><span style=display:flex><span>                                  (cdr subtable)))))
</span></span><span style=display:flex><span>            (set-cdr! local-table
</span></span><span style=display:flex><span>                      (cons (list key-1
</span></span><span style=display:flex><span>                                  (cons key-2 value))
</span></span><span style=display:flex><span>                            (cdr local-table)))))
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#39;ok</span>)
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>dispatch</span> m)
</span></span><span style=display:flex><span>      (<span style=color:#66d9ef>cond </span>((eq? m <span style=color:#e6db74>&#39;lookup-proc</span>) lookup)
</span></span><span style=display:flex><span>            ((eq? m <span style=color:#e6db74>&#39;insert-proc!</span>) insert!)
</span></span><span style=display:flex><span>            (<span style=color:#66d9ef>else </span>(<span style=color:#a6e22e>error</span> <span style=color:#e6db74>&#34;Unknown operation -- TABLE&#34;</span> m))))
</span></span><span style=display:flex><span>    dispatch))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>operation-table (<span style=color:#a6e22e>make-table</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>get (<span style=color:#a6e22e>operation-table</span> <span style=color:#e6db74>&#39;lookup-proc</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>put (<span style=color:#a6e22e>operation-table</span> <span style=color:#e6db74>&#39;insert-proc!</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>variable?</span> x) (symbol? x))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>same-variable?</span> x v) (eq? x v))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>=number?</span> x num)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>and </span>(number? x) (= x num)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>deriv</span> exp var)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>cond </span>((number? exp) <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>        ((<span style=color:#a6e22e>variable?</span> exp) (<span style=color:#66d9ef>if </span>(<span style=color:#a6e22e>same-variable?</span> exp var) <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>0</span>))
</span></span><span style=display:flex><span>        (<span style=color:#66d9ef>else </span>((<span style=color:#a6e22e>get</span> <span style=color:#e6db74>&#39;deriv</span> (<span style=color:#a6e22e>operator</span> exp)) (<span style=color:#a6e22e>operands</span> exp)
</span></span><span style=display:flex><span>                                           var))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>operator</span> exp) (car exp))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>operands</span> exp) (cdr exp))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>install-sum-package</span>)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>make-sum</span> a1 a2)
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>cond </span>((<span style=color:#a6e22e>=number?</span> a1 <span style=color:#ae81ff>0</span>) a2)
</span></span><span style=display:flex><span>          ((<span style=color:#a6e22e>=number?</span> a2 <span style=color:#ae81ff>0</span>) a1)
</span></span><span style=display:flex><span>          ((<span style=color:#66d9ef>and </span>(number? a1) (number? a2)) (+ a1 a2))
</span></span><span style=display:flex><span>          (<span style=color:#66d9ef>else </span>(list <span style=color:#e6db74>&#39;+</span> a1 a2))))
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>addend</span> operands) (car operands))
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>augend</span> operands) (cadr operands))
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>deriv-sum</span> operands var)
</span></span><span style=display:flex><span>    (<span style=color:#a6e22e>make-sum</span> (<span style=color:#a6e22e>deriv</span> (<span style=color:#a6e22e>addend</span> operands) var)
</span></span><span style=display:flex><span>              (<span style=color:#a6e22e>deriv</span> (<span style=color:#a6e22e>augend</span> operands) var)))
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>put</span> <span style=color:#e6db74>&#39;make</span> <span style=color:#e6db74>&#39;+</span> make-sum)
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>put</span> <span style=color:#e6db74>&#39;deriv</span> <span style=color:#e6db74>&#39;+</span> deriv-sum)
</span></span><span style=display:flex><span>  (display <span style=color:#e6db74>&#34;Install sum package done\n&#34;</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>make-sum</span> a1 a2)
</span></span><span style=display:flex><span>  ((<span style=color:#a6e22e>get</span> <span style=color:#e6db74>&#39;make</span> <span style=color:#e6db74>&#39;+</span>) a1 a2))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>install-product-package</span>)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>make-product</span> m1 m2)
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>cond </span>((<span style=color:#66d9ef>or </span>(<span style=color:#a6e22e>=number?</span> m1 <span style=color:#ae81ff>0</span>) (<span style=color:#a6e22e>=number?</span> m2 <span style=color:#ae81ff>0</span>)) <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>          ((<span style=color:#a6e22e>=number?</span> m1 <span style=color:#ae81ff>1</span>) m2)
</span></span><span style=display:flex><span>          ((<span style=color:#a6e22e>=number?</span> m2 <span style=color:#ae81ff>1</span>) m1)
</span></span><span style=display:flex><span>          (<span style=color:#66d9ef>else </span>(list <span style=color:#e6db74>&#39;*</span> m1 m2))))
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>multiplier</span> operands) (car operands))
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>multiplicand</span> operands) (cadr operands))
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>deriv-product</span> operands var)
</span></span><span style=display:flex><span>    (<span style=color:#a6e22e>make-sum</span>
</span></span><span style=display:flex><span>     (<span style=color:#a6e22e>make-product</span> (<span style=color:#a6e22e>multiplier</span> operands)
</span></span><span style=display:flex><span>                   (<span style=color:#a6e22e>deriv</span> (<span style=color:#a6e22e>multiplicand</span> operands) var))
</span></span><span style=display:flex><span>     (<span style=color:#a6e22e>make-product</span> (<span style=color:#a6e22e>deriv</span> (<span style=color:#a6e22e>multiplier</span> operands) var)
</span></span><span style=display:flex><span>                   (<span style=color:#a6e22e>multiplicand</span> operands))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>put</span> <span style=color:#e6db74>&#39;make</span> <span style=color:#e6db74>&#39;*</span> make-product)
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>put</span> <span style=color:#e6db74>&#39;deriv</span> <span style=color:#e6db74>&#39;*</span> deriv-product)
</span></span><span style=display:flex><span>  (display <span style=color:#e6db74>&#34;Install product package done\n&#34;</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>make-product</span> m1 m2)
</span></span><span style=display:flex><span>  ((<span style=color:#a6e22e>get</span> <span style=color:#e6db74>&#39;make</span> <span style=color:#e6db74>&#39;*</span>) m1 m2))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>**</span> base exponent)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>if </span>(= exponent <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>      <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>      (* base (<span style=color:#a6e22e>**</span> base (- exponent <span style=color:#ae81ff>1</span>)))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>install-exponentiation-package</span>)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>make-exponentiation</span> b e)
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>cond </span>((<span style=color:#a6e22e>=number?</span> e <span style=color:#ae81ff>0</span>) <span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>          ((<span style=color:#a6e22e>=number?</span> e <span style=color:#ae81ff>1</span>) b)
</span></span><span style=display:flex><span>          ((<span style=color:#66d9ef>and </span>(number? b) (number? e)) (<span style=color:#a6e22e>**</span> b e))
</span></span><span style=display:flex><span>          (<span style=color:#66d9ef>else </span>(list <span style=color:#e6db74>&#39;**</span> b e))))
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>base</span> operands) (car operands))
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>exponent</span> operands) (cadr operands))
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>deriv-exponentiation</span> operands var)
</span></span><span style=display:flex><span>    (<span style=color:#a6e22e>make-product</span>
</span></span><span style=display:flex><span>     (<span style=color:#a6e22e>make-product</span>
</span></span><span style=display:flex><span>      (<span style=color:#a6e22e>exponent</span> operands)
</span></span><span style=display:flex><span>      (<span style=color:#a6e22e>make-exponentiation</span> (<span style=color:#a6e22e>base</span> operands) (- (<span style=color:#a6e22e>exponent</span> operands) <span style=color:#ae81ff>1</span>)))
</span></span><span style=display:flex><span>     (<span style=color:#a6e22e>deriv</span> (<span style=color:#a6e22e>base</span> operands) var)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>put</span> <span style=color:#e6db74>&#39;make</span> <span style=color:#e6db74>&#39;**</span> make-exponentiation)
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>put</span> <span style=color:#e6db74>&#39;deriv</span> <span style=color:#e6db74>&#39;**</span> deriv-exponentiation)
</span></span><span style=display:flex><span>  (display <span style=color:#e6db74>&#34;Install exponentiation package done\n&#34;</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>make-exponentiation</span> b e)
</span></span><span style=display:flex><span>  ((<span style=color:#a6e22e>get</span> <span style=color:#e6db74>&#39;make</span> <span style=color:#e6db74>&#39;**</span>) b e))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#a6e22e>install-sum-package</span>)
</span></span><span style=display:flex><span>(<span style=color:#a6e22e>install-product-package</span>)
</span></span><span style=display:flex><span>(<span style=color:#a6e22e>install-exponentiation-package</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (deriv &#39;(+ (* x x) (* 2 (** x 3))) &#39;x)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: (+ (+ x x) (* 2 (* 3 (** x 2))))</span>
</span></span></code></pre></td></tr></table></div></div><p><code>put</code> 过程调用时前两个参数调换一下即可。</p><h3 id=练习-74>练习 74</h3><p>Insatiable Enterprise 公司是一个高度分散经营的联合公司，由大量分布在世界各地的分支机构组成。公司的计算机设施已经通过一种非常巧妙的网络连接模式联为一体，它使得从任何一个用户的角度看，整个网络就像是一台计算机。在第一次试图利用网络能力从各分支机构的文件中提取管理信息时，Insatiable 的总经理非常沮丧地发现，虽然所有分支机构的文件都被实现为 Scheme 的数据结构，但是各分支机构所用的数据结构却各不相同。她马上招集了各分支机构的经理会议，希望寻找一种策略集成起这些文件，以便在维持各个分支机构中现存独立工作方式的同时，又能满足公司总部管理的需要。</p><p>请说明这种策略可以如何通过数据导向的程序设计技术实现。作为例子，假定每个分支机构的人事记录都存放在一个独立文件里，其中包含了一集以雇员名字作为键值的记录。而有关集合的结构却由于分支机构的不同而不同。进一步说，某个雇员的记录本身又是一个集合（各分支机构所用的结构也不同），其中所包含的信息也在一些作为键值的标识符之下，例如 address 和 salary。特别是考虑如下问题：</p><p>a) 请为公司总部实现一个 <code>get-record</code> 过程，使它能从一个特定的人事文件里提取出一个特定的雇员记录。这一过程应该能应用于任何分支机构的文件。请说明各个独立分支机构的文件应具有怎样的结构。特别是考虑，它们必须提供哪些类型信息。</p><p>b) 请为公司总部实现一个 <code>get-salary</code> 过程，它能从任何分支机构的人事文件中取得某个给定雇员的薪金信息。为了使这个操作能够工作，这些记录应具有怎样的结构？</p><p>c) 请为公司总部实现一个过程 <code>find-employee-record</code>，该过程需要针对一个特定雇员名，在所有分支机构的文件查找对应的记录，并返回找到的记录。假定这一过程的参数是一个雇员名和所有分支文件的表。</p><p>d) 当 Insatiable 购并新公司后，要将新的人事文件结合到系统中，必须做哪些修改。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#f92672>#</span>lang sicp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>get-record</span> employee-name personnel-file)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>record</span> ((<span style=color:#a6e22e>get</span> <span style=color:#e6db74>&#39;get-record</span> (<span style=color:#a6e22e>type-tag</span> personnel-file))
</span></span><span style=display:flex><span>                 employee-name
</span></span><span style=display:flex><span>                 (<span style=color:#a6e22e>contents</span> personnel-file))))
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>if </span>record
</span></span><span style=display:flex><span>        (<span style=color:#a6e22e>attach-tag</span> (<span style=color:#a6e22e>type-tag</span> personnel-file) record)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>#f</span>)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>get-salary</span> record)
</span></span><span style=display:flex><span>  ((<span style=color:#a6e22e>get</span> <span style=color:#e6db74>&#39;get-salary</span> (<span style=color:#a6e22e>type-tag</span> record)) (<span style=color:#a6e22e>contents</span> record)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>find-employee-record</span> employee-name personnel-files)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>if </span>(null? personnel-files)
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>#f</span>
</span></span><span style=display:flex><span>      (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>record</span> (<span style=color:#a6e22e>get-record</span> employee-name (car personnel-files))))
</span></span><span style=display:flex><span>        (<span style=color:#66d9ef>if </span>record
</span></span><span style=display:flex><span>            record
</span></span><span style=display:flex><span>            (<span style=color:#a6e22e>find-employee-record</span> employee-name (cdr personnel-files))))))
</span></span></code></pre></td></tr></table></div></div><h3 id=练习-75>练习 75</h3><p>请用消息传递的风格实现构造函数 <code>make-from-mag-ang</code>。这一过程应该与上面给出的 <code>make-from-real-imag</code> 过程类似。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#f92672>#</span>lang sicp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>make-from-mag-ang</span> magnitude angle)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>dispatch</span> op)
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>cond </span>((eq? op <span style=color:#e6db74>&#39;real-part</span>) (* magnitude (cos angle)))
</span></span><span style=display:flex><span>          ((eq? op <span style=color:#e6db74>&#39;imag-part</span>) (* magnitude (sin angle)))
</span></span><span style=display:flex><span>          ((eq? op <span style=color:#e6db74>&#39;magnitude</span>) magnitude)
</span></span><span style=display:flex><span>          ((eq? op <span style=color:#e6db74>&#39;angle</span>) angle)
</span></span><span style=display:flex><span>          (<span style=color:#a6e22e>else</span>
</span></span><span style=display:flex><span>           (<span style=color:#a6e22e>error</span> <span style=color:#e6db74>&#34;Unknown op -- MAKE-FROM-MAG-ANG&#34;</span> op))))
</span></span><span style=display:flex><span>  dispatch)
</span></span></code></pre></td></tr></table></div></div><h3 id=练习-76>练习 76</h3><p>一个带有通用型操作的大型系统可能不断演化，在演化中常需要加入新的数据对象类型或者新的操作。对于上面提出的三种策略 &mdash;&mdash; 带有显式分派的通用型操作，数据导向的风格，以及消息传递的风格 &mdash;&mdash; 请描述在加入一个新类型或者新操作时，系统所必须做的修改。哪种组织方式最适合哪些经常需要加入新类型的系统？哪种组织方式最适合哪些经常加入新操作的系统？</p><table><thead><tr><th style=text-align:center>策略</th><th style=text-align:center>新类型</th><th style=text-align:center>新操作</th></tr></thead><tbody><tr><td style=text-align:center>显式分派</td><td style=text-align:center>创建新的命名不冲突的过程并修改通用型过程适配新类型</td><td style=text-align:center>在每个类型中添加新操作并创建通用型操作</td></tr><tr><td style=text-align:center>数据导向</td><td style=text-align:center>创建新的过程并安装到操作表中</td><td style=text-align:center>在每个类型中添加新操作并安装到操作表中</td></tr><tr><td style=text-align:center>消息传递</td><td style=text-align:center>创建新的过程</td><td style=text-align:center>在每个类型中添加新操作</td></tr></tbody></table><p>两种情况消息传递均最为合适。</p><h3 id=练习-77>练习 77</h3><p>Louis Reasoner 试着去求值 <code>(magnitude z)</code>，其中的 <code>z</code> 就是图 2-24 里的那个对象。令他吃惊的是，从 <code>apply-generic</code> 出来的不是 <code>5</code> 而是一个错误信息，说没办法对类型 <code>(complex)</code> 做操作 <code>magnitude</code>。他将这次交互的情况给 Alyssa P. Hacker 看，Alyssa 说“问题出在没有为 <code>complex</code> 数定义复数选择函数，而只是为 <code>polar</code> 和 <code>rectangular</code> 数定义了它们。你需要做的就是在 <code>complex</code> 包里加入下面这些东西”：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>(<span style=color:#a6e22e>put</span> <span style=color:#e6db74>&#39;real-part</span> <span style=color:#f92672>&#39;</span>(complex) real-part)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#a6e22e>put</span> <span style=color:#e6db74>&#39;imag-part</span> <span style=color:#f92672>&#39;</span>(complex) imag-part)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#a6e22e>put</span> <span style=color:#e6db74>&#39;magnitude</span> <span style=color:#f92672>&#39;</span>(complex) magnitude)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#a6e22e>put</span> <span style=color:#e6db74>&#39;angle</span> <span style=color:#f92672>&#39;</span>(complex) angle)
</span></span></code></pre></td></tr></table></div></div><p>请详细说明为什么这样做是可行的。作为一个例子，请考虑表达式 <code>(magnitude z)</code> 的求值过程，其中 <code>z</code> 就是图 2-24 里展示的那个对象，请追踪一下这一求值过程中的所有函数调用。特别是看看 <code>apply-generic</code> 被调用了几次？每次调用中分派的是哪个过程？</p><p>因为 <code>z</code> 的最外层标志位 <code>complex</code>，原有操作表中没有 <code>magnitude</code> 与 <code>complex</code> 的组合，因此查找失败；添加之后，调用 <code>(magnitude z)</code> 的话会逐层传递到 rectangular 的 <code>magnitude</code> 过程。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>(magnitude z)  <span style=color:#75715e>; call</span>
</span></span><span style=display:flex><span>(<span style=color:#a6e22e>apply-generic</span> <span style=color:#e6db74>&#39;magnitude</span> z)
</span></span><span style=display:flex><span>((<span style=color:#a6e22e>get</span> <span style=color:#e6db74>&#39;magnitude</span> <span style=color:#f92672>&#39;</span>(complex)) (<span style=color:#a6e22e>contents</span> z))
</span></span><span style=display:flex><span>(magnitude (<span style=color:#a6e22e>contents</span> z))  <span style=color:#75715e>; complex</span>
</span></span><span style=display:flex><span>(<span style=color:#a6e22e>apply-generic</span> <span style=color:#e6db74>&#39;magnitude</span> (<span style=color:#a6e22e>contents</span> z))
</span></span><span style=display:flex><span>((<span style=color:#a6e22e>get</span> <span style=color:#e6db74>&#39;magnitude</span> <span style=color:#f92672>&#39;</span>(rectangular)) (<span style=color:#a6e22e>contents</span> (<span style=color:#a6e22e>contents</span> z)))
</span></span><span style=display:flex><span>(magnitude (<span style=color:#a6e22e>contents</span> (<span style=color:#a6e22e>contents</span> z)))  <span style=color:#75715e>; rectangular</span>
</span></span></code></pre></td></tr></table></div></div><p><code>apply-generic</code> 被调用了两次，第一次被分配给 <code>complex</code> 的 <code>magnitude</code> 过程，第二次被分配给 <code>rectangular</code> 的 <code>maginitude</code> 过程。</p><h3 id=练习-78>练习 78</h3><p>包 <code>scheme-number</code> 里的内部过程几乎什么也没做，只不过是去调用基本过程 <code>+</code>、<code>-</code> 等等。直接使用语言的基本过程当然是不可能的，因为我们的数据类型标志系统要求每个数据对象都附加一个类型。然而，事实上所有 Lisp 实现都有自己的类型系统，使用在系统实现的内部，基本谓词 <code>symbol?</code> 和 <code>number?</code> 等用于确定每个数据对象是否具有特定的类型。请修改 2.4.2 节中 <code>type-tag</code>、<code>contents</code> 和 <code>attach-tag</code> 的定义，使我们的通用算术系统可以利用 Scheme 的内部类型系统。这也就是说，修改后的系统应该像原来一样工作，除了其中常规的数直接采用 Scheme 的数形式，而不是表示为一个 <code>car</code> 部分是符号 <code>scheme-number</code> 的序对。</p><p>见
<a href=#%e7%bb%83%e4%b9%a0-80 title="练习 80">练习 80
</a>。</p><h3 id=练习-79>练习 79</h3><p>请定义一个通用型相等谓词 <code>equ?</code>，它能检查两个数是否相等。请将它安装到通用算术包里。这一操作应该能处理常规的数、有理数和复数。</p><p>见
<a href=#%e7%bb%83%e4%b9%a0-80 title="练习 80">练习 80
</a>。</p><h3 id=练习-80>练习 80</h3><p>请定义一个通用谓词 <code>=zero?</code>，检查其参数是否为 <code>0</code>，并将它安装到通用算术包里。这一操作应该能处理常规的数、有理数和复数。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 29
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 30
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 31
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 32
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 33
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 34
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 35
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 36
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 37
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 38
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 39
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 40
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 41
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 42
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 43
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 44
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 45
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 46
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 47
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 48
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 49
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 50
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 51
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 52
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 53
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 54
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 55
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 56
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 57
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 58
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 59
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 60
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 61
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 62
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 63
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 64
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 65
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 66
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 67
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 68
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 69
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 70
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 71
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 72
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 73
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 74
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 75
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 76
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 77
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 78
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 79
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 80
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 81
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 82
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 83
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 84
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 85
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 86
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 87
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 88
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 89
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 90
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 91
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 92
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 93
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 94
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 95
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 96
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 97
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 98
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 99
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">100
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">101
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">102
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">103
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">104
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">105
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">106
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">107
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">108
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">109
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">110
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">111
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">112
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">113
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">114
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">115
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">116
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">117
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">118
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">119
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">120
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">121
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">122
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">123
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">124
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">125
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">126
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">127
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">128
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">129
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">130
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">131
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">132
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">133
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">134
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">135
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">136
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">137
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">138
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">139
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">140
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">141
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">142
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">143
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">144
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">145
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">146
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">147
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">148
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">149
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">150
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">151
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">152
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">153
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">154
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">155
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">156
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">157
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">158
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">159
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">160
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">161
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">162
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">163
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">164
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">165
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">166
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">167
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">168
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">169
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">170
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">171
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">172
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">173
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">174
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">175
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">176
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">177
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">178
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">179
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">180
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">181
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">182
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">183
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">184
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">185
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">186
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">187
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">188
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">189
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">190
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">191
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">192
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">193
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">194
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">195
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">196
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">197
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">198
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">199
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">200
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">201
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">202
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">203
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">204
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">205
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">206
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">207
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">208
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">209
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">210
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">211
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">212
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">213
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">214
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">215
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">216
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">217
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">218
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">219
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">220
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">221
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">222
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">223
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">224
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">225
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">226
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">227
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">228
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">229
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">230
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">231
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">232
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">233
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">234
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">235
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">236
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">237
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">238
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">239
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">240
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">241
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">242
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">243
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">244
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">245
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">246
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">247
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">248
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">249
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">250
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">251
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">252
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">253
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">254
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">255
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">256
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">257
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">258
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">259
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">260
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">261
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">262
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">263
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">264
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">265
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">266
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">267
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">268
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">269
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">270
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">271
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">272
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">273
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">274
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">275
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">276
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">277
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">278
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">279
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">280
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">281
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">282
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">283
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">284
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">285
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">286
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">287
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">288
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">289
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">290
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">291
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">292
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">293
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">294
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">295
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">296
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">297
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">298
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">299
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">300
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">301
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">302
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">303
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">304
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">305
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">306
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">307
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">308
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">309
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">310
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">311
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">312
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">313
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">314
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">315
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">316
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">317
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">318
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">319
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">320
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">321
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">322
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">323
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">324
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">325
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#f92672>#</span>lang sicp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>make-table</span>)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>local-table</span> (list <span style=color:#e6db74>&#39;*table*</span>)))
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>lookup</span> key-1 key-2)
</span></span><span style=display:flex><span>      (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>subtable</span> (assoc key-1 (cdr local-table))))
</span></span><span style=display:flex><span>        (<span style=color:#66d9ef>if </span>subtable
</span></span><span style=display:flex><span>            (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>record</span> (assoc key-2 (cdr subtable))))
</span></span><span style=display:flex><span>              (<span style=color:#66d9ef>if </span>record
</span></span><span style=display:flex><span>                  (cdr record)
</span></span><span style=display:flex><span>                  false))
</span></span><span style=display:flex><span>            false)))
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>insert!</span> key-1 key-2 value)
</span></span><span style=display:flex><span>      (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>subtable</span> (assoc key-1 (cdr local-table))))
</span></span><span style=display:flex><span>        (<span style=color:#66d9ef>if </span>subtable
</span></span><span style=display:flex><span>            (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>record</span> (assoc key-2 (cdr subtable))))
</span></span><span style=display:flex><span>              (<span style=color:#66d9ef>if </span>record
</span></span><span style=display:flex><span>                  (set-cdr! record value)
</span></span><span style=display:flex><span>                  (set-cdr! subtable
</span></span><span style=display:flex><span>                            (cons (cons key-2 value)
</span></span><span style=display:flex><span>                                  (cdr subtable)))))
</span></span><span style=display:flex><span>            (set-cdr! local-table
</span></span><span style=display:flex><span>                      (cons (list key-1
</span></span><span style=display:flex><span>                                  (cons key-2 value))
</span></span><span style=display:flex><span>                            (cdr local-table)))))
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#39;ok</span>)
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>dispatch</span> m)
</span></span><span style=display:flex><span>      (<span style=color:#66d9ef>cond </span>((eq? m <span style=color:#e6db74>&#39;lookup-proc</span>) lookup)
</span></span><span style=display:flex><span>            ((eq? m <span style=color:#e6db74>&#39;insert-proc!</span>) insert!)
</span></span><span style=display:flex><span>            (<span style=color:#66d9ef>else </span>(<span style=color:#a6e22e>error</span> <span style=color:#e6db74>&#34;Unknown operation -- TABLE&#34;</span> m))))
</span></span><span style=display:flex><span>    dispatch))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>operation-table (<span style=color:#a6e22e>make-table</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>get (<span style=color:#a6e22e>operation-table</span> <span style=color:#e6db74>&#39;lookup-proc</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>put (<span style=color:#a6e22e>operation-table</span> <span style=color:#e6db74>&#39;insert-proc!</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>attach-tag</span> type-tag contents)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>if </span>(pair? contents)
</span></span><span style=display:flex><span>      (cons type-tag contents)
</span></span><span style=display:flex><span>      contents))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>type-tag</span> datum)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>if </span>(pair? datum)
</span></span><span style=display:flex><span>      (car datum)
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#39;scheme-number</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>contents</span> datum)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>if </span>(pair? datum)
</span></span><span style=display:flex><span>      (cdr datum)
</span></span><span style=display:flex><span>      datum))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>apply-generic</span> op <span style=color:#f92672>.</span> args)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>type-tags</span> (map type-tag args)))
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>proc</span> (<span style=color:#a6e22e>get</span> op type-tags)))
</span></span><span style=display:flex><span>      (<span style=color:#66d9ef>if </span>proc
</span></span><span style=display:flex><span>          (apply proc (map contents args))
</span></span><span style=display:flex><span>          (<span style=color:#a6e22e>error</span>
</span></span><span style=display:flex><span>           <span style=color:#e6db74>&#34;No method for these types -- APPLY-GENERIC&#34;</span>
</span></span><span style=display:flex><span>           (list op type-tags))))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>add</span> x y) (<span style=color:#a6e22e>apply-generic</span> <span style=color:#e6db74>&#39;add</span> x y))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>sub</span> x y) (<span style=color:#a6e22e>apply-generic</span> <span style=color:#e6db74>&#39;sub</span> x y))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>mul</span> x y) (<span style=color:#a6e22e>apply-generic</span> <span style=color:#e6db74>&#39;mul</span> x y))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>div</span> x y) (<span style=color:#a6e22e>apply-generic</span> <span style=color:#e6db74>&#39;div</span> x y))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>equ?</span> x y) (<span style=color:#a6e22e>apply-generic</span> <span style=color:#e6db74>&#39;equ?</span> x y))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>=zero?</span> x) (<span style=color:#a6e22e>apply-generic</span> <span style=color:#e6db74>&#39;=zero?</span> x))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>install-scheme-number-package</span>)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>tag</span> x)
</span></span><span style=display:flex><span>    (<span style=color:#a6e22e>attach-tag</span> <span style=color:#e6db74>&#39;scheme-number</span> x))
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>put</span> <span style=color:#e6db74>&#39;equ?</span> <span style=color:#f92672>&#39;</span>(scheme-number scheme-number)
</span></span><span style=display:flex><span>       (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>x</span> y) (<span style=color:#a6e22e>tag</span> (= x y))))
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>put</span> <span style=color:#e6db74>&#39;=zero?</span> <span style=color:#f92672>&#39;</span>(scheme-number)
</span></span><span style=display:flex><span>       (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>x</span>) (<span style=color:#a6e22e>tag</span> (= x <span style=color:#ae81ff>0</span>))))
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>put</span> <span style=color:#e6db74>&#39;add</span> <span style=color:#f92672>&#39;</span>(scheme-number scheme-number)
</span></span><span style=display:flex><span>       (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>x</span> y) (<span style=color:#a6e22e>tag</span> (+ x y))))
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>put</span> <span style=color:#e6db74>&#39;sub</span> <span style=color:#f92672>&#39;</span>(scheme-number scheme-number)
</span></span><span style=display:flex><span>       (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>x</span> y) (<span style=color:#a6e22e>tag</span> (- x y))))
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>put</span> <span style=color:#e6db74>&#39;mul</span> <span style=color:#f92672>&#39;</span>(scheme-number scheme-number)
</span></span><span style=display:flex><span>       (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>x</span> y) (<span style=color:#a6e22e>tag</span> (* x y))))
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>put</span> <span style=color:#e6db74>&#39;div</span> <span style=color:#f92672>&#39;</span>(scheme-number scheme-number)
</span></span><span style=display:flex><span>       (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>x</span> y) (<span style=color:#a6e22e>tag</span> (/ x y))))
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>put</span> <span style=color:#e6db74>&#39;make</span> <span style=color:#e6db74>&#39;scheme-number</span>
</span></span><span style=display:flex><span>       (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>x</span>) (<span style=color:#a6e22e>tag</span> x)))
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;done</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>make-scheme-number</span> n)
</span></span><span style=display:flex><span>  ((<span style=color:#a6e22e>get</span> <span style=color:#e6db74>&#39;make</span> <span style=color:#e6db74>&#39;scheme-number</span>) n))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>install-rational-package</span>)
</span></span><span style=display:flex><span>  <span style=color:#75715e>;; internal procedures</span>
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>numer</span> x) (car x))
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>denom</span> x) (cdr x))
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>make-rat</span> n d)
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>g</span> (gcd n d)))
</span></span><span style=display:flex><span>      (cons (/ n g) (/ d g))))
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>add-rat</span> x y)
</span></span><span style=display:flex><span>    (<span style=color:#a6e22e>make-rat</span> (+ (* (<span style=color:#a6e22e>numer</span> x) (<span style=color:#a6e22e>denom</span> y))
</span></span><span style=display:flex><span>                 (* (<span style=color:#a6e22e>numer</span> y) (<span style=color:#a6e22e>denom</span>  x)))
</span></span><span style=display:flex><span>              (* (<span style=color:#a6e22e>denom</span> x) (<span style=color:#a6e22e>denom</span> y))))
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>sub-rat</span> x y)
</span></span><span style=display:flex><span>    (<span style=color:#a6e22e>make-rat</span> (- (* (<span style=color:#a6e22e>numer</span> x) (<span style=color:#a6e22e>denom</span> y))
</span></span><span style=display:flex><span>                 (* (<span style=color:#a6e22e>numer</span> y) (<span style=color:#a6e22e>denom</span> x)))
</span></span><span style=display:flex><span>              (* (<span style=color:#a6e22e>denom</span> x) (<span style=color:#a6e22e>denom</span> y))))
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>mul-rat</span> x y)
</span></span><span style=display:flex><span>    (<span style=color:#a6e22e>make-rat</span> (* (<span style=color:#a6e22e>numer</span> x) (<span style=color:#a6e22e>numer</span> y))
</span></span><span style=display:flex><span>              (* (<span style=color:#a6e22e>denom</span> x) (<span style=color:#a6e22e>denom</span> y))))
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>div-rat</span> x y)
</span></span><span style=display:flex><span>    (<span style=color:#a6e22e>make-rat</span> (* (<span style=color:#a6e22e>numer</span> x) (<span style=color:#a6e22e>denom</span> y))
</span></span><span style=display:flex><span>              (* (<span style=color:#a6e22e>denom</span> x) (<span style=color:#a6e22e>numer</span> y))))
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>equ?</span> x y)
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>and </span>(= (<span style=color:#a6e22e>numer</span> x) (<span style=color:#a6e22e>numer</span> y))
</span></span><span style=display:flex><span>         (= (<span style=color:#a6e22e>denom</span> x) (<span style=color:#a6e22e>denom</span> y))))
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>=zero?</span> x)
</span></span><span style=display:flex><span>    (= (<span style=color:#a6e22e>numer</span> x) <span style=color:#ae81ff>0</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>;; interface to rest of the system</span>
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>tag</span> x) (<span style=color:#a6e22e>attach-tag</span> <span style=color:#e6db74>&#39;rational</span> x))
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>put</span> <span style=color:#e6db74>&#39;add</span> <span style=color:#f92672>&#39;</span>(rational rational)
</span></span><span style=display:flex><span>       (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>x</span> y) (<span style=color:#a6e22e>tag</span> (<span style=color:#a6e22e>add-rat</span> x y))))
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>put</span> <span style=color:#e6db74>&#39;sub</span> <span style=color:#f92672>&#39;</span>(rational rational)
</span></span><span style=display:flex><span>       (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>x</span> y) (<span style=color:#a6e22e>tag</span> (<span style=color:#a6e22e>sub-rat</span> x y))))
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>put</span> <span style=color:#e6db74>&#39;mul</span> <span style=color:#f92672>&#39;</span>(rational rational)
</span></span><span style=display:flex><span>       (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>x</span> y) (<span style=color:#a6e22e>tag</span> (<span style=color:#a6e22e>mul-rat</span> x y))))
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>put</span> <span style=color:#e6db74>&#39;div</span> <span style=color:#f92672>&#39;</span>(rational rational)
</span></span><span style=display:flex><span>       (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>x</span> y) (<span style=color:#a6e22e>tag</span> (<span style=color:#a6e22e>div-rat</span> x y))))
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>put</span> <span style=color:#e6db74>&#39;equ?</span> <span style=color:#f92672>&#39;</span>(rational rational)
</span></span><span style=display:flex><span>       (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>x</span> y) (<span style=color:#a6e22e>tag</span> (<span style=color:#a6e22e>equ?</span> x y))))
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>put</span> <span style=color:#e6db74>&#39;=zero?</span> <span style=color:#f92672>&#39;</span>(rational)
</span></span><span style=display:flex><span>       (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>x</span>) (<span style=color:#a6e22e>tag</span> (<span style=color:#a6e22e>=zero?</span> x))))
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>put</span> <span style=color:#e6db74>&#39;make</span> <span style=color:#e6db74>&#39;rational</span>
</span></span><span style=display:flex><span>       (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>n</span> d) (<span style=color:#a6e22e>tag</span> (<span style=color:#a6e22e>make-rat</span> n d))))
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;done</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>make-rat</span> n d)
</span></span><span style=display:flex><span>  ((<span style=color:#a6e22e>get</span> <span style=color:#e6db74>&#39;make</span> <span style=color:#e6db74>&#39;rational</span>) n d))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>square</span> x) (* x x))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>install-rectangular-package</span>)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(real-part z) (car z))
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(imag-part z) (cdr z))
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>make-from-real-imag</span> x y) (cons x y))
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(magnitude z)
</span></span><span style=display:flex><span>    (sqrt (+ (<span style=color:#a6e22e>square</span> (real-part z))
</span></span><span style=display:flex><span>             (<span style=color:#a6e22e>square</span> (imag-part z)))))
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(angle z)
</span></span><span style=display:flex><span>    (atan (imag-part z) (real-part z)))
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>make-from-mag-ang</span> r a)
</span></span><span style=display:flex><span>    (cons (* r (cos a)) (* (<span style=color:#a6e22e>r</span> (sin a)))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>tag</span> x) (<span style=color:#a6e22e>attach-tag</span> <span style=color:#e6db74>&#39;rectangular</span> x))
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>put</span> <span style=color:#e6db74>&#39;real-part</span> <span style=color:#f92672>&#39;</span>(rectangular) real-part)
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>put</span> <span style=color:#e6db74>&#39;imag-part</span> <span style=color:#f92672>&#39;</span>(rectangular) imag-part)
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>put</span> <span style=color:#e6db74>&#39;magnitude</span> <span style=color:#f92672>&#39;</span>(rectangular) magnitude)
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>put</span> <span style=color:#e6db74>&#39;angle</span> <span style=color:#f92672>&#39;</span>(rectangular) angle)
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>put</span> <span style=color:#e6db74>&#39;make-from-real-imag</span> <span style=color:#e6db74>&#39;rectangular</span>
</span></span><span style=display:flex><span>       (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>x</span> y) (<span style=color:#a6e22e>tag</span> (<span style=color:#a6e22e>make-from-real-imag</span> x y))))
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>put</span> <span style=color:#e6db74>&#39;make-from-mag-ang</span> <span style=color:#e6db74>&#39;rectangular</span>
</span></span><span style=display:flex><span>       (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>r</span> a) (<span style=color:#a6e22e>tag</span> (<span style=color:#a6e22e>make-from-mag-ang</span> r a))))
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;done</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>install-polar-package</span>)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(magnitude z) (car z))
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(angle z) (cdr z))
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>make-from-mag-ang</span> r a) (cons r a))
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(real-part z)
</span></span><span style=display:flex><span>    (* (magnitude z) (cos (angle z))))
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(imag-part z)
</span></span><span style=display:flex><span>    (* (magnitude z) (sin (angle z))))
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>make-from-real-imag</span> x y)
</span></span><span style=display:flex><span>    (cons (sqrt (+ (<span style=color:#a6e22e>square</span> x) (<span style=color:#a6e22e>square</span> y)))
</span></span><span style=display:flex><span>          (atan y x)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>tag</span> x) (<span style=color:#a6e22e>attach-tag</span> <span style=color:#e6db74>&#39;polar</span> x))
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>put</span> <span style=color:#e6db74>&#39;real-part</span> <span style=color:#f92672>&#39;</span>(polar) real-part)
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>put</span> <span style=color:#e6db74>&#39;imag-part</span> <span style=color:#f92672>&#39;</span>(polar) imag-part)
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>put</span> <span style=color:#e6db74>&#39;magnitude</span> <span style=color:#f92672>&#39;</span>(polar) magnitude)
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>put</span> <span style=color:#e6db74>&#39;angle</span> <span style=color:#f92672>&#39;</span>(polar) angle)
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>put</span> <span style=color:#e6db74>&#39;make-from-real-imag</span> <span style=color:#e6db74>&#39;polar</span>
</span></span><span style=display:flex><span>       (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>x</span> y) (<span style=color:#a6e22e>tag</span> (<span style=color:#a6e22e>make-from-real-imag</span> x y))))
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>put</span> <span style=color:#e6db74>&#39;make-from-mag-ang</span> <span style=color:#e6db74>&#39;polar</span>
</span></span><span style=display:flex><span>       (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>r</span> a) (<span style=color:#a6e22e>tag</span> (<span style=color:#a6e22e>make-from-mag-ang</span> r a))))
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;done</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(real-part z) (<span style=color:#a6e22e>apply-generic</span> <span style=color:#e6db74>&#39;real-part</span> z))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(imag-part z) (<span style=color:#a6e22e>apply-generic</span> <span style=color:#e6db74>&#39;imag-part</span> z))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(magnitude z) (<span style=color:#a6e22e>apply-generic</span> <span style=color:#e6db74>&#39;magnitude</span> z))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(angle z) (<span style=color:#a6e22e>apply-generic</span> <span style=color:#e6db74>&#39;angle</span> z))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>install-complex-package</span>)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>make-from-real-imag</span> x y)
</span></span><span style=display:flex><span>    ((<span style=color:#a6e22e>get</span> <span style=color:#e6db74>&#39;make-from-real-imag</span> <span style=color:#e6db74>&#39;rectangular</span>) x y))
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>make-from-mag-ang</span> r a)
</span></span><span style=display:flex><span>    ((<span style=color:#a6e22e>get</span> <span style=color:#e6db74>&#39;make-from-mag-ang</span> <span style=color:#e6db74>&#39;polar</span>) r a))
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>add-complex</span> z1 z2)
</span></span><span style=display:flex><span>    (<span style=color:#a6e22e>make-from-real-imag</span> (+ (real-part z1) (real-part z2))
</span></span><span style=display:flex><span>                         (+ (imag-part z1) (imag-part z2))))
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>sub-complex</span> z1 z2)
</span></span><span style=display:flex><span>    (<span style=color:#a6e22e>make-from-real-imag</span> (- (real-part z1) (real-part z2))
</span></span><span style=display:flex><span>                         (- (imag-part z2) (imag-part z2))))
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>mul-complex</span> z1 z2)
</span></span><span style=display:flex><span>    (<span style=color:#a6e22e>make-from-mag-ang</span> (* (magnitude z1) (magnitude z2))
</span></span><span style=display:flex><span>                       (+ (angle z1) (angle z2))))
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>div-complex</span> z1 z2)
</span></span><span style=display:flex><span>    (<span style=color:#a6e22e>make-from-mag-ang</span> (/ (magnitude z1) (magnitude z2))
</span></span><span style=display:flex><span>                       (- (angle z1) (angle z2))))
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>equ?</span> z1 z2)
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>or </span>(<span style=color:#66d9ef>and </span>(= (real-part z1) (real-part z2))
</span></span><span style=display:flex><span>             (= (imag-part z1) (imag-part z2)))
</span></span><span style=display:flex><span>        (<span style=color:#66d9ef>and </span>(= (magnitude z1) (magnitude z2))
</span></span><span style=display:flex><span>             (= (angle z1) (angle z2)))))
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>=zero?</span> z)
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>or </span>(= (magnitude z) <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>        (<span style=color:#66d9ef>and </span>(= (real-part z) <span style=color:#ae81ff>0</span>) (= (imag-part z) <span style=color:#ae81ff>0</span>))))
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>tag</span> z) (<span style=color:#a6e22e>attach-tag</span> <span style=color:#e6db74>&#39;complex</span> z))
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>put</span> <span style=color:#e6db74>&#39;real-part</span> <span style=color:#f92672>&#39;</span>(complex) real-part)
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>put</span> <span style=color:#e6db74>&#39;imag-part</span> <span style=color:#f92672>&#39;</span>(complex) imag-part)
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>put</span> <span style=color:#e6db74>&#39;magnitude</span> <span style=color:#f92672>&#39;</span>(complex) magnitude)
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>put</span> <span style=color:#e6db74>&#39;angle</span> <span style=color:#f92672>&#39;</span>(complex) angle)
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>put</span> <span style=color:#e6db74>&#39;add</span> <span style=color:#f92672>&#39;</span>(complex complex)
</span></span><span style=display:flex><span>       (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>z1</span> z2) (<span style=color:#a6e22e>tag</span> (<span style=color:#a6e22e>add-complex</span> z1 z2))))
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>put</span> <span style=color:#e6db74>&#39;sub</span> <span style=color:#f92672>&#39;</span>(complex complex)
</span></span><span style=display:flex><span>       (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>z1</span> z2) (<span style=color:#a6e22e>tag</span> (<span style=color:#a6e22e>sub-complex</span> z1 z2))))
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>put</span> <span style=color:#e6db74>&#39;mul</span> <span style=color:#f92672>&#39;</span>(complex complex)
</span></span><span style=display:flex><span>       (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>z1</span> z2) (<span style=color:#a6e22e>tag</span> (<span style=color:#a6e22e>mul-complex</span> z1 z2))))
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>put</span> <span style=color:#e6db74>&#39;div</span> <span style=color:#f92672>&#39;</span>(complex complex)
</span></span><span style=display:flex><span>       (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>z1</span> z2) (<span style=color:#a6e22e>tag</span> (<span style=color:#a6e22e>div-complex</span> z1 z2))))
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>put</span> <span style=color:#e6db74>&#39;equ?</span> <span style=color:#f92672>&#39;</span>(complex complex)
</span></span><span style=display:flex><span>       (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>z1</span> z2) (<span style=color:#a6e22e>tag</span> (<span style=color:#a6e22e>equ?</span> z1 z2))))
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>put</span> <span style=color:#e6db74>&#39;=zero?</span> <span style=color:#f92672>&#39;</span>(complex)
</span></span><span style=display:flex><span>       (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>z</span>) (<span style=color:#a6e22e>tag</span> (<span style=color:#a6e22e>=zero?</span> z))))
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>put</span> <span style=color:#e6db74>&#39;make-from-real-imag</span> <span style=color:#e6db74>&#39;complex</span>
</span></span><span style=display:flex><span>       (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>x</span> y) (<span style=color:#a6e22e>tag</span> (<span style=color:#a6e22e>make-from-real-imag</span> x y))))
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>put</span> <span style=color:#e6db74>&#39;make-from-mag-ang</span> <span style=color:#e6db74>&#39;complex</span>
</span></span><span style=display:flex><span>       (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>r</span> a) (<span style=color:#a6e22e>tag</span> (<span style=color:#a6e22e>make-from-mag-ang</span> r a))))
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;done</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>make-complex-from-real-imag</span> x y)
</span></span><span style=display:flex><span>  ((<span style=color:#a6e22e>get</span> <span style=color:#e6db74>&#39;make-from-real-imag</span> <span style=color:#e6db74>&#39;complex</span>) x y))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>make-complex-from-mag-ang</span> r a)
</span></span><span style=display:flex><span>  ((<span style=color:#a6e22e>get</span> <span style=color:#e6db74>&#39;make-from-mag-ang</span> <span style=color:#e6db74>&#39;complex</span>) r a))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#a6e22e>install-scheme-number-package</span>)
</span></span><span style=display:flex><span>(<span style=color:#a6e22e>install-rational-package</span>)
</span></span><span style=display:flex><span>(<span style=color:#a6e22e>install-rectangular-package</span>)
</span></span><span style=display:flex><span>(<span style=color:#a6e22e>install-polar-package</span>)
</span></span><span style=display:flex><span>(<span style=color:#a6e22e>install-complex-package</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (define r1 (make-rat 1 2))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (define r2 (make-rat 3 4))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (mul r1 r2)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: (rational 3 . 8)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (define s1 (make-scheme-number 2))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (define s2 (make-scheme-number 3))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (div s1 s2)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: 2/3</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (add 3 4)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: 7</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (define c1 (make-complex-from-real-imag 3 4))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (define c2 (make-complex-from-mag-ang 5 (/ 3.1415926 4)))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (real-part c1)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: 3</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (imag-part c1)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: 4</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (magnitude c1)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: 5</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (cos (angle c1))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: 0.6000000000000001</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (add c1 c2)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: (complex rectangular 6.53553395329987 . 7.535533858565605)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (define s1 (make-scheme-number 2))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (define s2 (make-scheme-number 3))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (equ? s1 s2)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: #f</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (equ? 4 4)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: #t</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (define r1 (make-rat 3 4))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (define r2 (make-rat 3 4))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (equ? r1 r2)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: #t</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (define c1 (make-complex-from-real-imag 3 4))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (define c2 (make-complex-from-mag-ang 5 (/ 3.1415926 4)))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (equ? c1 c2)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: #f</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (define s1 (make-scheme-number 2))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (define s2 (make-scheme-number 0))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (=zero? s1)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: #f</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (=zero? s2)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: #t</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (=zero? 0)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: #t</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (define r1 (make-rat 0 3))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (define r2 (make-rat 3 4))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (=zero? r1)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: #t</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (=zero? r2)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: #f</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (define c1 (make-complex-from-real-imag 0 0))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (define c2 (make-complex-from-mag-ang 5 (/ 3.1415926 4)))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (=zero? c1)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: #t</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;&gt;&gt;&gt; (=zero? c2)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;: #f</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=练习-81>练习 81</h3><p>Louis Reasoner 注意到，甚至在两个参数的类型实际相同的情况下，<code>apply-generic</code> 也可能试图去做参数间的类型强制。由此他推论说，需要在强制表格中加入一些过程，以将每个类型的参数“强制”到它们自己的类型。例如，除了上面给出的 <code>scheme-number->complex</code> 强制之外，他觉得应该有：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>scheme-number-&gt;scheme-number</span> n) n)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>complex-&gt;complex</span> z) z)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#a6e22e>put-coercion</span> <span style=color:#e6db74>&#39;scheme-number</span> <span style=color:#e6db74>&#39;scheme-number</span>
</span></span><span style=display:flex><span>              scheme-number-&gt;scheme-number)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#a6e22e>put-coercion</span> <span style=color:#e6db74>&#39;complex</span> <span style=color:#e6db74>&#39;complex</span> complex-&gt;complex)
</span></span></code></pre></td></tr></table></div></div><p>a) 如果安装了 Louis 的强制过程，如果在调用 <code>apply-generic</code> 时各参数的类型都为 <code>scheme-number</code> 或者类型都为 <code>complex</code>，而在表格中又找不到相应的操作，这时会出现什么情况？例如，假定我们定义了一个通用型的求幂运算：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(exp x y) (<span style=color:#a6e22e>apply-generic</span> <span style=color:#e6db74>&#39;exp</span> x y))
</span></span></code></pre></td></tr></table></div></div><p>并在 Scheme 数值包里放入了一个求幂过程，但其他程序包里都没有：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#75715e>;;following added to Scheme-number package</span>
</span></span><span style=display:flex><span>(<span style=color:#a6e22e>put</span> <span style=color:#e6db74>&#39;exp</span> <span style=color:#f92672>&#39;</span>(scheme-number scheme-number)
</span></span><span style=display:flex><span>     (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>x</span> y) (<span style=color:#a6e22e>tag</span> (expt x y))))  <span style=color:#75715e>; using primitive expt</span>
</span></span></code></pre></td></tr></table></div></div><p>如果对两个复数调用 <code>exp</code> 会出现什么情况？</p><p>b) Louis 真的纠正了有关同样类型参数的强制问题吗？<code>apply-generic</code> 还能像原来那样正确工作吗？</p><p>c) 请修改 <code>apply-generic</code>，使之不会试着去强制两个同样类型的参数。</p><p>程序会一直做 <code>complex</code> 到 <code>complex</code> 的类型转换，陷入死循环。</p><p>没有解决，当遇到没有处理两个相同类型参数的过程时，就会陷入死循环，修改如下：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>apply-generic</span> op <span style=color:#f92672>.</span> args)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>type-tags</span> (map type-tag args)))
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>proc</span> (<span style=color:#a6e22e>get</span> op type-tags)))
</span></span><span style=display:flex><span>      (<span style=color:#66d9ef>if </span>proc
</span></span><span style=display:flex><span>          (apply proc (map contents args))
</span></span><span style=display:flex><span>          (<span style=color:#66d9ef>if </span>(= (length args) <span style=color:#ae81ff>2</span>)
</span></span><span style=display:flex><span>              (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>type1</span> (car type-tags))
</span></span><span style=display:flex><span>                    (<span style=color:#a6e22e>type2</span> (cadr type-tags))
</span></span><span style=display:flex><span>                    (<span style=color:#a6e22e>a1</span> (car args))
</span></span><span style=display:flex><span>                    (<span style=color:#a6e22e>a2</span> (cadr args)))
</span></span><span style=display:flex><span>                (<span style=color:#66d9ef>if </span>(eq? type1 type2)
</span></span><span style=display:flex><span>                    (<span style=color:#a6e22e>error</span> <span style=color:#e6db74>&#34;No method for these types&#34;</span>
</span></span><span style=display:flex><span>                                (list op type-tags))
</span></span><span style=display:flex><span>                    (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>t1-&gt;t2</span> (<span style=color:#a6e22e>get-coercion</span> type1 type2))
</span></span><span style=display:flex><span>                          (<span style=color:#a6e22e>t2-&gt;t1</span> (<span style=color:#a6e22e>get-coercion</span> type2 type1)))
</span></span><span style=display:flex><span>                      (<span style=color:#66d9ef>cond </span>(<span style=color:#a6e22e>t1-&gt;t2</span>
</span></span><span style=display:flex><span>                             (<span style=color:#a6e22e>apply-generic</span> op (<span style=color:#a6e22e>t1-&gt;t2</span> a1) a2))
</span></span><span style=display:flex><span>                            (<span style=color:#a6e22e>t2-&gt;t1</span>
</span></span><span style=display:flex><span>                             (<span style=color:#a6e22e>apply-generic</span> op a1 (<span style=color:#a6e22e>t2-&gt;t1</span> a2)))
</span></span><span style=display:flex><span>                            (<span style=color:#a6e22e>else</span>
</span></span><span style=display:flex><span>                             (<span style=color:#a6e22e>error</span> <span style=color:#e6db74>&#34;No method for these types&#34;</span>
</span></span><span style=display:flex><span>                                    (list op type-tags)))))))
</span></span><span style=display:flex><span>              (<span style=color:#a6e22e>error</span> <span style=color:#e6db74>&#34;No method for these types&#34;</span>
</span></span><span style=display:flex><span>                     (list op type-tags)))))))
</span></span></code></pre></td></tr></table></div></div><h3 id=练习-82>练习 82</h3><p>请阐述一种方法，设法推广 <code>apply-generic</code>，以便处理多个参数的一般性情况下的强制问题。一种可能策略是试着将所有参数都强制到第一个参数的类型，而后试着强制到第二个参数的类型，并如此试下去。请给出一个例子说明这种策略还不够一般（就像上面对两个参数的情况给出的例子那样）。（提示：请考虑一些情况，其中表格里某些合用的操作将不会被考虑。）</p><p>不够一般：可能存在相同类型的参数，此时没必要相互强制。一般化的 <code>apply-generic</code> 如下：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">47
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">48
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">49
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">50
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">51
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">52
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">53
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">54
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">55
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#f92672>#</span>lang sicp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>same-type?</span> type-tags)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>type</span> (car type-tags)))
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>iter</span> type-tags)
</span></span><span style=display:flex><span>      (<span style=color:#66d9ef>if </span>(null? type-tags)
</span></span><span style=display:flex><span>          true
</span></span><span style=display:flex><span>          (<span style=color:#66d9ef>and </span>(eq? type (car type-tags))
</span></span><span style=display:flex><span>               (<span style=color:#a6e22e>iter</span> (cdr type-tags)))))
</span></span><span style=display:flex><span>    (<span style=color:#a6e22e>iter</span> (cdr type-tags))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>get-types</span> type-tags)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>iter</span> types rest-type-tags)
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>if </span>(null? rest-type-tags)
</span></span><span style=display:flex><span>        types
</span></span><span style=display:flex><span>        (<span style=color:#66d9ef>if </span>(memq (car rest-type-tags) types)
</span></span><span style=display:flex><span>            (<span style=color:#a6e22e>iter</span> types (cdr rest-type-tags))
</span></span><span style=display:flex><span>            (<span style=color:#a6e22e>iter</span> (cons (car rest-type-tags) types)
</span></span><span style=display:flex><span>                  (cdr rest-type-tags)))))
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>iter</span> <span style=color:#f92672>&#39;</span>() type-tags))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>coercion</span> type args)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>iter</span> rest-args)
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>if </span>(null? rest-args)
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#39;</span>()
</span></span><span style=display:flex><span>        (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>type2</span> (<span style=color:#a6e22e>type-tag</span> (car rest-args))))
</span></span><span style=display:flex><span>          (<span style=color:#66d9ef>if </span>(eq? type type2)
</span></span><span style=display:flex><span>              (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>proc</span> (<span style=color:#a6e22e>get-coercion</span> type2 type)))
</span></span><span style=display:flex><span>                (<span style=color:#66d9ef>if </span>proc
</span></span><span style=display:flex><span>                    (cons (<span style=color:#a6e22e>proc</span> (car rest-args))
</span></span><span style=display:flex><span>                          (<span style=color:#a6e22e>iter</span> (cdr rest-args)))
</span></span><span style=display:flex><span>                    false))))))
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>iter</span> args))
</span></span><span style=display:flex><span>                     
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>apply-generic</span> op <span style=color:#f92672>.</span> args)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>type-tags</span> (map type-tag args)))
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>proc</span> (<span style=color:#a6e22e>get</span> op type-tags)))
</span></span><span style=display:flex><span>      (<span style=color:#66d9ef>if </span>proc
</span></span><span style=display:flex><span>          (apply proc (map contents args))
</span></span><span style=display:flex><span>          (<span style=color:#66d9ef>if </span>(<span style=color:#a6e22e>same-type?</span> type-tags)
</span></span><span style=display:flex><span>              (<span style=color:#a6e22e>error</span> <span style=color:#e6db74>&#34;No method for these types&#34;</span>
</span></span><span style=display:flex><span>                     (list op type-tags))
</span></span><span style=display:flex><span>              (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>types</span> (<span style=color:#a6e22e>get-types</span> type-tags)))
</span></span><span style=display:flex><span>                (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>handle</span> types)
</span></span><span style=display:flex><span>                  (<span style=color:#66d9ef>if </span>(null? types)
</span></span><span style=display:flex><span>                      (<span style=color:#a6e22e>error</span> <span style=color:#e6db74>&#34;No method for these types&#34;</span>
</span></span><span style=display:flex><span>                             (list op type-tags))
</span></span><span style=display:flex><span>                      (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>same-type-args</span> (<span style=color:#a6e22e>coercion</span> (car types) args)))
</span></span><span style=display:flex><span>                        (<span style=color:#66d9ef>if </span>same-type-args
</span></span><span style=display:flex><span>                            (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>proc</span> (<span style=color:#a6e22e>get</span> op (map type-tag same-type-args))))
</span></span><span style=display:flex><span>                              (<span style=color:#66d9ef>if </span>proc
</span></span><span style=display:flex><span>                                  (apply proc same-type-args)
</span></span><span style=display:flex><span>                                  (<span style=color:#a6e22e>handle</span> (cdr types) args)))
</span></span><span style=display:flex><span>                            (<span style=color:#a6e22e>handle</span> (cdr types) args)))))
</span></span><span style=display:flex><span>                (<span style=color:#a6e22e>handle</span> types)))))))
</span></span></code></pre></td></tr></table></div></div><h3 id=练习-83>练习 83</h3><p>假定你正在设计一个通用型的算术包，处理图 2-25 所示的类型塔，包括整数、有理数、实数和复数。请为每个类型（除复数外）设计一个过程，它能将该类型的对象提升到塔中的上面一层。请说明如何安装一个通用的 <code>raise</code> 操作，使之能对各个类型工作（除复数之外）。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#f92672>#</span>lang sicp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>raise</span> x) (<span style=color:#a6e22e>apply-generic</span> <span style=color:#e6db74>&#39;raise</span> x))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;; add into scheme-number package</span>
</span></span><span style=display:flex><span>(<span style=color:#a6e22e>put</span> <span style=color:#e6db74>&#39;raise</span> <span style=color:#f92672>&#39;</span>(scheme-number)
</span></span><span style=display:flex><span>     (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>x</span>) (<span style=color:#a6e22e>tag</span> (<span style=color:#a6e22e>make-rat</span> x <span style=color:#ae81ff>1</span>))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;; add into rational package</span>
</span></span><span style=display:flex><span>(<span style=color:#a6e22e>put</span> <span style=color:#e6db74>&#39;raise</span> <span style=color:#f92672>&#39;</span>(rational)
</span></span><span style=display:flex><span>     (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>x</span>) (<span style=color:#a6e22e>tag</span> (<span style=color:#a6e22e>make-real</span> (/ (<span style=color:#a6e22e>numer</span> x) (<span style=color:#a6e22e>denom</span> x))))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;; add into real package</span>
</span></span><span style=display:flex><span>(<span style=color:#a6e22e>put</span> <span style=color:#e6db74>&#39;raise</span> <span style=color:#f92672>&#39;</span>(real)
</span></span><span style=display:flex><span>     (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>x</span>) (<span style=color:#a6e22e>tag</span> (<span style=color:#a6e22e>make-complex-from-real-imag</span> x <span style=color:#ae81ff>0</span>))))
</span></span></code></pre></td></tr></table></div></div><h3 id=练习-84>练习 84</h3><p>利用
<a href=#%e7%bb%83%e4%b9%a0-83 title="练习 83">练习 83</a> 的 <code>raise</code> 操作修改 <code>apply-generic</code> 过程，使它能通过逐层提升的方式将参数强制到同样的类型，正如本节中讨论的。你将需要安排一种方式，去检查两个类型中哪个更高。请以一种能与系统中其他部分“相容”，而且又不会影响向塔中加入新层次的方式完成这一工作。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">47
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">48
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">49
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">50
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">51
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">52
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">53
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">54
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">55
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">56
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">57
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">58
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">59
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">60
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">61
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#f92672>#</span>lang sicp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>same-type?</span> type-tags)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>type</span> (car type-tags)))
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>iter</span> type-tags)
</span></span><span style=display:flex><span>      (<span style=color:#66d9ef>if </span>(null? type-tags)
</span></span><span style=display:flex><span>          true
</span></span><span style=display:flex><span>          (<span style=color:#66d9ef>and </span>(eq? type (car type-tags))
</span></span><span style=display:flex><span>               (<span style=color:#a6e22e>iter</span> (cdr type-tags)))))
</span></span><span style=display:flex><span>    (<span style=color:#a6e22e>iter</span> (cdr type-tags))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>get-types</span> type-tags)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>iter</span> types rest-type-tags)
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>if </span>(null? rest-type-tags)
</span></span><span style=display:flex><span>        types
</span></span><span style=display:flex><span>        (<span style=color:#66d9ef>if </span>(memq (car rest-type-tags) types)
</span></span><span style=display:flex><span>            (<span style=color:#a6e22e>iter</span> types (cdr rest-type-tags))
</span></span><span style=display:flex><span>            (<span style=color:#a6e22e>iter</span> (cons (car rest-type-tags) types)
</span></span><span style=display:flex><span>                  (cdr rest-type-tags)))))
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>iter</span> <span style=color:#f92672>&#39;</span>() type-tags))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>tower <span style=color:#f92672>&#39;</span>(integer rational real complex))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>higher?</span> type1 type2)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>length1</span> (length (memq type1 tower)))
</span></span><span style=display:flex><span>        (<span style=color:#a6e22e>length2</span> (length (memq type2 tower))))
</span></span><span style=display:flex><span>    (&lt; length1 length2)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>get-top</span> types)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>iter</span> top rest-types)
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>if </span>(null? rest-types)
</span></span><span style=display:flex><span>        top
</span></span><span style=display:flex><span>        (<span style=color:#66d9ef>if </span>(<span style=color:#a6e22e>higher?</span> (car rest-types) top)
</span></span><span style=display:flex><span>            (<span style=color:#a6e22e>iter</span> (car rest-types) (cdr rest-types))
</span></span><span style=display:flex><span>            (<span style=color:#a6e22e>iter</span> top (cdr rest-types)))))
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>iter</span> <span style=color:#e6db74>&#39;integer</span> types))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>multi-raise</span> type arg)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>if </span>(eq? (<span style=color:#a6e22e>type-tag</span> arg) type)
</span></span><span style=display:flex><span>      arg
</span></span><span style=display:flex><span>      (<span style=color:#a6e22e>multi-raise</span> type (<span style=color:#a6e22e>raise</span> arg))))
</span></span><span style=display:flex><span>                     
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>apply-generic</span> op <span style=color:#f92672>.</span> args)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>type-tags</span> (map type-tag args)))
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>proc</span> (<span style=color:#a6e22e>get</span> op type-tags)))
</span></span><span style=display:flex><span>      (<span style=color:#66d9ef>if </span>proc
</span></span><span style=display:flex><span>          (apply proc (map contents args))
</span></span><span style=display:flex><span>          (<span style=color:#66d9ef>if </span>(<span style=color:#a6e22e>same-type?</span> type-tags)
</span></span><span style=display:flex><span>              (<span style=color:#a6e22e>error</span> <span style=color:#e6db74>&#34;No method for these types&#34;</span>
</span></span><span style=display:flex><span>                     (list op type-tags))
</span></span><span style=display:flex><span>              (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>types</span> (<span style=color:#a6e22e>get-types</span> type-tags)))
</span></span><span style=display:flex><span>                (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>top</span> (<span style=color:#a6e22e>get-top</span> types)))
</span></span><span style=display:flex><span>                  (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>same-type-args</span> (<span style=color:#a6e22e>map</span>
</span></span><span style=display:flex><span>                                         (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>arg</span>)
</span></span><span style=display:flex><span>                                           (<span style=color:#a6e22e>multi-raise</span> top arg))
</span></span><span style=display:flex><span>                                         args)))
</span></span><span style=display:flex><span>                    (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>proc</span> (<span style=color:#a6e22e>get</span> op (map type-tag same-type-args))))
</span></span><span style=display:flex><span>                      (<span style=color:#66d9ef>if </span>proc
</span></span><span style=display:flex><span>                          (apply proc same-type-args)
</span></span><span style=display:flex><span>                          (<span style=color:#a6e22e>error</span> <span style=color:#e6db74>&#34;No method for these types&#34;</span>
</span></span><span style=display:flex><span>                                 (list op type-tags))))))))))))
</span></span></code></pre></td></tr></table></div></div><h3 id=练习-85>练习 85</h3><p>本节中提到了“简化”数据对象表示的一种方法，就是使之在类型塔中尽可能地下降。请设计一个过程 <code>drop</code>（下落），使它能在如
<a href=#%e7%bb%83%e4%b9%a0-83 title="练习 83">练习 83</a> 所描述的 类型塔中完成这一工作。这里的关键是以某种一般性的方式，判断一个数据对象能否下降。举例来说，复数 $1.5 + 0i$ 至多可以下降到 <code>real</code>，复数 $1 + 0i$ 至多可以下降到 <code>integer</code>，而复数 $2 + 3i$ 就根本无法下降。现在提出一种确定一个对象能否下降的计划：首先定义一个运算 <code>project</code>（投影），它将一个对象“压”到塔的下面一层。例如，投影一个复数就是丢掉其虚部。这样，一个数能够向下落，如果我们首先 <code>project</code> 它而后将得到的结果 <code>raise</code> 到开始的类型，最终得到的东西与开始的东西相等。请阐述实现这一想法的具体细节，并写出一个 <code>drop</code> 过程，使它可以将一个对象尽可能下落。你将需要设计各种各样的投影函数，并需要把 <code>project</code> 安装为系统里的一个通用型操作。你还需要使用一个通用型的相等谓词，例如
<a href=#%e7%bb%83%e4%b9%a0-79 title="练习 79">练习 79</a> 所描述的。最后，请利用 <code>drop</code> 重写
<a href=#%e7%bb%83%e4%b9%a0-84 title="练习 84">练习 84</a> 的 <code>apply-generic</code>，使之可以“简化”其结果。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#f92672>#</span>lang sicp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>project</span> x) (<span style=color:#a6e22e>apply-generic</span> <span style=color:#e6db74>&#39;project</span> x))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>droppable?</span> x)
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>equ?</span> x (<span style=color:#a6e22e>raise</span> (<span style=color:#a6e22e>project</span> x))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>drop</span> x)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>if </span>(<span style=color:#a6e22e>droppable?</span> x)
</span></span><span style=display:flex><span>      (<span style=color:#a6e22e>drop</span> (<span style=color:#a6e22e>project</span> x))
</span></span><span style=display:flex><span>      x))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;; add into rational package</span>
</span></span><span style=display:flex><span>(<span style=color:#a6e22e>put</span> <span style=color:#e6db74>&#39;project</span> <span style=color:#f92672>&#39;</span>(rational)
</span></span><span style=display:flex><span>     (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>x</span>) (<span style=color:#a6e22e>tag</span> (<span style=color:#a6e22e>make-scheme-number</span> (round (/ (<span style=color:#a6e22e>numer</span> x) (<span style=color:#a6e22e>denom</span> x)))))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;; add into real package</span>
</span></span><span style=display:flex><span>(<span style=color:#a6e22e>put</span> <span style=color:#e6db74>&#39;project</span> <span style=color:#f92672>&#39;</span>(real)
</span></span><span style=display:flex><span>     (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>x</span>) (<span style=color:#a6e22e>tag</span> (<span style=color:#a6e22e>make-rat</span> (* x <span style=color:#ae81ff>1</span>e9) <span style=color:#ae81ff>1</span>e9))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;; add into complex package</span>
</span></span><span style=display:flex><span>(<span style=color:#a6e22e>put</span> <span style=color:#e6db74>&#39;project</span> <span style=color:#f92672>&#39;</span>(complex)
</span></span><span style=display:flex><span>     (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>x</span>) (<span style=color:#a6e22e>tag</span> (<span style=color:#a6e22e>make-real</span> (real-part x)))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>apply-generic</span> op <span style=color:#f92672>.</span> args)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>args2</span> (map drop args)))
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>type-tags</span> (map type-tag args2)))
</span></span><span style=display:flex><span>      (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>proc</span> (<span style=color:#a6e22e>get</span> op type-tags)))
</span></span><span style=display:flex><span>        (<span style=color:#66d9ef>if </span>proc
</span></span><span style=display:flex><span>            (apply proc (map contents args2))
</span></span><span style=display:flex><span>            (<span style=color:#66d9ef>if </span>(<span style=color:#a6e22e>same-type?</span> type-tags)
</span></span><span style=display:flex><span>                (<span style=color:#a6e22e>error</span> <span style=color:#e6db74>&#34;No method for these types&#34;</span>
</span></span><span style=display:flex><span>                       (list op (map type-tag args)))
</span></span><span style=display:flex><span>                (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>types</span> (<span style=color:#a6e22e>get-types</span> type-tags)))
</span></span><span style=display:flex><span>                  (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>top</span> (<span style=color:#a6e22e>get-top</span> types)))
</span></span><span style=display:flex><span>                    (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>same-type-args</span> (<span style=color:#a6e22e>map</span>
</span></span><span style=display:flex><span>                                           (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>arg</span>)
</span></span><span style=display:flex><span>                                             (<span style=color:#a6e22e>multi-raise</span> top arg))
</span></span><span style=display:flex><span>                                           args2)))
</span></span><span style=display:flex><span>                      (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>proc</span> (<span style=color:#a6e22e>get</span> op (map type-tag same-type-args))))
</span></span><span style=display:flex><span>                        (<span style=color:#66d9ef>if </span>proc
</span></span><span style=display:flex><span>                            (apply proc same-type-args)
</span></span><span style=display:flex><span>                            (<span style=color:#a6e22e>error</span> <span style=color:#e6db74>&#34;No method for these types&#34;</span>
</span></span><span style=display:flex><span>                                   (list op (map type-tag args)))))))))))))
</span></span></code></pre></td></tr></table></div></div><h3 id=练习-86>练习 86</h3><p>假定我们希望处理一些复数，它们的实部、虚部、模和幅角都可以是常规数值、有理数，或者我们希望加入系统的任何其他数值类型。请描述和实现系统需要做的各种修改，以满足这一需要。你应设法将例如 <code>sine</code> 和 <code>cosine</code> 一类的运算也定义为在常规数和有理数上的通用运算。</p><p>将复数包里面的各种基本算术操作全部替换成通用型算术操作。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#f92672>#</span>lang sicp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>sine</span> x) (<span style=color:#a6e22e>apply-generic</span> <span style=color:#e6db74>&#39;sine</span> x))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>cosine</span> x) (<span style=color:#a6e22e>apply-generic</span> <span style=color:#e6db74>&#39;cosine</span> x))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;; add into scheme-number package</span>
</span></span><span style=display:flex><span>(<span style=color:#a6e22e>put</span> <span style=color:#e6db74>&#39;sine</span> <span style=color:#f92672>&#39;</span>(scheme-number)
</span></span><span style=display:flex><span>     (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>x</span>) (<span style=color:#a6e22e>tag</span> (sin x))))
</span></span><span style=display:flex><span>(<span style=color:#a6e22e>put</span> <span style=color:#e6db74>&#39;cosine</span> <span style=color:#f92672>&#39;</span>(scheme-number)
</span></span><span style=display:flex><span>     (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>x</span>) (<span style=color:#a6e22e>tag</span> (cos x))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;; add into rational package</span>
</span></span><span style=display:flex><span>(<span style=color:#a6e22e>pur</span> <span style=color:#e6db74>&#39;sine</span> <span style=color:#f92672>&#39;</span>(rational)
</span></span><span style=display:flex><span>     (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>x</span>) (<span style=color:#a6e22e>tag</span> (sin (/ (<span style=color:#a6e22e>numer</span> x) (<span style=color:#a6e22e>denom</span> x))))))
</span></span><span style=display:flex><span>(<span style=color:#a6e22e>pur</span> <span style=color:#e6db74>&#39;cosine</span> <span style=color:#f92672>&#39;</span>(rational)
</span></span><span style=display:flex><span>     (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>x</span>) (<span style=color:#a6e22e>tag</span> (cos (/ (<span style=color:#a6e22e>numer</span> x) (<span style=color:#a6e22e>denom</span> x))))))
</span></span></code></pre></td></tr></table></div></div><h3 id=练习-87>练习 87</h3><p>请在通用算术包中为多项式安装 <code>=zero?</code>，这将使 <code>adjoin-term</code> 也能对系数本身也是多项式的多项式使用。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#f92672>#</span>lang sicp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;; add into polynomial package</span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>=zero-poly?</span> p)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>iter</span> terms)
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>if </span>(<span style=color:#a6e22e>empty-termlist?</span> terms)
</span></span><span style=display:flex><span>        true
</span></span><span style=display:flex><span>        (<span style=color:#66d9ef>and </span>(<span style=color:#a6e22e>=zero?</span> (<span style=color:#a6e22e>coeff</span> (<span style=color:#a6e22e>first-term</span> terms)))
</span></span><span style=display:flex><span>             (<span style=color:#a6e22e>iter</span> (<span style=color:#a6e22e>rest-terms</span> terms)))))
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>iter</span> (<span style=color:#a6e22e>term-list</span> p)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#a6e22e>put</span> <span style=color:#e6db74>&#39;=zero?</span> <span style=color:#f92672>&#39;</span>(polynomial)
</span></span><span style=display:flex><span>     (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>p</span>) (<span style=color:#a6e22e>=zero-poly?</span> p)))
</span></span></code></pre></td></tr></table></div></div><h3 id=练习-88>练习 88</h3><p>请扩充多项式系统，加上多项式的减法。（提示：你可能发现定义一个通用的求负操作非常有用。）</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#f92672>#</span>lang sicp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>inverse</span> x) (<span style=color:#a6e22e>apply-generic</span> <span style=color:#e6db74>&#39;inverse</span> x))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;; add into schme-number package</span>
</span></span><span style=display:flex><span>(<span style=color:#a6e22e>put</span> <span style=color:#e6db74>&#39;inverse</span> <span style=color:#f92672>&#39;</span>(scheme-number)
</span></span><span style=display:flex><span>     (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>x</span>) (<span style=color:#a6e22e>tag</span> (<span style=color:#a6e22e>make-scheme-number</span> (- x)))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;; add into rational package</span>
</span></span><span style=display:flex><span>(<span style=color:#a6e22e>put</span> <span style=color:#e6db74>&#39;inverse</span> <span style=color:#f92672>&#39;</span>(rational)
</span></span><span style=display:flex><span>     (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>x</span>) (<span style=color:#a6e22e>tag</span> (<span style=color:#a6e22e>make-rat</span> (- (<span style=color:#a6e22e>numer</span> x)) (<span style=color:#a6e22e>denom</span> x)))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;; add into real package</span>
</span></span><span style=display:flex><span>(<span style=color:#a6e22e>put</span> <span style=color:#e6db74>&#39;inverse</span> <span style=color:#f92672>&#39;</span>(real)
</span></span><span style=display:flex><span>     (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>x</span>) (<span style=color:#a6e22e>tag</span> (<span style=color:#a6e22e>make-rat</span> (- x )))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;; add into complex package</span>
</span></span><span style=display:flex><span>(<span style=color:#a6e22e>put</span> <span style=color:#e6db74>&#39;inverse</span> <span style=color:#f92672>&#39;</span>(complex)
</span></span><span style=display:flex><span>     (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>x</span>)
</span></span><span style=display:flex><span>       (<span style=color:#a6e22e>tag</span> (<span style=color:#a6e22e>make-complex-from-real-imag</span> (- (real-part x))
</span></span><span style=display:flex><span>                                         (- (imag-part x))))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;; add into polynominal package</span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>sub-poly</span> p1 p2)
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>add-poly</span> p2 (<span style=color:#a6e22e>inverse</span> p2)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#a6e22e>put</span> <span style=color:#e6db74>&#39;inverse</span> <span style=color:#f92672>&#39;</span>(polynominal)
</span></span><span style=display:flex><span>     (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>p</span>) (<span style=color:#a6e22e>tag</span> (<span style=color:#a6e22e>make-poly</span>
</span></span><span style=display:flex><span>                       (<span style=color:#a6e22e>variable</span> p)
</span></span><span style=display:flex><span>                       (map (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>term</span>)
</span></span><span style=display:flex><span>                              (<span style=color:#a6e22e>make-term</span> (<span style=color:#a6e22e>order</span> term)
</span></span><span style=display:flex><span>                                         (<span style=color:#a6e22e>inverse</span> (<span style=color:#a6e22e>coeff</span> term))))
</span></span><span style=display:flex><span>                            (<span style=color:#a6e22e>term-list</span> p))))))
</span></span><span style=display:flex><span>(<span style=color:#a6e22e>put</span> <span style=color:#e6db74>&#39;sub</span> <span style=color:#f92672>&#39;</span>(polynominal polynominal)
</span></span><span style=display:flex><span>     (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>p1</span> p2) (<span style=color:#a6e22e>tag</span> (<span style=color:#a6e22e>sub-poly</span> p1 p2))))
</span></span></code></pre></td></tr></table></div></div><h3 id=练习-89>练习 89</h3><p>请定义一些过程，实现上面讨论的适宜稠密多项式的项表表示。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#f92672>#</span>lang sicp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>adjoin-term</span> term term-list)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>if </span>(<span style=color:#a6e22e>=zero?</span> (<span style=color:#a6e22e>coeff</span> term))
</span></span><span style=display:flex><span>      term-list
</span></span><span style=display:flex><span>      (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>order1</span> (<span style=color:#a6e22e>order</span> term))
</span></span><span style=display:flex><span>            (<span style=color:#a6e22e>order2</span> (- (length term-list) <span style=color:#ae81ff>1</span>)))
</span></span><span style=display:flex><span>        (<span style=color:#66d9ef>cond </span>((&lt; order1 order2)
</span></span><span style=display:flex><span>               (cons (<span style=color:#a6e22e>first-term</span> term-list)
</span></span><span style=display:flex><span>                     (<span style=color:#a6e22e>adjoin-term</span> term (<span style=color:#a6e22e>rest-terms</span> term-list))))
</span></span><span style=display:flex><span>              ((= order1 order2)
</span></span><span style=display:flex><span>               (cons (<span style=color:#a6e22e>coeff</span> term) (<span style=color:#a6e22e>rest-terms</span> term-list)))
</span></span><span style=display:flex><span>              (<span style=color:#a6e22e>else</span>
</span></span><span style=display:flex><span>               (<span style=color:#a6e22e>adjoin-term</span> term (cons <span style=color:#ae81ff>0</span> term-list)))))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>first-term</span> term-list)
</span></span><span style=display:flex><span>  (list (- (length term-list) <span style=color:#ae81ff>1</span>) (car term-list)))
</span></span></code></pre></td></tr></table></div></div><h3 id=练习-90>练习 90</h3><p>假定我们希望有一个多项式系统，它应该对稠密多项式和稀疏多项式都非常有效。一种途径就是在我们的系统里同时允许两种表示形式。这时的情况类似于 2.4 节复数的例子，那里同时允许采用直角坐标表示和极坐标表示。为了完成这一工作，我们必须区分不同的项表类型，并将针对项表的操作通用化。请重新设计这个多项式系统，实现这种推广。这将是一项需要付出很多努力的工作，而不是一个局部修改。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">47
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">48
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">49
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#f92672>#</span>lang sicp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>install-sparse-term-list</span>)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>adjoin-term</span> term term-list)
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>if </span>(<span style=color:#a6e22e>=zero?</span> (<span style=color:#a6e22e>coeff</span> term))
</span></span><span style=display:flex><span>        term-list
</span></span><span style=display:flex><span>        (cons term term-list)))
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>first-term</span> term-list) (car term-list))
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>rest-terms</span> term-list) (cdr term-lists))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>tag</span> term-list) (<span style=color:#a6e22e>attach-tag</span> <span style=color:#e6db74>&#39;sparse</span> term-list))
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>put</span> <span style=color:#e6db74>&#39;adjoin-term</span> <span style=color:#e6db74>&#39;sparse</span> adjoin-term)
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>put</span> <span style=color:#e6db74>&#39;first-term</span> <span style=color:#f92672>&#39;</span>(sparse) first-term)
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>put</span> <span style=color:#e6db74>&#39;rest-terms</span> <span style=color:#f92672>&#39;</span>(sparse)
</span></span><span style=display:flex><span>       (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>term-list</span>) (<span style=color:#a6e22e>tag</span> (<span style=color:#a6e22e>rest-terms</span> term-list))))
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;done</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>install-dense-term-list</span>)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>adjoin-term</span> term term-list)
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>if </span>(<span style=color:#a6e22e>=zero?</span> (<span style=color:#a6e22e>coeff</span> term))
</span></span><span style=display:flex><span>        term-list
</span></span><span style=display:flex><span>        (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>order1</span> (<span style=color:#a6e22e>order</span> term))
</span></span><span style=display:flex><span>              (<span style=color:#a6e22e>order2</span> (- (length term-list) <span style=color:#ae81ff>1</span>)))
</span></span><span style=display:flex><span>          (<span style=color:#66d9ef>cond </span>((&lt; order1 order2)
</span></span><span style=display:flex><span>                 (cons (<span style=color:#a6e22e>first-term</span> term-list)
</span></span><span style=display:flex><span>                       (<span style=color:#a6e22e>adjoin-term</span> term (<span style=color:#a6e22e>rest-terms</span> term-list))))
</span></span><span style=display:flex><span>                ((= order1 order2)
</span></span><span style=display:flex><span>                 (cons (<span style=color:#a6e22e>coeff</span> term) (<span style=color:#a6e22e>rest-terms</span> term-list)))
</span></span><span style=display:flex><span>                (<span style=color:#a6e22e>else</span>
</span></span><span style=display:flex><span>                 (<span style=color:#a6e22e>adjoin-term</span> term (cons <span style=color:#ae81ff>0</span> term-list)))))))
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>first-term</span> term-list)
</span></span><span style=display:flex><span>    (list (- (length term-list) <span style=color:#ae81ff>1</span>) (car term-list)))
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>rest-terms</span> term-list) (cdr term-lists))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>tag</span> term-list) (<span style=color:#a6e22e>attach-tag</span> <span style=color:#e6db74>&#39;dense</span> term-list))
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>put</span> <span style=color:#e6db74>&#39;adjoin-term</span> <span style=color:#e6db74>&#39;dense</span> adjoin-term)
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>put</span> <span style=color:#e6db74>&#39;first-term</span> <span style=color:#f92672>&#39;</span>(dense) first-term)
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>put</span> <span style=color:#e6db74>&#39;rest-terms</span> <span style=color:#f92672>&#39;</span>(dense)
</span></span><span style=display:flex><span>       (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>term-list</span>) (<span style=color:#a6e22e>tag</span> (<span style=color:#a6e22e>rest-terms</span> term-list))))
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;done</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>adjoin-term</span> term term-list)
</span></span><span style=display:flex><span>  ((<span style=color:#a6e22e>get</span> <span style=color:#e6db74>&#39;adjoin-term</span> (<span style=color:#a6e22e>type-tag</span> term-list)) term term-list))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>first-term</span> term-list)
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>apply-generic</span> <span style=color:#e6db74>&#39;first-term</span> term-list))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>rest-terms</span> term-list)
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>apply-generic</span> <span style=color:#e6db74>&#39;rest-terms</span> term-list))
</span></span></code></pre></td></tr></table></div></div><h3 id=练习-91>练习 91</h3><p>一个单变元多项式可以除以另一个多项式，产生出一个商式和一个余式，例如</p><p>$$
\frac{x^5 - 1}{x^2 - 1} = x^3 + x\quad ,\quad\text{余式 } x - 1
$$</p><p>除法可以通过长除完成。也就是说，用被除式的最高次项除以除式的最高次项，得到商式的第一项；而后用这个结果乘以除式，并从被除式中减去这个乘积。剩下的工作就是用减后得到的差作为新的被除式，以便产生出随后的结果。当除式的次数超过被除式的次数时结束，将此时的被除式作为余式。还有，如果被除式就是 $0$，那么就返回 $0$ 作为商和余式。</p><p>我们可以基于 <code>add-poly</code> 和 <code>mul-poly</code> 的模型，设计出一个除法过程 <code>div-poly</code>。这一过程首先检查两个多项式是否具有相同的变元，如果是的话就剥去这一变元，将问题送给过程 <code>div-terms</code>，它执行项表上的除法运算。<code>div-poly</code> 最后将变元重新附加到 <code>div-terms</code> 返回的结果上。将 <code>div-terms</code> 设计为同时计算出除法的商式和余式是比较方便的。<code>div-terms</code> 可以以两个表为参数，返回一个商式的表和一个余式的表。</p><p>请完成下面 <code>div-termns</code> 的定义，填充其中空缺的表达式，并基于它实现 <code>div-poly</code>。该过程应该以两个多项式为参数，返回一个包含商和余式多项式的表。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>div-terms</span> L1 L2)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>if </span>(<span style=color:#a6e22e>empty-termlist?</span> L1)
</span></span><span style=display:flex><span>      (list (<span style=color:#a6e22e>the-empty-termlist</span>) (<span style=color:#a6e22e>the-empty-termlist</span>))
</span></span><span style=display:flex><span>      (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>t1</span> (<span style=color:#a6e22e>first-term</span> L1))
</span></span><span style=display:flex><span>            (<span style=color:#a6e22e>t2</span> (<span style=color:#a6e22e>first-term</span> L2)))
</span></span><span style=display:flex><span>        (<span style=color:#66d9ef>if </span>(&gt; (<span style=color:#a6e22e>order</span> t2) (<span style=color:#a6e22e>order</span> t1))
</span></span><span style=display:flex><span>            (list (<span style=color:#a6e22e>the-empty-termlist</span>) L1)
</span></span><span style=display:flex><span>            (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>new-c</span> (<span style=color:#a6e22e>div</span> (<span style=color:#a6e22e>coeff</span> t1) (<span style=color:#a6e22e>coeff</span> t2)))
</span></span><span style=display:flex><span>                  (<span style=color:#a6e22e>new-o</span> (- (<span style=color:#a6e22e>order</span> t1) (<span style=color:#a6e22e>order</span> t2))))
</span></span><span style=display:flex><span>              (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>rest-of-result</span>
</span></span><span style=display:flex><span>                     &lt;递归地计算结果的其余部分&gt;
</span></span><span style=display:flex><span>                     ))
</span></span><span style=display:flex><span>                &lt;形成完整的结果&gt;
</span></span><span style=display:flex><span>                ))))))
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#f92672>#</span>lang sicp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>div-terms</span> L1 L2)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>if </span>(<span style=color:#a6e22e>empty-termlist?</span> L1)
</span></span><span style=display:flex><span>      (list (<span style=color:#a6e22e>the-empty-termlist</span>) (<span style=color:#a6e22e>the-empty-termlist</span>))
</span></span><span style=display:flex><span>      (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>t1</span> (<span style=color:#a6e22e>first-term</span> L1))
</span></span><span style=display:flex><span>            (<span style=color:#a6e22e>t2</span> (<span style=color:#a6e22e>first-term</span> L2)))
</span></span><span style=display:flex><span>        (<span style=color:#66d9ef>if </span>(&gt; (<span style=color:#a6e22e>order</span> t2) (<span style=color:#a6e22e>order</span> t1))
</span></span><span style=display:flex><span>            (list (<span style=color:#a6e22e>the-empty-termlist</span>) L1)
</span></span><span style=display:flex><span>            (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>new-c</span> (<span style=color:#a6e22e>div</span> (<span style=color:#a6e22e>coeff</span> t1) (<span style=color:#a6e22e>coeff</span> t2)))
</span></span><span style=display:flex><span>                  (<span style=color:#a6e22e>new-o</span> (- (<span style=color:#a6e22e>order</span> t1) (<span style=color:#a6e22e>order</span> t2))))
</span></span><span style=display:flex><span>              (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>rest-of-result</span>
</span></span><span style=display:flex><span>                     (<span style=color:#a6e22e>div-terms</span> (<span style=color:#a6e22e>sub-terms</span>
</span></span><span style=display:flex><span>                                 L1
</span></span><span style=display:flex><span>                                 (<span style=color:#a6e22e>mul-terms</span> (list (<span style=color:#a6e22e>make-term</span>
</span></span><span style=display:flex><span>                                                   new-o
</span></span><span style=display:flex><span>                                                   new-c))
</span></span><span style=display:flex><span>                                            L2))
</span></span><span style=display:flex><span>                                L2)
</span></span><span style=display:flex><span>                     ))
</span></span><span style=display:flex><span>                (list (<span style=color:#a6e22e>adjoin-term</span> (<span style=color:#a6e22e>make-term</span> new-o new-c)
</span></span><span style=display:flex><span>                                   (car rest-of-result))
</span></span><span style=display:flex><span>                      (cadr rest-of-result))
</span></span><span style=display:flex><span>                ))))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>div-poly</span> p1 p2)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>if </span>(<span style=color:#a6e22e>same-variable?</span> (<span style=color:#a6e22e>variable</span> p1) (<span style=color:#a6e22e>variable</span> p2))
</span></span><span style=display:flex><span>      (<span style=color:#a6e22e>make-poly</span> (<span style=color:#a6e22e>variable</span> p1)
</span></span><span style=display:flex><span>                 (<span style=color:#a6e22e>div-terms</span> (<span style=color:#a6e22e>term-list</span> p1)
</span></span><span style=display:flex><span>                            (<span style=color:#a6e22e>term-list</span> p2)))
</span></span><span style=display:flex><span>      (<span style=color:#a6e22e>error</span> <span style=color:#e6db74>&#34;Polys not in same var -- DIV-POLY&#34;</span>
</span></span><span style=display:flex><span>             (list p1 p2))))
</span></span></code></pre></td></tr></table></div></div><h3 id=练习-92>练习 92</h3><p>通过加入强制性的变量序扩充多项式程序包，使多项式的加法和乘法能对具有不同变量的多项式进行。（这绝不简单！）</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#f92672>#</span>lang sicp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>types <span style=color:#f92672>&#39;</span>(scheme-number rational real complex))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>add-coercion</span> x y)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>t1</span> (<span style=color:#a6e22e>type-tag</span> x)) (<span style=color:#a6e22e>t2</span> (<span style=color:#a6e22e>type-tag</span> y)))
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>cond </span>((<span style=color:#66d9ef>and </span>(eq? t1 <span style=color:#e6db74>&#39;polynomial</span>) (memq t2 types))
</span></span><span style=display:flex><span>           (<span style=color:#a6e22e>add</span> x (<span style=color:#a6e22e>make-poly</span>
</span></span><span style=display:flex><span>                   (<span style=color:#a6e22e>variable</span> x)
</span></span><span style=display:flex><span>                   (list (<span style=color:#a6e22e>make-term</span> <span style=color:#ae81ff>0</span> (<span style=color:#a6e22e>content</span> y))))))
</span></span><span style=display:flex><span>          ((<span style=color:#66d9ef>and </span>(memq t1 types) (eq? t2 <span style=color:#e6db74>&#39;polynominal</span>))
</span></span><span style=display:flex><span>           (<span style=color:#a6e22e>add</span> y (<span style=color:#a6e22e>make-poly</span>
</span></span><span style=display:flex><span>                   (<span style=color:#a6e22e>variable</span> y)
</span></span><span style=display:flex><span>                   (list (<span style=color:#a6e22e>make-term</span> <span style=color:#ae81ff>0</span> (<span style=color:#a6e22e>content</span> x))))))
</span></span><span style=display:flex><span>          (<span style=color:#66d9ef>else </span>(<span style=color:#a6e22e>add</span> x y)))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>mul-coercion</span> x y)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>let </span>((<span style=color:#a6e22e>t1</span> (<span style=color:#a6e22e>type-tag</span> x)) (<span style=color:#a6e22e>t2</span> (<span style=color:#a6e22e>type-tag</span> y)))
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>cond </span>((<span style=color:#66d9ef>and </span>(eq? t1 <span style=color:#e6db74>&#39;polynomial</span>) (memq t2 types))
</span></span><span style=display:flex><span>           (<span style=color:#a6e22e>mul</span> x (<span style=color:#a6e22e>make-poly</span>
</span></span><span style=display:flex><span>                   (<span style=color:#a6e22e>variable</span> x)
</span></span><span style=display:flex><span>                   (list (<span style=color:#a6e22e>make-term</span> <span style=color:#ae81ff>0</span> (<span style=color:#a6e22e>content</span> y))))))
</span></span><span style=display:flex><span>          ((<span style=color:#66d9ef>and </span>(memq t1 types) (eq? t2 <span style=color:#e6db74>&#39;polynominal</span>))
</span></span><span style=display:flex><span>           (<span style=color:#a6e22e>mul</span> y (<span style=color:#a6e22e>make-poly</span>
</span></span><span style=display:flex><span>                   (<span style=color:#a6e22e>variable</span> y)
</span></span><span style=display:flex><span>                   (list (<span style=color:#a6e22e>make-term</span> <span style=color:#ae81ff>0</span> (<span style=color:#a6e22e>content</span> x))))))
</span></span><span style=display:flex><span>          (<span style=color:#66d9ef>else </span>(<span style=color:#a6e22e>mul</span> x y)))))
</span></span></code></pre></td></tr></table></div></div></div><footer class=post-footer><div class=post-tags><a href=/tags/scheme>Scheme</a>
<a href=/tags/sicp>SICP</a></div><div class=addthis_inline_share_toolbox style=text-align:center></div><hr><div class=post-copyright><img src=/imgs/cc/cc.svg width=75 height=75 align=right><ul><li class=post-copyright-title><strong>文章标题：</strong>
Learn SICP Chapter 2</li><li class=post-copyright-author><strong>本文作者：</strong>
Baitian</li><li class=post-copyright-link><strong>本文链接：</strong>
<a id=post-cr-link href=/post/sicp/learn-sicp-ch2/ title="Learn SICP Chapter 2">/post/sicp/learn-sicp-ch2/</a></li><li class=post-copyright-license><strong>版权声明：</strong>
本博客所有文章除特别声明外，均采用 <i class="fab fa-fw fa-creative-commons"></i><a target=_blank href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh>BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><div class=post-nav><div class="post-nav-next post-nav-item"><a href=/post/openstack/ubuntu-18-04-kolla-ansible-deploy-openstack-stein-multinode/ rel=next title="Ubuntu 18.04 通过 Kolla Ansible 部署多节点 OpenStack Stein"><i class="fa fa-chevron-left"></i> Ubuntu 18.04 通过 Kolla Ansible 部署多节点 OpenStack Stein</a></div><div class="post-nav-prev post-nav-item"><a href=/post/sicp/learn-sicp-ch1/ rel=prev title="Learn SICP Chapter 1">Learn SICP Chapter 1
<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div class=post-comments><div class=comment-head><div class=comment-headline><i class="fas fa-comments fa-fw"></i>
<span>评论交流</span></div></div><div class=comment-wrap><div><div class=comment-loading><i class="fa fa-sync fa-spin"></i></div><div class=giscus-container></div></div></div></div></div></main><footer class=footer><div class=footer-inner><div class=copyright>&copy;
<span itemprop=copyrightYear>2019 - 2022</span>
<span class=with-love><i class="fa fa-heart"></i></span>
<span class=author itemprop=copyrightHolder>Baitian</span></div><div class=powered-by>由 <a href=https://gohugo.io target=_blank>Hugo</a> & <a href=https://github.com/hugo-next/hugo-theme-next target=_blank>Hugo NexT.Pisces</a> 强力驱动</div></div></footer><script type=text/javascript src=https://unpkg.com/animejs@3.2.1/lib/anime.min.js defer></script>
<script class=next-config data-name=main type=application/json>{"bookmark":{"color":"#222","enable":false,"save":"manual"},"copybtn":true,"darkmode":true,"giscus":{"cfg":{"category":"Comments","categoryid":null,"emit":false,"inputposition":"top","mapping":"title","reactions":false,"repo":"baitian752/baitian752.github.io","repoid":"MDEwOlJlcG9zaXRvcnkyNDQ2MDkwNjk","theme":"preferred_color_scheme"},"js":"https://giscus.app/client.js"},"hostname":"/","i18n":{"empty":"没有找到任何搜索结果：${query}","hits":"","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","placeholder":"搜索..."},"lang":"zh-CN","lazyload":false,"localSearch":{"enable":true,"path":"searchindexes.xml","preload":false,"topnperarticle":-1,"trigger":"auto","unescape":false},"motion":{"async":true,"enable":true,"transition":{"collheader":"fadeInLeft","postblock":"fadeIn","postbody":"fadeInDown","postheader":"fadeInDown","sidebar":"fadeInUp"}},"root":"/","scheme":"Pisces","sidebar":{"display":"post","offset":12,"padding":18,"position":"left","width":256},"vendor":{"plugins":"unpkg","router":"https://unpkg.com"},"version":"4.2.0","waline":{"cfg":{"emoji":false,"imguploader":false,"pageview":true,"placeholder":"请文明发言","requiredmeta":["nick","mail"],"serverurl":null,"wordlimit":200},"css":{"alias":"waline","file":"dist/waline.css","name":"@waline/client","version":"2.6.1"},"js":{"alias":"waline","file":"dist/waline.js","name":"@waline/client","version":"2.6.1"}}}</script><script type=text/javascript src=/js/main.min.a39bf43ceda90a8a424b9bd67fa9ad071d0da51c67ba2ef98477a2bab0cdd005.js defer></script></body></html>