<?xml version="1.0" encoding="utf-8" standalone="yes"?><search><entry><title>Jupyter Notebook</title><url>/post/tools/jupyter-notebook/</url><categories><category>Tool</category></categories><tags><tag>Jupyter</tag><tag>Notebook</tag></tags><content type="html"><![CDATA[å†™è¿™ç¯‡åšå®¢çš„ç›®çš„ï¼Œå¤§æ¦‚æ˜¯èº«è¾¹å¾ˆå¤šäººéƒ½è®¤ä¸º Jupyter Notebook æ˜¯ Python ä¸“å±çš„ï¼Œä½†å…¶å® Jupyter æ˜¯æ”¯æŒå¾ˆå¤šå…¶ä»– kernel çš„ï¼Œåœ¨å­¦ä¹ ä¸€é—¨æ–°çš„è¯­è¨€ã€æˆ–æ˜¯å¯¹äºä¸€äº›æ–°çš„è¯­è¨€ç‰¹æ€§ä¸ç¡®å®šçš„æ—¶å€™ï¼Œç”¨ Jupyter æ¥æµ‹è¯•ä¼šååˆ†æ–¹ä¾¿ï¼Œå°¤å…¶æ˜¯å¯¹äºåƒ C++ã€Goã€Rust è¿™ç§ç¼–è¯‘å‹è¯­è¨€ã€‚
éƒ¨ç½²æµç¨‹ å‡ºäºå®‰å…¨æ€§è€ƒè™‘ï¼Œè¯·ä¸è¦ä½¿ç”¨ root ç”¨æˆ·è¿è¡Œ Jupyterï¼Œå› ä¸º Jupyter é»˜è®¤æ˜¯å¼€å¯ Terminal çš„ï¼Œå³ä½¿å…³æ‰ï¼Œé€šè¿‡ç¼–ç¨‹è¯­è¨€çš„æ¥å£ï¼Œä¹Ÿå¯ä»¥ç›´æ¥å¯¹ç³»ç»Ÿè¿›è¡Œæ“ä½œã€‚è¯¥æµç¨‹åœ¨å®¹å™¨ä¸­éƒ¨ç½²ï¼ŒåŒæ—¶ç”¨é root ç”¨æˆ·è¿è¡Œï¼Œæä¾›äº†ä¸€å®šçš„å®‰å…¨ä¿éšœã€‚ Dockerfile ä¸‹é¢çš„ Dockerfile ä¼šè£… C++, Go, Rust è¿™ 3 ä¸ª kernelï¼Œå¯ä»¥å‚è€ƒå®˜æ–¹ wiki è£…å…¶ä»– kernelã€‚å¦‚æœ Host ç³»ç»Ÿä¸æ˜¯ x86_64 æ¶æ„çš„ï¼ŒMiniconda å’Œ Go éœ€è¦ä¸‹è½½å¯¹åº”æ¶æ„çš„ releaseï¼ˆå¯èƒ½ä¼šè¸©ä¸€äº›å‘ ğŸ¤£ï¼‰ã€‚ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 FROM debian:bullseye-slim ARG USER=notebook ARG HOME=/home/${USER} RUN adduser --disabled-password --gecos &#34;&#34; --home ${HOME} ${USER} RUN apt-get update &amp;&amp; export DEBIAN_FRONTEND=noninteractive &amp;&amp; \ apt-get install -y --no-install-recommends ca-certificates curl wget cmake build-essential &amp;&amp; \ rm -rf /var/lib/apt/lists/* USER ${USER} # install miniconda ENV PATH=${HOME}/miniconda3/bin:${PATH} RUN cd ${HOME} &amp;&amp; \ wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh &amp;&amp; \ bash Miniconda3-latest-Linux-x86_64.sh -b &amp;&amp; \ rm -f Miniconda3-latest-Linux-x86_64.sh # install jupyter RUN conda install -y jupyter # install C++ kernel RUN conda install -y xeus-cling -c conda-forge # clean conda cache RUN conda clean --all # install go kernel ENV PATH=${HOME}/go/bin:${PATH} RUN wget -qO- https://go.dev/dl/go1.19.linux-amd64.tar.gz | tar zxvf - -C ${HOME} RUN go install github.com/gopherdata/gophernotes@v0.7.5 &amp;&amp; \ mkdir -p ${HOME}/.local/share/jupyter/kernels/gophernotes &amp;&amp; \ cd ${HOME}/.local/share/jupyter/kernels/gophernotes &amp;&amp; \ cp &#34;$(go env GOPATH)&#34;/pkg/mod/github.com/gopherdata/gophernotes@v0.7.5/kernel/* ./ &amp;&amp; \ chmod +w kernel.json &amp;&amp; \ sed &#34;s|gophernotes|$(go env GOPATH)/bin/gophernotes|&#34; &lt; kernel.json.in &gt; kernel.json # install rust kernel ENV PATH=${HOME}/.cargo/bin:${PATH} RUN cd ${HOME} &amp;&amp; \ curl --proto &#39;=https&#39; --tlsv1.2 -sSf https://sh.rustup.rs &gt; rustup-init.sh &amp;&amp; \ bash rustup-init.sh -y &amp;&amp; \ rm -f rustup-init.sh RUN rustup component add rust-src &amp;&amp; \ cargo install evcxr_jupyter &amp;&amp; \ evcxr_jupyter --install RUN mkdir -p ${HOME}/notebook WORKDIR ${HOME}/notebook ENTRYPOINT [ &#34;jupyter&#34;, &#34;notebook&#34;, &#34;--ip=&#39;*&#39;&#34;, &#34;--port=8888&#34; ] æ„å»º docker é•œåƒ 1 docker build -t notebook . è¿è¡Œå®¹å™¨ 1 docker run -d -p 8888:8888 --restart always --name notebook notebook è®¾ç½®è®¿é—®å¯†ç  1 docker exec -it notebook jupyter notebook password é‡å¯å®¹å™¨ 1 docker restart notebook é‡ç½®å¯†ç çš„æµç¨‹ä¹Ÿæ˜¯ è®¾ç½®è®¿é—®å¯†ç  å é‡å¯å®¹å™¨ ã€‚ ]]></content></entry><entry><title>Ubuntu 18.04 é€šè¿‡ Kolla Ansible éƒ¨ç½² OpenStack Ussuri</title><url>/post/openstack/ubuntu-18-04-kolla-ansible-deploy-openstack-ussuri/</url><categories><category>Work</category></categories><tags><tag>OpenStack</tag><tag>Python</tag><tag>Shell</tag></tags><content type="html"><![CDATA[å®‰è£… Ubuntu 18.04 å®‰è£…ä¸¤å° Ubuntu 18.04ï¼Œå…¶ä¸­ä¸€å°è‡³å°‘é…ç½®ä¸¤å—ç½‘å¡ï¼Œå¦ä¸€å°è‡³å°‘é…ç½®ä¸€å—ç½‘å¡ã€‚
è¯´æ˜ï¼šé…ç½®ä¸¤å—ç½‘å¡çš„ä½œä¸ºæ§åˆ¶èŠ‚ç‚¹ ( controller )ï¼Œä¸€å—ç½‘å¡çš„ä½œä¸ºè®¡ç®—èŠ‚ç‚¹ ( compute )ã€‚
å‡†å¤‡å·¥ä½œ ( controller, compute ) é…ç½® IP controller
è®¾ç½®æ§åˆ¶èŠ‚ç‚¹ IPã€ç½‘å…³å˜é‡
1 2 LOCAL_GATEWAY=192.168.56.1 LOCAL_ADDRESS=192.168.56.xxx è®¾ç½®è®¡ç®—èŠ‚ç‚¹ IP
1 COMPUTE_ADDRESS=192.168.56.yyy è®¾ç½®ç½‘ç»œæ¥å£åç§°å˜é‡
ç½‘ç»œæ¥å£åç§°éœ€è¦æ ¹æ®å®é™…ä¿®æ”¹ï¼Œå¯ä½¿ç”¨å‘½ä»¤ `ip a` æŸ¥çœ‹ç½‘å¡ä¿¡æ¯ 1 2 NETWORK_INTERFACE1=eno1 NETWORK_INTERFACE2=eno2 é…ç½®æ¥å£ IP
1 2 3 4 5 6 7 8 9 10 11 12 rm -r /etc/netplan/* &amp;&amp; \ tee /etc/netplan/controller.yaml &lt;&lt;- EOF network: version: 2 renderer: networkd ethernets: $NETWORK_INTERFACE1: addresses: [$LOCAL_ADDRESS/24] gateway4: $LOCAL_GATEWAY $NETWORK_INTERFACE2: dhcp4: false EOF compute
è®¾ç½® compute IP åŠç½‘å…³å˜é‡
1 2 LOCAL_GATEWAY=192.168.56.1 LOCAL_ADDRESS=192.168.56.yyy `compute` çš„ç½‘ç»œæ¥å£åç§°å¿…éœ€ä¸ `controller` çš„ä¸€è‡´ è®¾ç½®ç½‘ç»œæ¥å£åç§°å’Œ MAC åœ°å€å˜é‡
`NETWORK_INTERFACE` ä¸ºä¿®æ”¹åçš„ç½‘ç»œæ¥å£åç§° 1 2 NETWORK_INTERFACE=eno1 NETWORK_INTERFACE_MAC=xx:yy:xx:yy:xx:yy å¯ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•ä¿®æ”¹ç½‘ç»œæ¥å£åç§°ï¼š
æ–°å»ºè§„åˆ™ 1 2 3 tee /etc/udev/rules.d/70-persistent-net.rules &lt;&lt;- EOF SUBSYSTEM==&#34;net&#34;, ACTION==&#34;add&#34;, DRIVERS==&#34;?*&#34;, ATTR{address}==&#34;$NETWORK_INTERFACE_MAC&#34;, NAME=&#34;$NETWORK_INTERFACE&#34; EOF ä¿®æ”¹ grub 1 sed -i &#34;s|GRUB_CMDLINE_LINUX=\&#34;\&#34;|GRUB_CMDLINE_LINUX=\&#34;net.ifnames=1 biosdevname=0\&#34;|g&#34; /etc/default/grub æ›´æ–° bootloader 1 update-grub æ›´æ–° initram 1 update-initramfs -u é…ç½®æ¥å£ IP
1 2 3 4 5 6 7 8 9 10 rm -r /etc/netplan/* &amp;&amp; \ tee /etc/netplan/compute.yaml &lt;&lt;- EOF network: version: 2 renderer: networkd ethernets: $NETWORK_INTERFACE: addresses: [$LOCAL_ADDRESS/24] gateway4: $LOCAL_GATEWAY EOF æ£€æŸ¥æ–‡ä»¶ ( controller ) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 /root â”œâ”€â”€ bionic-server-cloudimg-amd64.img â”œâ”€â”€ CentOS-7-x86_64-GenericCloud.qcow2.xz â”œâ”€â”€ cirros-0.5.1-x86_64-disk.img â”œâ”€â”€ create_dual_intermediate_CA.sh â”œâ”€â”€ images â”‚Â â”œâ”€â”€ registry.tar â”‚Â â”œâ”€â”€ ubuntu.tar â”‚Â â”œâ”€â”€ ubuntu-source-aodh-api.tar â”‚Â â”œâ”€â”€ ubuntu-source-aodh-evaluator.tar â”‚Â â”œâ”€â”€ ubuntu-source-aodh-listener.tar â”‚Â â”œâ”€â”€ ubuntu-source-aodh-notifier.tar â”‚Â â”œâ”€â”€ ubuntu-source-ceilometer-central.tar â”‚Â â”œâ”€â”€ ubuntu-source-ceilometer-compute.tar â”‚Â â”œâ”€â”€ ubuntu-source-ceilometer-notification.tar â”‚Â â”œâ”€â”€ ubuntu-source-chrony.tar â”‚Â â”œâ”€â”€ ubuntu-source-cinder-api.tar â”‚Â â”œâ”€â”€ ubuntu-source-cinder-backup.tar â”‚Â â”œâ”€â”€ ubuntu-source-cinder-scheduler.tar â”‚Â â”œâ”€â”€ ubuntu-source-cinder-volume.tar â”‚Â â”œâ”€â”€ ubuntu-source-cron.tar â”‚Â â”œâ”€â”€ ubuntu-source-etcd.tar â”‚Â â”œâ”€â”€ ubuntu-source-fluentd.tar â”‚Â â”œâ”€â”€ ubuntu-source-glance-api.tar â”‚Â â”œâ”€â”€ ubuntu-source-gnocchi-api.tar â”‚Â â”œâ”€â”€ ubuntu-source-gnocchi-metricd.tar â”‚Â â”œâ”€â”€ ubuntu-source-heat-api-cfn.tar â”‚Â â”œâ”€â”€ ubuntu-source-heat-api.tar â”‚Â â”œâ”€â”€ ubuntu-source-heat-engine.tar â”‚Â â”œâ”€â”€ ubuntu-source-horizon.tar â”‚Â â”œâ”€â”€ ubuntu-source-iscsid.tar â”‚Â â”œâ”€â”€ ubuntu-source-keystone-fernet.tar â”‚Â â”œâ”€â”€ ubuntu-source-keystone-ssh.tar â”‚Â â”œâ”€â”€ ubuntu-source-keystone.tar â”‚Â â”œâ”€â”€ ubuntu-source-kolla-toolbox.tar â”‚Â â”œâ”€â”€ ubuntu-source-kuryr-libnetwork.tar â”‚Â â”œâ”€â”€ ubuntu-source-mariadb-clustercheck.tar â”‚Â â”œâ”€â”€ ubuntu-source-mariadb.tar â”‚Â â”œâ”€â”€ ubuntu-source-memcached.tar â”‚Â â”œâ”€â”€ ubuntu-source-neutron-dhcp-agent.tar â”‚Â â”œâ”€â”€ ubuntu-source-neutron-l3-agent.tar â”‚Â â”œâ”€â”€ ubuntu-source-neutron-metadata-agent.tar â”‚Â â”œâ”€â”€ ubuntu-source-neutron-openvswitch-agent.tar â”‚Â â”œâ”€â”€ ubuntu-source-neutron-server.tar â”‚Â â”œâ”€â”€ ubuntu-source-nova-api.tar â”‚Â â”œâ”€â”€ ubuntu-source-nova-compute.tar â”‚Â â”œâ”€â”€ ubuntu-source-nova-conductor.tar â”‚Â â”œâ”€â”€ ubuntu-source-nova-libvirt.tar â”‚Â â”œâ”€â”€ ubuntu-source-nova-novncproxy.tar â”‚Â â”œâ”€â”€ ubuntu-source-nova-scheduler.tar â”‚Â â”œâ”€â”€ ubuntu-source-nova-ssh.tar â”‚Â â”œâ”€â”€ ubuntu-source-octavia-api.tar â”‚Â â”œâ”€â”€ ubuntu-source-octavia-health-manager.tar â”‚Â â”œâ”€â”€ ubuntu-source-octavia-housekeeping.tar â”‚Â â”œâ”€â”€ ubuntu-source-octavia-worker.tar â”‚Â â”œâ”€â”€ ubuntu-source-openvswitch-db-server.tar â”‚Â â”œâ”€â”€ ubuntu-source-openvswitch-vswitchd.tar â”‚Â â”œâ”€â”€ ubuntu-source-panko-api.tar â”‚Â â”œâ”€â”€ ubuntu-source-placement-api.tar â”‚Â â”œâ”€â”€ ubuntu-source-rabbitmq.tar â”‚Â â”œâ”€â”€ ubuntu-source-tgtd.tar â”‚Â â”œâ”€â”€ ubuntu-source-titan-api.tar â”‚Â â”œâ”€â”€ ubuntu-source-titan-scaling.tar â”‚Â â”œâ”€â”€ ubuntu-source-titan-scheduler.tar â”‚Â â”œâ”€â”€ ubuntu-source-zun-api.tar â”‚Â â”œâ”€â”€ ubuntu-source-zun-cni-daemon.tar â”‚Â â”œâ”€â”€ ubuntu-source-zun-compute.tar â”‚Â â””â”€â”€ ubuntu-source-zun-wsproxy.tar â”œâ”€â”€ init-runonce â”œâ”€â”€ kolla-ansible.tar.gz â”œâ”€â”€ multinode â”œâ”€â”€ openssl.cnf â”œâ”€â”€ prediction_train.csv â”œâ”€â”€ python-titanclient.tar.gz â”œâ”€â”€ test-only-amphora-x64-haproxy-ubuntu-bionic.qcow2 â”œâ”€â”€ trusted.gpg â””â”€â”€ Windows 2016 Server.qcow.gz é…ç½®è‡ªå®šä¹‰æº IP åŠç«¯å£ 1 2 CUSTOM_MIRROR_HOST=192.168.56.zzz CUSTOM_MIRROR_PORT=81 é…ç½® apt æº 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 tee /etc/apt/sources.list &lt;&lt;- EOF deb http://$CUSTOM_MIRROR_HOST:$CUSTOM_MIRROR_PORT/ubuntu/ bionic main restricted universe multiverse deb-src http://$CUSTOM_MIRROR_HOST:$CUSTOM_MIRROR_PORT/ubuntu/ bionic main restricted universe multiverse deb http://$CUSTOM_MIRROR_HOST:$CUSTOM_MIRROR_PORT/ubuntu/ bionic-security main restricted universe multiverse deb-src http://$CUSTOM_MIRROR_HOST:$CUSTOM_MIRROR_PORT/ubuntu/ bionic-security main restricted universe multiverse deb http://$CUSTOM_MIRROR_HOST:$CUSTOM_MIRROR_PORT/ubuntu/ bionic-updates main restricted universe multiverse deb-src http://$CUSTOM_MIRROR_HOST:$CUSTOM_MIRROR_PORT/ubuntu/ bionic-updates main restricted universe multiverse deb http://$CUSTOM_MIRROR_HOST:$CUSTOM_MIRROR_PORT/ubuntu/ bionic-proposed main restricted universe multiverse deb-src http://$CUSTOM_MIRROR_HOST:$CUSTOM_MIRROR_PORT/ubuntu/ bionic-proposed main restricted universe multiverse deb http://$CUSTOM_MIRROR_HOST:$CUSTOM_MIRROR_PORT/ubuntu/ bionic-backports main restricted universe multiverse deb-src http://$CUSTOM_MIRROR_HOST:$CUSTOM_MIRROR_PORT/ubuntu/ bionic-backports main restricted universe multiverse deb [arch=amd64 trusted=yes] http://$CUSTOM_MIRROR_HOST:$CUSTOM_MIRROR_PORT/docker-ce/linux/ubuntu/ bionic stable # deb-src [arch=amd64 trusted=yes] http://$CUSTOM_MIRROR_HOST:$CUSTOM_MIRROR_PORT/docker-ce/linux/ubuntu/ bionic stable EOF é…ç½® pip æº 1 2 3 4 5 mkdir -p $HOME/.config/pip &amp;&amp; tee $HOME/.config/pip/pip.conf &lt;&lt;- EOF [global] index-url = http://$CUSTOM_MIRROR_HOST:$CUSTOM_MIRROR_PORT/pypi/simple/ trusted-host = $CUSTOM_MIRROR_HOST EOF å¤åˆ¶ GPG å…¬é’¥ 1 cp $HOME/trusted.gpg /etc/apt/trusted.gpg æ›´æ–° apt ç´¢å¼• 1 apt update å®‰è£… pip 1 apt install python3-pip -y å®‰è£…å¹¶åˆ›å»ºã€æ¿€æ´» python è™šæ‹Ÿç¯å¢ƒã€æ›´æ–° pip 1 2 3 4 apt install python3-venv -y &amp;&amp; \ python3 -m venv --system-site-packages $HOME/venv &amp;&amp; \ . $HOME/venv/bin/activate &amp;&amp; \ pip install -U pip pip å®‰è£… wheel ( é¿å…åç»­ build æ—¶æŠ¥é”™ ) 1 pip install wheel å®‰è£… docker 1 apt install docker-ce -y å®‰è£…éƒ¨ç½²å·¥å…· ( controller ) å®‰è£…ä¾èµ– 1 apt install python3-apt python3-dev libffi-dev gcc libssl-dev curl git lvm2 -y å®‰è£… ansible 1 pip install -U &#39;ansible&lt;2.10&#39; å®‰è£… kolla ansible 1 2 3 4 tar zxvf $HOME/kolla-ansible.tar.gz -C $HOME &amp;&amp; \ pip install -U -r $HOME/kolla-ansible/requirements.txt &amp;&amp; \ pip install -U $HOME/kolla-ansible &amp;&amp; \ rm -r $HOME/kolla-ansible å®‰è£… OpenStack å®¢æˆ·ç«¯ 1 pip install python-openstackclient é…ç½® kolla ansible ( controller ) æ‹·è´å…¨å±€é…ç½®å’Œå¯†ç é…ç½®æ–‡ä»¶ 1 cp -r $HOME/venv/share/kolla-ansible/etc_examples/kolla /etc/ è®¾ç½® INVENTORY å˜é‡ 1 INVENTORY=multinode é…ç½® inventory *storage ä¸ºé…ç½®äº† cinder ç©ºé—²å·çš„ä¸»æœº 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 tee $HOME/multinode_temp &lt;&lt;- EOF [control] $LOCAL_ADDRESS [network] $LOCAL_ADDRESS [compute] $LOCAL_ADDRESS $COMPUTE_ADDRESS [monitoring] $LOCAL_ADDRESS [storage] $COMPUTE_ADDRESS EOF cat multinode &gt;&gt; multinode_temp &amp;&amp; \ mv multinode_temp multinode ç”Ÿæˆéšæœºå¯†ç  1 kolla-genpwd ä¿®æ”¹å…¨å±€é…ç½®æ–‡ä»¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 tee -a /etc/kolla/globals.yml &lt;&lt;- EOF kolla_dev_repos_git: &#34;http://git.trystack.cn/openstack&#34; config_strategy: &#34;COPY_ALWAYS&#34; kolla_base_distro: &#34;ubuntu&#34; kolla_install_type: &#34;source&#34; openstack_release: &#34;ussuri&#34; kolla_internal_vip_address: &#34;$LOCAL_ADDRESS&#34; network_interface: &#34;$NETWORK_INTERFACE1&#34; neutron_external_interface: &#34;$NETWORK_INTERFACE2&#34; node_custom_config: &#34;/etc/kolla/config&#34; enable_haproxy: &#34;no&#34; enable_cinder: &#34;yes&#34; enable_cinder_backend_lvm: &#34;yes&#34; enable_etcd: &#34;yes&#34; enable_kuryr: &#34;yes&#34; enable_zun: &#34;yes&#34; docker_configure_for_zun: &#34;yes&#34; containerd_configure_for_zun: &#34;yes&#34; enable_aodh: &#34;yes&#34; enable_gnocchi: &#34;yes&#34; enable_panko: &#34;yes&#34; enable_ceilometer: &#34;yes&#34; enable_octavia: &#34;yes&#34; enable_titan: &#34;yes&#34; # nova_compute_virt_type: &#34;qemu&#34; # Must set this when deploying in virtual machines docker_registry: &#34;$LOCAL_ADDRESS:4000&#34; custom_docker_host: &#34;$CUSTOM_MIRROR_HOST&#34; custom_docker_port: &#34;$CUSTOM_MIRROR_PORT&#34; EOF é…ç½® cinder-volumes ( inventory ä¸­çš„ storage èŠ‚ç‚¹ ) è¿™é‡Œå‡è®¾ç©ºé—²åˆ†åŒºä¸º /dev/sdb 1 2 3 free_device=/dev/sdb &amp;&amp; \ pvcreate $free_device &amp;&amp; \ vgcreate cinder-volumes $free_device é…ç½® SSH å¯†é’¥ç™»å½•å„èŠ‚ç‚¹ï¼Œå¹¶ç¡®è®¤ä¸»æœºæŒ‡çº¹éªŒè¯ ç”Ÿæˆ SSH å¯†é’¥å¯¹
è¾“å…¥ä»¥ä¸‹å‘½ä»¤åä¸€ç›´å›è½¦å³å¯ 1 ssh-keygen å°†ç”Ÿæˆçš„ $HOME/.ssh/id_rsa.pub æ–‡ä»¶å†…å®¹æ‹·è´è‡³æ‰€æœ‰èŠ‚ç‚¹çš„ /root/.ssh/authorized_keys æ–‡ä»¶å¹¶ä¿®æ”¹æ–‡ä»¶æƒé™ï¼š
(controller, compute)
1 chmod 644 /root/.ssh/authorized_keys æµ‹è¯•å¤šèŠ‚ç‚¹é…ç½® ç¬¬ä¸€æ¬¡è¿æ¥çš„è¯éœ€è¦æ‰‹åŠ¨è¾“å…¥ yes è¿›è¡Œç¡®è®¤ 1 ansible -i $HOME/$INVENTORY all -m ping è®¾ç½® ansible çš„ python è§£é‡Šå™¨ 1 2 3 4 tee $HOME/.ansible.cfg &lt;&lt;- EOF [defaults] interpreter_python=$HOME/venv/bin/python EOF é¢å¤–é…ç½® æ‹·è´æ•…éšœé¢„æµ‹æ•°æ®
1 2 mkdir -p /etc/kolla/config/horizon &amp;&amp; \ cp $HOME/prediction_train.csv /etc/kolla/config/horizon/ åˆ›å»º zun-cni ç›®å½•
1 mkdir -p /opt/cni/bin/ nova compute monitors
1 2 3 4 5 mkdir -p /etc/kolla/config/nova &amp;&amp; \ tee /etc/kolla/config/nova/nova.conf &lt;&lt;- EOF [DEFAULT] compute_monitors = cpu.virt_driver EOF octavia é…ç½® SSL è¯ä¹¦
`pass` è¡¨ç¤ºä¸ç”¨æ‰§è¡Œä»»ä½•å‘½ä»¤ è·å–åˆ›å»ºè¯ä¹¦è„šæœ¬ 1 pass è·å– SSL é…ç½®æ–‡ä»¶ 1 pass ç”Ÿæˆ SSL è¯ä¹¦ 1 2 export OCTAVIA_PASS=`awk &#39;/^octavia_ca_password:/ {print $2}&#39; /etc/kolla/passwords.yml` bash $HOME/create_dual_intermediate_CA.sh æ‹·è´ SSL è¯ä¹¦ 1 2 mkdir -p /etc/kolla/config/octavia cp $HOME/dual_ca/etc/octavia/certs/* /etc/kolla/config/octavia/ è·å– kolla é•œåƒ(controller) å¯¼å…¥æœ¬åœ°é•œåƒ 1 2 3 cd $HOME/images &amp;&amp; \ for item in `ls`; do docker load -i $item; done &amp;&amp; \ cd $HOME ä¿®æ”¹ ubuntuã€registryã€horizon é•œåƒ tagï¼ˆå¦‚æœ‰å¿…è¦ï¼‰ 1 2 3 docker tag d70eaf7277ea ubuntu:latest docker tag 2d4f4b5309b1 registry:latest docker tag 84ced3da8f79 kolla/ubuntu-source-horizon:ussuri æ­å»ºæœ¬åœ° registry æœåŠ¡å™¨ 1 docker run -d --name registry --restart=always -p 4000:5000 -v /opt/registry:/var/lib/registry registry ä¿®æ”¹é•œåƒ tag 1 2 3 for item in `docker images | awk &#39;/ ussuri / {print $1}&#39;`; do \ docker image tag $item:ussuri $LOCAL_ADDRESS:4000/$item:ussuri; \ done éƒ¨ç½² (controller) Kolla Ansible Bootstrap Servers 1 kolla-ansible -i $HOME/$INVENTORY bootstrap-servers ä¸Šä¼ é•œåƒè‡³æœ¬åœ° registry æœåŠ¡å™¨ 1 for item in $(docker images | awk &#34;/$LOCAL_ADDRESS:4000/ {print \$1}&#34;); do docker push $item:ussuri; done Kolla Ansible Pre-Checks 1 kolla-ansible -i $HOME/$INVENTORY prechecks Kolla Ansible Deploy 1 kolla-ansible -i $HOME/$INVENTORY deploy Kolla Ansible Post Deploy 1 kolla-ansible -i $HOME/$INVENTORY post-deploy é…ç½® (controller) é…ç½®ç®¡ç†å‘˜ç¯å¢ƒ 1 . /etc/kolla/admin-openrc.sh é…ç½®åˆå§‹åŒ–è„šæœ¬ $HOME/init-runonce
è¯·æ ¹æ®å®é™… IP ä¿¡æ¯ä¿®æ”¹ä¸‹åˆ— IP / ç½‘æ®µ 1 2 3 EXT_NET_CIDR=${EXT_NET_CIDR:-&#39;192.168.56.0/24&#39;} EXT_NET_RANGE=${EXT_NET_RANGE:-&#39;start=192.168.56.221,end=192.168.56.230&#39;} EXT_NET_GATEWAY=${EXT_NET_GATEWAY:-&#39;192.168.56.1&#39;} æ‰§è¡Œåˆå§‹åŒ–è„šæœ¬ 1 bash $HOME/init-runonce é¢å¤–é…ç½® (controller) è®¾ç½®ç¯å¢ƒå˜é‡ 1 2 3 4 5 KOLLA_OPENSTACK_COMMAND=openstack ADMIN_USER_ID=$($KOLLA_OPENSTACK_COMMAND user list | awk &#39;/ admin / {print $2}&#39;) ADMIN_PROJECT_ID=$($KOLLA_OPENSTACK_COMMAND project list | awk &#39;/ admin / {print $2}&#39;) ADMIN_SEC_GROUP=$($KOLLA_OPENSTACK_COMMAND security group list --project ${ADMIN_PROJECT_ID} | awk &#39;/ default / {print $2}&#39;) ADMIN_DOMAIN_ID=$($KOLLA_OPENSTACK_COMMAND domain show Default | awk &#39;/ id / {print $4}&#39;) è®¾ç½® admin domain ID 1 2 3 tee -a /etc/kolla/admin-openrc.sh &lt;&lt;- EOF export OS_USER_DOMAIN_ID=$ADMIN_DOMAIN_ID EOF root ç”¨æˆ·é…ç½® è·å– root ç”¨æˆ·å¯†ç 
1 ROOT_PASS=$(awk &#39;/^root_user_password:/ {print $2}&#39; /etc/kolla/passwords.yml) åˆ›å»º root ç”¨æˆ·
1 $KOLLA_OPENSTACK_COMMAND user create --domain $ADMIN_DOMAIN_ID --project-domain $ADMIN_PROJECT_ID --password $ROOT_PASS root ä¿®æ”¹ root è§’è‰²
1 2 3 $KOLLA_OPENSTACK_COMMAND role add --system all --user root admin $KOLLA_OPENSTACK_COMMAND role add --project admin --user root heat_stack_owner $KOLLA_OPENSTACK_COMMAND role add --project admin --user root admin ä½¿ç”¨ root ç”¨æˆ·
1 2 export OS_USERNAME=root export OS_PASSWORD=$ROOT_PASS æ·»åŠ  root ç”¨æˆ·å¯†é’¥å¯¹
1 $KOLLA_OPENSTACK_COMMAND keypair create --public-key $HOME/.ssh/id_rsa.pub mykey é‡å¯ titan å®¹å™¨ 1 docker restart titan_api titan_scheduler titan_scaling octavia é…ç½® è·å– Network ID
1 NETWORK_ID=$($KOLLA_OPENSTACK_COMMAND network list | awk &#39;/ public1 / {print $2}&#39;) è®¾ç½® Flavor ID
1 FLAVOR_ID=2 ä¿®æ”¹ Octavia Worker é…ç½®
1 2 3 sed -i &#34;s|amp_boot_network_list =.*|amp_boot_network_list = $NETWORK_ID|g&#34; /etc/kolla/octavia-worker/octavia.conf sed -i &#34;s|amp_secgroup_list =.*|amp_secgroup_list = octavia|g&#34; /etc/kolla/octavia-worker/octavia.conf sed -i &#34;s|amp_flavor_id =.*|amp_flavor_id = $FLAVOR_ID|g&#34; /etc/kolla/octavia-worker/octavia.conf åˆ›å»º amphora é•œåƒ
1 $KOLLA_OPENSTACK_COMMAND image create --public --disk-format qcow2 --file test-only-amphora-x64-haproxy-ubuntu-bionic.qcow2 --tag amphora amphora è·å– Octavia å¯†ç 
1 OCTAVIA_KEYSTONE_PASSWORD=$(awk &#39;/^octavia_keystone_password:/ {print $2}&#39; /etc/kolla/passwords.yml) ä½¿ç”¨ Octavia ç”¨æˆ·
1 2 3 4 export OS_USERNAME=octavia export OS_PASSWORD=$OCTAVIA_KEYSTONE_PASSWORD export OS_PROJECT_NAME=service export OS_TENANT_NAME=service åˆ›å»º octavia å®‰å…¨ç»„
1 $KOLLA_OPENSTACK_COMMAND security group create --description &#39;Used by octavia amphora instance&#39; octavia ä¸ºå®‰å…¨ç»„æ·»åŠ è§„åˆ™
1 2 3 4 SECURITY_GROUP_ID=$($KOLLA_OPENSTACK_COMMAND security group list | awk &#39;/ octavia / {print $2}&#39;) $KOLLA_OPENSTACK_COMMAND security group rule create --protocol icmp $SECURITY_GROUP_ID $KOLLA_OPENSTACK_COMMAND security group rule create --protocol tcp --dst-port 22 --egress $SECURITY_GROUP_ID $KOLLA_OPENSTACK_COMMAND security group rule create --protocol tcp --dst-port 9443 --ingress $SECURITY_GROUP_ID æ·»åŠ å¯†é’¥å¯¹
1 $KOLLA_OPENSTACK_COMMAND keypair create --public-key $HOME/.ssh/id_rsa.pub octavia_ssh_key é‡å¯ Octavia Worker å®¹å™¨
1 docker restart octavia_worker ]]></content></entry><entry><title>Learn SICP Chapter 3</title><url>/post/sicp/learn-sicp-ch3/</url><categories><category>Learn</category></categories><tags><tag>Scheme</tag><tag>SICP</tag></tags><content type="html"><![CDATA[å³ä½¿åœ¨å˜åŒ–ä¸­ï¼Œå®ƒä¹Ÿä¸æ¯«æœªå˜ã€‚
------ èµ«æ‹‰å…‹ç«‹ç‰¹ï¼ˆHeraclitusï¼‰ å˜å¾—è¶Šå¤šï¼Œå®ƒå°±è¶Šæ˜¯åŸæ¥çš„æ ·å­ã€‚
------ é˜¿å°”èŠ¬æ–¯ &#183; å¡å°”ï¼ˆAlphonse Karrï¼‰ ç»ƒä¹  1 ä¸€ä¸ªç´¯åŠ å™¨æ˜¯ä¸€ä¸ªè¿‡ç¨‹ï¼Œåå¤ç”¨æ•°å€¼å‚æ•°è°ƒç”¨å®ƒï¼Œå°±ä¼šä½¿å®ƒçš„å„ä¸ªå‚æ•°ç´¯åŠ åˆ°ä¸€ä¸ªå’Œæ•°ä¸­ã€‚æ¯æ¬¡è°ƒç”¨æ—¶ç´¯åŠ å™¨å°†è¿”å›å½“å‰çš„ç´¯åŠ å’Œã€‚è¯·å†™å‡ºä¸€ä¸ªç”Ÿæˆç´¯åŠ å™¨çš„è¿‡ç¨‹ make-accumulatorï¼Œå®ƒæ‰€ç”Ÿæˆçš„æ¯ä¸ªç´¯åŠ å™¨ç»´æŒç»´æŒç€ä¸€ä¸ªç‹¬ç«‹çš„å’Œã€‚é€ç»™ make-accumulator çš„è¾“å…¥æè¿°äº†æœ‰å…³å’Œæ•°çš„åˆå§‹å€¼ï¼Œä¾‹å¦‚ï¼š
1 2 3 4 5 6 7 (define A (make-accumulator 5)) (A 10) 15 (A 10) 25 1 2 3 4 5 6 #lang sicp (define (make-accumulator init) (lambda (value) (begin (set! init (+ init value)) init))) ç»ƒä¹  2 åœ¨å¯¹åº”ç”¨ç¨‹åºåšè½¯ä»¶æµ‹è¯•æ—¶ï¼Œèƒ½å¤Ÿç»Ÿè®¡å‡ºåœ¨è®¡ç®—è¿‡ç¨‹ä¸­æŸä¸ªç»™å®šè¿‡ç¨‹è¢«è°ƒç”¨çš„æ¬¡æ•°å¸¸å¸¸å¾ˆæœ‰ç”¨å¤„ã€‚è¯·å†™å‡ºä¸€ä¸ªè¿‡ç¨‹ make-monitoredï¼Œå®ƒä»¥ä¸€ä¸ªè¿‡ç¨‹ f ä½œä¸ºè¾“å…¥ï¼Œè¯¥è¿‡ç¨‹æœ¬èº«æœ‰ä¸€ä¸ªè¾“å…¥ã€‚make-monitored è¿”å›çš„ç»“æœæ˜¯ç¬¬ä¸‰ä¸ªè¿‡ç¨‹ï¼Œæ¯”å¦‚è¯´ mfï¼Œå®ƒå°†ç”¨ä¸€ä¸ªå†…éƒ¨è®¡æ•°å™¨ç»´æŒç€è‡ªå·±è¢«è°ƒç”¨çš„æ¬¡æ•°ã€‚å¦‚æœ mf çš„è¾“å…¥æ˜¯ç‰¹æ®Šç¬¦å· how-many-calls?ï¼Œé‚£ä¹ˆ mf å°±è¿”å›å†…éƒ¨è®¡æ•°å™¨çš„å€¼ï¼›å¦‚æœè¾“å…¥æ˜¯ç‰¹æ®Šç¬¦å· reset-countï¼Œé‚£ä¹ˆ mf å°±å°†è®¡æ•°å™¨é‡æ–°è®¾ç½®ä¸º 0ï¼›å¯¹äºä»»ä½•å…¶ä»–è¾“å…¥ï¼Œmf å°†è¿”å›è¿‡ç¨‹ f åº”ç”¨äºè¿™ä¸€è¾“å…¥çš„ç»“æœï¼Œå¹¶å°†å†…éƒ¨è®¡æ•°å™¨åŠ ä¸€ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯èƒ½ä»¥ä¸‹é¢æ–¹å¼åšå‡ºè¿‡ç¨‹ sqrt çš„ä¸€ä¸ªå—ç›‘è§†çš„ç‰ˆæœ¬ï¼š
1 2 3 4 5 6 7 (define s (make-monitored sqrt)) (s 100) 10 (s &#39;how-many-calls?) 1 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 #lang sicp (define (make-monitored f) (let ((_count 0)) (lambda (arg) (cond ((eq? arg &#39;how-many-calls?) _count) ((eq? arg &#39;reset-count) (set! _count 0)) (else (begin (set! _count (+ _count 1)) (f arg))))))) ;&gt;&gt;&gt; (define s (make-monitored sqrt)) ;&gt;&gt;&gt; (s 100) ;: 10 ;&gt;&gt;&gt; (s 2) ;: 1.4142135623730951 ;&gt;&gt;&gt; (s &#39;how-many-calls?) ;: 2 ;&gt;&gt;&gt; (s &#39;reset-count) ;&gt;&gt;&gt; (s &#39;how-many-calls?) ;: 0 ç»ƒä¹  3 è¯·ä¿®æ”¹ make-account è¿‡ç¨‹ï¼Œä½¿å®ƒèƒ½åˆ›å»ºä¸€ç§å¸¦å¯†ç ä¿æŠ¤çš„è´¦æˆ·ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåº”è¯¥è®© make-account ä»¥ä¸€ä¸ªç¬¦å·ä½œä¸ºé™„åŠ çš„å‚æ•°ï¼Œå°±åƒï¼š
1 (define acc (make-account 100 &#39;secret-password)) è¿™æ ·äº§ç”Ÿçš„è´¦æˆ·å¯¹è±¡åœ¨æ¥åˆ°ä¸€ä¸ªè¯·æ±‚æ—¶ï¼Œåªæœ‰åŒæ—¶æä¾›äº†è´¦æˆ·æä¾›äº†è´¦æˆ·åˆ›å»ºæ—¶ç»™å®šçš„å¯†ç ï¼Œå®ƒæ‰å¤„ç†è¿™ä¸€è¯·æ±‚ï¼Œå¦åˆ™å°±å‘å‡ºä¸€ä¸ªæŠ±æ€¨ä¿¡æ¯ï¼š
1 2 3 4 5 ((acc &#39;secret-password &#39;withdraw) 40) 60 ((acc &#39;some-other-password &#39;deposit) 50) &#34;Incorrect password&#34; 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 #lang sicp (define (make-account balance password) (define (withdraw amount) (if (&gt;= balance amount) (begin (set! balance (- balance amount)) balance) &#34;Insufficient funds&#34;)) (define (deposit amount) (begin (set! balance (+ balance amount)) balance)) (define (dispatch pass m) (if (eq? pass password) (cond ((eq? m &#39;withdraw) withdraw) ((eq? m &#39;deposit) deposit) (else (error &#34;Unknown request -- MAKE-ACCOUNT&#34; m))) (lambda (arg . args) &#34;Incorrect password&#34;))) dispatch) ç»ƒä¹  4 è¯·ä¿®æ”¹ ç»ƒä¹  3 ä¸­çš„ make-account è¿‡ç¨‹ï¼ŒåŠ ä¸Šå¦ä¸€ä¸ªå±€éƒ¨çŠ¶æ€å˜é‡ï¼Œä½¿å¾—å¦‚æœä¸€ä¸ªè´¦æˆ·è¢«ç”¨ä¸æ­£ç¡®çš„å¯†ç è¿ç»­è®¿é—®äº† 7 æ¬¡ï¼Œå®ƒå°±å°†å»è°ƒç”¨è¿‡ç¨‹ call-the-copsï¼ˆå«è­¦å¯Ÿï¼‰ã€‚
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 #lang sicp (define (call-the-cops) &#34;Cops are coming&#34;) (define (make-account balance password) (let ((times 7)) (define (withdraw amount) (if (&gt;= balance amount) (begin (set! balance (- balance amount)) balance) &#34;Insufficient funds&#34;)) (define (deposit amount) (begin (set! balance (+ balance amount)) balance)) (define (dispatch pass m) (if (eq? pass password) (cond ((eq? m &#39;withdraw) withdraw) ((eq? m &#39;deposit) deposit) (else (error &#34;Unknown request -- MAKE-ACCOUNT&#34; m))) (lambda (...args) (set! times (- times 1)) (if (&lt;= times 0) (call-the-cops) &#34;Incorrect password&#34;)))) dispatch)) ;&gt;&gt;&gt; (define acc (make-account 100 &#39;752)) ;&gt;&gt;&gt; ((acc &#39;752 &#39;withdraw) 40) ;: 60 ;&gt;&gt;&gt; ((acc &#39;1 &#39;withdraw) 30) ;: &#34;Incorrect password&#34; ;&gt;&gt;&gt; ((acc &#39;2 &#39;withdraw) 30) ;: &#34;Incorrect password&#34; ;&gt;&gt;&gt; ((acc &#39;3 &#39;withdraw) 30) ;: &#34;Incorrect password&#34; ;&gt;&gt;&gt; ((acc &#39;4 &#39;withdraw) 30) ;: &#34;Incorrect password&#34; ;&gt;&gt;&gt; ((acc &#39;5 &#39;withdraw) 30) ;: &#34;Incorrect password&#34; ;&gt;&gt;&gt; ((acc &#39;6 &#39;withdraw) 30) ;: &#34;Incorrect password&#34; ;&gt;&gt;&gt; ((acc &#39;7 &#39;withdraw) 30) ;: &#34;Cops are coming&#34; ;&gt;&gt;&gt; ((acc &#39;8 &#39;withdraw) 30) ;: &#34;Cops are coming&#34; ;&gt;&gt;&gt; ((acc &#39;9 &#39;withdraw) 30) ;: &#34;Cops are coming&#34; ç»ƒä¹  5 è’™ç‰¹å¡ç½—ç§¯åˆ†æ˜¯ä¸€ç§é€šè¿‡è’™ç‰¹å¡ç½—æ¨¡æ‹Ÿä¼°è®¡å®šç§¯åˆ†å€¼çš„æ–¹æ³•ã€‚è€ƒè™‘ç”±è°“è¯ $P(x, y)$ æè¿°çš„ä¸€ä¸ªåŒºåŸŸçš„é¢ç§¯è®¡ç®—é—®é¢˜ï¼Œè¯¥è°“è¯å¯¹äºæ­¤åŒºåŸŸå†…éƒ¨çš„ç‚¹ $(x, y)$ ä¸ºçœŸï¼Œå¯¹äºä¸åœ¨åŒºåŸŸå†…çš„ç‚¹ä¸ºå‡ã€‚ä¸¾ä¾‹æ¥è¯´ï¼ŒåŒ…å«åœ¨ä»¥ $(5, 7)$ ä¸ºåœ†å¿ƒåŠå¾„ä¸º $3$ çš„åœ†åœˆæ‰€å›´æˆçš„åŒºåŸŸï¼Œå¯ä»¥ç”¨æ£€æŸ¥å…¬å¼ $(x - 5)^2 + (y - 7)^2 \le 3^2$ æ˜¯å¦æˆç«‹çš„è°“è¯æè¿°ã€‚è¦ä¼°è®¡è¿™æ ·ä¸€ä¸ªè°“è¯æ‰€æè¿°çš„åŒºåŸŸçš„é¢ç§¯ï¼Œæˆ‘ä»¬åº”é¦–å…ˆé€‰å–ä¸€ä¸ªåŒ…å«è¯¥åŒºåŸŸçš„çŸ©å½¢ã€‚ä¾‹å¦‚ï¼Œä»¥ $(2, 4)$ å’Œ $(8, 10)$ ä½œä¸ºå¯¹è§’ç‚¹çš„çŸ©å½¢åŒ…å«ç€ä¸Šé¢çš„åœ†ã€‚éœ€è¦ç¡®å®šçš„ç§¯åˆ†ä¹Ÿå°±æ˜¯è¿™ä¸€çŸ©å½¢ä¸­ä½äºæ‰€å…³æ³¨åŒºåŸŸå†…çš„é‚£ä¸ªéƒ¨åˆ†ã€‚æˆ‘ä»¬å¯ä»¥è¿™æ ·ä¼°è®¡ç§¯åˆ†å€¼ï¼šéšæœºé€‰å–ä½äºçŸ©å½¢ä¸­çš„ç‚¹ $(x, y)$ï¼Œå¯¹æ¯ä¸ªç‚¹æ£€æŸ¥ $P(x, y)$ï¼Œç¡®å®šè¯¥ç‚¹æ˜¯å¦ä½äºæ‰€è€ƒè™‘çš„åŒºåŸŸå†…ã€‚å¦‚æœè¯•äº†è¶³å¤Ÿå¤šçš„ç‚¹ $(x, y)$ï¼Œé‚£ä¹ˆè½åœ¨åŒºåŸŸå†…çš„ç‚¹çš„æ¯”ç‡å°†èƒ½ç»™å‡ºçŸ©å½¢ä¸­æœ‰å…³åŒºåŸŸçš„æ¯”ç‡ã€‚è¿™æ ·ï¼Œç”¨è¿™ä¸€æ¯”ç‡å»ä¹˜æ•´ä¸ªçŸ©å½¢çš„é¢ç§¯ï¼Œå°±èƒ½å¾—åˆ°ç›¸åº”ç§¯åˆ†çš„ä¸€ä¸ªä¼°è®¡å€¼ã€‚
å°†è’™ç‰¹å¡ç½—ç§¯åˆ†å®ç°ä¸ºä¸€ä¸ªè¿‡ç¨‹ estimate-integralï¼Œå®ƒä»¥ä¸€ä¸ªè°“è¯ Pï¼ŒçŸ©å½¢çš„ä¸Šä¸‹è¾¹ç•Œ x1ã€x2ã€y1 å’Œ y2ï¼Œä»¥åŠä¸ºäº§ç”Ÿä¼°è®¡å€¼è€Œè¦æ±‚è¯•éªŒçš„æ¬¡æ•°ä½œä¸ºå‚æ•°ã€‚ä½ çš„è¿‡ç¨‹åº”è¯¥ä½¿ç”¨ä¸Šé¢ç”¨äºä¼°è®¡ $\pi$ å€¼çš„åŒä¸€ä¸ª monte-carlo è¿‡ç¨‹ã€‚è¯·ç”¨ä½ çš„ estimate-integralï¼Œé€šè¿‡å¯¹å•ä½åœ†é¢ç§¯çš„åº¦é‡äº§ç”Ÿå‡º $\pi$ çš„ä¸€ä¸ªä¼°è®¡å€¼ã€‚
ä½ å¯èƒ½å‘ç°ï¼Œæœ‰ä¸€ä¸ªä»ç»™å®šåŒºåŸŸä¸­é€‰å–éšæœºæ•°çš„è¿‡ç¨‹éå¸¸æœ‰ç”¨ã€‚ä¸‹é¢çš„ random-in-range è¿‡ç¨‹åˆ©ç”¨ 1.2.6 èŠ‚ é‡Œä½¿ç”¨çš„ random å®ç°è¿™ä¸€å·¥ä½œï¼Œå®ƒè¿”å›ä¸€ä¸ªå°äºå…¶è¾“å…¥çš„éè´Ÿæ•°ã€‚
1 2 3 (define (random-in-range low high) (let ((range (- high low))) (+ low (random range)))) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 #lang sicp (define (random-in-range low high) (let ((range (- high low))) (+ low (random range)))) (define (unit-circle-test) (let ((x (random-in-range -1.0 1.0)) (y (random-in-range -1.0 1.0))) (&lt; (+ (* x x) (* y y)) 1))) (define (monte-carlo trials experiment) (define (iter trials-remaining trials-passed) (cond ((= trials-remaining 0) (/ trials-passed trials)) ((experiment) (iter (- trials-remaining 1) (+ trials-passed 1))) (else (iter (- trials-remaining 1) trials-passed)))) (iter trials 0)) ;&gt;&gt;&gt; (* 4.0 (monte-carlo 100 unit-circle-test)) ;: 3.28 ;&gt;&gt;&gt; (* 4.0 (monte-carlo 1000 unit-circle-test)) ;: 3.076 ;&gt;&gt;&gt; (* 4.0 (monte-carlo 10000 unit-circle-test)) ;: 3.1144 ;&gt;&gt;&gt; (* 4.0 (monte-carlo 100000 unit-circle-test)) ;: 3.14748 ;&gt;&gt;&gt; (* 4.0 (monte-carlo 1000000 unit-circle-test)) ;: 3.146112 ;&gt;&gt;&gt; (* 4.0 (monte-carlo 10000000 unit-circle-test)) ;: 3.1423176 ç»ƒä¹  6 æœ‰æ—¶ä¹Ÿéœ€è¦èƒ½é‡ç½®éšæœºæ•°ç”Ÿæˆå™¨ï¼Œä»¥ä¾¿ä»æŸä¸ªç»™å®šå€¼å¼€å§‹ç”Ÿæˆéšæœºæ•°åºåˆ—ã€‚è¯·é‡æ–°è®¾è®¡ä¸€ä¸ª rand è¿‡ç¨‹ï¼Œä½¿å¾—æˆ‘ä»¬å¯ä»¥ç”¨ç¬¦å· generate æˆ–è€…ç¬¦å· reset ä½œä¸ºå‚æ•°å»è°ƒç”¨å®ƒã€‚å…¶è¡Œä¸ºæ˜¯ï¼š(rand 'generate) å°†äº§ç”Ÿå‡ºä¸€ä¸ªæ–°éšæœºæ•°ï¼Œ((rand 'reset) &lt;new-value&gt;) å°†å†…éƒ¨çŠ¶æ€å˜é‡é‡æ–°è®¾ç½®ä¸ºæŒ‡å®šçš„å€¼ &lt;new-value&gt;ã€‚é€šè¿‡è¿™æ ·é‡ç½®çŠ¶æ€ï¼Œæˆ‘ä»¬å°±å¯ä»¥é‡å¤ç”ŸæˆåŒæ ·çš„åºåˆ—ã€‚åœ¨ä½¿ç”¨éšæœºæ•°æµ‹è¯•ç¨‹åºï¼Œæ’é™¤å…¶ä¸­é”™è¯¯æ—¶ï¼Œè¿™ç§åŠŸèƒ½éå¸¸æœ‰ç”¨ã€‚
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 #lang sicp (define random-init 0) (define (rand-update x) (+ x 1)) (define rand (let ((x random-init)) (define (generate) (set! x (rand-update x)) x) (define (reset init) (set! x init)) (define (dispatch message) (cond ((eq? message &#39;generate) (generate)) ((eq? message &#39;reset) reset) (else (error &#34;Unknown request -- RAND&#34; message)))) dispatch)) ;&gt;&gt;&gt; (rand &#39;generate) ;: 1 ;&gt;&gt;&gt; (rand &#39;generate) ;: 2 ;&gt;&gt;&gt; (rand &#39;generate) ;: 3 ;&gt;&gt;&gt; ((rand &#39;reset) 752) ;&gt;&gt;&gt; (rand &#39;generate) ;: 753 ;&gt;&gt;&gt; (rand &#39;generate) ;: 754 ;&gt;&gt;&gt; (rand &#39;generate) ;: 755 ç»ƒä¹  7 è€ƒè™‘å¦‚ ç»ƒä¹  3 æ‰€æè¿°çš„ï¼Œç”± make-account åˆ›å»ºçš„å¸¦æœ‰å¯†ç çš„é“¶è¡Œè´¦æˆ·å¯¹è±¡ã€‚å‡å®šæˆ‘ä»¬çš„é“¶è¡Œç³»ç»Ÿä¸­éœ€è¦ä¸€ç§æä¾›å…±ç”¨è´¦æˆ·çš„èƒ½åŠ›ã€‚è¯·å®šä¹‰è¿‡ç¨‹ make-joint åˆ›å»ºè¿™ç§è´¦æˆ·ã€‚make-joint åº”è¯¥æœ‰ä¸‰ä¸ªå‚æ•°ï¼šç¬¬ä¸€ä¸ªæ˜¯æœ‰å¯†ç ä¿æŠ¤çš„è´¦æˆ·ï¼›ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ª å¯†ç ï¼Œå®ƒå¿…é¡»ä¸é‚£ä¸ªå·²ç»å®šä¹‰çš„è´¦æˆ·çš„å¯†ç åŒ¹é…ï¼Œä»¥ä½¿ make-joint æ“ä½œèƒ½å¤Ÿç»§ç»­ä¸‹å»ï¼›ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯æ–°å¯†ç ã€‚make-joint ç”¨è¿™ä¸€æ–°å¯†ç åˆ›å»ºèµ·å¯¹é‚£ä¸ªåŸæœ‰è´¦æˆ·çš„å¦ä¸€è®¿é—®é€”å¾„ã€‚ä¾‹å¦‚ï¼Œå¦‚æœ peter-acc æ˜¯ä¸€ä¸ªå…·æœ‰å¯†ç  open-sesame çš„é“¶è¡Œè´¦æˆ·ï¼Œé‚£ä¹ˆ
1 2 (define paul-acc (make-joint peter-acc &#39;open-sesame &#39;rosebud)) å°†ä½¿æˆ‘ä»¬å¯ä»¥é€šè¿‡åå­— paul-acc å’Œå¯†ç  rosebud å¯¹è´¦æˆ· peter-acc åšç°é‡‘äº¤æ˜“ã€‚ä½ å¯èƒ½å¸Œæœ›ä¿®æ”¹è‡ªå·±å¯¹ ç»ƒä¹  3.3 çš„è§£ï¼ŒåŠ å…¥è¿™ä¸€æ–°åŠŸèƒ½ã€‚
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 #lang sicp (define (make-account balance password) (define (withdraw amount) (if (&gt;= balance amount) (begin (set! balance (- balance amount)) balance) &#34;Insufficient funds&#34;)) (define (deposit amount) (begin (set! balance (+ balance amount)) balance)) (define (check-password pass) (if (eq? pass password) #t #f)) (define (dispatch pass m) (if (eq? m &#39;check-password) (check-password pass) (if (check-password pass) (cond ((eq? m &#39;withdraw) withdraw) ((eq? m &#39;deposit) deposit) (else (error &#34;Unknown request -- MAKE-ACCOUNT&#34; m))) (lambda (arg . args) &#34;Incorrect password&#34;)))) dispatch) (define (make-joint account password my-password) (if (account password &#39;check-password) (lambda (pass m) (if (eq? pass my-password) (account password m) (lambda (arg . args) &#34;Incorrect user password&#34;))) (lambda (arg . args) &#34;Incorrect admin password&#34;))) (define peter-acc (make-account 100 &#39;open-sesame)) (define paul-acc (make-joint peter-acc &#39;open-sesame &#39;rosebud)) (define bob-acc (make-joint peter-acc &#39;pass &#39;haha)) ;&gt;&gt;&gt; (bob-acc &#39;test &#39;test) ;: &#34;Incorrect admin password&#34; ;&gt;&gt;&gt; ((peter-acc &#39;open-sesame &#39;withdraw) 50) ;: 50 ;&gt;&gt;&gt; ((peter-acc &#39;open-sesame &#39;deposit) 50) ;: 100 ;&gt;&gt;&gt; ((paul-acc &#39;rosebud &#39;withdraw) 40) ;: 60 ;&gt;&gt;&gt; ((paul-acc &#39;rosebud &#39;withdraw) 40) ;: 20 ;&gt;&gt;&gt; ((paul-acc &#39;rosebud &#39;withdraw) 40) ;: &#34;Insufficient funds&#34; ;&gt;&gt;&gt; ((paul-acc &#39;open-sesame &#39;withdraw) 40) ;: &#34;Incorrect user password&#34; ;&gt;&gt;&gt; ((peter-acc &#39;open-sesame &#39;deposit) 50) ;: 70 ç»ƒä¹  8 åœ¨ 1.1.3 èŠ‚ å®šä¹‰æ±‚å€¼æ¨¡å‹æ—¶æˆ‘ä»¬è¯´è¿‡ï¼Œæ±‚å€¼ä¸€ä¸ªè¡¨è¾¾å¼çš„ç¬¬ä¸€æ­¥å°±æ˜¯æ±‚å€¼å…¶ä¸­çš„å­è¡¨è¾¾å¼ã€‚ä½†é‚£æ—¶å¹¶æ²¡æœ‰è¯´æ˜åº”è¯¥æŒ‰æ€æ ·çš„é¡ºåºå¯¹è¿™äº›å­è¡¨è¾¾å¼æ±‚å€¼ï¼ˆä¾‹å¦‚ï¼Œæ˜¯ä»å·¦åˆ°å³è¿˜æ˜¯ä»å³åˆ°å·¦ï¼‰ã€‚å½“æˆ‘ä»¬å¼•è¿›äº†èµ‹å€¼ä¹‹åï¼Œå¯¹ä¸€ä¸ªè¿‡ç¨‹çš„å„ä¸ªå‚æ•°çš„æ±‚å€¼é¡ºåºä¸åŒå°±å¯èƒ½å¯¼è‡´ä¸åŒçš„ç»“æœã€‚è¯·å®šä¹‰ä¸€ä¸ªç®€å•çš„è¿‡ç¨‹ fï¼Œä½¿å¾— (+ (f 0) (f 1)) çš„æ±‚å€¼åœ¨å¯¹å®é™…å‚æ•°é‡‡ç”¨ä»å·¦åˆ°å³çš„æ±‚å€¼é¡ºåºæ—¶è¿”å› 0ï¼Œè€Œå¯¹å®é™…å‚æ•°é‡‡ç”¨ä»å³åˆ°å·¦çš„æ±‚å€¼é¡ºåºæ—¶è¿”å› 1ã€‚
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 #lang sicp (define (f-builder flag) (lambda (x) (begin (set! flag (- flag 1)) (* x flag)))) ;&gt;&gt;&gt; (define f (f-builder 2)) ;&gt;&gt;&gt; (define ff (f-builder 2)) ;&gt;&gt;&gt; (+ (f 0) (f 1)) ;: 0 ;&gt;&gt;&gt; (+ (ff 1) (ff 0)) ;: 1 ç»ƒä¹  9 åœ¨ 1.2.1 èŠ‚ é‡Œï¼Œæˆ‘ä»¬ç”¨ä»£æ¢æ¨¡å‹åˆ†æäº†ä¸¤ä¸ªè®¡ç®—é˜¶ä¹˜çš„å‡½æ•°ï¼Œé€’å½’ç‰ˆæœ¬ï¼š
1 2 3 4 (define (factorial n) (if (= n 1) 1 (* n (factorial (- n 1))))) å’Œè¿­ä»£ç‰ˆæœ¬ï¼š
1 2 3 4 5 6 7 8 9 (define (factorial n) (fact-iter 1 1 n)) (define (fact-iter product counter max-count) (if (&gt; counter max-count) product (fact-iter (* counter product) (+ counter 1) max-count))) è¯·è¯´æ˜é‡‡ç”¨è¿‡ç¨‹ factorial çš„ä¸Šè¿°ç‰ˆæœ¬æ±‚å€¼ (factorial 6) æ—¶æ‰€åˆ›å»ºçš„ç¯å¢ƒç»“æ„ã€‚
ç»ƒä¹  10 åœ¨ make-withdraw è¿‡ç¨‹é‡Œï¼Œå±€éƒ¨å˜é‡ balance æ˜¯ä½œä¸º make-withdraw çš„å‚æ•°åˆ›å»ºçš„ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥æ˜¾å¼åœ°é€šè¿‡ä½¿ç”¨ let åˆ›å»ºå±€éƒ¨çŠ¶æ€å˜é‡ï¼Œå°±åƒä¸‹é¢æ‰€åšçš„ï¼š
1 2 3 4 5 6 7 (define (make-withdraw initial-amount) (let ((balance initial-amount)) (lambda (amount) (if (&gt;= balance amount) (begin (set! balance (- balance amount)) balance) &#34;Insufficient funds&#34;)))) è¯·é‡æ¸© 1.3.2 èŠ‚ï¼Œlet å®é™…ä¸Šæ˜¯ä¸€ä¸ªè¿‡ç¨‹è°ƒç”¨çš„è¯­æ³•ç³–è¡£ï¼š
1 (let ((&lt;var&gt; &lt;exp&gt;)) &lt;body&gt;) å®ƒå°†è¢«è§£é‡Šä¸º
1 ((lambda (&lt;var&gt;) &lt;body&gt;) &lt;exp&gt;) çš„å¦ä¸€ç§è¯­æ³•å½¢å¼ã€‚è¯·ç”¨ç¯å¢ƒæ¨¡å‹åˆ†æ make-withdraw çš„è¿™ä¸ªç‰ˆæœ¬ï¼Œç”»å‡ºåƒä¸Šé¢é‚£æ ·çš„å›¾ç¤ºï¼Œè¯´æ˜è°ƒç”¨ï¼š
1 2 3 4 5 (define W1 (make-withdraw 100)) (W1 50) (define W2 (make-withdraw 100)) æ—¶çš„æƒ…å†µå¹¶é˜é‡Š make-withdraw çš„è¿™ä¸¤ä¸ªç‰ˆæœ¬åˆ›å»ºå‡ºçš„å¯¹è±¡å…·æœ‰ç›¸åŒçš„è¡Œä¸ºã€‚ä¸¤ä¸ªç‰ˆæœ¬çš„ç¯å¢ƒç»“æ„æœ‰ä»€ä¹ˆä¸åŒå—ï¼Ÿ
]]></content></entry><entry><title>è¿œç¨‹å·¥ä½œæ–¹å¼</title><url>/post/remote-work/2020/</url><categories><category>Work</category></categories><tags><tag>Remote</tag><tag>SSH</tag><tag>Proxy</tag></tags><content type="html"><![CDATA[SSH ä»£ç† ä» SSH è¯´èµ·ï¼ŒåŸºæœ¬çš„ä½¿ç”¨å°±ä¸è¯´äº†ï¼Œé¦–å…ˆä»‹ç»å®ƒæ”¯æŒçš„ä¸‰ç§ä»£ç†æ–¹å¼ï¼ˆåœ¨ Unix-like ç¯å¢ƒä¸‹åŸºæœ¬éƒ½å¯ä»¥ç”¨ man ssh æŸ¥åˆ°ï¼‰ã€‚
æœ¬åœ°ä»£ç† 1 ssh -L [&lt;æœ¬æœºåœ°å€&gt;:]&lt;æœ¬æœºç«¯å£&gt;:&lt;æœåŠ¡å™¨åœ°å€1&gt;:&lt;æœåŠ¡å™¨ç«¯å£&gt; &lt;ç”¨æˆ·&gt;@&lt;æœåŠ¡å™¨åœ°å€2&gt; [-p &lt;æœåŠ¡å™¨ SSH ç«¯å£&gt;] ï¼ˆ&lt;x&gt; è¡¨ç¤ºå˜é‡ï¼Œ[x] æ˜¯å¯é€‰å‚æ•°ï¼‰
&lt;æœ¬æœºåœ°å€&gt; é»˜è®¤ä¸º 127.0.0.1 æˆ– localhost
&lt;æœåŠ¡å™¨ SSH ç«¯å£&gt; é»˜è®¤ä¸º 22
è¿™ä¼šå°† &lt;æœ¬æœºåœ°å€&gt;:&lt;æœ¬æœºç«¯å£&gt; ç½‘ç»œè¯·æ±‚è½¬å‘åˆ° &lt;æœåŠ¡å™¨åœ°å€1&gt;:&lt;æœåŠ¡å™¨ç«¯å£&gt; ã€‚
ä¸‹é¢ç”¨ MobaXterm å¸¦çš„ Cygwin ç¯å¢ƒçœ‹çœ‹å…·ä½“ç”¨é€”ï¼š
é¦–å…ˆç›´æ¥ SSH ç™»å½•æœåŠ¡å™¨ï¼š
1 ssh root@baitian.xyz åœ¨å½“å‰ç›®å½•æ–°å»ºä¸€ä¸ª index.html æ–‡ä»¶ï¼Œç”¨æ¥æµ‹è¯• Web è®¿é—®ï¼Œå†…å®¹å¦‚ä¸‹ï¼š
1 &lt;html&gt;&lt;body&gt;&lt;h1&gt;Hello Boy!&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt; å¯åŠ¨ä¸€ä¸ª HTTP æœåŠ¡ï¼š
1 python3 -m http.server --bind 172.17.0.1 8000 è¿™ä¼šåœ¨ 172.17.0.1:8000 ä»¥å½“å‰ç›®å½•å¯åŠ¨ HTTP æœåŠ¡ï¼Œæˆ‘çš„æœåŠ¡å™¨å…¬ç½‘åœ°å€æ˜¯ baitian.xyzï¼Œä½†æˆ‘çš„æœåŠ¡å™¨æ— æ³•å°† HTTP æœåŠ¡ç»‘å®šåˆ°è¿™ä¸ªåœ°å€ï¼Œå› ä¸ºå…¬ç½‘åœ°å€æ˜¯äº‘æœåŠ¡å™¨æä¾›å•†é‚£ä¸€å±‚ç»‘å®šçš„ï¼Œæˆ‘çš„æœåŠ¡å™¨ç”¨ ip a æˆ–æ˜¯ ifconfig ç­‰å‘½ä»¤éƒ½çœ‹ä¸åˆ°å…¬ç½‘åœ°å€ï¼ˆå¦‚æœæ˜¯ç›´æ¥åœ¨å…¬ç½‘å¼€å¯ HTTP æœåŠ¡ï¼Œå¹¶é…ç½®å¥½é˜²ç«å¢™è§„åˆ™ï¼Œæ˜¯å¯ä»¥ç›´æ¥ç”¨å…¬ç½‘è®¿é—®çš„ï¼Œå…¶å®æˆ‘ç”¨å†…ç½‘ 192.168.1.116 åœ°å€å°±ä¼šç›´æ¥ç»‘å®šåˆ°å…¬ç½‘ï¼Œå½“ç„¶ï¼Œè¿™éƒ½æ˜¯æä¾›å•†åšçš„æ˜ å°„ï¼‰ã€‚
æ­¤æ—¶ï¼Œæˆ‘åœ¨æœ¬æœºç”¨åœ°å€ http://172.17.0.1:8000 è®¿é—® HTTP æœåŠ¡ï¼š
å…¶å®ï¼Œè¿™æ˜¯ä¸è¯¥æœ‰çš„æ“ä½œï¼Œ172.*.*.* è¿™ä¸ªæ˜¯å†…ç½‘åœ°å€ï¼Œä¸åœ¨åŒä¸€ç½‘æ®µæ˜¯æ— æ³•ç›´æ¥è®¿é—®çš„ï¼Œä½†ä¹Ÿåˆ«å¤ªæ‹˜æ³¥äºä»€ä¹ˆå†…ç½‘ï¼Œå¤–ç½‘/å…¬ç½‘çš„ï¼Œæœ¬æ–‡çš„ç›®çš„å°±æ˜¯æ¨¡ç³Šè¿™äº›ï¼Œæ¶ˆé™¤è®¿é—®é™åˆ¶ã€‚
å¼€å¯æœ¬åœ°ä»£ç†ï¼š
1 ssh -L 8000:172.17.0.1:8000 root@baitian.xyz ç„¶åï¼š
è¿™å°±æ˜¯æœ¬åœ°ä»£ç†ã€‚
(å¦‚æœæŒ‰ &lt;Ctrl + D&gt; æ— æ³•æ–­å¼€ SSH ä»£ç†çš„è¿æ¥ï¼Œè¯·å…ˆå…³é—­æµè§ˆå™¨çª—å£)
åå‘ä»£ç† 1 ssh -R [&lt;forward ip&gt;:]&lt;forward port&gt;:&lt;local ip&gt;:&lt;local port&gt; &lt;user&gt;@&lt;server&gt; [-p &lt;server SSH port&gt;] å’Œå‰é¢çš„æœ¬åœ°ä»£ç†çš„åŒºåˆ«åªæ˜¯æœ¬æœºå’Œè½¬å‘çš„ IP åŠç«¯å£è°ƒæ¢äº†ï¼Œä¹Ÿå³åå‘ä»£ç†ï¼Œç›¸å¯¹åœ°æŠŠé‚£ä¸ªæœ¬åœ°ä»£ç†å«æ­£å‘ä»£ç†ä¹Ÿæˆã€‚
è¿™å¯ä»¥å°†æœåŠ¡å™¨ &lt;forward ip&gt;:&lt;forward port&gt; çš„è¯·æ±‚è½¬å‘åˆ°æœ¬æœº &lt;local ip&gt;:&lt;local port&gt;ï¼Œä½†æœ¬æœºä¸€èˆ¬æ˜¯ PCï¼Œä¸å¼€ä»€ä¹ˆæœåŠ¡çš„ï¼Œæ‰€ä»¥ä½¿ç”¨å¾—è¾ƒæœ¬åœ°ä»£ç†æ›´å°‘ï¼Œä¸€èˆ¬å°±æ˜¯ç”¨æ¥â€œç©¿å¢™â€çš„ï¼šç™»å½•åˆ°å­¦æ ¡å†…éƒ¨çš„ç”µè„‘ã€å…¬å¸å†…éƒ¨çš„ç”µè„‘ã€æ“ä½œå®¶é‡Œçš„ç©æ„å„¿ã€‚
ä¸‹é¢æ¨¡æ‹Ÿä¸€ä¸‹å…·ä½“ä½¿ç”¨ï¼š
è¿™æ˜¯æˆ‘åœ¨è‡ªå·±ç”µè„‘ä¸Šå¯åŠ¨çš„ä¸€ä¸ª Ubuntu å®¹å™¨çš„ç½‘ç»œæƒ…å†µï¼Œåœ¨æ²¡æœ‰ä»»ä½•è®¾ç½®çš„æƒ…å†µä¸‹æˆ‘è¿ä¸ä¸Šï¼ŒåŒ…æ‹¬ä»»ä½•ç½‘ç»œè¯·æ±‚ã€‚ç”±äºå®¹å™¨ç±»å‹è®¾ç½®çš„ Windows Containerï¼Œç½‘å…³ä¹Ÿæ— æ³•è®¿é—®ã€‚
Ubuntu å®¹å™¨åå‘ä»£ç†è¿æ¥æœåŠ¡å™¨ï¼š
1 ssh -R 192.168.1.116:8000:127.0.0.1:22 root@baitian.xyz ç¡®ä¿æœåŠ¡å™¨çš„ 8000 ç«¯å£æ²¡æœ‰è¢«é˜²ç«å¢™æ‹¦æˆªï¼Œæœ€ç®€å•çš„æ–¹å¼æ˜¯ï¼ˆä½†æ˜¯å¾—å®‰è£… ufwï¼Œæ²¡æœ‰çš„è¯å¯ä»¥ç”¨ iptablesï¼›å¦‚æœæ˜¯äº‘æœåŠ¡å™¨/VPS çš„è¯ï¼Œå‚å•†å¯èƒ½è¿˜å­˜åœ¨ä¸€å±‚é˜²ç«å¢™ï¼Œæ³¨æ„åœ¨æœåŠ¡å™¨åå°ç®¡ç†è®¾ç½®ç›¸åº”å®‰å…¨ç»„è§„åˆ™ï¼‰ï¼š
1 ufw allow 8000 ä»¥åŠæœåŠ¡å™¨çš„ SSH é…ç½® /etc/ssh/sshd_config å­˜åœ¨ä»¥ä¸‹é…ç½®ï¼ˆä¿®æ”¹é…ç½®åå¾—é‡å¯ SSH æœåŠ¡ï¼‰ï¼š
1 GatewayPorts yes æ­¤æ—¶ä¾¿å¯é€šè¿‡æœåŠ¡å™¨è¿æ¥åˆ° Ubuntu å®¹å™¨ï¼š
1 ssh root@baitian.xyz -p 8000 (æ³¨ï¼šæˆ‘çš„æœåŠ¡å™¨å†…ç½‘åœ°å€ 192.168.1.116 æ˜¯ç›´æ¥å’Œå…¬ç½‘åœ°å€ baitian.xyz åœ¨ä¸Šå±‚æ˜ å°„çš„ï¼ŒUbuntu å®¹å™¨è¦ä¹ˆé…ç½®å…è®¸ root ç”¨æˆ·å¯†ç ç™»å½•å¹¶è®¾ç½®å¯†ç ï¼Œè¦ä¹ˆè®¾ç½®ç§˜é’¥å¯¹ç™»å½•ã€‚)
åŠ¨æ€ç«¯å£æ˜ å°„ï¼ˆSocks ä»£ç†ï¼‰ 1 ssh -D [&lt;local ip&gt;:]&lt;local port&gt; &lt;user&gt;@&lt;server&gt; [-p &lt;server SSH port&gt;] è¿™ä¼šåœ¨æœ¬åœ° &lt;local ip&gt;:&lt;local port&gt; å¼€å¯ä¸€ä¸ª Socks 5 ä»£ç†ï¼Œä»£ç†æœåŠ¡å™¨ä¸º SSH è¿æ¥çš„æœåŠ¡å™¨ã€‚
å†çœ‹æœ¬åœ°ä»£ç†ä¸­çš„ä¾‹å­ï¼š
å¼€å¯ Socks ä»£ç†ï¼š
1 ssh -D 1080 root@baitian.xyz æœ¬åœ° 127.0.0.1:1080 ä¸º Socks 5 ä»£ç†ã€‚
å¼€å¯ HTTP æœåŠ¡ï¼š
1 python3 -m http.server --bind 192.168.1.116 8001 æµè§ˆå™¨é…ç½®ä»£ç†ï¼š
Microsoft Edge (Chromium) Google Chrome Mozilla Firefox ä¸å»ºè®®å‘½ä»¤è¡Œé‚£ä¹ˆä½¿ç”¨ä»£ç†ï¼Œå‘½ä»¤è¡Œé‚£æ ·å¯åŠ¨çš„è¯ï¼Œæ¯”å¦‚ Chromeï¼Œå¾—å…ˆæŠŠ Chrome çš„æ‰€æœ‰çª—å£å…³æ‰ï¼ŒEdge ä¹Ÿæ˜¯ï¼ˆè¿™é‡Œæ˜¯æ–°ç‰ˆçš„ Edgeï¼Œå’Œ Chrome å·®ä¸å¤šï¼Œæ—§ç‰ˆ Edge åœ¨æ›´æ–°çš„ Windows 10 ä¼šæ¶ˆå¤±ï¼‰ï¼Œæœ‰æ¡ä»¶å¯ä»¥ä½¿ç”¨ SwitchyOmega æ’ä»¶ï¼ˆéœ€è¦ FQï¼‰ã€‚
è¿œç¨‹æ¡Œé¢ SSH X Server/Client æˆ‘ä»¥å‰å¯¹è¿™ä¸ªçš„å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„ç†è§£æ˜¯åçš„ï¼Œå…¶å®è¿™ä¸€å¥—é‡Œé¢è‡ªå·±çš„ PC ä¸€èˆ¬å……å½“æœåŠ¡ç«¯ï¼ŒæœåŠ¡å™¨å……å½“å®¢æˆ·ç«¯ï¼ŒæœåŠ¡å™¨è°ƒç”¨ PC çš„æœåŠ¡ã€‚
æ‰€ä»¥ï¼Œç›´æ¥ä½¿ç”¨åŸç”Ÿ SSH æä¾›çš„ Xï¼ˆå¯ä»¥å« X11ï¼‰è½¬å‘çš„è¯ PC éœ€è¦å®‰è£… X Serverï¼Œå¯ä»¥å®‰è£… VcXsrv ï¼Œå®‰è£…å¥½åå¯åŠ¨ã€‚å…ˆè®¾ç½®å¥½ DISPLAY ç¯å¢ƒå˜é‡ï¼Œç„¶å SSH è¿æ¥æœåŠ¡å™¨ã€‚
1 ssh -Y root@baitian.xyz Windows ç”¨æˆ·æ¨èä½¿ç”¨ MobaXterm ä½œä¸º SSH å®¢æˆ·ç«¯ï¼Œé›†æˆäº† X Serverï¼Œå¯ä»¥æ–¹ä¾¿ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥å¼€å„ç§éš§é“ï¼ˆä¹Ÿå°±æ˜¯å‰æ–‡æ‰€è¯´çš„ä»£ç†ï¼‰ã€‚ VNC æˆ‘å·²ç»å¥½ä¹…æ²¡ç”¨è¿‡äº†ï¼Œå°±ä¸å†™äº†ï¼Œç½‘ä¸Šä¹Ÿæœ‰è®¸å¤šèµ„æ–™ã€‚
TeamViewer æˆ‘æ²¡ç”¨è¿‡ï¼Œå°±ä¸è¯´äº†ã€‚
ä½†æˆ‘çŸ¥é“è¿™ä¸ªå¯ä»¥ç©¿é€å†…ç½‘ï¼Œè¿™æ˜¯å¾ˆå¤§çš„ä¸€ä¸ªä¼˜åŠ¿ï¼ŒVNC å¯èƒ½éœ€è¦ç»“åˆä»£ç†æ‰è¡Œã€‚
RDP Windows ä¸‹çš„è¿œç¨‹æ¡Œé¢ï¼Œä½¿ç”¨ Windows æœåŠ¡å™¨å¯èƒ½ä¼šç”¨åˆ°
å¯¹äºè¿™äº›æ–¹å¼çš„ä¼˜åŠ£æˆ‘æ²¡æœ‰ä»€ä¹ˆè§è§£ï¼ŒåªçŸ¥é“ç½‘ç»œå¥½çš„è¯éƒ½æ²¡é—®é¢˜ï¼Œç½‘ç»œä¸è¡Œéƒ½æœ‰é—®é¢˜&hellip;
è¿œç¨‹å¼€å‘ çœ‹åˆ°è¿™é‡Œï¼Œæˆ‘æƒ³ä½ è‚¯å®šæ˜¯ä¸€åç¨‹åºå‘˜å§ï¼Œå¦‚æœä½ è¿˜æ²¡ç”¨è¿‡ Visual Studio Code (VSC)ï¼Œæˆ‘å¼ºçƒˆæ¨èä½ ä½¿ç”¨ï¼Œå› ä¸ºè¿™ä¸€èŠ‚éƒ½æ˜¯å®ƒï¼Œå¸Œæœ›ä½ èƒ½ä½“ä¼šåˆ°å®ƒçš„å¥½ç”¨ã€‚
å®‰è£…æ’ä»¶ Remote Developmentã€‚
è¿™ä¸ªæ’ä»¶åŒ…å«ä¸‰ç§è¿œç¨‹è¿æ¥æ–¹å¼ï¼š
SSH (OpenSSH Server) Container (Docker) WSL (Windows Subsystem for Linux) VSC SSH è¿œç¨‹ä¸»æœº é¦–å…ˆï¼Œéœ€è¦äº†è§£ä¸€ä¸ªå« SSH Config çš„ä¸œè¥¿, å…¶å®å¾ˆç®€å•ï¼Œå°±æ˜¯è§„å®šäº† SSH è¿æ¥çš„é…ç½®ï¼Œä¸ç”¨è¿æ¥æ—¶æŒ‡å®šé‚£ä¹ˆå¤šå‚æ•°ã€‚
æ¯”å¦‚ï¼Œæˆ‘åœ¨ C:\Users\baitian\.ssh\config æ–‡ä»¶å­˜åœ¨é…ç½®ï¼ˆæ³¨æ„ï¼Œç”¨æˆ·åç”¨è‡ªå·±çš„ï¼‰ï¼š
1 2 3 4 5 Host aliyun HostName baitian.xyz Port 22 User root IdentityFile ~/.ssh/baitian752 æˆ‘å°±å¯ä»¥ç›´æ¥é€šè¿‡å‘½ä»¤ ssh aliyun è¿æ¥åˆ°æˆ‘çš„é˜¿é‡Œäº‘æœåŠ¡å™¨äº†ã€‚
åŒæ—¶ï¼ŒVSC çš„è¿œç¨‹æ’ä»¶å¯ä»¥è¯†åˆ«å‡ºé…ç½®çš„è¿œç¨‹ä¸»æœºï¼š
è¿æ¥ä¸Šå»ï¼Œå·¦ä¸‹è§’æ˜¾ç¤º SSH: aliyun è¡¨ç¤ºè¿æ¥æˆåŠŸï¼ˆç¬¬ä¸€æ¬¡è¿æ¥æ—¶ç”±äºè¦å®‰è£…æœåŠ¡ç«¯æ—¶é—´ä¼šä¹…ä¸€äº›ï¼‰ï¼š
æ‰“å¼€ä¸€ä¸ªè¿œç¨‹é¡¹ç›®ï¼Œç„¶åï¼Œæ‰€æœ‰æ“ä½œå¦‚æœ¬åœ°ä¸€èˆ¬ï¼š
å¦‚æœè¦ä½¿ç”¨ X Serverï¼Œä¿®æ”¹ C:\Users\baitian\.ssh\config å¦‚ä¸‹ï¼š
1 2 3 4 5 6 7 Host aliyun HostName baitian.xyz Port 22 User root IdentityFile ~/.ssh/baitian752 ForwardX11 yes ForwardX11Trusted yes é…ç½®å¥½ DISPLAY ç¯å¢ƒå˜é‡ï¼Œå¯åŠ¨ VcXsrvï¼Œé‡æ–°æ‰“å¼€é¡¹ç›®ã€‚æ­¤æ—¶ï¼Œä¾¿å¯åœ¨æœåŠ¡å™¨é€šè¿‡ X Client åœ¨æœ¬åœ°æ˜¾ç¤ºå›¾å½¢ç•Œé¢ï¼š
VSC Docker å®¹å™¨ è¿æ¥æœ¬æœºçš„ Docker å®¹å™¨ï¼Œä½†è¿™ç§ç©å„¿æ³•åœ¨ Windows ä¸‹å¯¹å†…å­˜éœ€æ±‚æ¯”è¾ƒé«˜ï¼Œä¼°è®¡ 12GB åŠä»¥ä¸Šæ‰èƒ½æ¯”è¾ƒçˆ½ï¼Œå’Œä¸Šé¢ç›¸æ¯”ä¸€æ–¹é¢æ˜¯ Docker çš„ä¼˜åŠ¿ï¼Œå¦ä¸€æ–¹é¢æ˜¯å¸¦å®½ï¼Œæ¯•ç«Ÿè¿™æ˜¯åœ¨æœ¬æœºã€‚
VSC WSL æˆ‘ç›®å‰ä¸æ¨èä½¿ç”¨ WSLï¼Œå› ä¸º WSL ç³»ç»Ÿæœ‰è¯¸å¤šé™åˆ¶ï¼Œå’Œå®¹å™¨å·®ä¸å¤šçš„ï¼Œæ¯”å¦‚ï¼ŒåŸºäº systemctl æœåŠ¡æ˜¯è·‘ä¸äº†çš„ï¼ˆå’Œç³»ç»Ÿçš„å¯åŠ¨æ–¹å¼æœ‰å…³ï¼Œè¿™æ˜¯å¾ˆåº•å±‚çš„ä¸œè¥¿äº†ï¼Œæˆ‘æ²¡æœ‰ä»€ä¹ˆäº†è§£ï¼‰ï¼Œå’Œ Docker ç›¸æ¯”è¿˜æœ‰ä¸€ä¸ªå·¨å¤§çš„ä¸è¶³ï¼Œç£ç›˜ I/O å·¨æ…¢ã€‚ä¹Ÿå¬é—» WSL 2 è®¸ä¹…äº†ï¼Œæµ‹è¯•è¿‡ä¸€æ¬¡ï¼Œè¿˜æ˜¯æ²¡æ„Ÿè§‰å¥½ç”¨ï¼Œè€Œä¸”éœ€è¦é¢„è§ˆç‰ˆ Windows 10 æ‰èƒ½ä½“éªŒ WSL 2ã€‚
æˆ‘çš„è§‚ç‚¹æ˜¯ï¼Œå†…å­˜è¶³å¤Ÿçš„è¯ï¼Œç›®å‰å®Œå…¨æ²¡å¿…è¦ä½¿ç”¨ WSLï¼ŒDocker çš„å„æ–¹é¢ä½“éªŒéƒ½æ¯” WSL å¥½ï¼›å†…å­˜ä¸å¤Ÿçš„è¯ï¼Œç”¨ SSH è¿æ¥è¿œç¨‹ä¸»æœºå§ï¼Œä¸ç”¨å›¾å½¢ç•Œé¢çš„è¯å¯¹ç½‘ç»œå¸¦å®½è¦æ±‚ä¹Ÿä¸é«˜ã€‚
Web æœåŠ¡ ä»¥ä¸Šæåˆ°çš„å„ç§æ–¹å¼ï¼Œå…¶å®å¯¹ Web æœåŠ¡æ˜¯æœ€å‹å¥½çš„ï¼Œå› ä¸ºæµè§ˆå™¨æ˜¯ä¸€ä¸ªå¤©ç„¶çš„å›¾å½¢ç•Œé¢ï¼ŒæœåŠ¡å™¨å‘é€æ•°æ®ï¼Œæµè§ˆå™¨è¿›è¡Œæ¸²æŸ“å°±è¡Œäº†ï¼Œå¯ä»¥é™ä½è®¸å¤šä¼ è¾“å¸¦å®½ã€‚è®¾ç½®å¥½ä»£ç†ï¼ˆæµè§ˆå™¨ä¹Ÿå¯ä»¥å¾ˆæ–¹ä¾¿è®¾ç½®ä»£ç†ï¼‰ï¼Œæ­¤åˆ»ï¼Œä½ ä¾¿ä¼šæ„Ÿè§‰çŠ¹å¦‚æœ¬åœ°å¼€å‘ä¸€æ ·ã€‚
æ¯”å¦‚ï¼Œç”¨è¿‡ Anaconda çš„å¯¹ Jupyter Notebook å¤§éƒ½ä¸é™Œç”Ÿå§ï¼Œè¿™ä¾¿æ˜¯ä¸€ä¸ªæµè§ˆå™¨ç«¯çš„åº”ç”¨ã€è¿™æ˜¯ä¸€ä¸ªå¾ˆå¼ºå¤§çš„åº”ç”¨ï¼Œå¯ä»¥å®‰è£…è®¸å¤šè¢«ç§°ä¹‹ä¸º kernel çš„æ¨¡å—ï¼Œå¯ä»¥åœ¨çº¿ä½¿ç”¨ C/C++, Wolfram Mathematica, gnuplot, Octave, R ç­‰ç­‰å¥½å¤šå¥½å¤šè¯­è¨€ã€‘ï¼›å†æ¯”å¦‚ï¼ŒOverLeafï¼Œä¸€ä¸ªåœ¨çº¿çš„ LaTeX IDEï¼ˆç”¨è¿‡ä¹‹åæˆ‘å°±å†æ²¡ç¢°è¿‡ TexLive äº†ï¼‰ã€‚
å…¶ä»–ç”¨æ³• é…ç½® SSH ä¸ºé•¿è¿æ¥ é»˜è®¤æƒ…å†µä¸‹ï¼ŒSSH è¿æ¥é•¿æ—¶é—´æ²¡å‘é€æ•°æ®çš„è¯ä¼šè‡ªåŠ¨æ–­å¼€ï¼Œå¯ä»¥åœ¨æœåŠ¡å™¨çš„ /etc/ssh/sshd_config ä½œå¦‚ä¸‹é…ç½®ï¼š
1 2 ClientAliveInterval 60 ClientAliveCountMax 3 è¿™æ ·é…ç½®æ¯è¿‡ 60 ç§’ä¼šå‘é€ä¸€ä¸ªæ•°æ®åŒ…ï¼Œä¿æŒè¿æ¥ä¸ºæ´»åŠ¨çŠ¶æ€ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥åœ¨å®¢æˆ·ç«¯é…ç½®ï¼ˆå°±æˆ‘ä¸ªäººè€Œè¨€ï¼Œå®¢æˆ·ç«¯æ˜¯è¿œå¤šäºæœåŠ¡ç«¯çš„ï¼Œæ‰€ä»¥ä¸€èˆ¬åœ¨æœåŠ¡ç«¯é…ç½®æ›´çœäº‹ï¼‰C:\Users\baitian\.ssh\config ï¼š
1 2 3 4 5 6 7 Host aliyun HostName baitian.xyz Port 22 User root IdentityFile ~/.ssh/baitian752 ServerAliveInterval 60 ServerAliveCountMax 3 æš‚æ—¶ä½¿ç”¨ï¼š
1 ssh &lt;user&gt;@&lt;server&gt; -o ServerAliveInterval=60 -o ServerAliveCountMax=3 æ­å»ºå…¬å…±ä»£ç† æœåŠ¡å™¨è‡ªå·± SSH è¿æ¥è‡ªå·±å¼€å¯åŠ¨æ€ç«¯å£æ˜ å°„ï¼š
1 ssh -D &lt;public ip&gt;:&lt;port&gt; &lt;user&gt;@127.0.0.1 åŒæ—¶é˜²ç«å¢™å¼€å¯æœåŠ¡å™¨çš„ &lt;port&gt; ç«¯å£ï¼Œèƒ½å¤Ÿè®¿é—®å…¬ç½‘çš„æœºå™¨ä¾¿éƒ½å¯ä»¥ä½¿ç”¨ &lt;public ip&gt;:&lt;port&gt; ä½œä¸º Socks 5 ä»£ç†äº†ã€‚
è¿™é‡Œå…¬ç½‘åªæ˜¯ç›¸å¯¹çš„ï¼Œæ¯”å¦‚æˆ‘è‡ªå·±ç”µè„‘ç»è¿‡è·¯ç”±å™¨å IP ä¸º 192.168.1.8ï¼Œé‚£ä¹ˆï¼Œæˆ‘é€šè¿‡ä»¥ä¸‹æ–¹å¼ï¼š
1 ssh -D 192.168.1.8:1080 &lt;user&gt;@&lt;server ip&gt; å¯ä»¥åœ¨è‡ªå·±ç”µè„‘æ‰€å±çš„è·¯ç”±å™¨å­ç½‘æ­å»ºä¸€ä¸ª Socks 5 ä»£ç†ï¼ˆ192.168.1.8:1080ï¼‰ï¼Œä¾¿å¯å±€é™åœ¨ä¸€ä¸ªç›¸å¯¹å°çš„èŒƒå›´å†…å…±äº« &lt;server ip&gt; çš„ç½‘ç»œäº†ã€‚
ç»“åˆ SSH é•¿è¿æ¥ï¼Œå¯ä»¥æ­å»ºä¸€ä¸ªæŒä¹…åŒ–çš„ä»£ç†ã€‚ SSH è·³æ¿æœºç™»å½• æœ‰æ—¶å€™å­˜åœ¨ä»¥ä¸‹æƒ…å†µï¼šåªèƒ½é€šè¿‡è·³æ¿æœº &lt;server1&gt; è¿æ¥å…¶ä»–æœåŠ¡å™¨ï¼ˆæ¯”å¦‚ &lt;server2&gt;ï¼‰ï¼Œè€Œ &lt;server1&gt; çš„æƒé™ç»™çš„å¾ˆä½ï¼Œè·¯ç”±ï¼ŒSSH é…ç½®éƒ½ä¸èƒ½ä¿®æ”¹ã€‚
æ­¤æ—¶ï¼Œæƒ³ç›´æ¥ç™»å½• &lt;server2&gt;ï¼Œå¯ä»¥ç”¨å‰é¢æåˆ°çš„åå‘ä»£ç†æ–¹å¼ï¼Œä½†è¿™ç§æ–¹å¼éœ€è¦ä¸€å°æœ‰ root æƒé™ï¼ˆéœ€è¦ä¿®æ”¹ SSH æœåŠ¡ç«¯é…ç½®ï¼‰çš„å…¬ç½‘æœåŠ¡å™¨ï¼Œæ‰€ç¤ºå¤„ç†è¿™ç§æƒ…å†µå¹¶ä¸å¥½ã€‚
SSH æœ¬èº«å°±æ”¯æŒè·³æ¿ç™»å½•:
1 ssh -J &lt;user1&gt;@&lt;server1&gt; &lt;user2&gt;@&lt;server2&gt; è¿™ä¼šç™»å½•åˆ° &lt;server2&gt;ï¼Œå¦‚æœé…ç½®ä¸Šä»£ç†ï¼Œä»£ç†æœåŠ¡å™¨æ˜¯ &lt;server2&gt; ã€‚
å½“ç„¶ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ &lt;server1&gt; ä½œä¸ºä»£ç†æœåŠ¡å™¨ï¼Œè¿æ¥ &lt;server2&gt;ï¼š
1 ssh &lt;user2&gt;@&lt;server2&gt; -o ProxyCommand=&#34;ssh.exe -W %h:%p &lt;user1&gt;@&lt;server1&gt;&#34; å¦‚æœæ˜¯ Windows 10 è‡ªå¸¦çš„ OpenSSH å®¢æˆ·ç«¯ï¼Œæ³¨æ„é‡Œé¢çš„ ssh.exe ä¸èƒ½æ”¹æˆ sshï¼›DISPLAY ç¯å¢ƒå˜é‡ä¹Ÿå¯èƒ½å¯¼è‡´é”™è¯¯ï¼Œéœ€è¦æ—¶åˆ é™¤è¯¥ç¯å¢ƒå˜é‡ï¼Œæˆ–è€…ä½¿ç”¨ Git for Windows çš„ SSH å®¢æˆ·ç«¯ï¼Œæˆ–æ˜¯ MSYS2 çš„ SSH å®¢æˆ·ç«¯ï¼ˆæœªæµ‹è¯•ï¼‰ï¼›æœ€å¥½æ˜¯é…ç½® SSH ç§˜é’¥å¯¹ç™»å½•ï¼Œæ›´å®‰å…¨ã€çœäº‹ï¼Œå¦‚æœå®åœ¨æ˜¯æ— æ³•é…ç½®ç§˜é’¥å¯¹ï¼Œåˆä¸æƒ³æ‰‹åŠ¨è¾“å…¥å¯†ç ï¼Œå¯ä»¥è€ƒè™‘ sshpassã€‚ ]]></content></entry><entry><title>Ubuntu 18.04 é€šè¿‡ Kolla Ansible éƒ¨ç½²å¤šèŠ‚ç‚¹ OpenStack Stein</title><url>/post/openstack/ubuntu-18-04-kolla-ansible-deploy-openstack-stein-multinode/</url><categories><category>Work</category></categories><tags><tag>OpenStack</tag><tag>Python</tag><tag>Shell</tag></tags><content type="html"><![CDATA[Virtual Box å®‰è£… Ubuntu 18.04 Live Server å®‰è£… 3 å° Ubuntu 18.04ï¼Œå„é…ç½®ä¸€å— NAT ç½‘å¡å’Œä¸€å—ä»…ä¸»æœº (Host Only) ç½‘å¡ï¼Œ3 å°çš„ä»…ä¸»æœºç½‘ç»œç”¨åŒä¸€ä¸ª Virtual Box çš„è™šæ‹Ÿç½‘å¡ã€‚ä¸»æœºååŠ IP å¦‚ä¸‹ï¼š
1 2 3 controller: 192.168.56.10 compute1: 192.168.56.20 compute2: 192.168.56.30 å‡†å¤‡å·¥ä½œï¼ˆcontrollerï¼Œcompute1ï¼Œcompute2ï¼‰ é…ç½®è®¿é—®æ›´å¿«çš„ apt æºï¼Œpip æºï¼ˆæ¸…åã€é˜¿é‡Œç­‰ï¼‰ å®‰è£… pip 1 apt install python-pip -y æ›´æ–° pip 1 pip install -U pip å®‰è£… Docker 1 apt install docker.io -y å®‰è£…éƒ¨ç½²å·¥å…·ï¼ˆcontrollerï¼‰ å®‰è£…ä¾èµ– 1 apt install python-dev libffi-dev gcc libssl-dev python-selinux python-setuptools -y å®‰è£… ansible 1 pip install ansible å®‰è£… kolla ansible 1 git clone http://git.trystack.cn/openstack/kolla-ansible.git --branch stable/stein --depth 1 $HOME/kolla-ansible ä¸Šé¢ä½¿ç”¨äº† OpenStack å›½å†… git é•œåƒ å®‰è£… kolla ansible ä¾èµ– 1 pip install -U -r $HOME/kolla-ansible/requirements.txt é…ç½® Hostsï¼ˆcontrollerï¼Œcompute1ï¼Œcompute2ï¼‰ï¼ˆ/etc/hostsï¼‰ æ³¨é‡Šæ‰ä¸»æœºååˆ° 127.0.1.1 çš„æ˜ å°„ æ·»åŠ èŠ‚ç‚¹ä¿¡æ¯ï¼ˆcontrollerï¼‰ 1 2 3 192.168.56.10 controller 192.168.56.20 compute1 192.168.56.30 compute2 é…ç½® kolla ï¼ˆcontrollerï¼‰ æ‹·è´å…¨å±€é…ç½® globals.yml å’Œå¯†ç é…ç½® passwords.yml 1 cp -r $HOME/kolla-ansible/etc/kolla /etc/ æ‹·è´å¤šèŠ‚ç‚¹é…ç½®æ–‡ä»¶ multinode 1 cp $HOME/kolla-ansible/ansible/inventory/multinode $HOME/ ç”Ÿæˆéšæœºå¯†ç  1 $HOME/kolla-ansible/tools/generate_passwords.py é…ç½® globals.ymlï¼Œæ·»åŠ ä»¥ä¸‹å†…å®¹ï¼ˆ/etc/kolla/globals.ymlï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 kolla_dev_repos_git: &#34;http://git.trystack.cn/openstack&#34; config_strategy: &#34;COPY_ONCE&#34; kolla_base_distro: &#34;ubuntu&#34; kolla_install_type: &#34;source&#34; openstack_release: &#34;stein&#34; kolla_internal_vip_address: &#34;controller&#34; network_interface: &#34;enp0s8&#34; # Host Only network interface neutron_external_interface: &#34;enp0s3&#34; # NAT network interface node_custom_config: &#34;/etc/kolla/config&#34; enable_haproxy: &#34;no&#34; enable_cinder: &#34;yes&#34; enable_cinder_backend_lvm: &#34;yes&#34; enable_etcd: &#34;yes&#34; enable_kuryr: &#34;yes&#34; enable_zun: &#34;yes&#34; enable_neutron_provider_networks: &#34;yes&#34; enable_osprofiler: &#34;yes&#34; enable_skydive: &#34;yes&#34; enable_elasticsearch: &#34;yes&#34; enable_aodh: &#34;yes&#34; enable_gnocchi: &#34;yes&#34; enable_panko: &#34;yes&#34; enable_ceilometer: &#34;yes&#34; enable_octavia: &#34;yes&#34; nova_compute_virt_type: &#34;qemu&#34; # Must set this when deploying in virtual machines é…ç½®å¤šèŠ‚ç‚¹ä¿¡æ¯ï¼ˆ./multinodeï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 [control] controller ansible_ssh_user=root [network] controller ansible_ssh_user=root [compute] controller ansible_ssh_user=root compute1 ansible_ssh_user=root compute2 ansible_ssh_user=root [monitoring] controller ansible_ssh_user=root [storage] controller ansible_ssh_user=root compute1 ansible_ssh_user=root compute2 ansible_ssh_user=root åœ¨é…ç½®äº† storage çš„èŠ‚ç‚¹ä¸ŠæŒ‚è½½ä¸€å—ç¡¬ç›˜ï¼ˆcontroller, conpute1, compute2ï¼‰ è¿™é‡Œå‡è®¾è®¾å¤‡ä¸º /dev/sdb 1 2 3 free_device=/dev/sdb pvcreate $free_device vgcreate cinder-volumes $free_device é…ç½® SSH å¯†é’¥ç™»å½•å„èŠ‚ç‚¹ï¼Œå¹¶ç¡®è®¤ä¸»æœºæŒ‡çº¹éªŒè¯ æµ‹è¯•å¤šèŠ‚ç‚¹é…ç½® 1 ansible -i $HOME/multinode all -m ping é¢å¤–é…ç½® chrony ç»‘å®šåœ°å€ï¼Œ/etc/kolla/config/chrony/chrony.conf
1 bindaddress 192.168.56.10 nova compute monitorsï¼Œ/etc/kolla/config/nova/nova.conf
1 2 [DEFAULT] compute_monitors = cpu.virt_driver octavia é…ç½® SSL è¯ä¹¦
å…‹éš† octavia git ä»“åº“
1 git clone http://git.trystack.cn/openstack/octavia.git --branch stable/stein --depth 1 $HOME/octavia ç”Ÿæˆ SSL è¯ä¹¦
1 2 3 4 grep octavia_ca_password /etc/kolla/passwords.yml (è¿™è¡Œæ˜¯è¾“å‡ºï¼‰octavia_ca_password: &lt;octavia_ca_password&gt; sed -i &#39;s/foobar/&lt;octavia_ca_password&gt;/g&#39; $HOME/octavia/bin/create_certificates.sh $HOME/octavia/bin/create_certificates.sh certs $HOME/octavia/etc/certificates/openssl.cnf æ‹·è´ SSL è¯ä¹¦
1 cp $HOME/certs/ca_01.pem certs/client.pem $HOME/certs/private/cakey.pem /etc/kolla/config/octavia/ è·å– kolla é•œåƒï¼ˆcontrollerï¼‰ é…ç½® Docker ä»“åº“ä»£ç†ï¼ˆå¯é€‰ï¼‰ åœ¨ /etc/docker/daemon.json ä¸­æ·»åŠ 
1 2 3 { &#34;registry-mirrors&#34;: [&#34;https://docker.mirrors.sjtug.sjtu.edu.cn&#34;] } é‡è½½ daemonï¼Œé‡å¯ docker
1 2 systemctl daemon-reload systemctl restart docker æ–¹å¼1ï¼Œä» Docker Hub æ‹‰å– 1 $HOME/kolla-ansible/tools/kolla-ansible pull -vvv æ–¹å¼2ï¼Œæœ¬åœ° tar å¯¼å…¥ æ­å»ºæœ¬åœ° registry æœåŠ¡å™¨ 1 docker run -d --name registry --restart=always -p 4000:5000 -v /opt/registry:/var/lib/registry registry ä¿®æ”¹é•œåƒ tag 1 for item in `docker images | grep stein | awk &#39;{print $1}&#39;`; do docker image tag $item:stein controller:4000/$item:stein; done é…ç½® kolla ä½¿ç”¨æœ¬åœ° registry æœåŠ¡å™¨ åœ¨ /etc/kolla/globals.yml ä¸­æ·»åŠ 
1 docker_registry: &#34;controller:4000&#34; Kolla Ansible Bootstrap Serversï¼ˆcontrollerï¼‰ 1 $HOME/kolla-ansible/tools/kolla-ansible -i $HOME/multinode bootstrap-servers æ‹‰å–é•œåƒè‡³å„èŠ‚ç‚¹ï¼ˆcontrollerï¼‰ ä¸Šä¼ é•œåƒè‡³æœ¬åœ° registry æœåŠ¡å™¨ 1 for item in `docker images | grep controller:4000 | awk &#39;{print $1}&#39;`; do docker push $item:stein; done æ‹‰å–é•œåƒè‡³å„èŠ‚ç‚¹ 1 $HOME/kolla-ansible/tools/kolla-ansible -i $HOME/multinode pull å„èŠ‚ç‚¹é…ç½® ZUN Compute å®¹å™¨ï¼ˆcontrollerï¼Œcompute1ï¼Œcompute2ï¼‰ ä¿®æ”¹ /etc/systemd/system/docker.service.d/kolla.conf
å°†
1 ExecStart=/usr/bin/dockerd --insecure-registry controller:4000 --log-opt max-file=5 --log-opt max-size=50m åˆ†åˆ«ä¿®æ”¹ä¸º
(controller)
1 ExecStart=/usr/bin/dockerd --insecure-registry controller:4000 --log-opt max-file=5 --log-opt max-size=50m -H tcp://controller:2375 -H unix:///var/run/docker.sock --cluster-store=etcd://controller:2379 (compute1)
1 ExecStart=/usr/bin/dockerd --insecure-registry controller:4000 --log-opt max-file=5 --log-opt max-size=50m -H tcp://compute1:2375 -H unix:///var/run/docker.sock --cluster-store=etcd://controller:2379 (compute2)
1 ExecStart=/usr/bin/dockerd --insecure-registry controller:4000 --log-opt max-file=5 --log-opt max-size=50m -H tcp://compute2:2375 -H unix:///var/run/docker.sock --cluster-store=etcd://controller:2379 é‡è½½ daemonï¼Œé‡å¯ docker ï¼ˆcontrollerï¼Œcompute1ï¼Œcompute2ï¼‰
1 2 systemctl daemon-reload systemctl restart docker Kolla Ansible Pre-Checksï¼ˆcontrollerï¼‰ 1 $HOME/kolla-ansible/tools/kolla-ansible -i $HOME/multinode prechecks Kolla Ansible Deployï¼ˆcontrollerï¼‰ 1 $HOME/kolla-ansible/tools/kolla-ansible -i $HOME/multinode deploy Kolla Ansible Post Deployï¼ˆcontrollerï¼‰ 1 $HOME/kolla-ansible/tools/kolla-ansible -i $HOME/multinode post-deploy åˆå§‹åŒ–é…ç½®ï¼ˆcontrollerï¼‰ å®‰è£… OpenStack å®¢æˆ·ç«¯ï¼ˆå»ºè®®åœ¨è™šæ‹Ÿç¯å¢ƒè¿›è¡Œï¼‰ 1 pip install python-openstackclient é…ç½®ç®¡ç†å‘˜ç¯å¢ƒ 1 . /etc/kolla/admin-openrc.sh æ‹·è´åˆå§‹åŒ–è„šæœ¬ 1 cp $HOME/kolla-ansible/tools/init-runonce $HOME/ é…ç½®åˆå§‹åŒ–è„šæœ¬ ï¼ˆ./init-runonceï¼‰ 1 2 3 EXT_NET_CIDR=&#39;10.0.2.0/24&#39; EXT_NET_RANGE=&#39;start=10.0.2.100,end=10.0.2.199&#39; EXT_NET_GATEWAY=&#39;10.0.2.2&#39; æ‰§è¡Œåˆå§‹åŒ–è„šæœ¬ 1 . $HOME/init-runonce é…ç½® br-ex æ¡¥æ¥ç½‘å¡ ï¼ˆ/etc/network/interfacesï¼‰ 1 2 3 4 5 auto br-ex iface br-ex inet static address 10.0.2.200 netmask 255.255.255.0 gateway 10.0.2.2 é‡å¯ç½‘ç»œ 1 netplan apply é¢å¤–é…ç½®ï¼ˆcontrollerï¼‰ Horizon ç®¡ç†å‘˜ç¯å¢ƒ å°† admin-openrc.shï¼Œprediction_train.csvï¼Œmodel.m æ‹·è´è‡³ horizon å®¹å™¨å¹¶ä¿®æ”¹æƒé™
1 2 3 docker cp /etc/kolla/admin-openrc.sh horizon:/etc/openstack-dashboard/ docker cp $HOME/prediction_train.csv horizon:/etc/openstack-dashboard/ docker cp $HOME/model.m horizon:/etc/openstack-dashboard/ 1 2 3 docker exec horizon chown horizon:horizon /etc/openstack-dashboard/admin-openrc.sh docker exec horizon chown horizon:horizon /etc/openstack-dashboard/prediction_train.csv docker exec horizon chown horizon:horizon /etc/openstack-dashboard/model.m é‡å¯ horizon å®¹å™¨
1 docker restart horizon octavia é…ç½® åˆ›å»º amphora é•œåƒï¼ˆå¯åœ¨ https://tarballs.openstack.org/octavia/test-images/ ä¸‹è½½ï¼‰
1 openstack image create --disk-format qcow2 --file $HOME/test-only-amphora-x64-haproxy-ubuntu-bionic.qcow2 --tag amphora amphora åˆ›å»º octavia å®‰å…¨ç»„
1 openstack security group create --description &#39;Used by octavia amphora instance&#39; octavia ä¸ºå®‰å…¨ç»„æ·»åŠ è§„åˆ™
ï¼ˆ&lt;security_group_id&gt; é€šè¿‡ openstack security group list è·å–ï¼‰
1 2 3 openstack security group rule create --protocol icmp &lt;security_group_id&gt; openstack security group rule create --protocol tcp --dst-port 5555 --egress &lt;security_group_id&gt; openstack security group rule create --protocol tcp --dst-port 9443 --ingress &lt;security_group_id&gt; æ·»åŠ å¯†é’¥å¯¹
ï¼ˆ&lt;octavia_keystone_password&gt; é€šè¿‡ grep octavia_keystone_password /etc/kolla/passwords.yml è·å–ï¼‰
1 2 openstack keypair create --public-key $HOME/.ssh/id_rsa.pub octavia_ssh_key openstack --os-username octavia --os-password &lt;octavia_keystone_password&gt; keypair create --public-key $HOME/.ssh/id_rsa.pub octavia_ssh_key ä¿®æ”¹ /etc/kolla/octavia-worker/octavia.conf
ï¼ˆ&lt;network_id&gt; é€šè¿‡ openstack network list è·å–ï¼Œé€‰æ‹© public1 çš„ IDï¼‰
ï¼ˆ&lt;flavor_id&gt; é€šè¿‡ openstack flavor list è·å–ï¼‰
1 2 3 4 5 6 [controller_worker] amp_boot_network_list = &lt;network_id&gt; amp_image_tag = amphora amp_secgroup_list = octavia amp_flavor_id = &lt;flavor_id&gt; amp_ssh_key_name = octavia_ssh_key é‡å¯ octavia_worker å®¹å™¨
1 docker restart octavia_worker ]]></content></entry><entry><title>Learn SICP Chapter 2</title><url>/post/sicp/learn-sicp-ch2/</url><categories><category>Learn</category></categories><tags><tag>Scheme</tag><tag>SICP</tag></tags><content type="html"><![CDATA[ç°åœ¨åˆ°äº†æ•°å­¦æŠ½è±¡ä¸­æœ€å…³é”®çš„ä¸€æ­¥ï¼šè®©æˆ‘ä»¬å¿˜è®°è¿™äº›ç¬¦å·æ‰€è¡¨ç¤ºçš„å¯¹è±¡ã€‚â€¦â€¦ï¼ˆæ•°å­¦å®¶ï¼‰ä¸åº”åœ¨è¿™é‡Œåœæ­¥ï¼Œæœ‰è®¸å¤šæ“ä½œå¯ä»¥åº”ç”¨äºè¿™äº›ç¬¦å·ï¼Œè€Œæ ¹æœ¬ä¸å¿…è€ƒè™‘å®ƒä»¬åˆ°åº•ä»£è¡¨ç€ä»€ä¹ˆä¸œè¥¿ã€‚
Hermann Weyl, The Mathematical Way of Thinking
ï¼ˆæ€ç»´çš„æ•°å­¦æ–¹å¼ï¼‰ ç»ƒä¹  1 è¯·å®šä¹‰å‡º make-rat çš„ä¸€ä¸ªæ›´å¥½çš„ç‰ˆæœ¬ï¼Œä½¿ä¹‹å¯ä»¥æ­£ç¡®å¤„ç†æ­£æ•°å’Œè´Ÿæ•°ã€‚å½“æœ‰ç†æ•°ä¸ºæ­£æ—¶ï¼Œmake-rat åº”å½“å°†å…¶è§„èŒƒåŒ–ï¼Œä½¿å®ƒçš„åˆ†å­å’Œåˆ†æ¯éƒ½æ˜¯æ­£çš„ã€‚å¦‚æœæœ‰ç†æ•°ä¸ºè´Ÿï¼Œé‚£ä¹ˆå°±åº”åªè®©åˆ†å­ä¸ºè´Ÿã€‚
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 #lang sicp (define (gcd m n) (if (= m 0) n (if (= n 0) m (if (&gt; m n) (gcd (- m n) n) (gcd m (- n m)))))) (define (make-rat n d) (if (= d 0) (error &#34;Denom cannot be 0&#34;) (if (= n 0) (cons 0 1) (if (and (&lt; n 0) (&lt; d 0)) (make-rat (- n) (- d)) (if (and (&lt; n 0) (&gt; d 0)) (let ((g (gcd (- n) d))) (cons (/ n g) (/ d g))) (if (and (&gt; n 0) (&gt; d 0)) (let ((g (gcd n d))) (cons (/ n g) (/ d g))) (cons (- n) (- d)))))))) (define (number x) (car x)) (define (denom x) (cdr x)) (define (add-rat x y) (make-rat (+ (* (number x) (denom y)) (* (number y) (denom x))) (* (denom x) (denom y)))) (define (sub-rat x y) (make-rat (- (* (number x) (denom y)) (* (number y) (denom x))) (* (denom x) (denom y)))) (define (mul-rat x y) (make-rat (* (number x) (number y)) (* (denom x) (denom y)))) (define (div-rat x y) (make-rat (* (number x) (denom y)) (* (number y) (denom x)))) (define (equal-rat? x y) (= (* (number x) (denom y)) (* (number y) (denom x)))) (define (print-rat x) (newline) (display (number x)) (display &#34;/&#34;) (display (denom x))) ;&gt;&gt;&gt; (make-rat 2 0) ;: Denom cannot be 0 ;&gt;&gt;&gt; (print-rat (make-rat 2 4)) ;: 1/2 ;&gt;&gt;&gt; (print-rat (make-rat -2 4)) ;: -1/2 ;&gt;&gt;&gt; (print-rat (make-rat 2 -4)) ;: -2/4 ;&gt;&gt;&gt; (print-rat (make-rat -2 -4)) ;: 1/2 ;&gt;&gt;&gt; (print-rat (add-rat (make-rat 2 4) (make-rat 4 6))) ;: 7/6 ;&gt;&gt;&gt; (print-rat (sub-rat (make-rat 2 4) (make-rat 4 6))) ;: -1/6 ;&gt;&gt;&gt; (print-rat (mul-rat (make-rat 2 4) (make-rat 4 6))) ;: 1/3 ;&gt;&gt;&gt; (print-rat (div-rat (make-rat 2 4) (make-rat 4 6))) ;: 3/4 ;&gt;&gt;&gt; (equal-rat? (make-rat 32 -128) (make-rat -13 52)) ;: #t ç»ƒä¹  2 è¯·è€ƒè™‘å¹³é¢ä¸Šçº¿æ®µçš„è¡¨ç¤ºé—®é¢˜ã€‚ä¸€ä¸ªçº¿æ®µç”¨ä¸€å¯¹ç‚¹è¡¨ç¤ºï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯çº¿æ®µçš„å§‹ç‚¹ä¸ç»ˆç‚¹ï¼Œè¯·å®šä¹‰æ„é€ å‡½æ•° make-segment å’Œé€‰æ‹©å‡½æ•° start-segmentã€end-segmentï¼Œå®ƒä»¬åŸºäºç‚¹å®šä¹‰çº¿æ®µçš„è¡¨ç¤ºã€‚è¿›è€Œï¼Œä¸€ä¸ªç‚¹å¯ä»¥ç”¨æ•°çš„åºå¯¹è¡¨ç¤ºï¼Œåºå¯¹çš„ä¸¤ä¸ªæˆåˆ†åˆ†åˆ«è¡¨ç¤ºç‚¹çš„ $x$ åæ ‡å’Œ $y$ åæ ‡ã€‚è¯·æ®æ­¤è¿›ä¸€æ­¥ç»™å‡ºæ„é€ å‡½æ•° make-point å’Œé€‰æ‹©å‡½æ•° x-pointã€y-pointï¼Œç”¨å®ƒä»¬å®šä¹‰å‡ºç‚¹çš„è¿™ç§è¡¨ç¤ºã€‚æœ€åï¼Œè¯·åŸºäºæ‰€å®šä¹‰çš„æ„é€ å‡½æ•°å’Œé€‰æ‹©å‡½æ•°ï¼Œå®šä¹‰å‡ºè¿‡ç¨‹ midpoint-segmantï¼Œå®ƒä»¥ä¸€ä¸ªçº¿æ®µä¸ºå‚æ•°ï¼Œè¿”å›çº¿æ®µçš„ä¸­ç‚¹ï¼ˆä¹Ÿå°±æ˜¯é‚£ä¸ªåæ ‡å€¼ä¸¤ä¸ªç«¯ç‚¹çš„å¹³å‡å€¼çš„ç‚¹ï¼‰ã€‚ä¸ºäº†è¯•éªŒè¿™äº›è¿‡ç¨‹ï¼Œè¿˜éœ€è¦å®šä¹‰ä¸€ç§æ‰“å°ç‚¹çš„æ–¹æ³•ï¼š
1 2 3 4 5 6 7 (define (print-point p) (newline) (display &#34;(&#34;) (display (x-point p)) (display &#34;,&#34;) (display (y-point p)) (display &#34;)&#34;)) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 #lang sicp (define (print-point p) (newline) (display &#34;(&#34;) (display (x-point p)) (display &#34;,&#34;) (display (y-point p)) (display &#34;)&#34;)) (define (make-point x y) (cons x y)) (define (x-point p) (car p)) (define (y-point p) (cdr p)) (define (make-segment p q) (cons p q)) (define (start-segment s) (car s)) (define (end-segment s) (cdr s)) (define (midpoint-segment s) (let ((p (start-segment s)) (q (end-segment s))) (cons (/ (+ (x-point p) (x-point q)) 2) (/ (+ (y-point p) (y-point q)) 2)))) ;&gt;&gt;&gt; (define p (make-point 1 2)) ;&gt;&gt;&gt; (define q (make-point 3 4)) ;&gt;&gt;&gt; (print-point p) ;: (1,2) ;&gt;&gt;&gt; (define s (make-segment p q)) ;&gt;&gt;&gt; (define m (midpoint-segment s)) ;&gt;&gt;&gt; (print-point m) ;: (2,3) ç»ƒä¹  3 è¯·å®ç°ä¸€ç§å¹³é¢çŸ©å½¢çš„è¡¨ç¤ºï¼ˆæç¤ºï¼šä½ æœ‰å¯èƒ½å€Ÿç”¨ ç»ƒä¹  2 çš„ç»“æœï¼‰ã€‚åŸºäºä½ çš„æ„é€ å‡½æ•°å’Œé€‰æ‹©å‡½æ•°å®šä¹‰å‡ ä¸ªè¿‡ç¨‹ï¼Œè®¡ç®—ç»™å®šçŸ©å½¢çš„å‘¨é•¿å’Œé¢ç§¯ç­‰ã€‚ç°åœ¨è¯·å†ä¸ºçŸ©å½¢å®ç°å¦ä¸€ç§è¡¨ç¤ºæ–¹å¼ã€‚ä½ åº”è¯¥æ€æ ·è®¾è®¡ç³»ç»Ÿï¼Œä½¿ä¹‹èƒ½æä¾›é€‚å½“çš„æŠ½è±¡å±è”½ï¼Œä½¿åŒä¸€ä¸ªå‘¨é•¿æˆ–è€…é¢ç§¯è¿‡ç¨‹å¯¹ä¸¤ç§ä¸åŒè¡¨ç¤ºéƒ½èƒ½å·¥ä½œã€‚
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 #lang sicp (define (make-point x y) (cons x y)) (define (x-point p) (car p)) (define (y-point p) (cdr p)) (define (make-rect origin angle width height) (cons (cons origin angle) (cons width height))) (define (origin-rect r) (car (car r))) (define (angle-rect r) (cdr (car r))) (define (width-rect r) (car (cdr r))) (define (height-rect r) (cdr (cdr r))) (define (perimeter-rect r) (* 2 (+ (width-rect r) (height-rect r)))) (define (area-rect r) (* (width-rect r) (height-rect r))) ;&gt;&gt;&gt; (define r (make-rect (make-point 0 0) 1.57 2 3)) ;&gt;&gt;&gt; (perimeter-rect r) ;: 10 ;&gt;&gt;&gt; (area-rect r) ;: 6 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 #lang sicp (define (make-point x y) (cons x y)) (define (x-point p) (car p)) (define (y-point p) (cdr p)) (define (distance-point p q) (define (sqr x) (* x x)) (sqrt (+ (sqr (- (x-point p) (x-point q))) (sqr (- (y-point p) (y-point q)))))) (define (dot-product v1 v2) (+ (* (x-point v1) (x-point v2)) (* (y-point v1) (y-point v2)))) (define (sub-vector v1 v2) (cons (- (car v1) (car v2)) (- (cdr v1) (cdr v2)))) (define (make-rect p1 p2 p3) (let ((d (distance-point p2 p3))) (if (or (&lt; d (distance-point p1 p2)) (&lt; d (distance-point p1 p3))) (error &#34;Points should make a rectangle&#34;) (cons p1 (cons p2 p3))))) (define (width-rect r) (distance-point (car r) (car (cdr r)))) (define (height-rect r) (distance-point (car r) (cdr (cdr r)))) (define (perimeter-rect r) (* 2 (+ (width-rect r) (height-rect r)))) (define (area-rect r) (* (width-rect r) (height-rect r))) ;&gt;&gt;&gt; (define r (make-rect ; (make-point 0 0) ; (make-point 2 0) ; (make-point 0 3))) ;&gt;&gt;&gt;&gt; (perimeter-rect r) ;: 10 ;&gt;&gt;&gt; (area-rect r) ;: 6 ç»ƒä¹  4 ä¸‹é¢æ˜¯åºå¯¹çš„å¦ä¸€ç§è¿‡ç¨‹æ€§è¡¨ç¤ºæ–¹æ³•ã€‚è¯·é’ˆå¯¹è¿™ä¸€è¡¨è¿°éªŒè¯ï¼Œå¯¹äºä»»æ„çš„ x å’Œ yï¼Œ(car (cons x y)) éƒ½å°†äº§ç”Ÿå‡º xã€‚
1 2 3 4 5 (define (cons x y) (lambda (m) (m x y))) (define (car z) (z (lambda (p q) p))) å¯¹åº”çš„ cdr åº”è¯¥å¦‚ä½•å®šä¹‰ï¼Ÿï¼ˆæç¤ºï¼šä¸ºäº†éªŒè¯è¿™ä¸€è¡¨ç¤ºç¡®å®èƒ½è¡Œï¼Œè¯·åˆ©ç”¨ 1.1.5 èŠ‚çš„ä»£æ¢æ¨¡å‹ã€‚ï¼‰
1 2 3 4 5 6 (car z) (z (lambda (p q) p)) ((cons x y) (lambda (p q) p)) ((lambda (m) (m x y)) (lambda (p q) p)) ((lambda (p q) p) x y) x 1 2 (define (cdr z) (z (lambda (p q) q))) ç»ƒä¹  5 è¯·è¯æ˜ï¼Œå¦‚æœå°† $a$ å’Œ $b$ çš„åºå¯¹è¡¨ç¤ºä¸ºä¹˜ç§¯ $2^a 3^b$ æ‰€å¯¹åº”çš„æ•´æ•°ï¼Œæˆ‘ä»¬å°±å¯ä»¥åªç”¨éè´Ÿæ•´æ•°å’Œç®—æœ¯è¿ç®—è¡¨ç¤ºåºå¯¹ã€‚è¯·ç»™å‡ºå¯¹åº”çš„è¿‡ç¨‹ consã€car å’Œ cdr çš„å®šä¹‰ã€‚
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 #lang sicp (define (pow b n) (define (iter n r) (if (= n 0) r (iter (- n 1) (* b r)))) (iter n 1)) (define (cons x y) (* (pow 2 x) (pow 3 y))) (define (car z) (define (iter x r) (if (odd? x) r (iter (/ x 2) (+ r 1)))) (iter z 0)) (define (cdr z) (define (get-odd x) (if (odd? x) x (get-odd (/ x 2)))) (define (iter x r) (if (= x 1) r (iter (/ x 3) (+ r 1)))) (iter (get-odd z) 0)) ;&gt;&gt;&gt; (define z (cons 618 991)) ;&gt;&gt;&gt; (car z) ;: 618 ;&gt;&gt;&gt; (cdr z) ;: 991 ç»ƒä¹  6 å¦‚æœè§‰å¾—å°†åºå¯¹è¡¨ç¤ºä¸ºè¿‡ç¨‹è¿˜ä¸è¶³ä»¥ä»¤äººå¦‚é›·çŒé¡¶ï¼Œé‚£ä¹ˆè¯·è€ƒè™‘ï¼Œåœ¨ä¸€ä¸ªå¯ä»¥å¯¹è¿‡ç¨‹åšå„ç§æ“ä½œçš„è¯­è¨€é‡Œï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥æ²¡æœ‰æ•°ï¼ˆè‡³å°‘åœ¨åªè€ƒè™‘éè´Ÿæ•´æ•°çš„æƒ…å†µä¸‹ï¼‰ï¼Œå°† $0$ å’ŒåŠ ä¸€æ“ä½œå®ç°ä¸ºï¼š
1 2 3 4 (define zero (lambda (f) (lambda (x) x))) (define (add-1 n) (lambda (f) (lambda (x) (f ((n f) x))))) è¿™ä¸€è¡¨ç¤ºå½¢å¼ç§°ä¸º Church è®¡æ•°åå­—æ¥æºäºå…¶å‘æ˜äººæ•°ç†é€»è¾‘å­¦å®¶ Alonzo Churchï¼ˆä¸˜å¥‡ï¼‰ï¼Œ$\lambda$ æ¼”ç®—ä¹Ÿæ˜¯ä»–å‘æ˜çš„ã€‚
è¯·ç›´æ¥å®šä¹‰ one å’Œ twoï¼ˆä¸ç”¨ zero å’Œ add-1ï¼‰ï¼ˆæç¤ºï¼šåˆ©ç”¨ä»£æ¢å»æ±‚å€¼ï¼ˆadd0-1 zeroï¼‰ï¼‰ã€‚è¯·ç»™å‡ºåŠ æ³•è¿‡ç¨‹ + çš„ä¸€ä¸ªç›´æ¥å®šä¹‰ï¼ˆä¸è¦é€šè¿‡åå¤åº”ç”¨ add-1ï¼‰ã€‚
å®šä¹‰ oneï¼Œç›´æ¥ä»£å…¥ï¼Œåˆ©ç”¨ (add-1 zero)ï¼š
1 2 3 4 5 6 7 8 9 ; (define one (add-1 zero)) ; (define one ; (lambda (f) (lambda (x) (f ((zero f) x))))) ; (define one ; (lambda (f) (lambda (x) (f (((lambda (f) (lambda (x) x)) f) x))))) ; (define one ; (lambda (f) (lambda (x) (f ((lambda (x) x) x))))) (define one (lambda (f) (lambda (x) (f x)))) å®šä¹‰ twoï¼Œ(add-1 one)ï¼š
1 2 3 4 5 6 7 8 9 ; (define two (add-1 one)) ; (define two ; (lambda (f) (lambda (x) (f ((one f) x))))) ; (define two ; (lambda (f) (lambda (x) (f (((lambda (f) (lambda (x) (f x))) f) x))))) ; (define two ; (lambda (f) (lambda (x) (f ((lambda (x) (f x)) x))))) (define two (lambda (f) (lambda (x) (f (f x))))) n çš„å®šä¹‰ä¸º (add-1 n-1)ï¼š
1 2 ; (define n ; (lambda (f) (lambda (x) (f ((n-1 f) x))))) add-2 çš„å®šä¹‰ä¸º (add-1 (add-1 n))ï¼š
1 2 3 4 5 6 7 8 9 10 11 12 ; (define (add-2 n) ; (add-1 (add-1 n))) ; (define (add-2 n) ; (add-1 (lambda (f) (lambda (x) (f ((n f) x)))))) ; (define (add-2 n) ; (lambda (f) (lambda (x) (f (((lambda (f) (lambda (x) (f ((n f) x)))) f) x))))) ; (define (add-2 n) ; (lambda (f) (lambda (x) (f ((lambda (x) (f ((n f) x))) x))))) ; (define (add-2 n) ; (lambda (f) (lambda (x) (f (f ((n f) x)))))) (define (add-2 n) (lambda (f) (lambda (x) ((two f) ((n f) x))))) å‡å®š add-m-1 çš„å®šä¹‰ä¸ºï¼š
1 2 ; (define (add-m-1 n) ; (lambda (f) (lambda (x) ((m-1 f) ((n f) x))))) add-m çš„å®šä¹‰ä¸º (add-1 (add-m-1 n))ï¼š
1 2 3 4 5 6 7 8 9 10 11 12 ; (define (add-m n) ; (add-1 (add-m-1 n))) ; (define (add-m n) ; (add-1 (lambda (f) (lambda (x) ((m-1 f) ((n f) x)))))) ; (define (add-m n) ; (lambda (f) (lambda (x) (f (((lambda (f) (lambda (x) ((m-1 f) ((n f) x)))) f) x))))) ; (define (add-m n) ; (lambda (f) (lambda (x) (f ((lambda (x) ((m-1 f) ((n f) x))) x))))) ; (define (add-m n) ; (lambda (f) (lambda (x) (f ((m-1 f) ((n f) x)))))) ; (define (add-m n) ; (lambda (f) (lambda (x) ((m f) ((n f) x))))) + çš„å®šä¹‰ä¸ºï¼š
1 2 (define (+ m n) (lambda (f) (lambda (x) ((m f) ((n f) x))))) ç»ƒä¹  7 Alyssa çš„ç¨‹åºæ˜¯ä¸å®Œæ•´çš„ï¼Œå› ä¸ºå¥¹è¿˜æ²¡æœ‰ç¡®å®šåŒºé—´æŠ½è±¡çš„å®ç°ã€‚è¿™é‡Œæ˜¯åŒºé—´æ„é€ ç¬¦çš„å®šä¹‰ï¼š
1 (define (make-interval a b) (cons a b)) è¯·å®šä¹‰é€‰æ‹©ç¬¦ upper-bound å’Œ lower-boundï¼Œå®Œæˆè¿™ä¸€å®ç°ã€‚
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 #lang sicp (define (make-interval a b) (cons a b)) (define (upper-bound i) (max (car i) (cdr i))) (define (lower-bound i) (min (car i) (cdr i))) ;&gt;&gt;&gt; (define i (make-interval 2 3)) ;&gt;&gt;&gt; (upper-bound i) ;: 3 ;&gt;&gt;&gt; (lower-bound i) ;: 2 ;&gt;&gt;&gt; (define i2 (make-interval 2 -3)) ;&gt;&gt;&gt; (upper-bound i2) ;: 2 ;&gt;&gt;&gt; (lower-bound i2) ;: -3 ç»ƒä¹  8 é€šè¿‡ç±»ä¼¼äº Alyssa çš„æ¨ç†ï¼Œè¯´æ˜ä¸¤ä¸ªåŒºé—´çš„å·®åº”è¯¥æ€æ ·è®¡ç®—ã€‚è¯·å®šä¹‰å‡ºç›¸åº”çš„å‡æ³•è¿‡ç¨‹ sub-intervalã€‚
æŠŠå‡å»åŒºé—´çš„ä¸¤ä¸ªç«¯ç‚¹å–ç›¸åæ•°æ„é€ æ–°åŒºé—´ï¼Œç„¶åé€šè¿‡åŠ æ³•å®ç°å‡æ³•ã€‚
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 #lang sicp (define (make-interval a b) (cons a b)) (define (upper-bound i) (max (car i) (cdr i))) (define (lower-bound i) (min (car i) (cdr i))) (define (add-interval x y) (make-interval (+ (lower-bound x) (lower-bound y)) (+ (upper-bound x) (upper-bound y)))) (define (inv-interval i) (make-interval (- (lower-bound i)) (- (upper-bound i)))) (define (sub-interval x y) (add-interval x (inv-interval y))) ç»ƒä¹  9 åŒºé—´çš„å®½åº¦å°±æ˜¯å…¶ä¸Šç•Œå’Œä¸‹ç•Œä¹‹å·®çš„ä¸€åŠã€‚åŒºé—´å®½åº¦æ˜¯æœ‰å…³åŒºé—´æ‰€æè¿°çš„ç›¸åº”æ•°å€¼çš„éç¡®å®šæ€§çš„ä¸€ç§åº¦é‡ã€‚å¯¹äºæŸäº›ç®—æœ¯è¿ç®—ï¼Œä¸¤ä¸ªåŒºé—´çš„ç»„åˆç»“æœçš„å®½åº¦å°±æ˜¯å‚æ•°åŒºé—´çš„å®½åº¦çš„å‡½æ•°ï¼Œè€Œå¯¹å…¶ä»–è¿ç®—ï¼Œç»„åˆåŒºé—´çš„å®½åº¦åˆ™ä¸æ˜¯å‚æ•°åŒºé—´å®½åº¦çš„å‡½æ•°ã€‚è¯æ˜ä¸¤ä¸ªåŒºé—´çš„å’Œï¼ˆä¸å·®ï¼‰çš„å®½åº¦å°±æ˜¯è¢«åŠ ï¼ˆæˆ–å‡ï¼‰çš„åŒºé—´çš„å®½åº¦çš„å‡½æ•°ã€‚ä¸¾ä¾‹è¯´æ˜ï¼Œå¯¹äºä¹˜å’Œé™¤è€Œè¨€ï¼Œæƒ…å†µå¹¶éå¦‚æ­¤ã€‚
è¯´æ˜ï¼š
$I$ è¡¨ç¤ºåŒºé—´ $u(I)$ è¡¨ç¤º $I$ çš„ä¸Šç•Œ $l(I)$ è¡¨ç¤º $I$ çš„ä¸‹ç•Œ $w(I)$ è¡¨ç¤º $I$ çš„å®½åº¦ $+, -, \times, /$ å¯ç”¨äºåŒºé—´ $w(I)$ çš„å®šä¹‰å¦‚ä¸‹ï¼š
$$ w(I) = \frac{u(I) - l(I)}{2} $$
å¯¹äºåŠ æ³•ï¼š
$$ u(I_1 + I_2) = u(I_1) + u(I_2) $$
$$ l(I_1 + I_2) = l(I_1) + l(I_2) $$
å› æ­¤ï¼š
$$ \begin{aligned} w(I_1 + I_2) &amp;= \frac{u(I_1 + I_2) - l(I_1 + I_2)}{2} \\ &amp;= \frac{u(I_1) - l(I_1) + u(I_2) - l(I_2)}{2} \\ &amp;= w(I_1) + w(I_2) \end{aligned} $$
å¯¹äºå‡æ³•ï¼š
$$ \begin{aligned} w(I_1 - I_2) &amp;= w(I_1 + (-I_2)) \\ &amp;= \frac{u(I_1 + (-I_2)) - l(I_1 + (-I_2))}{2} \\ &amp;= \frac{u(I_1) - l(I_1) + u(-I_2) - l(-I_2)}{2} \\ &amp;= w(I_1) + w(I_2) \end{aligned} $$
å¯¹äºä¹˜æ³•ï¼Œè¦è¯æ˜ä¸æ˜¯è¢«ä¹˜åŒºé—´å®½åº¦çš„å‡½æ•°ï¼Œåªéœ€è¯æ˜è¢«ä¹˜åŒºé—´å®½åº¦ç¡®å®šæ—¶ï¼Œä¹˜ç§¯åŒºé—´çš„å®½åº¦ä¸å®šã€‚
ä¸å¦¨å–ç¬¬ä¸€ä¸ªåŒºé—´ä¸º $[0, 1]$, ç¬¬äºŒä¸ªåŒºé—´åˆ†åˆ«ä¸º $[0, 1]$ã€$[1, 2]$,æ­¤æ—¶ï¼Œä¹˜ç§¯åŒºé—´çš„å®½åº¦åˆ†åˆ«ä¸º $0.5$ã€$1$ï¼Œå› æ­¤ï¼Œä¹˜ç§¯åŒºé—´çš„å®½åº¦ä¸æ˜¯è¢«ä¹˜åŒºé—´å®½åº¦çš„å‡½æ•°ã€‚
å¯¹äºé™¤æ³•ï¼Œè¯æ˜è¿‡ç¨‹ä¸ä¹˜æ³•ç±»ä¼¼ã€‚
ç»ƒä¹  10 Ben Bitdiddle æ˜¯ä¸ªä¸“ä¸šç¨‹åºå‘˜ï¼Œä»–çœ‹äº† Alyssa å·¥ä½œåè¯„è®ºè¯´ï¼Œé™¤ä»¥ä¸€ä¸ªæ¨ªè·¨ $0$ çš„åŒºé—´çš„æ„ä¹‰ä¸æ¸…æ¥šã€‚è¯·ä¿®æ”¹ Alyssa çš„ä»£ç ï¼Œæ£€æŸ¥è¿™ç§æƒ…å†µå¹¶åœ¨å‡ºç°è¿™ä¸€æƒ…å†µæ—¶æŠ¥é”™ã€‚
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 #lang sicp (define (make-interval a b) (cons a b)) (define (upper-bound i) (max (car i) (cdr i))) (define (lower-bound i) (min (car i) (cdr i))) (define (mul-interval x y) (let ((p1 (* (lower-bound x) (lower-bound y))) (p2 (* (lower-bound x) (upper-bound y))) (p3 (* (upper-bound x) (upper-bound y))) (p4 (* (upper-bound x) (lower-bound y)))) (make-interval (min p1 p2 p3 p4) (max p1 p2 p3 p4)))) (define (div-interval x y) (if (and (&gt; (upper-bound y) 0) (&lt; (lower-bound y) 0)) (error &#34;Not support interval cross 0 -- Div-Interval&#34;) (mul-interval x (make-interval (/ 1.0 (upper-bound y)) (/ 1.0 (lower-bound y)))))) ;&gt;&gt;&gt; (define x (make-interval 1 2)) ;&gt;&gt;&gt; (define y (make-interval -1 1)) ;&gt;&gt;&gt; (div-interval x y) ;: Not support interval cross 0 -- Div-Interval ;&gt;&gt;&gt; (define x2 (make-interval 1 2)) ;&gt;&gt;&gt; (define y2 (make-interval 3 4)) ;&gt;&gt;&gt; (div-interval x2 y2) ;: (0.25 . 0.6666666666666666) ç»ƒä¹  11 åœ¨çœ‹äº†è¿™äº›ä¸œè¥¿ä¹‹åï¼ŒBen åˆè¯´å‡ºäº†ä¸‹é¢è¿™æ®µæœ‰äº›ç¥ç§˜çš„è¯ï¼šâ€œé€šè¿‡ç›‘æµ‹åŒºé—´çš„ç«¯ç‚¹ï¼Œæœ‰å¯èƒ½å°† mul-interval åˆ†è§£ä¸º 9 ä¸­æƒ…å†µï¼Œæ¯ç§æƒ…å†µä¸­æ‰€éœ€çš„ä¹˜æ³•éƒ½ä¸è¶…è¿‡ä¸¤æ¬¡â€ã€‚è¯·æ ¹æ® Ben çš„å»ºè®®é‡å†™è¿™ä¸ªè¿‡ç¨‹ã€‚
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 #lang sicp (define (make-interval a b) (cons a b)) (define (upper-bound i) (max (car i) (cdr i))) (define (lower-bound i) (min (car i) (cdr i))) (define (mul-interval x y) (let ((ux (upper-bound x)) (lx (lower-bound x)) (uy (upper-bound y)) (ly (lower-bound y))) (if (&lt;= ux 0) (cond ((&lt;= uy 0) (make-interval (* lx ly) (* ux uy))) ((&gt;= ly 0) (make-interval (* lx uy) (* ux ly))) (else (make-interval (* lx uy) (* lx ly)))) (if (&gt;= lx 0) (cond ((&lt;= uy 0) (make-interval (* lx uy) (* ux ly))) ((&gt;= ly 0) (make-interval (* lx ly) (* ux uy))) (else (make-interval (* ux ly) (* ux uy)))) (cond ((&lt;= uy 0) (make-interval (* lx ly) (* ux ly))) ((&gt;= ly 0) (make-interval (* lx uy) (* ux uy))) (else (make-interval (max (* lx ly) (* ux uy)) (min (* lx uy) (* ux ly))))))))) ;&gt;&gt;&gt; (define x (make-interval 1 2)) ;&gt;&gt;&gt; (define y (make-interval -1 1)) ;&gt;&gt;&gt; (mul-interval x y) ;: (-2 . 2) ;&gt;&gt;&gt; (define x2 (make-interval 1 2)) ;&gt;&gt;&gt; (define y2 (make-interval 3 4)) ;&gt;&gt;&gt; (mul-interval x2 y2) ;: (3 . 8) ç»ƒä¹  12 è¯·å®šä¹‰ä¸€ä¸ªæ„é€ å‡½æ•° make-center-percentï¼Œå®ƒä»¥ä¸€ä¸ªä¸­å¿ƒç‚¹å’Œä¸€ä¸ªç™¾åˆ†æ¯”ä¸ºå‚æ•°ï¼Œäº§ç”Ÿå‡ºæ‰€éœ€è¦çš„åŒºé—´ã€‚ä½ è¿˜éœ€è¦å®šä¹‰é€‰æ‹©å‡½æ•° percentï¼Œé€šè¿‡å®ƒå¯ä»¥å¾—åˆ°ç»™å®šåŒºé—´çš„ç™¾åˆ†æ•°è¯¯å·®ï¼Œé€‰æ‹©å‡½æ•° center ä¸å‰é¢å®šä¹‰çš„ä¸€æ ·ã€‚
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 #lang sicp (define (make-interval a b) (cons a b)) (define (upper-bound i) (max (car i) (cdr i))) (define (lower-bound i) (min (car i) (cdr i))) (define (center i) (/ (+ (lower-bound i) (upper-bound i)) 2)) (define (width i) (/ (- (upper-bound i) (lower-bound i)) 2)) (define (make-center-percent c p) (let ((w (* c p))) (make-interval (- c w) (+ c w)))) (define (percent i) (/ (width i) (center i))) ;&gt;&gt;&gt; (define i (make-center-percent 2 0.1)) ;&gt;&gt;&gt; i ;: (1.8 . 2.2) ;&gt;&gt;&gt; (center i) ;: 2.0 ;&gt;&gt;&gt; (width i) ;: 0.2 ;&gt;&gt;&gt; (percent i) ;: 0.1 ç»ƒä¹  13 è¯·è¯æ˜ï¼Œåœ¨è¯¯å·®ä¸ºå¾ˆå°çš„ç™¾åˆ†æ•°çš„æ¡ä»¶ä¸‹ï¼Œå­˜åœ¨ç€ä¸€ä¸ªç®€å•å…¬å¼ï¼Œåˆ©ç”¨å®ƒå¯ä»¥ä»ä¸¤ä¸ªè¢«ä¹˜åŒºé—´çš„è¯¯å·®ç®—å‡ºä¹˜ç§¯çš„ç™¾åˆ†æ•°è¯¯å·®å€¼ã€‚ä½ å¯ä»¥å‡å®šæ‰€æœ‰çš„æ•°ä¸ºæ­£ï¼Œä»¥ç®€åŒ–è¿™ä¸€é—®é¢˜ã€‚
å‡è®¾æ‰€æœ‰çš„æ•°ä¸ºæ­£ï¼Œ$c_1, c_2, w_1, w_2, p_1, p_2$ åˆ†åˆ«ä¸ºä¸¤ä¸ªè¢«ä¹˜åŒºé—´çš„ä¸­ç‚¹ã€å®½åº¦ã€ç™¾åˆ†æ¯”è¯¯å·®ï¼Œ$l, u, w, c$ åˆ†åˆ«ä¸ºä¹˜ç§¯åŒºé—´çš„ä¸‹ç•Œã€ä¸Šç•Œã€å®½åº¦ã€ä¸­ç‚¹ï¼Œåˆ™
$$ l = (c_1 - w_1)(c_2 - w_2) $$
$$ u = (c_1 + w_1)(c_2 + w_2) $$
$$ w = \frac{u - l}{2} $$
$$ c = \frac{u + l}{2} $$
ç™¾åˆ†æ¯”è¯¯å·®ï¼š
$$ \begin{aligned} p &amp;= \frac{w}{c} \\ &amp;= \frac{u - l}{u + l} \\ &amp;= \frac{c_1w_2 + c_2w_1}{c_1c_2 + w_1w_2} \\ &amp;= \frac{p_1 + p_2}{p_1p_2 + 1} \\ &amp;\approx p_1 + p_2 \quad (p_1 \ll 1, p_2 \ll 1) \end{aligned} $$
ç»ƒä¹  14 è¯·ç¡®è®¤ Lem æ˜¯å¯¹çš„ã€‚è¯·ä½ ç”¨å„ç§ä¸åŒçš„ç®—æœ¯è¡¨è¾¾å¼æ¥æ£€æŸ¥è¿™ä¸€ç³»ç»Ÿçš„è¡Œä¸ºã€‚è¯·åšå‡ºä¸¤ä¸ªåŒºé—´ $A$ å’Œ $B$ï¼Œå¹¶ç”¨å®ƒä»¬è®¡ç®—è¡¨è¾¾å¼ $A/A$ å’Œ $B/B$ã€‚å¦‚æœæ‰€ç”¨åŒºé—´çš„å®½åº¦ç›¸å¯¹äºä¸­å¿ƒå€¼å–å¾ˆå°ç™¾åˆ†æ•°ï¼Œä½ å°†ä¼šå¾—åˆ°æ›´å¤šçš„çŸ¥è¯†ã€‚è¯·æ£€æŸ¥å¯¹äºä¸­å¿ƒ &mdash; ç™¾åˆ†æ¯”å½¢å¼ï¼ˆè§ ç»ƒä¹  12 ï¼‰è¿›è¡Œè®¡ç®—ç»“æœã€‚
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 #lang sicp (define (make-interval a b) (cons a b)) (define (upper-bound i) (max (car i) (cdr i))) (define (lower-bound i) (min (car i) (cdr i))) (define (add-interval x y) (make-interval (+ (lower-bound x) (lower-bound y)) (+ (upper-bound x) (upper-bound y)))) (define (mul-interval x y) (let ((p1 (* (lower-bound x) (lower-bound y))) (p2 (* (lower-bound x) (upper-bound y))) (p3 (* (upper-bound x) (upper-bound y))) (p4 (* (upper-bound x) (lower-bound y)))) (make-interval (min p1 p2 p3 p4) (max p1 p2 p3 p4)))) (define (div-interval x y) (if (and (&gt; (upper-bound y) 0) (&lt; (lower-bound y) 0)) (error &#34;Not support interval cross 0 -- Div-Interval&#34;) (mul-interval x (make-interval (/ 1.0 (upper-bound y)) (/ 1.0 (lower-bound y)))))) (define (center i) (/ (+ (lower-bound i) (upper-bound i)) 2)) (define (width i) (/ (- (upper-bound i) (lower-bound i)) 2)) (define (make-center-percent c p) (let ((w (* c p))) (make-interval (- c w) (+ c w)))) (define (percent i) (/ (width i) (center i))) (define (par1 r1 r2) (div-interval (mul-interval r1 r2) (add-interval r1 r2))) (define (par2 r1 r2) (let ((one (make-interval 1 1))) (div-interval one (add-interval (div-interval one r1) (div-interval one r2))))) ;&gt;&gt;&gt; (define r1 (make-interval 0.9 1.1)) ;&gt;&gt;&gt; (define r2 (make-interval 0.9 1.1)) ;&gt;&gt;&gt; (par1 r1 r2) ;: (0.3681818181818182 . 0.6722222222222224) ;&gt;&gt;&gt; (par2 r1 r2) ;: (0.44999999999999996 . 0.55) ;&gt;&gt;&gt; (define A (make-center-percent 1.0 0.05)) ;&gt;&gt;&gt; (define B (make-center-percent 1.0 0.1)) ;&gt;&gt;&gt; (define q1 (div-interval A A)) ;&gt;&gt;&gt; (define q2 (div-interval A B)) ;&gt;&gt;&gt; (center q1) ;: 1.0050125313283207 ;&gt;&gt;&gt; (percent q1) ;: 0.09975062344139651 ;&gt;&gt;&gt; (center q2) ;: 1.0151515151515151 ;&gt;&gt;&gt; (percent q2) ;: 0.14925373134328368 ç»ƒä¹  15 å¦ä¸€ç”¨æˆ· Eva Lu Ator ä¹Ÿæ³¨æ„åˆ°äº†ç”±ä¸åŒçš„ç­‰ä»·ä»£æ•°è¡¨è¾¾å¼è®¡ç®—å‡ºçš„åŒºé—´çš„å·®å¼‚ã€‚å¥¹è¯´ï¼Œå¦‚æœä¸€ä¸ªå…¬å¼å¯ä»¥å†™æˆä¸€ç§å½¢å¼ï¼Œå…¶ä¸­å…·æœ‰éå‡†ç¡®æ€§çš„å˜é‡ä¸é‡å¤å‡ºç°ï¼Œé‚£ä¹ˆ Alyssa çš„ç³»ç»Ÿäº§ç”Ÿå‡ºçš„åŒºé—´çš„é™ç•Œæ›´ç´§ä¸€äº›ã€‚å¥¹è¯´ï¼Œå› æ­¤ï¼Œåœ¨è®¡ç®—å¹¶è”ç”µé˜»æ—¶ï¼Œpar2 æ˜¯æ¯” par1â€œæ›´å¥½çš„â€ç¨‹åºã€‚å¥¹è¯´å¾—å¯¹å—ï¼Ÿ
å¯¹ï¼Œè®¾ $R_1$ çš„åŒºé—´ä¸º $[a_1, b_1] (a_1 \le b_1)$ï¼Œ$R_2$ çš„åŒºé—´ä¸º $[a_2, b_2] (a_2 \le b_2)$ï¼Œåˆ™ par1 çš„ç»“æœä¸ºï¼š
$$ \left[\frac{a_1a_2}{b_1+b_2}, \frac{b_1b_2}{a_1+a_2}\right] $$
par2 çš„ç»“æœä¸ºï¼š
$$ \left[\frac{a_1a_2}{a_1+a_2}, \frac{b_1b_2}{b_1+b_2}\right] $$
æ˜¾ç„¶ï¼Œpar2 è®¡ç®—æ‰€å¾—çš„åŒºé—´å®½åº¦ä¸ä¼šå¤§äº par1ã€‚
ç»ƒä¹  16 è¯·ç»™å‡ºä¸€ä¸ªä¸€èˆ¬æ€§çš„è§£é‡Šï¼šä¸ºä»€ä¹ˆç­‰ä»·çš„ä»£æ•°è¡¨è¾¾å¼å¯èƒ½å¯¼è‡´ä¸åŒè®¡ç®—ç»“æœï¼Ÿä½ èƒ½è®¾è®¡å‡ºä¸€ä¸ªåŒºé—´ç®—æœ¯åŒ…ï¼Œä½¿ä¹‹æ²¡æœ‰è¿™ç§ç¼ºé™·å—ï¼Ÿæˆ–è€…è¿™ä»¶äº‹æƒ…æ ¹æœ¬ä¸å¯èƒ½åšåˆ°ï¼Ÿï¼ˆè­¦å‘Šï¼šè¿™ä¸ªé—®é¢˜éå¸¸éš¾ã€‚ï¼‰
åœ¨ ç»ƒä¹  14 ä¸­ï¼Œ$A/A$ çš„ç»“æœå¹¶ä¸æ˜¯ $1$ï¼ŒåŸå› æ˜¯å¯¹äºç»™å®šçš„åŒºé—´ç®—æœ¯è¿ç®—è§„åˆ™ï¼Œæ²¡æœ‰è€ƒè™‘åˆ†å­å’Œåˆ†æ¯çš„ $A$ å…¶å®æ˜¯åŒä¸€ä¸ªé‡ï¼Œå§‹ç»ˆåªèƒ½å–ä¸€æ ·çš„æ•°å€¼ã€‚å†æ¯”å¦‚ï¼Œå°† $\frac{R_1R_2}{R_1 + R_2}$ ä¸­çš„åˆ†æ¯ä¸Šçš„ $R_1, R_2$ åˆ†åˆ«æ›¿æ¢æˆä¸ $R_1, R_2$ ç›¸åŒåŒºé—´çš„ $R_3, R_4$ï¼Œæ­¤æ—¶
$$ \frac{R_1R_2}{R_1 + R_2} = \frac{R_1R_2}{R_3 + R_4} $$
è€Œ $\frac{R_1R_2}{R_3 + R_4}$ ä¸ $\frac{1}{1/R_1 + 1/R_2}$ ä¸å­˜åœ¨â€œç­‰ä»·â€å…³ç³»ï¼Œä¾¿è¯´æ˜äº†é—®é¢˜ã€‚
TODO
ç»ƒä¹  17 è¯·å®šä¹‰å‡ºè¿‡ç¨‹ last-pairï¼Œå®ƒè¿”å›åªåŒ…å«ç»™å®šï¼ˆéç©ºï¼‰è¡¨é‡Œæœ€åä¸€ä¸ªå…ƒç´ çš„è¡¨ï¼š
1 2 (last-pair (list 23 72 149 34)) (34) 1 2 3 4 5 6 7 8 9 #lang sicp (define (last-pair l) (if (null? (cdr l)) l (last-pair (cdr l)))) ;&gt;&gt;&gt; (last-pair (list 23 72 149 34)) ;: (34) ç»ƒä¹  18 è¯·å®šä¹‰å‡ºè¿‡ç¨‹ reverseï¼Œå®ƒä»¥ä¸€ä¸ªè¡¨ä¸ºå‚æ•°ï¼Œè¿”å›çš„è¡¨ä¸­æ‰€åŒ…å«çš„å…ƒç´ ä¸å‚æ•°è¡¨ç›¸åŒï¼Œä½†æ’åˆ—é¡ºåºä¸å‚æ•°è¡¨ç›¸åï¼š
1 2 (reverse (list 1 4 9 16 25)) (25 16 9 4 1) 1 2 3 4 5 6 7 8 9 10 11 #lang sicp (define (reverse l) (define (reverse-iter lst r) (if (null? lst) r (reverse-iter (cdr lst) (cons (car lst) r)))) (reverse-iter l nil)) ;&gt;&gt;&gt; (reverse (list 1 4 9 16 25)) ;: (25 16 9 4 1) ç»ƒä¹  19 è¯·è€ƒè™‘ 1.2.2 èŠ‚çš„å…‘æ¢é›¶é’±æ–¹å¼è®¡æ•°ç¨‹åºã€‚å¦‚æœèƒ½å¤Ÿè½»è€Œæ˜“ä¸¾åœ°æ”¹å˜ç¨‹åºé‡Œæ‰€ç”¨çš„å…‘æ¢å¸ç§å°±æ›´å¥½äº†ã€‚è­¬å¦‚è¯´ï¼Œé‚£æ ·æˆ‘ä»¬å°±èƒ½è®¡ç®—å‡º 1 è‹±é•‘çš„ä¸åŒå…‘æ¢æ–¹å¼çš„æ•°ç›®ã€‚åœ¨å†™å‰é¢é‚£ä¸ªç¨‹åºæ—¶ï¼Œæœ‰å…³å¸ç§çš„çŸ¥è¯†ä¸­æœ‰ä¸€éƒ¨åˆ†å‡ºç°åœ¨è¿‡ç¨‹ first-denomination é‡Œï¼Œå¦ä¸€éƒ¨åˆ†å‡ºç°åœ¨è¿‡ç¨‹é‡Œ count-changeï¼ˆå®ƒçŸ¥é“æœ‰ 5 ç§ U.S. ç¡¬å¸ï¼‰ã€‚å¦‚æœèƒ½å¤Ÿç”¨ä¸€ä¸ªè¡¨æ¥æä¾›å¯ç”¨äºå…‘æ¢çš„ç¡¬å¸å°±æ›´å¥½äº†ã€‚
æˆ‘ä»¬å¸Œæœ›é‡å†™å‡ºè¿‡ç¨‹ ccï¼Œä½¿å…¶ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå¯ç”¨ç¡¬å¸çš„å¸å€¼è¡¨ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªæŒ‡å®šå¯ç”¨ç¡¬å¸ç§ç±»çš„æ•´æ•°ã€‚è€Œåæˆ‘ä»¬å°±å¯ä»¥é’ˆå¯¹å„ç§è´§å¸å®šä¹‰å‡ºä¸€äº›è¡¨ï¼š
1 2 3 (define us-coins (list 50 25 10 5 1)) (define uk-coins (list 100 50 20 10 5 2 1 0.5)) ç„¶åæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼è°ƒç”¨ ccï¼š
1 2 (cc 100 us-coins) 292 ä¸ºäº†åšåˆ°è¿™ä»¶äº‹ï¼Œæˆ‘ä»¬éœ€è¦å¯¹ç¨‹åº cc åšä¸€äº›ä¿®æ”¹ã€‚å®ƒä»ç„¶å…·æœ‰åŒæ ·çš„å½¢å¼ï¼Œä½†å°†ä»¥ä¸åŒçš„æ–¹å¼è®¿é—®è‡ªå·±çš„ç¬¬äºŒä¸ªå‚æ•°ï¼Œå¦‚ä¸‹é¢æ‰€ç¤ºï¼š
1 2 3 4 5 6 7 8 9 (define (cc amount coin-values) (cond ((= amount 0) 1) ((or (&lt; amount 0) (no-more? coin-values)) 0) (else (+ (cc amount (except-first-denomination coin-values)) (cc (- amount (first-denomination coin-values)) coin-values))))) è¯·åŸºäºè¡¨ç»“æ„ä¸Šçš„åŸºæœ¬æ“ä½œï¼Œå®šä¹‰å‡ºè¿‡ç¨‹ first-denominationã€except-first-denomination å’Œ no-more?ã€‚è¡¨ coin-values çš„æ’åˆ—é¡ºåºä¼šå½±å“ cc ç»™å‡ºçš„å›ç­”å—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 #lang sicp (define us-coins (list 50 25 10 5 1)) (define uk-coins (list 100 50 20 10 5 2 1 0.5)) (define (cc amount coin-values) (cond ((= amount 0) 1) ((or (&lt; amount 0) (no-more? coin-values)) 0) (else (+ (cc amount (except-first-denomination coin-values)) (cc (- amount (first-denomination coin-values)) coin-values))))) (define (except-first-denomination coin-values) (cdr coin-values)) (define (first-denomination coin-values) (car coin-values)) (define (no-more? coin-values) (null? coin-values)) ;&gt;&gt;&gt; (cc 100 us-coins) ;: 292 ;&gt;&gt;&gt; (cc 100 uk-coins) ;: 104561 è¡¨ coin-values çš„æ’åˆ—é¡ºåºä¸ä¼šå½±å“ cc ç»™å‡ºçš„å›ç­”ï¼Œå› ä¸º cc ä¼šéå†ç»™å®š coin-values ä¸­æ‰€æœ‰çš„å¯èƒ½å…‘æ¢é›¶é’±æ–¹å¼ã€‚
ç»ƒä¹  20 è¿‡ç¨‹ +ã€* å’Œ list å¯ä»¥å–ä»»æ„ä¸ªæ•°çš„å®é™…å‚æ•°ã€‚å®šä¹‰è¿™ç±»è¿‡ç¨‹çš„ä¸€ç§æ–¹å¼æ˜¯é‡‡ç”¨ä¸€ç§å¸¦ç‚¹å°¾éƒ¨è®°æ³•å½¢å¼çš„ defineã€‚åœ¨ä¸€ä¸ªè¿‡ç¨‹å®šä¹‰ä¸­ï¼Œå¦‚æœåœ¨å½¢å¼å‚æ•°è¡¨çš„æœ€åä¸€ä¸ªå‚æ•°ä¹‹å‰æœ‰ä¸€ä¸ªç‚¹å·ï¼Œé‚£å°±è¡¨æ˜ï¼Œå½“è¿™ä¸€è¿‡ç¨‹è¢«å®é™…è°ƒç”¨æ—¶ï¼Œå‰é¢å„ä¸ªå½¢å¼å‚æ•°ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰å°†ä»¥å‰é¢çš„å„ä¸ªå®é™…å‚æ•°ä¸ºå€¼ï¼Œä¸å¹³å¸¸ä¸€æ ·ã€‚ä½†æœ€åä¸€ä¸ªå½¢å¼å‚æ•°å°†ä»¥æ‰€æœ‰å‰©ä¸‹çš„å®é™…å‚æ•°çš„è¡¨ä¸ºå€¼ã€‚ä¾‹å¦‚ï¼Œå‡è‹¥æˆ‘ä»¬å®šä¹‰äº†ï¼š
1 (define (f x y . z) &lt;body&gt;) è¿‡ç¨‹ f å°±å¯ä»¥ç”¨ä¸¤ä¸ªä»¥ä¸Šçš„å‚æ•°è°ƒç”¨ã€‚å¦‚æœæ±‚å€¼ï¼š
1 (f 1 2 3 4 5 6) é‚£ä¹ˆåœ¨ f çš„ä½“é‡Œï¼Œ x å°†æ˜¯ $1$ï¼Œy å°†æ˜¯ $2$ï¼Œè€Œ z å°†æ˜¯è¡¨ (3 4 5 6)ã€‚ç»™äº†å®šä¹‰ï¼š
1 (define (g . w) &lt;body&gt;) è¿‡ç¨‹ g å¯ä»¥ç”¨ 0 ä¸ªæˆ–å¤šä¸ªå‚æ•°è°ƒç”¨ã€‚å¦‚æœæ±‚å€¼ï¼š
1 (g 1 2 3 4 5 6) é‚£ä¹ˆåœ¨ g çš„ä½“é‡Œï¼Œw å°†æ˜¯è¡¨ (1 2 3 4 5 6)ã€‚
è¯·é‡‡ç”¨è¿™ç§è®°æ³•å½¢å¼å†™å‡ºè¿‡ç¨‹ same-parityï¼Œå®ƒä»¥ä¸€ä¸ªæˆ–è€…å¤šä¸ªæ•´æ•°ä¸ºå‚æ•°ï¼Œè¿”å›æ‰€æœ‰ä¸å…¶ç¬¬ä¸€ä¸ªå‚æ•°æœ‰ç€åŒæ ·å¥‡å¶æ€§çš„å‚æ•°å½¢æˆçš„è¡¨ã€‚ä¾‹å¦‚ï¼š
1 2 3 4 5 (same-parity 1 2 3 4 5 6 7) (1 3 5 7) (same-parity 2 3 4 5 6 7) (2 4 6) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 #lang sicp (define (reverse l) (define (reverse-iter lst r) (if (null? lst) r (reverse-iter (cdr lst) (cons (car lst) r)))) (reverse-iter l nil)) (define (same-parity k . n) (define (iter n r) (if (null? n) r (iter (cdr n) (if (or (and (even? k) (even? (car n))) (and (odd? k) (odd? (car n)))) (cons (car n) r) r)))) (reverse (iter n (list k)))) ;&gt;&gt;&gt; (same-parity 1 2 3 4 5 6 7) ;: (1 3 5 7) ;&gt;&gt;&gt; (same-parity 2 3 4 5 6 7) ;: (2 4 6) ç»ƒä¹  21 è¿‡ç¨‹ square-list ä»¥ä¸€ä¸ªæ•°å€¼è¡¨ä¸ºå‚æ•°ï¼Œè¿”å›æ¯ä¸ªæ•°çš„å¹³æ–¹æ„æˆçš„è¡¨ï¼š
1 2 (square-list (list 1 2 3 4)) (1 4 9 16) ä¸‹é¢æ˜¯ square-list çš„ä¸¤ä¸ªå®šä¹‰ï¼Œè¯·å¡«å……å…¶ä¸­ç¼ºå°‘çš„è¡¨è¾¾å¼ä»¥å®Œæˆå®ƒä»¬ï¼š
1 2 3 4 5 6 7 (define (square-list items) (if (null? items) nil (cons &lt;??&gt; &lt;??&gt;))) (define (square-list items) (map &lt;??&gt; &lt;??&gt;)) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 #lang sicp (define (square x) (* x x)) (define (square-list items) (if (null? items) nil (cons (square (car items)) (square-list (cdr items))))) (define (square-list-2 items) (map square items)) ;&gt;&gt;&gt; (square-list (list 1 2 3 4)) ;: (1 4 9 16) ;&gt;&gt;&gt; (square-list-2 (list 1 2 3 4)) ;: (1 4 9 16) ç»ƒä¹  22 Louis Reasoner è¯•å›¾é‡å†™ ç»ƒä¹  21 çš„ç¬¬ä¸€ä¸ª square-list è¿‡ç¨‹ï¼Œå¸Œæœ›ä½¿å®ƒèƒ½ç”Ÿæˆä¸€ä¸ªè¿­ä»£è®¡ç®—è¿‡ç¨‹ï¼š
1 2 3 4 5 6 7 8 (define (square-list items) (define (iter things answer) (if (null? things) answer (iter (cdr things) (cons (square (car things)) answer)))) (iter items nil)) ä½†æ˜¯å¾ˆä¸å¹¸ï¼Œåœ¨æŒ‰è¿™ç§æ–¹å¼å®šä¹‰å‡ºçš„ square-list äº§ç”Ÿå‡ºçš„ç»“æœè¡¨ä¸­ï¼Œå…ƒç´ çš„é¡ºåºæ­£å¥½ä¸æˆ‘ä»¬æ‰€éœ€è¦çš„ç›¸åã€‚ä¸ºä»€ä¹ˆï¼Ÿ
Louis åˆè¯•ç€ä¿®æ­£å…¶ç¨‹åºï¼Œäº¤æ¢äº† cons çš„å‚æ•°ï¼š
1 2 3 4 5 6 7 8 (define (square-list items) (define (iter things answer) (if (null? things) answer (iter (cdr things) (cons answer (square (car things)))))) (iter items nil)) ä½†è¿˜æ˜¯ä¸è¡Œã€‚è¯·è§£é‡Šä¸ºä»€ä¹ˆã€‚
å‰è€…æ˜¯å› ä¸ºåœ¨ç”¨ cons æ„é€  list çš„æ—¶å€™ï¼Œæ˜¯ä»æœ€åä¸€ä¸ªå…ƒç´ å¼€å§‹å¾€å‰é¢æ„é€ ï¼Œå› æ­¤é¡ºåºåˆšå¥½ç›¸åã€‚
åè€…ä¸ç¬¦åˆ cons æ„é€  list çš„è§„åˆ™ï¼Œcons æ„é€  list çš„è¯ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºä¸€ä¸ªå…ƒç´ ï¼Œç¬¬äºŒä¸ªä¸ºä¸€ä¸ª listï¼ˆæˆ–è€… nilï¼‰ã€‚
ç»ƒä¹  23 è¿‡ç¨‹ for-each ä¸ map ç±»ä¼¼ï¼Œå®ƒä»¥ä¸€ä¸ªè¿‡ç¨‹å’Œä¸€ä¸ªå…ƒç´ è¡¨ä¸ºå‚æ•°ï¼Œä½†å®ƒå¹¶ä¸è¿”å›ç»“æœæµ‹è¡¨ï¼Œåªæ˜¯å°†è¿™ä¸€è¿‡ç¨‹ä»å·¦åˆ°å³åº”ç”¨äºå„ä¸ªå…ƒç´ ï¼Œå°†è¿‡ç¨‹åº”ç”¨äºå…ƒç´ å¾—åˆ°çš„å€¼éƒ½ä¸¢æ‰ä¸ç”¨ã€‚for-each é€šå¸¸ç”¨äºé‚£äº›æ‰§è¡Œäº†æŸäº›åŠ¨ä½œçš„è¿‡ç¨‹ï¼Œå¦‚æ‰“å°ç­‰ã€‚çœ‹ä¸‹é¢ä¾‹å­ï¼š
1 2 3 4 5 (for-each (lambda (x) (newline) (display x)) (list 57 321 88)) 57 321 88 ç”± for-each çš„è°ƒç”¨è¿”å›çš„å€¼ï¼ˆä¸Šé¢æ²¡æœ‰æ˜¾ç¤ºï¼‰å¯ä»¥æ˜¯æŸç§ä»»æ„çš„ä¸œè¥¿ï¼Œä¾‹å¦‚é€»è¾‘å€¼çœŸã€‚è¯·ç»™å‡ºä¸€ä¸ª for-each çš„å®ç°ã€‚
1 2 3 4 5 6 7 8 9 10 11 12 13 #lang sicp (define (for-each proc items) (cond ((not (null? items)) (proc (car items)) (for-each proc (cdr items))))) ;&gt;&gt;&gt; (for-each (lambda (x) (newline) (display x)) ;&gt;&gt;&gt; (list 57 321 88)) ;: ;: 57 ;: 321 ;: 88 ç»ƒä¹  24 å‡å®šç°åœ¨è¦æ±‚å€¼è¡¨è¾¾å¼ (list 1 (list 2 (list 3 4)))ï¼Œè¯·ç»™å‡ºç”±è§£é‡Šå™¨æ‰“å°å‡ºçš„ç»“æœï¼Œç»™å‡ºä¸ä¹‹å¯¹åº”çš„ç›’å­æŒ‡é’ˆç»“æ„ï¼Œå¹¶å°†å®ƒè§£é‡Šä¸ºä¸€æ£µæ ‘ï¼ˆå‚è§å›¾ 2-6ï¼‰ã€‚
1 (1 (2 (3 4))) ç»ƒä¹  25 ç»™å‡ºèƒ½å¤Ÿä»ä¸‹é¢å„è¡¨ä¸­å–å‡º 7 çš„ car å’Œ cdr ç»„åˆï¼š
1 2 3 4 5 (1 3 (5 7) 9) ((7)) (1 (2 (3 (4 (5 (6 7)))))) 1 2 3 4 5 6 7 #lang sicp (car (cdr (car (cdr (cdr (list 1 3 (list 5 7) 9)))))) (car (car (list (list 7)))) (car (cdr (car (cdr (car (cdr (car (cdr (car (cdr (car (cdr (list 1 (list 2 (list 3 (list 4 (list 5 (list 6 7)))))))))))))))))) ç»ƒä¹  26 å‡å®šå·²å°† x å’Œ y å®šä¹‰ä¸ºå¦‚ä¸‹çš„ä¸¤ä¸ªè¡¨ï¼š
1 2 3 (define x (list 1 2 3)) (define y (list 4 5 6)) è§£é‡Šå™¨å¯¹äºä¸‹é¢å„ä¸ªè¡¨è¾¾å¼å°†æ‰“å°å‡ºä»€ä¹ˆç»“æœï¼š
1 2 3 4 5 (append x y) (cons x y) (list x y) 1 2 3 4 5 (1 2 3 4 5 6) ((1 2 3) 4 5 6) ((1 2 3) (4 5 6)) ç»ƒä¹  27 è¯·ä¿®æ”¹ ç»ƒä¹  18 ä¸­æ‰€åšçš„ reverse è¿‡ç¨‹ï¼Œå¾—åˆ°ä¸€ä¸ª deep-reverse è¿‡ç¨‹ã€‚å®ƒä»¥ä¸€ä¸ªè¡¨ä¸ºå‚æ•°ï¼Œè¿”å›å¦ä¸€ä¸ªè¡¨ä½œä¸ºå€¼ï¼Œç»“æœè¡¨ä¸­çš„å…ƒç´ åè¿‡æ¥ï¼Œå…¶ä¸­çš„å­æ ‘ä¹Ÿåè½¬ã€‚ä¾‹å¦‚ï¼š
1 2 3 4 5 6 7 8 9 10 (define x (list 1 2) (list 3 4)) x ((1 2) (3 4)) (reverse x) ((3 4) (1 2)) (deep-reverse x) ((4 3) (2 1)) 1 2 3 4 5 6 7 8 9 10 11 12 #lang sicp (define (deep-reverse l) (define (iter lst r) (cond ((null? lst) r) ((pair? (car lst)) (iter (cdr lst) (cons (iter (car lst) nil) r))) (else (iter (cdr lst) (cons (car lst) r))))) (iter l nil)) (define x (list (list 1 2) (list 3 4))) (deep-reverse x) ç»ƒä¹  28 å†™ä¸€ä¸ªè¿‡ç¨‹ fringeï¼Œå®ƒä»¥ä¸€ä¸ªæ ‘ï¼ˆè¡¨ç¤ºä¸ºè¡¨ï¼‰ä¸ºå‚æ•°ï¼Œè¿”å›ä¸€ä¸ªè¡¨ï¼Œè¡¨ä¸­çš„å…ƒç´ æ˜¯è¿™æ£µæ ‘çš„æ‰€æœ‰æ ‘å¶ï¼ŒæŒ‰ç…§ä»å·¦åˆ°å³çš„é¡ºåºã€‚ä¾‹å¦‚ï¼š
1 2 3 4 5 6 7 (define x (list (list 1 2) (list 3 4))) (fringe x) (1 2 3 4) (fringe (list x x)) (1 2 3 4 1 2 3 4) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 #lang sicp (define (fringe l) (define (iter lst r) (cond ((null? lst) r) ((pair? (car lst)) (append (iter (car lst) nil) (iter (cdr lst) r))) (else (iter (cdr lst) (append r (list (car lst))))))) (iter l nil)) ;&gt;&gt;&gt; (define x (list (list 1 2) (list 3 4))) ;&gt;&gt;&gt; (fringe x) ;: (1 2 3 4) ;&gt;&gt;&gt; (fringe (list x x)) ;: (1 2 3 4 1 2 3 4) ç»ƒä¹  29 ä¸€ä¸ªäºŒå‰æ´»åŠ¨ä½“ç”±ä¸¤ä¸ªåˆ†æ”¯ç»„æˆï¼Œä¸€ä¸ªæ˜¯å·¦åˆ†æ”¯ï¼Œå¦ä¸€ä¸ªæ˜¯å³åˆ†æ”¯ï¼Œæ¯ä¸ªåˆ†æ”¯æ˜¯ä¸€ä¸ªå…·æœ‰ç¡®å®šé•¿åº¦çš„æ†ï¼Œä¸Šé¢æˆ–è€…åŠç€ä¸€ä¸ªé‡é‡ï¼Œæˆ–è€…åŠç€å¦ä¸€ä¸ªäºŒå‰æ´»åŠ¨ä½“ã€‚æˆ‘ä»¬å¯ä»¥ç”¨å¤åˆæ•°æ®å¯¹è±¡è¡¨ç¤ºè¿™ç§äºŒå‰æ´»åŠ¨ä½“ï¼Œå°†å®ƒé€šè¿‡å…¶ä¸¤ä¸ªåˆ†æ”¯æ„é€ èµ·æ¥ï¼ˆä¾‹å¦‚ï¼Œä½¿ç”¨ listï¼‰ï¼š
1 2 (define (make-mobile left right) (list left right)) åˆ†æ”¯å¯ä»¥ä»ä¸€ä¸ª lengthï¼ˆå®ƒåº”è¯¥æ˜¯ä¸€ä¸ªæ•°ï¼‰å†åŠ ä¸Šä¸€ä¸ª structure æ„é€ å‡ºæ¥ï¼Œè¿™ä¸ª structure æˆ–è€…æ˜¯ä¸€ä¸ªæ•°ï¼ˆè¡¨ç¤ºä¸€ä¸ªç®€å•é‡é‡ï¼‰ï¼Œæˆ–è€…æ˜¯å¦ä¸€ä¸ªæ´»åŠ¨ä½“ï¼š
1 2 (define (make-branch length structure) (list length structure)) a) è¯·å†™å‡ºç›¸åº”çš„é€‰æ‹©å‡½æ•° left-branch å’Œ right-branchï¼Œå®ƒä»¬åˆ†åˆ«è¿”å›æ´»åŠ¨ä½“çš„ä¸¤ä¸ªåˆ†æ”¯ã€‚è¿˜æœ‰ branch-length å’Œ branch-structureï¼Œå®ƒä»¬è¿”å›ä¸€ä¸ªåˆ†æ”¯ä¸Šçš„æˆåˆ†ã€‚
b) ç”¨ä½ çš„é€‰æ‹©å‡½æ•°å®šä¹‰è¿‡ç¨‹ total-weightï¼Œå®ƒè¿”å›ä¸€ä¸ªæ´»åŠ¨ä½“çš„æ€»é‡é‡ã€‚
c) ä¸€ä¸ªæ´»åŠ¨ä½“ç§°ä¸ºæ˜¯å¹³è¡¡çš„ï¼Œå¦‚æœå…¶å·¦åˆ†æ”¯çš„åŠ›çŸ©ç­‰äºå…¶å³åˆ†æ”¯çš„åŠ›çŸ©ï¼ˆä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœå…¶å·¦æ†çš„é•¿åº¦ä¹˜ä»¥åŠåœ¨æ†ä¸Šçš„é‡é‡ï¼Œç­‰äºè¿™ä¸ªæ´»åŠ¨ä½“å³è¾¹çš„åŒæ ·ä¹˜ç§¯ï¼‰ï¼Œè€Œä¸”åœ¨å…¶æ¯ä¸ªåˆ†æ”¯ä¸ŠåŠç€çš„å­æ´»åŠ¨ä½“ä¹Ÿéƒ½å¹³è¡¡ã€‚è¯·è®¾è®¡ä¸€ä¸ªè¿‡ç¨‹ï¼Œå®ƒèƒ½æ£€æŸ¥ä¸€ä¸ªæ´»åŠ¨ä½“æ˜¯å¦å¹³è¡¡ã€‚
d) å‡å®šæˆ‘ä»¬æ”¹å˜æ´»åŠ¨ä½“çš„è¡¨ç¤ºï¼Œé‡‡ç”¨ä¸‹é¢æ„é€ æ–¹å¼ï¼š
1 2 3 4 5 (define (make-mobile left right) (cons left right)) (define (make-branch length structure) (cons length structure)) ä½ éœ€è¦å¯¹è‡ªå·±çš„ç¨‹åºåšå¤šå°‘ä¿®æ”¹ï¼Œæ‰èƒ½å°†å®ƒæ”¹ä¸ºä½¿ç”¨è¿™ç§æ–°è¡¨ç¤ºï¼Ÿ
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 #lang sicp (define (make-mobile left right) (list left right)) (define (make-branch length structure) (list length structure)) (define (left-branch m) (car m)) (define (right-branch m) (car (cdr m))) (define (branch-length b) (car b)) (define (branch-structure b) (car (cdr b))) (define (total-weight m) (if (pair? m) (+ (total-weight (branch-structure (left-branch m))) (total-weight (branch-structure (right-branch m)))) m)) (define (mobile-balance? m) (if (not (pair? m)) #t (let ((lb (left-branch m)) (rb (right-branch m))) (and (mobile-balance? (branch-structure lb)) (mobile-balance? (branch-structure rb)) (= (* (branch-length lb) (total-weight (branch-structure lb))) (* (branch-length rb) (total-weight (branch-structure rb)))))))) ;&gt;&gt;&gt; (define m (make-mobile ;&gt;&gt;&gt; (make-branch 30 10) ;&gt;&gt;&gt; (make-branch 10 (make-mobile (make-branch 10 20) ;&gt;&gt;&gt; (make-branch 20 10))))) ;&gt;&gt;&gt; (total-weight m) ;: 40 ;&gt;&gt;&gt; (mobile-balance? m) ;: #t ;&gt;&gt;&gt; (define m2 (make-mobile ;&gt;&gt;&gt; (make-branch 20 (make-mobile (make-branch 20 10) ;&gt;&gt;&gt; (make-branch 10 30))) ;&gt;&gt;&gt; (make-branch 10 (make-mobile (make-branch 10 20) ;&gt;&gt;&gt; (make-branch 20 10))))) ;&gt;&gt;&gt; (total-weight m2) ;: 70 ;&gt;&gt;&gt; (mobile-balance? m2) ;: #f 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 #lang sicp (define (make-mobile left right) (cons left right)) (define (make-branch length structure) (cons length structure)) (define (left-branch m) (car m)) (define (right-branch m) (cdr m)) (define (branch-length b) (car b)) (define (branch-structure b) (cdr b)) ç»ƒä¹  30 è¯·å®šä¹‰ä¸€ä¸ªä¸ ç»ƒä¹  21 ä¸­ square-list è¿‡ç¨‹ç±»ä¼¼çš„ square-tree è¿‡ç¨‹ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒåº”è¯¥å…·æœ‰ä¸‹é¢çš„è¡Œä¸ºï¼š
1 2 3 4 5 (square-tree (list 1 (list 2 (list 3 4) 5) (list 6 7))) (1 (4 (9 16) 25) (36 49)) è¯·ä»¥ä¸¤ç§æ–¹å¼å®šä¹‰ square-treeï¼Œç›´æ¥å®šä¹‰ï¼ˆå³ä¸ä½¿ç”¨ä»»ä½•é«˜é˜¶å‡½æ•°ï¼‰ï¼Œä»¥åŠä½¿ç”¨ map å’Œé€’å½’å®šä¹‰ã€‚
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 #lang sicp (define (square-tree tree) (cond ((null? tree) nil) ((not (pair? tree)) (* tree tree)) (else (cons (square-tree (car tree)) (square-tree (cdr tree)))))) (define (square-tree2 tree) (map (lambda (sub-tree) (if (not (pair? sub-tree)) (* sub-tree sub-tree) (square-tree2 sub-tree))) tree)) ;&gt;&gt;&gt; (square-tree ;&gt;&gt;&gt; (list 1 ;&gt;&gt;&gt; (list 2 (list 3 4) 5) ;&gt;&gt;&gt; (list 6 7))) ;: (1 (4 (9 16) 25) (36 49)) ;&gt;&gt;&gt; (square-tree2 ;&gt;&gt;&gt; (list 1 ;&gt;&gt;&gt; (list 2 (list 3 4) 5) ;&gt;&gt;&gt; (list 6 7))) ;: (1 (4 (9 16) 25) (36 49)) ç»ƒä¹  31 å°†ä½ åœ¨ ç»ƒä¹  30 åšå‡ºçš„è§£ç­”è¿›ä¸€æ­¥æŠ½è±¡ï¼Œåšå‡ºä¸€ä¸ªè¿‡ç¨‹ï¼Œä½¿å®ƒçš„æ€§è´¨ä¿è¯èƒ½ä»¥ä¸‹é¢å½¢å¼å®šä¹‰ square-treeï¼š
1 (define (square-tree tree) (tree-map square tree)) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 #lang sicp (define (tree-map proc tree) (map (lambda (sub-tree) (if (not (pair? sub-tree)) (proc sub-tree) (tree-map proc sub-tree))) tree)) (define (square x) (* x x)) (define (square-tree tree) (tree-map square tree)) ;&gt;&gt;&gt; (square-tree ;&gt;&gt;&gt; (list 1 ;&gt;&gt;&gt; (list 2 (list 3 4) 5) ;&gt;&gt;&gt; (list 6 7))) ;: (1 (4 (9 16) 25) (36 49)) ç»ƒä¹  32 æˆ‘ä»¬å¯ä»¥å°†ä¸€ä¸ªé›†åˆè¡¨ç¤ºä¸ºä¸€ä¸ªå…ƒç´ äº’ä¸ç›¸åŒçš„è¡¨ï¼Œå› æ­¤å°±å¯ä»¥å°†ä¸€ä¸ªé›†åˆçš„æ‰€æœ‰å­é›†è¡¨ç¤ºä¸ºè¡¨çš„è¡¨ã€‚ä¾‹å¦‚ï¼Œå‡å®šé›†åˆä¸º (1 2 3)ï¼Œå®ƒçš„æ‰€æœ‰å­é›†çš„é›†åˆå°±æ˜¯ (() (3) (2) (2 3) (1) (1 3) (1 2) (1 2 3))ã€‚è¯·å®Œæˆä¸‹é¢çš„è¿‡ç¨‹å®šä¹‰ï¼Œå®ƒç”Ÿæˆå‡ºä¸€ä¸ªé›†åˆçš„æ‰€æœ‰å­é›†çš„é›†åˆã€‚è¯·è§£é‡Šå®ƒä¸ºä»€ä¹ˆèƒ½å®Œæˆè¿™ä¸€å·¥ä½œã€‚
1 2 3 4 5 (define (subsets s) (if (null? s) (list nil) (let ((rest (subsets (cdr s)))) (append rest (map &lt;??&gt; rest))))) 1 2 3 4 5 6 7 8 9 10 11 12 #lang sicp (define (subsets s) (if (null? s) (list nil) (let ((rest (subsets (cdr s)))) (append rest (map (lambda (e) (cons (car s) e)) rest))))) ;&gt;&gt;&gt; (subsets (list 1 2 3)) ;: (() (3) (2) (2 3) (1) (1 3) (1 2) (1 2 3)) é¦–å…ˆï¼Œrest è¡¨ç¤ºé›†åˆ s ä¸å« (car s) çš„æ‰€æœ‰å­é›†ï¼Œè€Œå« (car s) çš„å­é›†åˆšå¥½æ˜¯ rest ä¸­æ¯ä¸ªé›†åˆæ·»åŠ å…ƒç´  (car s)ï¼Œå°†äºŒè€…æ‹¼æ¥ï¼Œä¾¿å¾—åˆ° s çš„æ‰€æœ‰å­é›†ã€‚
ç»ƒä¹  33 è¯·å¡«å……ä¸‹é¢ç¼ºå¤±çš„è¡¨è¾¾å¼ï¼Œå®Œæˆå°†ä¸€äº›åŸºæœ¬çš„è¡¨æ“ä½œçœ‹ä½œç´¯ç§¯çš„å®šä¹‰ï¼š
1 2 3 4 5 6 7 8 (define (map p sequence) (accumulate (lambda (x y) &lt;??&gt;) nil sequence)) (define (append seq1 seq2) (accumulate cons &lt;??&gt; &lt;??&gt;)) (define (length sequence) (accumulate &lt;??&gt; 0 sequence)) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 #lang sicp (define (accumulate op initial sequence) (if (null? sequence) initial (op (car sequence) (accumulate op initial (cdr sequence))))) (define (map p sequence) (accumulate (lambda (x y) (cons (p x) y)) nil sequence)) (define (append seq1 seq2) (accumulate cons seq2 seq1)) (define (length sequence) (accumulate (lambda (x y) (+ 1 y)) 0 sequence)) ;&gt;&gt;&gt; (map (lambda (x) (+ 1 x)) (list 1 2 3)) ;: (2 3 4) ;&gt;&gt;&gt; (append (list 1 2 3) (list 4 5 6)) ;: (1 2 3 4 5 6) ;&gt;&gt;&gt; (length (list 1 2 3)) ;: 3 ç»ƒä¹  34 å¯¹äº $x$ çš„æŸä¸ªç»™å®šå€¼ï¼Œæ±‚å‡ºä¸€ä¸ªå¤šé¡¹å¼åœ¨ $x$ çš„å€¼ï¼Œä¹Ÿå¯ä»¥å½¢å¼åŒ–ä¸ºä¸€ç§ç´¯ç§¯ã€‚å‡å®šéœ€è¦æ±‚ä¸‹é¢å¤šé¡¹å¼çš„å€¼ï¼š
$$ a_nx^n + a_{n-1}x^{n-1} + \cdots + a_1x + a_0 $$
é‡‡ç”¨è‘—åçš„ Horner è§„åˆ™ï¼Œå¯ä»¥æ„é€ å‡ºä¸‹é¢çš„è®¡ç®—ï¼š
$$ (\cdots (a_nx + a_{n-1})x + \cdots + a_1)x + a_0 $$
æ¢å¥è¯è¯´ï¼Œæˆ‘ä»¬å¯ä»¥ä» $a_n$ å¼€å§‹ï¼Œä¹˜ä»¥ $x$ï¼Œå†åŠ ä¸Š $a_{n-1}$ï¼Œä¹˜ä»¥ $x$ï¼Œå¦‚æ­¤ä¸‹å»ï¼ŒçŸ¥é“å¤„ç†å®Œ $a_0$ã€‚è¯·å¡«å……ä¸‹é¢çš„æ¨¡æ¿ï¼Œåšå‡ºä¸€ä¸ªåˆ©ç”¨ Horner è§„åˆ™æ±‚å¤šé¡¹å¼å€¼çš„è¿‡ç¨‹ã€‚å‡å®šå¤šé¡¹å¼çš„ç³»æ•°å®‰æ’åœ¨ä¸€ä¸ªåºåˆ—é‡Œï¼Œä» $a_0$ ç›´è‡³ $a_n$ã€‚
1 2 3 4 (define (horner-eval x coefficient-sequence) (accumulate (lambda (this-coeff higher-terms) &lt;??&gt;) 0 coefficient-sequence)) ä¾‹å¦‚ï¼Œä¸ºäº†è®¡ç®— $1 + 3x + 5x^3 + x^5$ åœ¨ $x = 2$ çš„å€¼ï¼Œä½ éœ€è¦æ±‚å€¼ï¼š
1 (horner-eval 2 (list 1 3 0 5 0 1)) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 #lang sicp (define (accumulate op initial sequence) (if (null? sequence) initial (op (car sequence) (accumulate op initial (cdr sequence))))) (define (horner-eval x coefficient-sequence) (accumulate (lambda (this-coeff higher-terms) (+ this-coeff (* x higher-terms))) 0 coefficient-sequence)) ;&gt;&gt;&gt; (horner-eval 2 (list 1 3 0 5 0 1)) ;: 79 ç»ƒä¹  35 å°† 2.2.2 èŠ‚çš„ count-leaves é‡æ–°å®šä¹‰ä¸ºä¸€ä¸ªç´¯ç§¯ï¼š
1 2 (define (count-leaves t) (accumulate &lt;??&gt; &lt;??&gt; (map &lt;??&gt; &lt;??&gt;))) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 #lang sicp (define (accumulate op initial sequence) (if (null? sequence) initial (op (car sequence) (accumulate op initial (cdr sequence))))) (define (count-leaves t) (accumulate (lambda (x y) (+ x y)) 0 (map (lambda (s) (if (pair? s) (count-leaves s) 1)) t))) (count-leaves (list 1 (list 2 (list 3 4)))) ç»ƒä¹  36 è¿‡ç¨‹ accumulate-n ä¸ accumulate ç±»ä¼¼ï¼Œé™¤äº†å®ƒçš„ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªåºåˆ—çš„åºåˆ—ï¼Œå‡å®šå…¶ä¸­æ¯ä¸ªåºåˆ—çš„å…ƒç´ ä¸ªæ•°ç›¸åŒã€‚å®ƒç”¨æŒ‡å®šçš„ç´¯ç§¯è¿‡ç¨‹å»ç»„åˆèµ·æ‰€æœ‰åºåˆ—çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œè€Œåæ˜¯æ‰€æœ‰åºåˆ—çš„ç¬¬äºŒä¸ªå…ƒç´ ï¼Œå¹¶å¦‚æ­¤åšä¸‹å»ï¼Œè¿”å›å¾—åˆ°çš„æ‰€æœ‰ç»“æœçš„åºåˆ—ã€‚ä¾‹å¦‚ï¼Œå¦‚æœ s æ˜¯åŒ…å«ç€ 4 ä¸ªåºåˆ—çš„åºåˆ— ((1 2 3) (4 5 6) (7 8 9) (10 11 12))ï¼Œé‚£ä¹ˆ (accumulate-n + 0 s) çš„å€¼å°±åº”è¯¥æ˜¯åºåˆ— (22 26 30)ã€‚è¯·å¡«å……ä¸‹é¢ accumulate-n å®šä¹‰ä¸­æ‰€ç¼ºå¤±çš„è¡¨è¾¾å¼ï¼š
1 2 3 4 5 (define (accumulate-n op init seqs) (if (null? (car seqs)) nil (cons (accumulate op init &lt;??&gt;) (accumulate-n op init &lt;??&gt;)))) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 #lang sicp (define (accumulate op initial sequence) (if (null? sequence) initial (op (car sequence) (accumulate op initial (cdr sequence))))) (define (accumulate-n op init seqs) (if (null? (car seqs)) nil (cons (accumulate op init (map (lambda (s) (car s)) seqs)) (accumulate-n op init (map (lambda (s) (cdr s)) seqs))))) ;&gt;&gt;&gt; (define s (list (list 1 2 3) (list 4 5 6) (list 7 8 9) (list 10 11 12))) ;&gt;&gt;&gt; (accumulate-n + 0 s) ;: (22 26 30) ç»ƒä¹  37 å‡å®šæˆ‘ä»¬å°†å‘é‡ $v = (v_i)$ è¡¨ç¤ºä¸ºæ•°çš„åºåˆ—ï¼Œå°†çŸ©é˜µ $m = (m_{ij})$ è¡¨ç¤ºä¸ºå‘é‡ï¼ˆçŸ©é˜µè¡Œï¼‰çš„åºåˆ—ã€‚ä¾‹å¦‚ï¼ŒçŸ©é˜µï¼š
$$ \begin{bmatrix} 1 &amp; 2 &amp; 3 &amp; 4 \\ 4 &amp; 5 &amp; 6 &amp; 6 \\ 6 &amp; 7 &amp; 8 &amp; 9 \end{bmatrix} $$
ç”¨åºåˆ— ((1 2 3 4) (4 5 6 6) (6 7 8 9)) è¡¨ç¤ºã€‚å¯¹äºè¿™ç§è¡¨ç¤ºï¼Œæˆ‘ä»¬å¯ä»¥ç”¨åºåˆ—æ“ä½œç®€æ´åœ°è¡¨è¾¾åŸºæœ¬çš„çŸ©é˜µä¸å‘é‡è¿ç®—ã€‚è¿™äº›è¿ç®—ï¼ˆä»»ä½•æœ‰å…³çŸ©é˜µä»£æ•°çš„ä¹¦é‡Œéƒ½æœ‰æè¿°ï¼‰å¦‚ä¸‹ï¼š
(dot-product v w) | è¿”å›å’Œ $\sum_i v_i w_i$;
(matrix-*-vector m v) | è¿”å›å‘é‡ $t$ï¼Œå…¶ä¸­ $t_i = \sum_j m_{ij} v_j$;
(matrix-*-matrix m n) | è¿”å›çŸ©é˜µ $p$ï¼Œå…¶ä¸­ $p_{ij} = \sum_k m_{ik} n_{kj}$;
(transpose m) | è¿”å›çŸ©é˜µ $n$ï¼Œå…¶ä¸­ $n_{ij} = m_{ji}$;
æˆ‘ä»¬å¯ä»¥å°†ç‚¹ç§¯ï¼ˆdot productï¼‰å®šä¹‰ä¸ºï¼š
1 2 (define (dot-product v w) (accumulate + 0 (map * v w))) è¯·å¡«å……ä¸‹é¢è¿‡ç¨‹é‡Œç¼ºå¤±çš„è¡¨è¾¾å¼ï¼Œå®ƒä»¬è®¡ç®—å‡ºå…¶ä»–çš„çŸ©é˜µè¿ç®—ç»“æœï¼ˆè¿‡ç¨‹ accumulate-n åœ¨ ç»ƒä¹  36 ä¸­å®šä¹‰ï¼‰ã€‚
1 2 3 4 5 6 7 8 9 (define (matrix-*-vector m v) (map &lt;??&gt; m)) (define (transpose mat) (accumulate-n &lt;??&gt; &lt;??&gt; mat)) (define (matrix-*-matrix m n) (let ((cols (transpose n))) (map &lt;??&gt; m))) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 #lang sicp (define (accumulate op initial sequence) (if (null? sequence) initial (op (car sequence) (accumulate op initial (cdr sequence))))) (define (accumulate-n op init seqs) (if (null? (car seqs)) nil (cons (accumulate op init (map (lambda (s) (car s)) seqs)) (accumulate-n op init (map (lambda (s) (cdr s)) seqs))))) (define (dot-product v w) (accumulate + 0 (map * v w))) (define (matrix-*-vector m v) (map (lambda (row) (dot-product row v)) m)) (define (transpose mat) (accumulate-n cons nil mat)) (define (matrix-*-matrix m n) (let ((cols (transpose n))) (map (lambda (row) (matrix-*-vector cols row)) m))) ;&gt;&gt;&gt; (define v (list 1 2 3 4)) ;&gt;&gt;&gt; (define w (list 5 6 7 8)) ;&gt;&gt;&gt; (define m (list (list 1 2 3 4) (list 4 5 6 6) (list 6 7 8 9))) ;&gt;&gt;&gt; (dot-product v w) ;: 70 ;&gt;&gt;&gt; (matrix-*-vector m v) ;: (30 56 80) ;&gt;&gt;&gt; (matrix-*-matrix m (transpose m)) ;: ((30 56 80) (56 113 161) (80 161 230)) ;&gt;&gt;&gt; (matrix-*-matrix (transpose m) m) ;: ((53 64 75 82) (64 78 92 101) (75 92 109 120) (82 101 120 133)) ç»ƒä¹  38 è¿‡ç¨‹ accumulate ä¹Ÿç§°ä¸º fold-rightï¼Œå› ä¸ºå®ƒå°†åºåˆ—çš„ç¬¬ä¸€ä¸ªå…ƒç´ ç»„åˆåˆ°å³è¾¹æ‰€æœ‰å…ƒç´ çš„ç»„åˆç»“æœä¸Šã€‚ä¹Ÿæœ‰ä¸€ä¸ª fold-leftï¼Œå®ƒä¸ fold-right ç±»ä¼¼ï¼Œä½†å´æ˜¯æŒ‰ç…§ç›¸åæ–¹å‘å»æ“ä½œå„ä¸ªå…ƒç´ ï¼š
1 2 3 4 5 6 7 (define (fold-left op initial sequence) (define (iter result rest) (if (null? rest) result (iter (op result (car rest)) (cdr rest)))) (iter initial sequence)) ä¸‹é¢è¡¨è¾¾å¼çš„å€¼æ˜¯ä»€ä¹ˆï¼Ÿ
1 2 3 4 5 6 7 (fold-right / 1 (list 1 2 3)) (fold-left / 1 (list 1 2 3)) (fold-right list nil (list 1 2 3)) (fold-left list nil (list 1 2 3)) å¦‚æœè¦æ±‚ç”¨æŸä¸ª op æ—¶ä¿è¯ fold-right å’Œ fold-left å¯¹ä»»ä½•åºåˆ—éƒ½äº§ç”ŸåŒæ ·çš„ç»“æœï¼Œè¯·ç»™å‡º op åº”è¯¥æ»¡è¶³çš„æ€§è´¨ã€‚
1 2 3 4 5 6 7 3/2 1/6 (3 (2 (1 ()))) (((() 1) 2) 3) è¦æ±‚ç”¨æŸä¸ª op æ—¶ä¿è¯ fold-right å’Œ fold-left å¯¹ä»»ä½•åºåˆ—éƒ½äº§ç”ŸåŒæ ·çš„ç»“æœçš„è¯ï¼Œop åº”æ»¡è¶³äº¤æ¢å¾‹ï¼Œå³ (op a b) = (op b a)ã€‚
ç»ƒä¹  39 åŸºäº ç»ƒä¹  38 çš„ fold-right å’Œ fold-left å®Œæˆ reverse ï¼ˆ ç»ƒä¹  18 ï¼‰ä¸‹é¢çš„å®šä¹‰ï¼š
1 2 3 4 5 (define (reverse sequence) (fold-right (lambda (x y) &lt;??&gt;) nil sequence)) (define (reverse sequence) (fold-left (lambda (x y) &lt;??&gt;) nil sequence)) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 #lang sicp (define (fold-left op initial sequence) (define (iter result rest) (if (null? rest) result (iter (op result (car rest)) (cdr rest)))) (iter initial sequence)) (define (fold-right op initial sequence) (define (iter result rest) (if (null? rest) result (iter (op (car rest) result) (cdr rest)))) (iter initial sequence)) (define (reverse sequence) (fold-right (lambda (x y) (cons x y)) nil sequence)) (define (reverse2 sequence) (fold-left (lambda (x y) (cons y x)) nil sequence)) ;&gt;&gt;&gt; (reverse (list 1 2 3 4)) ;: (4 3 2 1) ;&gt;&gt;&gt; (reverse2 (list 1 2 3 4)) ;: (4 3 2 1) ç»ƒä¹  40 è¯·å®šä¹‰è¿‡ç¨‹ unique-pairsï¼Œç»™å®ƒæ•´æ•° $n$ï¼Œå®ƒäº§ç”Ÿå‡ºåºåˆ— $(i, j)$ï¼Œå…¶ä¸­ $1 \le j \lt i \le n$ã€‚è¯·ç”¨ unique-pairs å»ç®€åŒ–ä¸Šé¢ prime-sum-pairs çš„å®šä¹‰ã€‚
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 #lang sicp (define (filter predicate sequence) (cond ((null? sequence) nil) ((predicate (car sequence)) (cons (car sequence) (filter predicate (cdr sequence)))) (else (filter predicate (cdr sequence))))) (define (enumerate-interval m n) (if (&gt; m n) nil (cons m (enumerate-interval (+ 1 m) n)))) (define (unique-pairs n) (if (&lt;= n 1) nil (append (map (lambda (j) (list n j)) (enumerate-interval 1 (- n 1))) (unique-pairs (- n 1))))) (define (prime? n) (define (smallest-divisor n) (find-divisor n 2)) (define (find-divisor n test-divisor) (cond ((&gt; (square test-divisor) n) n) ((divides? test-divisor n) test-divisor) (else (find-divisor n (+ test-divisor 1))))) (define (square x) (* x x)) (define (divides? a b) (= (remainder b a) 0)) (= (smallest-divisor n) n)) (define (prime-sum-pairs n) (filter (lambda (p) (prime? (+ (car p) (cadr p)))) (unique-pairs n))) ;&gt;&gt;&gt; (prime-sum-pairs 6) ;: ((6 1) (6 5) (5 2) (4 1) (4 3) (3 2) (2 1)) ç»ƒä¹  41 è¯·å†™å‡ºä¸€ä¸ªè¿‡ç¨‹ï¼Œå®ƒèƒ½äº§ç”Ÿå‡ºæ‰€æœ‰å°äºç­‰äºç»™å®šæ•´æ•° $n$ çš„æ­£çš„ç›¸å¼‚æ•´æ•° $i$ã€$j$ å’Œ $k$ çš„æœ‰åºä¸‰å…ƒç»„ï¼Œä½¿æ¯ä¸ªä¸‰å…ƒç»„çš„ä¸‰ä¸ªå…ƒç´ ä¹‹å’Œç­‰äºç»™å®šçš„æ•´æ•° $s$ã€‚
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 #lang sicp (define (filter predicate sequence) (cond ((null? sequence) nil) ((predicate (car sequence)) (cons (car sequence) (filter predicate (cdr sequence)))) (else (filter predicate (cdr sequence))))) (define (accumulate op initial sequence) (if (null? sequence) initial (op (car sequence) (accumulate op initial (cdr sequence))))) (define (flatmap proc seq) (accumulate append nil (map proc seq))) (define (enumerate-interval m n) (if (&gt; m n) nil (cons m (enumerate-interval (+ 1 m) n)))) (define (unique-triples n) (if (&lt;= n 2) nil (append (flatmap (lambda (j) (map (lambda (k) (list n j k)) (enumerate-interval 1 (- j 1)))) (enumerate-interval 2 (- n 1))) (unique-triples (- n 1))))) (define (permute-triples seqs) (flatmap (lambda (seq) (let ((a (car seq)) (b (cadr seq)) (c (caddr seq))) (list (list a b c) (list a c b) (list b c a) (list b a c) (list c a b) (list c b a)))) seqs)) (define (triple-sum n s) (permute-triples (filter (lambda (triple) (= s (+ (car triple) (cadr triple) (caddr triple)))) (unique-triples n)))) ;&gt;&gt;&gt; (triple-sum 10 7) ;: ((4 2 1) (4 1 2) (2 1 4) (2 4 1) (1 4 2) (1 2 4)) ;&gt;&gt;&gt; (triple-sum 10 9) ;: ((6 2 1) (6 1 2) (2 1 6) (2 6 1) (1 6 2) (1 2 6) (5 3 1) (5 1 3) (3 1 5) (3 5 1) (1 5 3) (1 3 5) (4 3 2) (4 2 3) (3 2 4) (3 4 2) (2 4 3) (2 3 4)) ç»ƒä¹  42 â€œå…«çš‡åè°œé¢˜â€é—®çš„æ˜¯æ€æ ·å°†å…«ä¸ªçš‡åæ‘†åœ¨å›½é™…è±¡æ£‹æ£‹ç›˜ä¸Šï¼Œä½¿å¾—ä»»æ„ä¸€ä¸ªçš‡åéƒ½ä¸èƒ½æ”»å‡»å¦ä¸€ä¸ªçš‡åï¼ˆä¹Ÿå°±æ˜¯è¯´ï¼Œä»»æ„ä¸¤ä¸ªçš‡åéƒ½ä¸åœ¨åŒä¸€è¡Œã€åŒä¸€åˆ—æˆ–è€…åŒä¸€å¯¹è§’çº¿ä¸Šï¼‰ã€‚ä¸€ä¸ªå¯èƒ½çš„è§£å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚è§£å†³è¿™ä¸€è°œé¢˜çš„ä¸€ç§æ–¹æ³•æŒ‰ä¸€ä¸ªæ–¹å‘å¤„ç†æ£‹ç›˜ï¼Œæ¯æ¬¡åœ¨æ¯ä¸€åˆ—é‡Œæ”¾ä¸€ä¸ªçš‡åï¼Œå¦‚æœç°åœ¨å·²ç»æ”¾å¥½äº† $k-1$ ä¸ªçš‡åï¼Œç¬¬ $k$ ä¸ªçš‡åå°±å¿…é¡»æ”¾åœ¨ä¸ä¼šè¢«å·²åœ¨æ£‹ç›˜ä¸Šçš„ä»»ä½•çš‡åæ”»å‡»çš„ä½ç½®ä¸Šã€‚æˆ‘ä»¬å¯ä»¥é€’å½’åœ°æè¿°è¿™ä¸€è¿‡ç¨‹ï¼šå‡å®šæˆ‘ä»¬å·²ç»ç”Ÿæˆäº†åœ¨æ£‹ç›˜çš„å‰ $k-1$ åˆ—ä¸­æ”¾ç½® $k-1$ ä¸ªçš‡åçš„æ‰€æœ‰å¯èƒ½æ–¹å¼ï¼Œç°åœ¨éœ€è¦çš„å°±æ˜¯å¯¹äºå…¶ä¸­çš„æ¯ç§æ–¹å¼ï¼Œç”Ÿæˆå‡ºå°†ä¸‹ä¸€ä¸ªçš‡åæ”¾åœ¨ç¬¬ $k$ åˆ—ä¸­æ¯ä¸€è¡Œçš„æ‰©å……é›†åˆã€‚è€Œåè¿‡æ»¤å®ƒä»¬ï¼Œåªç•™ä¸‹èƒ½ä½¿ä½äºç¬¬ $k$ åˆ—çš„çš‡åä¸å…¶ä»–çš‡åç›¸å®‰æ— äº‹çš„é‚£äº›æ‰©å……ã€‚è¿™æ ·å°±èƒ½äº§ç”Ÿå‡ºå°† $k$ ä¸ªçš‡åæ”¾ç½®åœ¨å‰ $k$ åˆ—çš„æ‰€æœ‰æ ¼å±€çš„åºåˆ—ã€‚ç»§ç»­è¿™ä¸€è¿‡ç¨‹ï¼Œæˆ‘ä»¬å°†èƒ½äº§ç”Ÿå‡ºè¿™ä¸€è°œé¢˜çš„æ‰€æœ‰è§£ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªè§£ã€‚
å°†è¿™ä¸€è§£æ³•å®ç°ä¸ºä¸€ä¸ªè¿‡ç¨‹ queensï¼Œä»¤å®ƒè¿”å›åœ¨ $n\times n$ æ£‹ç›˜ä¸Šæ”¾ $n$ ä¸ªçš‡åçš„æ‰€æœ‰è§£çš„åºåˆ—ã€‚queens å†…éƒ¨çš„è¿‡ç¨‹ queen-colsï¼Œè¿”å›åœ¨æ£‹ç›˜çš„å‰ $k$ åˆ—ä¸­æ”¾çš‡åçš„æ‰€æœ‰æ ¼å±€çš„åºåˆ—ã€‚
1 2 3 4 5 6 7 8 9 10 11 12 13 (define (queens board-size) (define (queen-cols k) (if (= k 0) (list empty-board) (filter (lambda (positions) (safe? k positions)) (flatmap (lambda (rest-of-queens) (map (lambda (new-row) (adjoin-position new-row k rest-of-queens)) (enumerate-interval 1 board-size))) (queen-cols (- k 1)))))) (queen-cols board-size)) è¿™ä¸ªè¿‡ç¨‹é‡Œçš„ rest-of-queens æ˜¯åœ¨å‰ $k-1$ åˆ—æ”¾ç½® $k-1$ ä¸ªçš‡åçš„ä¸€ç§æ–¹å¼ï¼Œnew-row æ˜¯åœ¨ç¬¬ $k$ åˆ—æ”¾ç½®æ‰€è€ƒè™‘çš„è¡Œç¼–å·ã€‚è¯·å®Œæˆè¿™ä¸€ç¨‹åºï¼Œä¸ºæ­¤éœ€è¦å®ç°ä¸€ç§æ£‹ç›˜æ ¼å±€é›†åˆçš„è¡¨ç¤ºæ–¹æ³•ï¼›è¿˜è¦å®ç°è¿‡ç¨‹ adjoin-positionï¼Œå®ƒå°†ä¸€ä¸ªæ–°çš„è¡Œåˆ—æ ¼å±€åŠ å…¥ä¸€ä¸ªæ ¼å±€é›†åˆä¸­ï¼Œåœ¨ç¬¬ $k$ åˆ—çš„çš‡åç›¸å¯¹äºå…¶ä»–åˆ—çš„çš‡åæ˜¯å¦ä¸ºå®‰å…¨çš„ï¼ˆè¯·æ³¨æ„ï¼Œæˆ‘ä»¬åªéœ€æ£€æŸ¥æ–°çš‡åæ˜¯å¦å®‰å…¨ &mdash; å…¶ä»–çš‡åå·²ç»ä¿è¯ç›¸å®‰æ— äº‹äº†ï¼‰ã€‚
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 #lang sicp (define (reverse sequence) (if (null? sequence) nil (append (reverse (cdr sequence)) (list (car sequence))))) (define (filter predicate sequence) (cond ((null? sequence) nil) ((predicate (car sequence)) (cons (car sequence) (filter predicate (cdr sequence)))) (else (filter predicate (cdr sequence))))) (define (accumulate op initial sequence) (if (null? sequence) initial (op (car sequence) (accumulate op initial (cdr sequence))))) (define (flatmap proc seq) (accumulate append nil (map proc seq))) (define (enumerate-interval m n) (if (&gt; m n) nil (cons m (enumerate-interval (+ 1 m) n)))) (define empty-board nil) (define (adjoin-position new-row k rest-of-queens) (cons new-row rest-of-queens)) (define (safe? k positions) (let ((row (car positions)) (sum-row-col (+ (car positions) k)) (diff-row-col (- (car positions) k))) (accumulate (lambda (a b) (and a b)) #t (map (lambda (pos col) (and (not (= row pos)) (not (= sum-row-col (+ pos col))) (not (= diff-row-col (- pos col))))) (cdr positions) (reverse (enumerate-interval 1 (- k 1))))))) (define (queens board-size) (define (queen-cols k) (if (= k 0) (list empty-board) (filter (lambda (positions) (safe? k positions)) (flatmap (lambda (rest-of-queens) (map (lambda (new-row) (adjoin-position new-row k rest-of-queens)) (enumerate-interval 1 board-size))) (queen-cols (- k 1)))))) (queen-cols board-size)) ;&gt;&gt;&gt; (queens 8) ;: ((4 2 7 3 6 8 5 1) ;: (5 2 4 7 3 8 6 1) ;: (3 5 2 8 6 4 7 1) ;: (3 6 4 2 8 5 7 1) ;: (5 7 1 3 8 6 4 2) ;: (4 6 8 3 1 7 5 2) ;: (3 6 8 1 4 7 5 2) ;: (5 3 8 4 7 1 6 2) ;: (5 7 4 1 3 8 6 2) ;: (4 1 5 8 6 3 7 2) ;: (3 6 4 1 8 5 7 2) ;: (4 7 5 3 1 6 8 2) ;: (6 4 2 8 5 7 1 3) ;: (6 4 7 1 8 2 5 3) ;: (1 7 4 6 8 2 5 3) ;: (6 8 2 4 1 7 5 3) ;: (6 2 7 1 4 8 5 3) ;: (4 7 1 8 5 2 6 3) ;: (5 8 4 1 7 2 6 3) ;: (4 8 1 5 7 2 6 3) ;: (2 7 5 8 1 4 6 3) ;: (1 7 5 8 2 4 6 3) ;: (2 5 7 4 1 8 6 3) ;: (4 2 7 5 1 8 6 3) ;: (5 7 1 4 2 8 6 3) ;: (6 4 1 5 8 2 7 3) ;: (5 1 4 6 8 2 7 3) ;: (5 2 6 1 7 4 8 3) ;: (6 3 7 2 8 5 1 4) ;: (2 7 3 6 8 5 1 4) ;: (7 3 1 6 8 5 2 4) ;: (5 1 8 6 3 7 2 4) ;: (1 5 8 6 3 7 2 4) ;: (3 6 8 1 5 7 2 4) ;: (6 3 1 7 5 8 2 4) ;: (7 5 3 1 6 8 2 4) ;: (7 3 8 2 5 1 6 4) ;: (5 3 1 7 2 8 6 4) ;: (2 5 7 1 3 8 6 4) ;: (3 6 2 5 8 1 7 4) ;: (6 1 5 2 8 3 7 4) ;: (8 3 1 6 2 5 7 4) ;: (2 8 6 1 3 5 7 4) ;: (5 7 2 6 3 1 8 4) ;: (3 6 2 7 5 1 8 4) ;: (6 2 7 1 3 5 8 4) ;: (3 7 2 8 6 4 1 5) ;: (6 3 7 2 4 8 1 5) ;: (4 2 7 3 6 8 1 5) ;: (7 1 3 8 6 4 2 5) ;: (1 6 8 3 7 4 2 5) ;: (3 8 4 7 1 6 2 5) ;: (6 3 7 4 1 8 2 5) ;: (7 4 2 8 6 1 3 5) ;: (4 6 8 2 7 1 3 5) ;: (2 6 1 7 4 8 3 5) ;: (2 4 6 8 3 1 7 5) ;: (3 6 8 2 4 1 7 5) ;: (6 3 1 8 4 2 7 5) ;: (8 4 1 3 6 2 7 5) ;: (4 8 1 3 6 2 7 5) ;: (2 6 8 3 1 4 7 5) ;: (7 2 6 3 1 4 8 5) ;: (3 6 2 7 1 4 8 5) ;: (4 7 3 8 2 5 1 6) ;: (4 8 5 3 1 7 2 6) ;: (3 5 8 4 1 7 2 6) ;: (4 2 8 5 7 1 3 6) ;: (5 7 2 4 8 1 3 6) ;: (7 4 2 5 8 1 3 6) ;: (8 2 4 1 7 5 3 6) ;: (7 2 4 1 8 5 3 6) ;: (5 1 8 4 2 7 3 6) ;: (4 1 5 8 2 7 3 6) ;: (5 2 8 1 4 7 3 6) ;: (3 7 2 8 5 1 4 6) ;: (3 1 7 5 8 2 4 6) ;: (8 2 5 3 1 7 4 6) ;: (3 5 2 8 1 7 4 6) ;: (3 5 7 1 4 2 8 6) ;: (5 2 4 6 8 3 1 7) ;: (6 3 5 8 1 4 2 7) ;: (5 8 4 1 3 6 2 7) ;: (4 2 5 8 6 1 3 7) ;: (4 6 1 5 2 8 3 7) ;: (6 3 1 8 5 2 4 7) ;: (5 3 1 6 8 2 4 7) ;: (4 2 8 6 1 3 5 7) ;: (6 3 5 7 1 4 2 8) ;: (6 4 7 1 3 5 2 8) ;: (4 7 5 2 6 1 3 8) ;: (5 7 2 6 3 1 4 8)) ç»ƒä¹  43 Louis Reasoner åœ¨åš ç»ƒä¹  42 æ—¶é‡åˆ°äº†éº»çƒ¦ï¼Œä»–çš„ queens è¿‡ç¨‹çœ‹èµ·æ¥èƒ½è¡Œï¼Œä½†å´è¿è¡Œå¾—ææ…¢ï¼ˆLouis å±…ç„¶æ— æ³•å¿è€åˆ°å®ƒè§£ $6\times 6$ æ£‹ç›˜çš„é—®é¢˜ï¼‰ã€‚å½“ Louis è¯· Eva Lu Ator å¸®å¿™æ—¶ï¼Œå¥¹æŒ‡å‡ºä»–åœ¨ flatmap é‡Œäº¤æ¢äº†åµŒå¥—æ˜ å°„çš„é¡ºåºï¼Œå°†å®ƒå†™æˆäº†ï¼š
1 2 3 4 5 6 (flatmap (lambda (new-row) (map (lambda (rest-of-queens) (adjoin-position new-row k rest-of-queens)) (queen-cols (- k 1)))) (enumerate-interval 1 board-size)) è¯·è§£é‡Šä¸€ä¸‹ï¼Œä¸ºä»€ä¹ˆè¿™æ ·äº¤æ¢é¡ºåºä¼šä½¿ç¨‹åºè¿è¡Œå¾—éå¸¸æ…¢ã€‚ä¼°è®¡ä¸€ä¸‹ï¼Œç”¨ Louis çš„ç¨‹åºå»è§£å†³å…«çš‡åé—®é¢˜å¤§çº¦éœ€è¦å¤šå°‘æ—¶é—´ï¼Œå‡å®š ç»ƒä¹  42 ä¸­çš„ç¨‹åºéœ€è¦æ—¶é—´ $T$ æ±‚è§£è¿™ä¸€éš¾é¢˜ã€‚
åµŒå¥—é¡ºåºè°ƒæ¢åï¼Œflatmap åœ¨æ˜ å°„ (enumerate-interval 1 board-size) çš„æ¯ä¸€ä¸ªå…ƒç´ æ—¶ï¼Œéƒ½è¦é‡å¤è®¡ç®— (queen-cols (- k 1))ï¼Œç”±äº board-size ä¸º 8ï¼Œæ‰€éœ€æ—¶é—´å¤§çº¦ä¸º $8T$ã€‚
ç»ƒä¹  44 è¯·å®šä¹‰å‡º corner-split é‡Œä½¿ç”¨çš„è¿‡ç¨‹ up-splitï¼Œå®ƒä¸ right-split ç±»ä¼¼ï¼Œé™¤åœ¨å…¶ä¸­äº¤æ¢äº† below å’Œ beside çš„è§’è‰²ä¹‹å¤–ã€‚
1 2 3 4 5 6 7 #lang sicp (define (up-split painter n) (if (= n 0) painter (let ((smaller (up-split painter (- n 1)))) (below painter (beside smaller smaller))))) ç»ƒä¹  45 å¯ä»¥å°† right-split å’Œ up-split è¡¨è¿°ä¸ºæŸç§å¹¿ä¹‰åˆ’åˆ†æ“ä½œçš„å®ä¾‹ã€‚è¯·å®šä¹‰ä¸€ä¸ªè¿‡ç¨‹ splitï¼Œä½¿å®ƒå…·æœ‰å¦‚ä¸‹æ€§è´¨ï¼Œæ±‚å€¼ï¼š
1 2 3 (define right-split (split beside below)) (define up-split (split below beside)) äº§ç”Ÿè¿‡ç¨‹ right-split å’Œ up-splitï¼Œå…¶è¡Œä¸ºä¸å‰é¢å®šä¹‰çš„è¿‡ç¨‹ä¸€æ ·ã€‚
1 2 3 4 5 6 7 8 9 #lang sicp (define (split orient1 orient2) (define (iter painter n) (if (= n 0) painter (let ((smaller (iter painter (- n 1)))) (orient1 painter (orient2 smaller smaller))))) iter) ç»ƒä¹  46 ä»åŸç‚¹å‡ºå‘çš„ä¸€ä¸ªä¸¤ç»´å‘é‡ $\bm{v}$ å¯ä»¥ç”¨ä¸€ä¸ªç”± $x$ åæ ‡å’Œ $y$ åæ ‡æ„æˆçš„åºåˆ—è¡¨ç¤ºã€‚è¯·ä¸ºè¿™æ ·çš„å‘é‡å®ç°ä¸€ä¸ªæ•°æ®æŠ½è±¡ï¼šç»™å‡ºä¸€ä¸ªæ„é€ å‡½æ•° make-vectï¼Œä»¥åŠå¯¹åº”çš„é€‰æ‹©å‡½æ•° xcor-vect å’Œ ycor-vectã€‚å€ŸåŠ©äºä½ ç»™å‡ºçš„æ„é€ å‡½æ•°å’Œé€‰æ‹©å‡½æ•°ï¼Œå®ç°è¿‡ç¨‹ add-vectã€sub-vect å’Œ scale-vectï¼Œå®ƒä»¬èƒ½å®Œæˆå‘é‡åŠ æ³•ã€å‘é‡å‡æ³•å’Œå‘é‡çš„ä¼¸ç¼©ã€‚
$$ (x_1, y_1) + (x_2, y_2) = (x_1 + x_2, y_1 + y_2) $$ $$ (x_1, y_1) - (x_2, y_2) = (x_1 - x_2, y_1 - y_2) $$ $$ s \cdot (x, y) = (sx, sy) $$
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 #lang sicp (define (make-vect x y) (cons x y)) (define (xcor-vect v) (car v)) (define (ycor-vect v) (cdr v)) (define (add-vect v1 v2) (make-vect (+ (xcor-vect v1) (xcor-vect v2)) (+ (ycor-vect v1) (ycor-vect v2)))) (define (sub-vect v1 v2) (make-vect (- (xcor-vect v1) (xcor-vect v2)) (- (ycor-vect v1) (ycor-vect v2)))) (define (scale-vect s v) (make-vect (* s (xcor-vect v)) (* s (ycor-vect v)))) ç»ƒä¹  47 ä¸‹é¢æ˜¯å®ç°æ¡†æ¶çš„ä¸¤ä¸ªå¯èƒ½çš„è¿‡ç¨‹å‡½æ•°ï¼š
1 2 3 4 5 (define (make-frame origin edge1 edge2) (list origin edge1 edge2)) (define (make-frame origin edge1 edge2) (cons (origin) (cons edge1 edge2))) è¯·ä¸ºæ¯ä¸ªæ„é€ å‡½æ•°æä¾›é€‚å½“çš„é€‰æ‹©å‡½æ•°ï¼Œä¸ºæ¡†æ¶åšå‡ºç›¸åº”çš„å®ç°ã€‚
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 #lang sicp (define (make-frame origin edge1 edge2) (list origin edge1 edge2)) (define (origin-frame frame) (car frame)) (define (edge1-frame frame) (cadr frame)) (define (edge2-frame frame) (caddr frame)) ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;; ; ; (define (make-frame origin edge1 edge2) ; (cons origin (cons edge1 edge2))) ; ; (define (origin-frame frame) ; (car frame)) ; ; (define (edge1-frame frame) ; (cadr frame)) ; ; (define (edge2-frame frame) ; (cddr frame)) ; ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;; ç»ƒä¹  48 å¹³é¢ä¸Šçš„ä¸€æ¡ç›´çº¿å¯ä»¥ç”¨ä¸€å¯¹å‘é‡è¡¨ç¤º &mdash; ä»åŸç‚¹åˆ°çº¿æ®µèµ·ç‚¹çš„å‘é‡ï¼Œä»¥åŠä»åŸç‚¹åˆ°çº¿æ®µç»ˆç‚¹çš„å‘é‡ã€‚è¯·ç”¨ä½ åœ¨ ç»ƒä¹  46 åšå‡ºçš„å‘é‡è¡¨ç¤ºå®šä¹‰ä¸€ç§çº¿æ®µè¡¨ç¤ºï¼Œå…¶ä¸­ç”¨æ„é€ å‡½æ•° make-segment ä»¥åŠé€‰æ‹©å‡½æ•° start-segment å’Œ end-segmentã€‚
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 #lang sicp (define (make-vect x y) (cons x y)) (define (xcor-vect v) (car v)) (define (ycor-vect v) (cdr v)) (define (make-segment v1 v2) (cons v1 v2)) (define (start-segment s) (car s)) (define (end-segment s) (cdr s)) ç»ƒä¹  49 åˆ©ç”¨ segments-&gt;painter å®šä¹‰ä¸‹é¢çš„åŸºæœ¬ç”»å®¶ï¼š
a) ç”»å‡ºç»™å®šæ¡†æ¶è¾¹ç•Œçš„ç”»å®¶ã€‚
b) é€šè¿‡è¿æ¥æ¡†æ¶ä¸¤å¯¹è§’ç”»å‡ºä¸€ä¸ªå¤§å‰å­çš„ç”»å®¶ã€‚
c) é€šè¿‡è¿æ¥æ¡†æ¶å„è¾¹çš„ä¸­ç‚¹ç”»å‡ºä¸€ä¸ªè±å½¢çš„ç”»å®¶ã€‚
d) ç”»å®¶ waveã€‚
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 #lang sicp (#%require sicp-pict) (define (edges-&gt;painter frame) ((segments-&gt;painter (list (make-segment (make-vect 0 0) (make-vect 1 0)) (make-segment (make-vect 1 0) (make-vect 1 1)) (make-segment (make-vect 1 1) (make-vect 0 1)) (make-segment (make-vect 0 1) (make-vect 0 0)))) frame)) (define (diags-&gt;painter frame) ((segments-&gt;painter (list (make-segment (make-vect 0 0) (make-vect 1 1)) (make-segment (make-vect 1 0) (make-vect 0 1)))) frame)) (define (midpoints-&gt;painter frame) ((segments-&gt;painter (list (make-segment (make-vect 0.5 0) (make-vect 1 0.5)) (make-segment (make-vect 1 0.5) (make-vect 0.5 1)) (make-segment (make-vect 0.5 1) (make-vect 0 0.5)) (make-segment (make-vect 0 0.5) (make-vect 0.5 0)))) frame)) (define (wave-&gt;painter frame) ((segments-&gt;painter (list (make-segment (make-vect 0.20 0.00) (make-vect 0.35 0.50)) (make-segment (make-vect 0.35 0.50) (make-vect 0.30 0.60)) (make-segment (make-vect 0.30 0.60) (make-vect 0.15 0.45)) (make-segment (make-vect 0.15 0.45) (make-vect 0.00 0.60)) (make-segment (make-vect 0.00 0.80) (make-vect 0.15 0.65)) (make-segment (make-vect 0.15 0.65) (make-vect 0.30 0.70)) (make-segment (make-vect 0.30 0.70) (make-vect 0.40 0.70)) (make-segment (make-vect 0.40 0.70) (make-vect 0.35 0.85)) (make-segment (make-vect 0.35 0.85) (make-vect 0.40 1.00)) (make-segment (make-vect 0.60 1.00) (make-vect 0.65 0.85)) (make-segment (make-vect 0.65 0.85) (make-vect 0.60 0.70)) (make-segment (make-vect 0.60 0.70) (make-vect 0.75 0.70)) (make-segment (make-vect 0.75 0.70) (make-vect 1.00 0.40)) (make-segment (make-vect 1.00 0.20) (make-vect 0.60 0.48)) (make-segment (make-vect 0.60 0.48) (make-vect 0.80 0.00)) (make-segment (make-vect 0.40 0.00) (make-vect 0.50 0.30)) (make-segment (make-vect 0.50 0.30) (make-vect 0.60 0.00)))) frame)) 1 (paint edges-&gt;painter #:height 512 #:width 512) 1 (paint diags-&gt;painter #:height 512 #:width 512) 1 (paint midpoints-&gt;painter #:height 512 #:width 512) 1 (paint wave-&gt;painter #:height 512 #:width 512) ç»ƒä¹  50 è¯·å®šä¹‰å˜æ¢ flip-horizï¼Œå®ƒèƒ½åœ¨æ°´å¹³æ–¹å‘ä¸Šåè½¬ç”»å®¶ã€‚å†å®šä¹‰å‡ºå¯¹ç”»å®¶åšåæ—¶é’ˆæ–¹å‘ 180 åº¦å’Œ 270 åº¦æ—‹è½¬çš„å˜æ¢ã€‚
1 2 3 4 5 6 7 8 #lang sicp (#%require sicp-pict) (define (flip-horiz painter) (transform-painter painter (make-vect 1.0 0.0) (make-vect 0.0 0.0) (make-vect 1.0 1.0))) ç»ƒä¹  51 å®šä¹‰å¯¹ç”»å®¶çš„ below æ“ä½œï¼Œå®ƒä»¥ä¸¤ä¸ªç”»å®¶ä¸ºå‚æ•°ã€‚åœ¨ç»™å®šäº†ä¸€ä¸ªæ¡†æ¶åï¼Œç”± below å¾—åˆ°çš„ç”»å®¶å°†è¦æ±‚ç¬¬ä¸€ä¸ªç”»å®¶åœ¨æ¡†æ¶çš„ä¸‹éƒ¨ç”»å›¾ï¼Œè¦æ±‚ç¬¬äºŒä¸ªç”»å®¶åœ¨æ¡†æ¶çš„ä¸Šéƒ¨ç”»å›¾ã€‚è¯·æŒ‰ä¸¤ç§æ–¹å¼å®šä¹‰ belowï¼šé¦–å…ˆå†™å‡ºä¸€ä¸ªç±»ä¼¼äºä¸Šé¢ beside çš„è¿‡ç¨‹ï¼šå¦ä¸€ä¸ªåˆ™ç›´æ¥é€šè¿‡ beside å’Œé€‚å½“çš„æ—‹è½¬æ“ä½œï¼ˆæ¥è‡ª ç»ƒä¹  50 ï¼‰å®Œæˆæœ‰å…³å·¥ä½œã€‚
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 #lang sicp (#%require sicp-pict) (define (below painter1 painter2) (let ((split-point (make-vect 0.0 0.5))) (let ((paint-below (transform-painter painter1 (make-vect 0.0 0.0) (make-vect 1.0 0.0) split-point)) (paint-up (transform-painter painter2 split-point (make-vect 1.0 0.5) (make-vect 0.0 1.0)))) (lambda (frame) (paint-below frame) (paint-up frame))))) #;(define (below painter1 painter2) (rotate270 (beside (rotate90 painter2) (rotate90 painter1)))) ç»ƒä¹  52 åœ¨ä¸Šé¢æè¿°çš„å„ä¸ªå±‚æ¬¡ä¸Šå·¥ä½œï¼Œä¿®æ”¹å›¾ 2-9 ä¸­æ‰€ç¤ºçš„æ–¹å—çš„é™åˆ¶ã€‚ç‰¹åˆ«æ˜¯ï¼š
a) ç»™ ç»ƒä¹  49 çš„åŸºæœ¬ wave ç”»å®¶åŠ å…¥æŸäº›çº¿æ®µï¼ˆä¾‹å¦‚ï¼ŒåŠ ä¸Šä¸€ä¸ªç¬‘è„¸ï¼‰ã€‚
b) ä¿®æ”¹ corner-split çš„æ„é€ æ¨¡å¼ï¼ˆä¾‹å¦‚ï¼Œåªç”¨ up-split å’Œ right-split çš„å›¾åƒçš„å„ä¸€ä¸ªå‰¯æœ¬ï¼Œè€Œä¸æ˜¯ä¸¤ä¸ªï¼‰ã€‚
c) ä¿®æ”¹ square-limitï¼Œæ¢ä¸€ç§ä½¿ç”¨ square-of-four çš„æ–¹å¼ï¼Œä»¥å¦ä¸€ç§ä¸åŒæ¨¡å¼ç»„åˆèµ·å„ä¸ªè§’åŒºï¼ˆä¾‹å¦‚ï¼Œä½ å¯ä»¥è®©å¤§çš„ Rogers å…ˆç”Ÿä»æ­£æ–¹å½¢çš„æ¯ä¸ªè§’å‘å¤–çœ‹ï¼‰ã€‚
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 #lang sicp (#%require sicp-pict) (define (wave-smile-&gt;painter frame) ((segments-&gt;painter (list (make-segment (make-vect 0.20 0.00) (make-vect 0.35 0.50)) (make-segment (make-vect 0.35 0.50) (make-vect 0.30 0.60)) (make-segment (make-vect 0.30 0.60) (make-vect 0.15 0.45)) (make-segment (make-vect 0.15 0.45) (make-vect 0.00 0.60)) (make-segment (make-vect 0.00 0.80) (make-vect 0.15 0.65)) (make-segment (make-vect 0.15 0.65) (make-vect 0.30 0.70)) (make-segment (make-vect 0.30 0.70) (make-vect 0.40 0.70)) (make-segment (make-vect 0.40 0.70) (make-vect 0.35 0.85)) (make-segment (make-vect 0.35 0.85) (make-vect 0.40 1.00)) (make-segment (make-vect 0.60 1.00) (make-vect 0.65 0.85)) (make-segment (make-vect 0.65 0.85) (make-vect 0.60 0.70)) (make-segment (make-vect 0.60 0.70) (make-vect 0.75 0.70)) (make-segment (make-vect 0.75 0.70) (make-vect 1.00 0.40)) (make-segment (make-vect 1.00 0.20) (make-vect 0.60 0.48)) (make-segment (make-vect 0.60 0.48) (make-vect 0.80 0.00)) (make-segment (make-vect 0.40 0.00) (make-vect 0.50 0.30)) (make-segment (make-vect 0.50 0.30) (make-vect 0.60 0.00)) (make-segment (make-vect 0.40 0.90) (make-vect 0.425 0.95)) (make-segment (make-vect 0.425 0.95) (make-vect 0.45 0.90)) (make-segment (make-vect 0.55 0.90) (make-vect 0.575 0.95)) (make-segment (make-vect 0.575 0.95) (make-vect 0.60 0.90)) (make-segment (make-vect 0.47 0.80) (make-vect 0.53 0.80)))) frame)) (define (split orient1 orient2) (define (iter painter n) (if (= n 0) painter (let ((smaller (iter painter (- n 1)))) (orient1 painter (orient2 smaller smaller))))) iter) (define right-split (split beside below)) (define up-split (split below beside)) (define (corner-split painter n) (if (= n 0) painter (let ((up (up-split painter (- n 1))) (right (right-split painter (- n 1)))) (let ((top-left up) (bottom-right right) (corner (corner-split painter (- n 1)))) (beside (below painter top-left) (below bottom-right corner)))))) (define (square-of-four tl tr bl br) (lambda (painter) (let ((top (beside (tl painter) (tr painter))) (bottom (beside (bl painter) (br painter)))) (below bottom top)))) (define (square-limit painter n) (let ((combine4 (square-of-four identity flip-horiz flip-vert rotate180))) (combine4 (corner-split painter n)))) 1 (paint wave-smile-&gt;painter #:height 512 #:width 512) 1 (paint (corner-split wave-smile-&gt;painter 3) #:height 512 #:width 512) 1 (paint (square-limit einstein 3) #:height 512 #:width 512) ç»ƒä¹  53 è§£é‡Šå™¨åœ¨æ±‚å€¼ä¸‹é¢çš„å„ä¸ªè¡¨è¾¾å¼æ—¶å°†æ‰“å°å‡ºä»€ä¹ˆï¼Ÿ
1 2 3 4 5 6 7 8 9 10 11 12 13 (list &#39;a &#39;b &#39;c) (list (list &#39;george)) (cdr &#39;((x1 x2) (y1 y2))) (cadr &#39;((x1 x2) (y1 y2))) (pair? (car &#39;(a short list))) (memq &#39;red &#39;((red shoes) (blue socks))) (memq &#39;red &#39;(red shoes blue socks)) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 #lang sicp (list &#39;a &#39;b &#39;c) ;: (a b c) (list (list &#39;george)) ;: ((george)) (cdr &#39;((x1 x2) (y1 y2))) ;: ((y1 y2)) (cadr &#39;((x1 x2) (y1 y2))) ;: (y1 y2) (pair? (car &#39;(a short list))) ;: #f (memq &#39;red &#39;((red shoes) (blue socks))) ;: #f (memq &#39;red &#39;(red shoes blue socks)) ;: (red shoes blue socks) ç»ƒä¹  54 å¦‚æœä¸¤ä¸ªè¡¨åŒ…å«ç€åŒæ ·å…ƒç´ ï¼Œè¿™äº›å…ƒç´ ä¹ŸæŒ‰åŒæ ·é¡ºåºæ’åˆ—ï¼Œé‚£ä¹ˆå°±ç§°è¿™ä¸¤ä¸ªè¡¨ equal?ã€‚ä¾‹å¦‚ï¼š
1 (equal? &#39;(this is a list) &#39;(this is a list)) æ˜¯çœŸï¼›è€Œ
1 (equal? &#39;(this is a list) &#39;(this (is a) list)) æ˜¯å‡ã€‚è¯´å¾—æ›´å‡†ç¡®äº›ï¼Œæˆ‘ä»¬å¯ä»¥ä»ç¬¦å·ç›¸ç­‰çš„åŸºæœ¬ eq? å‡ºå‘ï¼Œä»¥é€’å½’æ–¹å¼å®šä¹‰å‡º equal?ã€‚a å’Œ b æ˜¯ equal? çš„ï¼Œå¦‚æœå®ƒä»¬éƒ½æ˜¯ç¬¦å·ï¼Œè€Œä¸”è¿™ä¸¤ä¸ªç¬¦å·æ»¡è¶³ eq?ï¼›æˆ–è€…å®ƒä»¬éƒ½æ˜¯è¡¨ï¼Œè€Œä¸” (car a) å’Œ (car b) ç›¸äº’ equal?ï¼Œå®ƒä»¬çš„ (cdr a) å’Œ (cdr b) ä¹Ÿæ˜¯ equal?ã€‚è¯·åˆ©ç”¨è¿™ä¸€æ€è·¯å®šä¹‰å‡º equal? è¿‡ç¨‹ã€‚
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 #lang sicp (define (equal? a b) (if (null? a) (if (null? b) #t #f) (if (null? b) #f (if (not (pair? (car a))) (if (not (pair? (car b))) (and (eq? (car a) (car b)) (equal? (cdr a) (cdr b))) #f) (if (not (pair? (car b))) #f (and (equal? (car a) (car b)) (equal? (cdr a) (cdr b)))))))) ç»ƒä¹  55 Eva Lu Ator è¾“å…¥äº†è¡¨è¾¾å¼ï¼š
1 (car &#39;&#39;abracadabra) ä»¤å¥¹åƒæƒŠçš„æ˜¯è§£é‡Šå™¨æ‰“å°å‡ºçš„æ˜¯ quoteã€‚è¯·è§£é‡Šè¿™ä¸€æƒ…å†µã€‚
ç”±äº ' å®é™…æ˜¯ quote è¿‡ç¨‹ï¼Œå³ 'abracadabra ä¸º (quote abracadabra)ï¼Œå› æ­¤ (car ''abracadabra) ä¸º (car '(quote abracadabra))ï¼Œä¼šè¾“å‡º quoteã€‚
ç»ƒä¹  56 è¯·è¯´æ˜å¦‚ä½•æ‰©å……åŸºæœ¬æ±‚å¯¼è§„åˆ™ï¼Œä»¥ä¾¿èƒ½å¤Ÿå¤„ç†æ›´å¤šç§ç±»çš„è¡¨è¾¾å¼ã€‚ä¾‹å¦‚ï¼Œé€šè¿‡ç»™ç¨‹åº deriv å¢åŠ ä¸€ä¸ªæ–°å­å¥ï¼Œå¹¶ä»¥é€‚å½“æ–¹å¼å®šä¹‰è¿‡ç¨‹ exponentiation?ã€baseã€exponent å’Œ make-exponentiation çš„æ–¹å¼ï¼Œå®ç°ä¸‹è¿°æ±‚å¯¼è§„åˆ™ï¼ˆä½ å¯ä»¥è€ƒè™‘ç”¨ç¬¦å· ** è¡¨ç¤ºä¹˜å¹‚ï¼‰ï¼š
$$ \frac{\mathrm{d}(u^n)}{\mathrm{d}x} = nu^{n-1}\left(\frac{\mathrm{d}u}{\mathrm{d}x}\right) $$
è¯·å°†å¦‚ä¸‹è§„åˆ™ä¹Ÿæ„é€ åˆ°ç¨‹åºé‡Œï¼šä»»ä½•ä¸œè¥¿çš„ $0$ æ¬¡å¹‚éƒ½æ˜¯ $1$ï¼Œè€Œå®ƒä»¬çš„ $1$ æ¬¡å¹‚éƒ½æ˜¯å…¶è‡ªèº«ã€‚
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 #lang sicp (define (=number? exp num) (and (number? exp) (= exp num))) (define (** base exponent) (define (iter exponent r) (if (= exponent 0) r (iter (- exponent 1) (* r base)))) (iter exponent 1)) (define (deriv exp var) (cond ((number? exp) 0) ((variable? exp) (if (same-variable? exp var) 1 0)) ((sum? exp) (make-sum (deriv (addend exp) var) (deriv (augend exp) var))) ((product? exp) (make-sum (make-product (multiplier exp) (deriv (multiplicand exp) var)) (make-product (deriv (multiplier exp) var) (multiplicand exp)))) ((exponentiation? exp) (make-product (make-product (exponent exp) (make-exponentiation (base exp) (- (exponent exp) 1))) (deriv (base exp) var))) (else (error &#34;unknow expression type --- DERIV&#34; exp)))) (define (variable? x) (symbol? x)) (define (same-variable? v1 v2) (and (variable? v1) (variable? v2) (eq? v1 v2))) (define (make-sum a1 a2) (cond ((=number? a1 0) a2) ((=number? a2 0) a1) ((and (number? a1) (number? a2)) (+ a1 a2)) (else (list &#39;+ a1 a2)))) (define (make-product m1 m2) (cond ((or (=number? m1 0) (=number? m2 0)) 0) ((=number? m1 1) m2) ((=number? m2 1) m1) ((and (number? m1) (number? m2)) (* m1 m2)) (else (list &#39;* m1 m2)))) (define (sum? x) (and (pair? x) (eq? (car x) &#39;+))) (define (addend s) (cadr s)) (define (augend s) (caddr s)) (define (product? x) (and (pair? x) (eq? (car x) &#39;*))) (define (multiplier p) (cadr p)) (define (multiplicand p) (caddr p)) (define (make-exponentiation b e) (cond ((=number? e 0) 1) ((=number? e 1) b) ((and (number? b) (number? e)) (** b e)) (else (list &#39;** b e)))) (define (exponentiation? x) (and (pair? x) (eq? (car x) &#39;**))) (define (base e) (cadr e)) (define (exponent e) (caddr e)) ;&gt;&gt;&gt; (deriv &#39;(* (** x 3) y) &#39;x) ;: (* (* 3 (** x 2)) y) ç»ƒä¹  57 è¯·æ‰©å……æ±‚å¯¼ç¨‹åºï¼Œä½¿ä¹‹èƒ½å¤„ç†ä»»æ„é¡¹ï¼ˆä¸¤é¡¹æˆ–è€…æ›´å¤šé¡¹ï¼‰çš„å’Œä¸ä¹˜ç§¯ã€‚è¿™æ ·ï¼Œä¸Šé¢çš„æœ€åä¸€ä¸ªä¾‹å­å°±å¯ä»¥è¡¨ç¤ºä¸ºï¼š
1 (deriv &#39;(* x y (+ x 3)) &#39;x) è®¾æ³•é€šè¿‡åªä¿®æ”¹å’Œä¸ä¹˜ç§¯çš„è¡¨ç¤ºï¼Œè€Œå®Œå…¨ä¸ä¿®æ”¹è¿‡ç¨‹ deriv çš„æ–¹å¼å®Œæˆè¿™ä¸€æ‰©å……ã€‚ä¾‹å¦‚ï¼Œè®©ä¸€ä¸ªå’Œå¼çš„ addend æ˜¯å®ƒçš„ç¬¬ä¸€é¡¹ï¼Œè€Œå…¶ augend æ˜¯å’Œå¼ä¸­çš„å…¶ä½™é¡¹ã€‚
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 #lang sicp (define (length l) (define (iter l r) (if (null? l) r (iter (cdr l) (+ r 1)))) (iter l 0)) (define (filter predicate sequence) (cond ((null? sequence) nil) ((predicate (car sequence)) (cons (car sequence) (filter predicate (cdr sequence)))) (else (filter predicate (cdr sequence))))) (define (=number? exp num) (and (number? exp) (= exp num))) (define (** base exponent) (define (iter exponent r) (if (= exponent 0) r (iter (- exponent 1) (* r base)))) (iter exponent 1)) (define (deriv exp var) (cond ((number? exp) 0) ((variable? exp) (if (same-variable? exp var) 1 0)) ((sum? exp) (make-sum (deriv (addend exp) var) (deriv (augend exp) var))) ((product? exp) (make-sum (make-product (multiplier exp) (deriv (multiplicand exp) var)) (make-product (deriv (multiplier exp) var) (multiplicand exp)))) ((exponentiation? exp) (make-product (make-product (exponent exp) (make-exponentiation (base exp) (- (exponent exp) 1))) (deriv (base exp) var))) (else (error &#34;unknow expression type --- DERIV&#34; exp)))) (define (variable? x) (symbol? x)) (define (same-variable? v1 v2) (and (variable? v1) (variable? v2) (eq? v1 v2))) (define (make-sum a1 . a2) (let ((a3 (filter (lambda (x) (or (pair? x) (not (=number? x 0)))) a2))) (cond ((= (length a3) 0) a1) ((= (length a3) 1) (let ((a (car a3))) (cond ((=number? a1 0) a) ((=number? a 0) a1) ((and (number? a1) (number? a)) (+ a1 a)) (else (list &#39;+ a1 a))))) (else (if (=number? a1 0) (cons &#39;+ a3) (cons &#39;+ (cons a1 a3))))))) (define (make-product m1 . m2) (let ((m3 (filter (lambda (x) (or (pair? x) (not (=number? x 1)))) m2))) (cond ((&gt; (length (filter (lambda (x) (and (not (pair? x)) (=number? x 0))) m3)) 0) 0) ((= (length m3) 0) m1) ((= (length m3) 1) (let ((m (car m3))) (cond ((or (=number? m1 0) (=number? m 0)) 0) ((=number? m1 1) m) ((=number? m 1) m1) ((and (number? m1) (number? m)) (* m1 m)) (else (list &#39;* m1 m))))) (else (cond ((=number? m1 0) 0) ((=number? m1 1) (cons &#39;* m3)) (else (cons &#39;* (cons m1 m3)))))))) (define (sum? x) (and (pair? x) (eq? (car x) &#39;+))) (define (addend s) (cadr s)) (define (augend s) (if (= (length s) 3) (caddr s) (cons &#39;+ (cddr s)))) (define (product? x) (and (pair? x) (eq? (car x) &#39;*))) (define (multiplier p) (cadr p)) (define (multiplicand p) (if (= (length p) 3) (caddr p) (cons &#39;* (cddr p)))) (define (make-exponentiation b e) (cond ((=number? e 0) 1) ((=number? e 1) b) ((and (number? b) (number? e)) (** b e)) (else (list &#39;** b e)))) (define (exponentiation? x) (and (pair? x) (eq? (car x) &#39;**))) (define (base e) (cadr e)) (define (exponent e) (caddr e)) ;&gt;&gt;&gt; (deriv &#39;(* x y (+ x 3)) &#39;x) ;: (+ (* x y) (* y (+ x 3))) ç»ƒä¹  58 å‡å®šæˆ‘ä»¬å¸Œæœ›ä¿®æ”¹æ±‚å¯¼ç¨‹åºï¼Œä½¿å®ƒèƒ½ç”¨äºå¸¸è§„æ•°å­¦å…¬å¼ï¼Œå…¶ä¸­ + å’Œ * é‡‡ç”¨çš„æ˜¯ä¸­ç¼€è¿ç®—ç¬¦è€Œä¸æ˜¯å‰ç¼€ã€‚ç”±äºæ±‚å¯¼ç¨‹åºä½¿åŸºäºæŠ½è±¡æ•°æ®å®šä¹‰çš„ï¼Œè¦ä¿®æ”¹å®ƒï¼Œä½¿ä¹‹èƒ½ç”¨äºå¦ä¸€ç§ä¸åŒçš„è¡¨è¾¾å¼è¡¨ç¤ºï¼Œæˆ‘ä»¬åªéœ€è¦æ¢ä¸€å¥—å·¥ä½œåœ¨æ–°çš„ã€æ±‚å¯¼ç¨‹åºéœ€è¦ä½¿ç”¨çš„ä»£æ•°è¡¨è¾¾å¼çš„è¡¨ç¤ºå½¢å¼ä¸Šçš„è°“è¯ã€é€‰æ‹©å‡½æ•°å’Œæ„é€ å‡½æ•°ã€‚
a) è¯·è¯´æ˜æ€æ ·åšå‡ºè¿™äº›è¿‡ç¨‹ï¼Œä»¥ä¾¿å®Œæˆåœ¨ä¸­ç¼€è¡¨ç¤ºå½¢å¼ï¼ˆä¾‹å¦‚ (x + (3 * (x + (y + 2)))) ä¸Šçš„ä»£æ•°è¡¨è¾¾å¼æ±‚å¯¼ã€‚ä¸ºäº†ç®€åŒ–æœ‰å…³çš„å·¥ä½œï¼Œç°åœ¨å¯ä»¥å‡å®š + å’Œ * æ€»æ˜¯å–ä¸¤ä¸ªå‚æ•°ï¼Œè€Œä¸”è¡¨è¾¾å¼ä¸­å·²ç»åŠ ä¸Šäº†æ‰€æœ‰çš„æ‹¬å·ã€‚
b) å¦‚æœå…è®¸æ ‡å‡†çš„ä»£æ•°å†™æ³•ï¼Œä¾‹å¦‚ (x + 3 * (x + y + 2))ï¼Œé—®é¢˜å°±ä¼šå˜å¾—æ›´å›°éš¾è®¸å¤šã€‚åœ¨è¿™ç§è¡¨è¾¾å¼é‡Œå¯èƒ½ä¸å†™ä¸å¿…è¦çš„æ‹¬å·ã€‚å¹¶è¦å‡å®šä¹˜æ³•åº”è¯¥åœ¨åŠ æ³•ä¹‹å‰å®Œæˆã€‚ä½ è¿˜èƒ½ä¸ºè¿™ç§è¡¨ç¤ºæ–¹å¼è®¾è®¡å¥½é€‚å½“çš„è°“è¯ã€é€‰æ‹©å‡½æ•°å’Œæ„é€ å‡½æ•°ï¼Œä½¿æˆ‘ä»¬çš„æ±‚å¯¼ç¨‹åºä»ç„¶èƒ½å·¥ä½œå—ï¼Ÿ
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 #lang sicp (define (deriv exp var) (cond ((number? exp) 0) ((variable? exp) (if (same-variable? exp var) 1 0)) ((sum? exp) (make-sum (deriv (addend exp) var) (deriv (augend exp) var))) ((product? exp) (make-sum (make-product (multiplier exp) (deriv (multiplicand exp) var)) (make-product (deriv (multiplier exp) var) (multiplicand exp)))) ((exponentiation? exp) (make-product (make-product (exponent exp) (make-exponentiation (base exp) (- (exponent exp) 1))) (deriv (base exp) var))) (else (error &#34;unknow expression type --- DERIV&#34; exp)))) (define (** base exponent) (define (iter exponent r) (if (= exponent 0) r (iter (- exponent 1) (* r base)))) (iter exponent 1)) (define (=number? exp num) (and (number? exp) (= exp num))) (define (variable? v) (symbol? v)) (define (same-variable? v1 v2) (and (variable? v1) (variable? v2) (eq? v1 v2))) (define (make-sum a1 a2) (cond ((=number? a1 0) a2) ((=number? a2 0) a1) ((and (number? a1) (number? a2)) (+ a1 a2)) (else (list a1 &#39;+ a2)))) (define (sum? x) (eq? (cadr x) &#39;+)) (define (addend s) (car s)) (define (augend s) (caddr s)) (define (make-product m1 m2) (cond ((or (=number? m1 0) (=number? m2 0)) 0) ((=number? m1 1) m2) ((=number? m2 1) m1) ((and (number? m1) (number? m2)) (* m1 m2)) (else (list m1 &#39;* m2)))) (define (product? x) (eq? (cadr x) &#39;*)) (define (multiplier p) (car p)) (define (multiplicand p) (caddr p)) (define (make-exponentiation b e) (cond ((=number? e 0) 1) ((=number? e 1) b) ((and (number? b) (number? e)) (** b e)) (else (list b &#39;** e)))) (define (exponentiation? x) (eq? (cadr x) &#39;**)) (define (base e) (car e)) (define (exponent e) (caddr e)) ;&gt;&gt;&gt; (deriv &#39;(x + (3 * (x + (y + 2)))) &#39;x) ;: 4 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 #lang sicp (define (deriv exp var) (cond ((number? exp) 0) ((variable? exp) (if (same-variable? exp var) 1 0)) ((sum? exp) (make-sum (deriv (addend exp) var) (deriv (augend exp) var))) ((product? exp) (make-sum (make-product (multiplier exp) (deriv (multiplicand exp) var)) (make-product (deriv (multiplier exp) var) (multiplicand exp)))) ((exponentiation? exp) (make-product (make-product (exponent exp) (make-exponentiation (base exp) (- (exponent exp) 1))) (deriv (base exp) var))) (else (error &#34;unknow expression type --- DERIV&#34; exp)))) (define (** base exponent) (define (iter exponent r) (if (= exponent 0) r (iter (- exponent 1) (* r base)))) (iter exponent 1)) (define (=number? exp num) (and (number? exp) (= exp num))) (define (variable? v) (symbol? v)) (define (same-variable? v1 v2) (and (variable? v1) (variable? v2) (eq? v1 v2))) (define (make-sum a1 a2) (cond ((=number? a1 0) a2) ((=number? a2 0) a1) ((and (number? a1) (number? a2)) (+ a1 a2)) (else (list a1 &#39;+ a2)))) (define (sum? x) (pair? (memq &#39;+ x))) (define (addend s) (let ((x (reverse (cdr (memq &#39;+ (reverse s)))))) (if (null? (cdr x)) (car x) x))) (define (augend s) (define (iter rs r) (if (eq? (car rs) &#39;+) r (iter (cdr rs) (cons (car rs) r)))) (let ((x (iter (reverse s) nil))) (if (null? (cdr x)) (car x) x))) (define (make-product m1 m2) (cond ((or (=number? m1 0) (=number? m2 0)) 0) ((=number? m1 1) m2) ((=number? m2 1) m1) ((and (number? m1) (number? m2)) (* m1 m2)) (else (list m1 &#39;* m2)))) (define (product? x) (pair? (memq &#39;* x))) (define (multiplier p) (let ((x (reverse (cdr (memq &#39;* (reverse p)))))) (if (null? (cdr x)) (car x) x))) (define (multiplicand p) (define (iter rp r) (if (eq? (car rp) &#39;*) r (iter (cdr rp) (cons (car rp) r)))) (let ((x (iter (reverse p) nil))) (if (null? (cdr x)) (car x) x))) (define (make-exponentiation b e) (cond ((=number? e 0) 1) ((=number? e 1) b) ((and (number? b) (number? e)) (** b e)) (else (list b &#39;** e)))) (define (exponentiation? x) (pair? (memq &#39;** x))) (define (base e) (let ((x (reverse (cdr (memq &#39;** (reverse e)))))) (if (null? (cdr x)) (car x) x))) (define (exponent e) (define (iter re r) (if (eq? (car re) &#39;**) r (iter (cdr re) (cons (car re) r)))) (let ((x (iter (reverse e) nil))) (if (null? (cdr x)) (car x) x))) ;&gt;&gt;&gt; (deriv &#39;(x + 3 * (x + y + 2)) &#39;x) ;: 4 ç»ƒä¹  59 è¯·ä¸ºé‡‡ç”¨æœªæ’åºè¡¨çš„é›†åˆå®ç°å®šä¹‰ union-set æ“ä½œã€‚
1 2 3 4 5 6 7 8 9 10 11 12 13 14 #lang sicp (define (element-of-set? x set) (cond ((null? set) #f) ((equal? x (car set)) #t) (else (element-of-set? x (cdr set))))) (define (union-set set1 set2) (cond ((null? set1) set2) ((null? set2) set1) ((element-of-set? (car set1) set2) (union-set (cdr set1) set2)) (else (cons (car set1) (union-set (cdr set1) set2))))) ç»ƒä¹  60 æˆ‘ä»¬å‰é¢è¯´æ˜äº†å¦‚ä½•å°†é›†åˆè¡¨ç¤ºä¸ºæ²¡æœ‰é‡å¤å…ƒç´ çš„è¡¨ã€‚ç°åœ¨å‡å®šå…è®¸é‡å¤ï¼Œä¾‹å¦‚ï¼Œé›†åˆ ${1, 2, 3}$ å¯èƒ½è¢«è¡¨ç¤ºä¸ºè¡¨ (2 3 2 1 3 2 2)ã€‚è¯·ä¸ºåœ¨è¿™ç§è¡¨ç¤ºä¸Šçš„æ“ä½œè®¾è®¡è¿‡ç¨‹ element-of-set?ã€adjoin-setã€union-setã€å’Œ intersection-setã€‚ä¸å‰é¢ä¸é‡å¤è¡¨ç¤ºé‡Œçš„ç›¸åº”æ“ä½œç›¸æ¯”ï¼Œç°åœ¨å„ä¸ªæ“ä½œçš„æ•ˆç‡æ€ä¹ˆæ ·ï¼Ÿåœ¨ä»€ä¹ˆæ ·çš„åº”ç”¨ä¸­ä½ æ›´å€¾å‘äºä½¿ç”¨è¿™ç§è¡¨ç¤ºï¼Œè€Œä¸æ˜¯å‰é¢é‚£ç§æ— é‡å¤çš„è¡¨ç¤ºï¼Ÿ
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 #lang sicp (define (element-of-set? x set) (cond ((null? set) #f) ((equal? x (car set)) #t) (else (element-of-set? x (cdr set))))) (define (adjoin-set x set) (cons x set)) (define (intersection-set set1 set2) (cond ((or (null? set1) (null? set2)) &#39;()) ((element-of-set? (car set1) set2) (cons (car set1) (intersection-set (cdr set1) set2))) (else (intersection-set (cdr set1) set2)))) (define (union-set set1 set2) (cond ((null? set1) set2) ((null? set2) set1) (else (cons (car set1) (union-set (cdr set1) set2))))) å…è®¸é‡å¤çš„æƒ…å†µä¸‹ï¼Œè¿‡ç¨‹ element-of-set? çš„æ•ˆç‡å˜åŒ–æ— æ³•ç¡®å®šï¼›ç”±äºè¿‡ç¨‹ adjoin-set å’Œ union-set ä¸å†éœ€è¦ä½¿ç”¨ element-of-set?ï¼Œå› æ­¤æ•ˆç‡ä¼šæé«˜ï¼›è€Œ intersection-set ç”±äºéœ€è¦å¤„ç†æ›´é•¿çš„è¡¨ï¼Œæ•ˆç‡ä¼šä¸‹é™ã€‚åœ¨éœ€è¦æ·»åŠ å…ƒç´ æˆ–æ˜¯å–å¹¶é¢‘ç¹çš„åº”ç”¨ä¸­ä½¿ç”¨è¿™ç§è¡¨ç¤ºæ•ˆç‡æ›´é«˜ã€‚
ç»ƒä¹  61 è¯·ç»™å‡ºé‡‡ç”¨æ’åºè¡¨ç¤ºæ—¶ adjoin-set çš„å®ç°ã€‚é€šè¿‡ç±»ä¼¼ element-of-set? çš„æ–¹å¼è¯´æ˜ï¼Œå¯ä»¥å¦‚ä½•åˆ©ç”¨æ’åºçš„ä¼˜åŠ¿å¾—åˆ°ä¸€ä¸ªè¿‡ç¨‹ï¼Œå…¶å¹³å‡æ‰€éœ€çš„æ­¥æ•°æ˜¯é‡‡ç”¨æœªæ’åºè¡¨ç¤ºæ—¶çš„ä¸€åŠã€‚
å°†å¾…æ’å…¥å…ƒç´ ä¾æ¬¡ä¸é›†åˆä¸­å…ƒç´ æ¯”è¾ƒï¼Œå¦‚æœå¾…æ’å…¥å…ƒç´ å¤§äºå½“å‰å…ƒç´ ï¼Œç»§ç»­æ¯”è¾ƒä¸‹ä¸€ä¸ªï¼›å¦‚æœç­‰äºå½“å‰å…ƒç´ ï¼Œä¸å¿…æ’å…¥ï¼›å¦‚æœå°äºå½“å‰å…ƒç´ ï¼Œæ’å…¥åˆ°è¯¥ä½ç½®ã€‚è¯¥è¡¨ç¤ºä¸‹å¹³å‡æ‰€éœ€çš„æ­¥æ•°æ˜¯é‡‡ç”¨æœªæ’åºè¡¨ç¤ºæ—¶çš„ä¸€åŠã€‚
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 #lang sicp (define (adjoin-set x set) (cond ((null? set) (list x)) ((&lt; (car set) x) (cons (car set) (adjoin-set x (cdr set)))) ((= (car set) x) set) (else (cons x set)))) ;&gt;&gt;&gt; (adjoin-set -10 (list 1 5 7 13)) ;: (-10 1 5 7 13) ;&gt;&gt;&gt; (adjoin-set 5 (list 1 5 7 13)) ;: (1 5 7 13) ;&gt;&gt;&gt; (adjoin-set 8 (list 1 5 7 13)) ;: (1 5 7 8 13) ;&gt;&gt;&gt; (adjoin-set 991 (list 1 5 7 13)) ;: (1 5 7 13 991) ç»ƒä¹  62 è¯·ç»™å‡ºåœ¨é›†åˆçš„æ’åºè¡¨ç¤ºä¸Š union-set çš„ä¸€ä¸ª $\Theta(n)$ å®ç°ã€‚
1 2 3 4 5 6 7 8 9 10 11 12 13 #lang sicp (define (union-set set1 set2) (cond ((null? set1) set2) ((null? set2) set1) (else (let ((x1 (car set1)) (x2 (car set2))) (cond ((= x1 x2) (cons x1 (union-set (cdr set1) (cdr set2)))) ((&lt; x1 x2) (cons x1 (union-set (cdr set1) set2))) (else (cons x2 (union-set set1 (cdr set2))))))))) ç»ƒä¹  63 ä¸‹é¢ä¸¤ä¸ªè¿‡ç¨‹éƒ½èƒ½å°†æ ‘å˜æ¢ä¸ºè¡¨ï¼š
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 #lang sicp (define (tree-&gt;list-1 tree) (if (null? tree) &#39;() (append (tree-&gt;list-1 (left-branch tree)) (cons (entry tree) (tree-&gt;list-1 (right-branch tree)))))) (define (tree-&gt;list-2 tree) (define (copy-to-list tree result-list) (if (null? tree) result-list (copy-to-list (left-branch tree) (cons (entry tree) (copy-to-list (right-branch tree) result-list))))) (copy-to-list tree &#39;())) a) è¿™ä¸¤ä¸ªè¿‡ç¨‹å¯¹æ‰€æœ‰çš„æ ‘éƒ½äº§ç”ŸåŒæ ·ç»“æœå—ï¼Ÿå¦‚æœä¸æ˜¯ï¼Œå®ƒä»¬äº§ç”Ÿå‡ºçš„ç»“æœæœ‰ä»€ä¹ˆä¸åŒï¼Ÿå®ƒä»¬å¯¹å›¾ 2-16 ä¸­çš„é‚£äº›æ ‘äº§ç”Ÿä»€ä¹ˆæ ·çš„è¡¨ï¼Ÿ
b) å°† $n$ ä¸ªç»“ç‚¹çš„å¹³è¡¡æ ‘å˜æ¢ä¸ºè¡¨æ—¶ï¼Œè¿™ä¸¤ä¸ªè¿‡ç¨‹æ‰€éœ€çš„æ­¥æ•°å…·æœ‰åŒæ ·é‡çº§çš„å¢é•¿é€Ÿåº¦å—ï¼Ÿå¦‚æœä¸ä¸€æ ·ï¼Œå“ªä¸ªè¿‡ç¨‹å¢é•¿å¾—æ…¢ä¸€äº›ï¼Ÿ
ç»“æœç›¸åŒï¼Œå¯¹å›¾ 2-16 ä¸­çš„æ ‘äº§ç”Ÿçš„è¡¨å‡ä¸º (1 3 5 7 9 11)ã€‚
ä¸åŒï¼Œtree-&gt;list-1 æ…¢ä¸€äº›ã€‚å› ä¸º tree-&gt;list-1 ä¸­çš„ append ä¼šå°†å¤æ‚åº¦æå‡ $n$ å€ã€‚
ç»ƒä¹  64 ä¸‹é¢è¿‡ç¨‹ list-&gt;tree å°†ä¸€ä¸ªæœ‰åºè¡¨å˜æ¢ä¸ºä¸€æ£µå¹³è¡¡äºŒå‰æ ‘ã€‚å…¶ä¸­çš„è¾…åŠ©å‡½æ•° partial-tree ä»¥æ•´æ•° $n$ å’Œä¸€ä¸ªè‡³å°‘åŒ…å« $n$ ä¸ªå…ƒç´ çš„è¡¨ä¸ºå‚æ•°ï¼Œæ„é€ å‡ºä¸€æ£µåŒ…å«è¿™ä¸ªè¡¨çš„å‰ $n$ ä¸ªå…ƒç´ çš„å¹³è¡¡æ ‘ã€‚ç”± partial-tree è¿”å›çš„ç»“æœæ˜¯ä¸€ä¸ªåºå¯¹ï¼ˆç”¨ cons æ„é€ ï¼‰ï¼Œå…¶ car æ˜¯æ„é€ å‡ºçš„æ ‘ï¼Œå…¶ cdr æ˜¯æ²¡æœ‰åŒ…å«åœ¨æ ‘ç§é‚£äº›å…ƒç´ çš„è¡¨ã€‚
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 (define (list-&gt;tree elements) (car (partial-tree elements (length elements)))) (define (partial-tree elts n) (if (= n 0) (cons &#39;() elts) (let ((left-size (quotient (- n 1) 2))) (let ((left-result (partial-tree elts left-size))) (let ((left-tree (car left-result)) (non-left-elts (cdr left-result)) (right-size (- n (+ left-size 1)))) (let ((this-entry (car non-left-elts)) (right-result (partial-tree (cdr non-left-elts) right-size))) (let ((right-tree (car right-result)) (remaining-elts (cdr right-result))) (cons (make-tree this-entry left-tree right-tree) remaining-elts)))))))) a) è¯·ç®€è¦åœ°å¹¶å°½å¯èƒ½æ¸…æ¥šåœ°è§£é‡Šä¸ºä»€ä¹ˆ partial-tree èƒ½å®Œæˆå·¥ä½œã€‚è¯·ç”»å‡ºå°† list-&gt;tree ç”¨äºè¡¨ (1 3 5 7 9 11) äº§ç”Ÿå‡ºçš„æ ‘ã€‚
b) è¿‡ç¨‹ list-&gt;tree è½¬æ¢ $n$ ä¸ªå…ƒç´ çš„è¡¨æ‰€éœ€çš„æ­¥æ•°ä»¥ä»€ä¹ˆé‡çº§å¢é•¿ï¼Ÿ
å¯¹äºä¸€ä¸ª listï¼Œé¦–å…ˆè®¡ç®—å‡ºæ„é€ å·¦å­æ ‘å’Œå³å­æ ‘éœ€è¦çš„ç»“ç‚¹æ•°ï¼Œç„¶åç”¨æ‰€éœ€ç»“ç‚¹é€’å½’åœ°è°ƒç”¨ partial-tree æ„é€ å­æ ‘ï¼Œæœ€åç”¨ç”Ÿæˆçš„å­æ ‘å’Œæ ¹ç»“ç‚¹æ„é€ æ ‘ã€‚list-&gt;tree ç”¨äºè¡¨ (1 3 5 7 9 11) äº§ç”Ÿå‡ºçš„æ ‘ä¸ºï¼š
partial-tree è®¿é—®æ¯ä¸ªç»“ç‚¹æ°å¥½ä¸€æ¬¡ï¼Œå°†å…¶è®¾ç½®ä¸ºè·Ÿç»“ç‚¹ï¼Œå…¶ä½™æ“ä½œå‡ä¸ºå¸¸æ•°çº§å¤æ‚åº¦ï¼Œå› æ­¤æ­¥æ•°ä¸º $\Theta(n)$ã€‚
ç»ƒä¹  65 åˆ©ç”¨ ç»ƒä¹  63 å’Œ ç»ƒä¹  64 çš„ç»“æœï¼Œç»™å‡ºå¯¹é‡‡ç”¨ï¼ˆå¹³è¡¡ï¼‰äºŒå‰æ ‘æ–¹å¼å®ç°çš„é›†åˆçš„ union-set å’Œ intersection-set æ“ä½œçš„ $\Theta(n)$ å®ç°ã€‚
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 #lang sicp (define (make-tree entry left right) (list entry left right)) (define (entry tree) (car tree)) (define (left-branch tree) (cadr tree)) (define (right-branch tree) (caddr tree)) (define (tree-&gt;list tree) (define (copy-to-list tree result-list) (if (null? tree) result-list (copy-to-list (left-branch tree) (cons (entry tree) (copy-to-list (right-branch tree) result-list))))) (copy-to-list tree &#39;())) (define (list-&gt;tree elements) (car (partial-tree elements (length elements)))) (define (partial-tree elts n) (if (= n 0) (cons &#39;() elts) (let ((left-size (quotient (- n 1) 2))) (let ((left-result (partial-tree elts left-size))) (let ((left-tree (car left-result)) (non-left-elts (cdr left-result)) (right-size (- n (+ left-size 1)))) (let ((this-entry (car non-left-elts)) (right-result (partial-tree (cdr non-left-elts) right-size))) (let ((right-tree (car right-result)) (remaining-elts (cdr right-result))) (cons (make-tree this-entry left-tree right-tree) remaining-elts)))))))) (define (union-set set1 set2) (define (union-set-list set1 set2) (cond ((null? set1) set2) ((null? set2) set1) (else (let ((x1 (car set1)) (x2 (car set2))) (cond ((= x1 x2) (cons x1 (union-set-list (cdr set1) (cdr set2)))) ((&lt; x1 x2) (cons x1 (union-set-list (cdr set1) set2))) (else (cons x2 (union-set-list set1 (cdr set2))))))))) (list-&gt;tree (union-set-list (tree-&gt;list set1) (tree-&gt;list set2)))) (define (intersection-set set1 set2) (define (intersection-set-list set1 set2) (if (or (null? set1) (null? set2)) &#39;() (let ((x1 (car set1)) (x2 (car set2))) (cond ((= x1 x2) (cons x1 (intersection-set-list (cdr set1) (cdr set2)))) ((&lt; x1 x2) (intersection-set-list (cdr set1) set2)) (else (intersection-set-list set1 (cdr set2))))))) (list-&gt;tree (intersection-set-list (tree-&gt;list set1) (tree-&gt;list set2)))) ;&gt;&gt;&gt; (define s1 (list-&gt;tree &#39;(1 2 3 5 6 8 10 11))) ;&gt;&gt;&gt; (define s2 (list-&gt;tree &#39;(2 4 6 8 11 13))) ;&gt;&gt;&gt; (tree-&gt;list (union-set s1 s2)) ;: (1 2 3 4 5 6 8 10 11 13) ;&gt;&gt;&gt; (tree-&gt;list (intersection-set s1 s2)) ;: (2 6 8 11) ç»ƒä¹  66 å‡è®¾è®°å½•çš„é›†åˆé‡‡ç”¨äºŒå‰æ ‘å®ç°ï¼ŒæŒ‰ç…§å…¶ä¸­ä½œä¸ºé”®å€¼çš„æ•°å€¼æ’åºã€‚è¯·å®ç°ç›¸åº”çš„ lookup è¿‡ç¨‹ã€‚
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 #lang sicp (define (key record) (car record)) (define (left-branch tree) (cadr tree)) (define (right-branch tree) (caddr tree)) (define (lookup given-key set-of-records) (cond ((null? set-of-records) false) ((&lt; given-key (key (car set-of-records))) (lookup given-key (left-branch set-of-records))) ((= given-key (key (car set-of-records))) (car set-of-records)) (else (lookup given-key (right-branch set-of-records))))) ç»ƒä¹  67 è¯·å®šä¹‰ä¸€æ£µç¼–ç æ ‘å’Œä¸€ä¸ªæ ·ä¾‹æ¶ˆæ¯ï¼š
1 2 3 4 5 6 7 8 (define sample-tree (make-code-tree (make-leaf &#39;A 4) (make-code-tree (make-leaf &#39;B 2) (make-code-tree (make-leaf &#39;D 1) (make-leaf &#39;C 1))))) (define sample-message &#39;(0 1 1 0 0 1 0 1 0 1 1 1 0)) ç„¶åç”¨è¿‡ç¨‹ decode å®Œæˆè¯¥æ¶ˆæ¯çš„ç¼–ç ï¼Œç»™å‡ºç¼–ç çš„ç»“æœã€‚
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 #lang sicp (define (make-leaf symbol weight) (list &#39;leaf symbol weight)) (define (leaf? object) (eq? (car object) &#39;leaf)) (define (symbol-leaf x) (cadr x)) (define (weight-leaf x) (caddr x)) (define (make-code-tree left right) (list left right (append (symbols left) (symbols right)) (+ (weight left) (weight right)))) (define (left-branch tree) (car tree)) (define (right-branch tree) (cadr tree)) (define (symbols tree) (if (leaf? tree) (list (symbol-leaf tree)) (caddr tree))) (define (weight tree) (if (leaf? tree) (weight-leaf tree) (cadddr tree))) (define (decode bits tree) (define (decode-1 bits current-branch) (if (null? bits) &#39;() (let ((next-branch (choose-branch (car bits) current-branch))) (if (leaf? next-branch) (cons (symbol-leaf next-branch) (decode-1 (cdr bits) tree)) (decode-1 (cdr bits) next-branch))))) (decode-1 bits tree)) (define (choose-branch bit branch) (cond ((= bit 0) (left-branch branch)) ((= bit 1) (right-branch branch)) (else (error &#34;bad bit -- CHOOSE-BRANCH&#34; bit)))) #;(define sample-tree (make-code-tree (make-leaf &#39;A 4) (make-code-tree (make-leaf &#39;B 2) (make-code-tree (make-leaf &#39;D 1) (make-leaf &#39;C 1))))) ;&gt;&gt;&gt; (define sample-message &#39;(0 1 1 0 0 1 0 1 0 1 1 1 0)) ;&gt;&gt;&gt; (decode sample-message sample-tree) ;: (A D A B B C A) ç»ƒä¹  68 è¿‡ç¨‹ encode ä»¥ä¸€ä¸ªæ¶ˆæ¯å’Œä¸€æ£µæ ‘ä¸ºå‚æ•°ï¼Œäº§ç”Ÿå‡ºè¢«ç¼–ç æ¶ˆæ¯æ‰€å¯¹åº”çš„äºŒè¿›åˆ¶ä½çš„è¡¨ï¼š
1 2 3 4 5 (define (encode message tree) (if (null? message) &#39;() (append (encode-symbol (car message) tree) (encode (cdr message) tree)))) å…¶ä¸­çš„ encode-symbol æ˜¯éœ€è¦ä½ å†™å‡ºçš„è¿‡ç¨‹ï¼Œå®ƒèƒ½æ ¹æ®ç»™å®šçš„æ ‘äº§ç”Ÿå‡ºç»™å®šç¬¦å·çš„äºŒè¿›åˆ¶ä½è¡¨ã€‚ä½ æ‰€è®¾è®¡çš„ encode-symbol åœ¨é‡åˆ°æœªå‡ºç°åœ¨æ ‘ä¸­çš„ç¬¦å·æ—¶åº”æŠ¥å‘Šé”™è¯¯ã€‚è¯·ç”¨åœ¨ ç»ƒä¹  2.67 ä¸­å¾—åˆ°çš„ç»“æœæ£€æŸ¥æ‰€å®ç°çš„è¿‡ç¨‹ï¼Œå·¥ä½œä¸­ç”¨åŒæ ·ä¸€æ£µæ ‘ï¼Œçœ‹çœ‹å¾—åˆ°çš„ç»“æœæ˜¯ä¸æ˜¯åŸæ¥é‚£ä¸ªæ¶ˆæ¯ã€‚
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 #lang sicp (define (make-leaf symbol weight) (list &#39;leaf symbol weight)) (define (leaf? object) (eq? (car object) &#39;leaf)) (define (symbol-leaf x) (cadr x)) (define (weight-leaf x) (caddr x)) (define (make-code-tree left right) (list left right (append (symbols left) (symbols right)) (+ (weight left) (weight right)))) (define (left-branch tree) (car tree)) (define (right-branch tree) (cadr tree)) (define (symbols tree) (if (leaf? tree) (list (symbol-leaf tree)) (caddr tree))) (define (weight tree) (if (leaf? tree) (weight-leaf tree) (cadddr tree))) (define (encode message tree) (if (null? message) &#39;() (append (encode-symbol (car message) tree) (encode (cdr message) tree)))) (define (encode-symbol symbol tree) (cond ((not (memq symbol (symbols tree))) (error &#34;bad symbol -- ENCODE-SYMBOL&#34; symbol)) ((leaf? tree) &#39;()) (else (if (memq symbol (symbols (left-branch tree))) (cons &#39;0 (encode-symbol symbol (left-branch tree))) (cons &#39;1 (encode-symbol symbol (right-branch tree))))))) #;(define sample-tree (make-code-tree (make-leaf &#39;A 4) (make-code-tree (make-leaf &#39;B 2) (make-code-tree (make-leaf &#39;D 1) (make-leaf &#39;C 1))))) ;&gt;&gt;&gt; (define sample-message &#39;(A D A B B C A)) ;&gt;&gt;&gt; (encode sample-message sample-tree) ;: (0 1 1 0 0 1 0 1 0 1 1 1 0) ç»ƒä¹  69 ä¸‹é¢è¿‡ç¨‹ä»¥ä¸€ä¸ªç¬¦å· &mdash; é¢‘åº¦å¯¹å¶è¡¨ä¸ºå‚æ•°ï¼ˆå…¶ä¸­æ²¡æœ‰ä»»ä½•ç¬¦å·å‡ºç°åœ¨å¤šäºä¸€ä¸ªå¯¹å¶ä¸­ï¼‰ï¼Œå¹¶æ ¹æ® Huffman ç®—æ³•ç”Ÿæˆå‡º Huffman ç¼–ç æ ‘ã€‚
1 2 (define (generate-huffman-tree pairs) (successive-merge (make-leaf-set pairs))) å…¶ä¸­çš„ make-leaf-set æ˜¯å‰é¢ç»™å‡ºçš„è¿‡ç¨‹ï¼Œå®ƒå°†å¯¹å¶è¡¨è½¬æ¢ä¸ºå¶çš„æœ‰åºé›†ï¼Œsuccessive-merge æ˜¯éœ€è¦ä½ å†™çš„è¿‡ç¨‹ï¼Œå®ƒä½¿ç”¨ make-code-tree åå¤å½’å¹¶é›†åˆä¸­å…·æœ‰æœ€å°æƒé‡çš„å…ƒç´ ï¼Œç›´è‡³é›†åˆé‡Œåªå‰©ä¸‹ä¸€ä¸ªå…ƒç´ ä¸ºæ­¢ã€‚è¿™ä¸ªå…ƒç´ å°±æ˜¯æˆ‘ä»¬æ‰€éœ€è¦çš„ Huffman æ ‘ã€‚ï¼ˆè¿™ä¸€è¿‡ç¨‹ç¨å¾®æœ‰ç‚¹æŠ€å·§æ€§ï¼Œä½†å¹¶ä¸å¾ˆå¤æ‚ã€‚å¦‚æœä½ æ­£åœ¨è®¾è®¡çš„è¿‡ç¨‹å˜å¾—å¤æ‚ï¼Œé‚£ä¹ˆå‡ ä¹å¯ä»¥è‚¯å®šæ˜¯åœ¨ä»€ä¹ˆåœ°æ–¹æé”™äº†ã€‚ä½ åº”è¯¥å°½å¯èƒ½åœ°åˆ©ç”¨æœ‰åºé›†åˆè¡¨ç¤ºè¿™ä¸€äº‹å®ã€‚ï¼‰
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 #lang sicp (define (make-leaf symbol weight) (list &#39;leaf symbol weight)) (define (leaf? object) (eq? (car object) &#39;leaf)) (define (symbol-leaf x) (cadr x)) (define (weight-leaf x) (caddr x)) (define (make-code-tree left right) (list left right (append (symbols left) (symbols right)) (+ (weight left) (weight right)))) (define (left-branch tree) (car tree)) (define (right-branch tree) (cadr tree)) (define (symbols tree) (if (leaf? tree) (list (symbol-leaf tree)) (caddr tree))) (define (weight tree) (if (leaf? tree) (weight-leaf tree) (cadddr tree))) (define (adjoin-set x set) (cond ((null? set) (list x)) ((&lt; (weight x) (weight (car set))) (cons x set)) (else (cons (car set) (adjoin-set x (cdr set)))))) (define (make-leaf-set pairs) (if (null? pairs) &#39;() (let ((pair (car pairs))) (adjoin-set (make-leaf (car pair) (cadr pair)) (make-leaf-set (cdr pairs)))))) (define (generate-huffman-tree pairs) (successive-merge (make-leaf-set pairs))) (define (successive-merge tree-set) (if (= (length tree-set) 1) (car tree-set) (successive-merge (adjoin-set (make-code-tree (car tree-set) (cadr tree-set)) (cddr tree-set))))) ;&gt;&gt;&gt; (generate-huffman-tree &#39;((A 4) (B 2) (C 1) (D 1))) #; ((leaf A 4) ((leaf B 2) ((leaf D 1) (leaf C 1) (D C) 2) (B D C) 4) (A B D C) 8) ç»ƒä¹  70 ä¸‹é¢å¸¦æœ‰ç›¸å¯¹é¢‘åº¦çš„ 8 ä¸ªç¬¦å·çš„å­—æ¯è¡¨ï¼Œæ˜¯ä¸ºäº†æœ‰æ•ˆç¼–ç  20 ä¸–çºª 50 å¹´ä»£çš„æ‘‡æ»šæ­Œæ›²ä¸­çš„è¯è¯­è€Œè®¾è®¡çš„ã€‚ï¼ˆè¯·æ³¨æ„ï¼Œâ€œå­—æ¯è¡¨â€ä¸­çš„â€œç¬¦å·â€ä¸å¿…æ˜¯å•ä¸ªå­—æ¯ã€‚ï¼‰
A | 2 | NA | 16
BOOM | 1 | SHA | 3
GET | 2 | YIP | 9
JOB | 2 | WAH | 1
è¯·ç”¨ï¼ˆ ç»ƒä¹  69 çš„ï¼‰generate-huffman-tree è¿‡ç¨‹ç”Ÿæˆå¯¹åº”çš„ Huffman æ ‘ï¼Œç”¨ï¼ˆ ç»ƒä¹  68 çš„ï¼‰encode è¿‡ç¨‹ç¼–ç ä¸‹é¢çš„æ¶ˆæ¯ï¼š
Get a job
Sha na na na na na na na na
Get a job
Sha na na na na na na na na
Wah yip yip yip yip yip yip yip yip yip
Sha boom
è¿™ä¸€ç¼–ç éœ€è¦å¤šå°‘ä¸ªäºŒè¿›åˆ¶ä½ï¼Ÿå¦‚æœå¯¹è¿™ 8 ä¸ªç¬¦å·çš„å­—æ¯è¡¨é‡‡ç”¨å®šé•¿ç¼–ç ï¼Œå®Œæˆè¿™ä¸ªæ­Œæ›²çš„ç¼–ç æœ€å°‘éœ€è¦å¤šå°‘ä¸ªäºŒè¿›åˆ¶ä½ï¼Ÿ
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 #lang sicp (define (make-leaf symbol weight) (list &#39;leaf symbol weight)) (define (leaf? object) (eq? (car object) &#39;leaf)) (define (symbol-leaf x) (cadr x)) (define (weight-leaf x) (caddr x)) (define (make-code-tree left right) (list left right (append (symbols left) (symbols right)) (+ (weight left) (weight right)))) (define (left-branch tree) (car tree)) (define (right-branch tree) (cadr tree)) (define (symbols tree) (if (leaf? tree) (list (symbol-leaf tree)) (caddr tree))) (define (weight tree) (if (leaf? tree) (weight-leaf tree) (cadddr tree))) (define (encode message tree) (if (null? message) &#39;() (append (encode-symbol (car message) tree) (encode (cdr message) tree)))) (define (encode-symbol symbol tree) (cond ((not (memq symbol (symbols tree))) (error &#34;bad symbol -- ENCODE-SYMBOL&#34; symbol)) ((leaf? tree) &#39;()) (else (if (memq symbol (symbols (left-branch tree))) (cons &#39;0 (encode-symbol symbol (left-branch tree))) (cons &#39;1 (encode-symbol symbol (right-branch tree))))))) (define (adjoin-set x set) (cond ((null? set) (list x)) ((&lt; (weight x) (weight (car set))) (cons x set)) (else (cons (car set) (adjoin-set x (cdr set)))))) (define (make-leaf-set pairs) (if (null? pairs) &#39;() (let ((pair (car pairs))) (adjoin-set (make-leaf (car pair) (cadr pair)) (make-leaf-set (cdr pairs)))))) (define (generate-huffman-tree pairs) (successive-merge (make-leaf-set pairs))) (define (successive-merge tree-set) (if (= (length tree-set) 1) (car tree-set) (successive-merge (adjoin-set (make-code-tree (car tree-set) (cadr tree-set)) (cddr tree-set))))) #; (define sample-pairs &#39;((A 2) (NA 16) (BOOM 1) (SHA 3) (GET 2) (YIP 9) (JOB 2) (WAH 1))) #; (define sample-message &#39;(GET A JOB SHA NA NA NA NA NA NA NA NA GET A JOB SHA NA NA NA NA NA NA NA NA WAH YIP YIP YIP YIP YIP YIP YIP YIP YIP SHA BOOM)) ;&gt;&gt;&gt; (generate-huffman-tree sample-pairs) #; ((leaf NA 16) ((leaf YIP 9) (((leaf A 2) ((leaf WAH 1) (leaf BOOM 1) (WAH BOOM) 2) (A WAH BOOM) 4) ((leaf SHA 3) ((leaf JOB 2) (leaf GET 2) (JOB GET) 4) (SHA JOB GET) 7) (A WAH BOOM SHA JOB GET) 11) (YIP A WAH BOOM SHA JOB GET) 20) (NA YIP A WAH BOOM SHA JOB GET) 36) ;&gt;&gt;&gt; (encode sample-message (generate-huffman-tree sample-pairs)) ;: (1 1 1 1 1 1 1 0 0 1 1 1 1 0 1 1 1 0 0 0 0 0 0 0 0 0 1 1 1 1 1 1 1 0 0 1 1 1 1 0 1 1 1 0 0 0 0 0 0 0 0 0 1 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 1 1 0 1 1 0 1 1) Huffman ç¼–ç éœ€è¦ 84 ä¸ªäºŒè¿›åˆ¶ä½ï¼Œé‡‡ç”¨å®šé•¿ç¼–ç ï¼Œæ¯ä¸ªå•è¯è‡³å°‘éœ€è¦ 3 ä¸ªäºŒè¿›åˆ¶ä½ï¼Œæ€»å…± 36 ä¸ªå•è¯ï¼Œä¾› 108 ä½ã€‚
ç»ƒä¹  71 å‡å®šæˆ‘ä»¬æœ‰ä¸€æ£µ $n$ ä¸ªç¬¦å·çš„å­—æ¯è¡¨çš„ Huffman æ ‘ï¼Œå…¶ä¸­å„ç¬¦å·çš„ç›¸å¯¹é¢‘åº¦åˆ†åˆ«æ˜¯ $1, 2, 4, \cdots, 2^{n-1}$ã€‚è¯·å¯¹ $n=5$ å’Œ $n=10$ å‹¾å‹’å‡ºæœ‰å…³çš„æ ‘çš„æ ·å­ã€‚å¯¹äºè¿™æ ·çš„æ ‘ï¼ˆå¯¹äºä¸€èˆ¬çš„ $n$ï¼‰ï¼Œç¼–ç å‡ºç°æœ€é¢‘ç¹çš„ç¬¦å·ç”¨å¤šå°‘ä¸ªäºŒè¿›åˆ¶ä½ï¼Ÿæœ€ä¸é¢‘ç¹çš„ç¬¦å·å‘¢ï¼Ÿ
æ ‘çš„æ¯ä¸ªéå¶ç»“ç‚¹è‡³å°‘æœ‰ä¸€æ£µå­æ ‘ä¸ºå¶ç»“ç‚¹ï¼Œæœ€é¢‘ç¹çš„ç¬¦å·ç”¨ $1$ ä¸ªäºŒè¿›åˆ¶ä½ï¼Œæœ€ä¸é¢‘ç¹çš„ç¬¦å·ç”¨ $n-1$ ä¸ªäºŒè¿›åˆ¶ä½ã€‚
ç»ƒä¹  72 è€ƒè™‘ä½ åœ¨ ç»ƒä¹  68 ä¸­è®¾è®¡çš„ç¼–ç è¿‡ç¨‹ã€‚å¯¹äºä¸€ä¸ªç¬¦å·çš„ç¼–ç ï¼Œè®¡ç®—æ­¥æ•°çš„å¢é•¿é€Ÿç‡æ˜¯ä»€ä¹ˆï¼Ÿè¯·æ³¨æ„ï¼Œè¿™æ—¶éœ€è¦æŠŠåœ¨æ¯ä¸ªç»“ç‚¹ä¸­æ£€æŸ¥ç¬¦å·è¡¨æ‰€éœ€çš„æ­¥æ•°åŒ…æ‹¬åœ¨å†…ã€‚ä¸€èˆ¬æ€§åœ°å›ç­”è¿™ä¸€é—®é¢˜æ˜¯éå¸¸å›°éš¾çš„ã€‚ç°åœ¨è€ƒè™‘ä¸€ç±»ç‰¹æ®Šæƒ…å†µï¼Œå…¶ä¸­çš„ $n$ ä¸ªç¬¦å·çš„ç›¸å¯¹é¢‘åº¦å¦‚ ç»ƒä¹  71 æ‰€æè¿°çš„ã€‚è¯·ç»™å‡ºç¼–ç æœ€é¢‘ç¹çš„ç¬¦å·æ‰€éœ€çš„æ­¥æ•°å’Œæœ€ä¸é¢‘ç¹çš„ç¬¦å·æ‰€éœ€çš„æ­¥æ•°çš„å¢é•¿é€Ÿåº¦ï¼ˆä½œä¸º $n$ çš„å‡½æ•°ï¼‰ã€‚
åˆ¤æ–­ç¬¦å·åœ¨ç¼–ç æ ‘ä¸­ $\Theta(n)$ï¼Œæ ‘çš„å¹³å‡æ·±åº¦ $\log(n)$ï¼Œå¢é•¿é€Ÿç‡ $\Theta(n\log(n))$ã€‚
åœ¨ ç»ƒä¹  71 ä¸­ï¼Œæœ€å¥½çš„æƒ…å†µä¸‹ï¼Œæœç´¢æ·±åº¦ä¸º $1$ï¼Œæœ€åçš„æƒ…å†µä¸º $n-1$ï¼Œå› æ­¤æ‰€éœ€çš„æ­¥æ•°åˆ†åˆ«ä¸º $\Theta(n)$ã€$\Theta(n^2)$ã€‚
ç»ƒä¹  73 2.3.2 èŠ‚æè¿°äº†ä¸€ä¸ªæ‰§è¡Œç¬¦å·æ±‚å¯¼çš„ç¨‹åºï¼š
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 (define (deriv exp var) (cond ((number? exp) 0) ((variable? exp) (if (same-variable? exp var) 1 0)) ((sum? exp) (make-sum (deriv (addend exp) var) (deriv (augend exp) var))) ((product? exp) (make-sum (make-product (multiplier exp) (deriv (multiplicand exp) var)) (make-product (deriv (multiplier exp) var) (multiplicand exp)))) (else (error &#34;unknown exporession type -- DERIV&#34; exp)))) å¯ä»¥è®¤ä¸ºï¼Œè¿™ä¸ªç¨‹åºæ˜¯åœ¨æ‰§è¡Œä¸€ç§åŸºäºè¢«æ±‚å¯¼è¡¨è¾¾å¼ç±»å‹çš„åˆ†æ´¾å·¥ä½œã€‚åœ¨è¿™é‡Œï¼Œæ•°æ®çš„â€œç±»å‹æ ‡å¿—â€å°±æ˜¯ä»£æ•°è¿ç®—ç¬¦ï¼ˆä¾‹å¦‚ +ï¼‰ï¼Œéœ€è¦æ‰§è¡Œçš„æ“ä½œæ˜¯ derivã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥å°†è¿™ä¸€ç¨‹åºå˜æ¢åˆ°æ•°æ®å¯¼å‘çš„é£æ ¼ï¼Œå°†åŸºæœ¬æ±‚å¯¼è¿‡ç¨‹é‡æ–°å†™æˆï¼š
1 2 3 4 5 6 7 8 9 (define (deriv exp var) (cond ((number? exp) 0) ((variable? exp) (if (same-variable? exp var) 1 0)) (else ((get &#39;deriv (operator exp)) (operands exp) var)))) (define (operator exp) (car exp)) (define (operands exp) (cdr exp)) a) è¯·è§£é‡Šä¸Šé¢ç©¶ç«Ÿåšäº†äº›ä»€ä¹ˆã€‚ä¸ºä»€ä¹ˆæˆ‘ä»¬æ— æ³•å°†ç›¸è¿‘çš„è°“è¯ number? å’Œ same-variable? ä¹ŸåŠ å…¥æ•°æ®å¯¼å‘åˆ†æ´¾ä¸­ï¼Ÿ
b) è¯·å†™å‡ºé’ˆå¯¹å’Œå¼ä¸ç§¯å¼çš„æ±‚å¯¼è¿‡ç¨‹ï¼Œå¹¶æŠŠå®ƒä»¬å®‰è£…åˆ°è¡¨æ ¼é‡Œï¼Œä»¥ä¾¿ä¸Šé¢ç¨‹åºä½¿ç”¨æ‰€éœ€è¦çš„è¾…åŠ©æ€§ä»£ç ã€‚
c) è¯·é€‰æ‹©ä¸€äº›ä½ å¸Œæœ›åŒ…æ‹¬çš„æ±‚å¯¼è§„åˆ™ï¼Œä¾‹å¦‚å¯¹ä¹˜å¹‚ï¼ˆç»ƒä¹  2.56ï¼‰æ±‚å¯¼ç­‰ç­‰ï¼Œå¹¶å°†å®ƒä»¬å®‰è£…åˆ°è¿™ä¸€æ•°æ®å¯¼å‘çš„ç³»ç»Ÿé‡Œã€‚
d) åœ¨è¿™ä¸€ç®€å•çš„ä»£æ•°è¿ç®—å™¨ä¸­ï¼Œè¡¨è¾¾å¼çš„ç±»å‹å°±æ˜¯æ„é€ èµ·å®ƒä»¬æ¥çš„ä»£æ•°è¿ç®—ç¬¦ã€‚å‡å®šæˆ‘ä»¬æƒ³ä»¥å¦ä¸€ç§ç›¸åçš„æ–¹å¼åšç´¢å¼•ï¼Œä½¿å¾— deriv é‡Œå®Œæˆåˆ†æ´¾çš„ä»£ç è¡Œåƒä¸‹é¢è¿™æ ·ï¼š
1 ((get (operator exp) &#39;deriv) (operands exp) var) æ±‚å¯¼ç³»ç»Ÿé‡Œè¿˜éœ€è¦åšå“ªäº›ç›¸åº”çš„æ”¹åŠ¨ï¼Ÿ
ä¸Šé¢çš„ä»£ç æ ¹æ®è¡¨è¾¾å¼çš„ç±»å‹é€‰æ‹©ç›¸åº”çš„æ±‚å¯¼è¿‡ç¨‹å¤„ç†è¡¨è¾¾å¼ã€‚number? å’Œ same-variable? ç”±äºæ²¡æœ‰è¿ç®—ç¬¦ï¼Œæ— æ³•åˆ¤æ–­è¡¨è¾¾å¼ç±»å‹ï¼Œå³æ— æ³•è°ƒç”¨ operator è¿‡ç¨‹ï¼Œéœ€è¦å•ç‹¬å¤„ç†ã€‚
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 #lang sicp (define (make-table) (let ((local-table (list &#39;*table*))) (define (lookup key-1 key-2) (let ((subtable (assoc key-1 (cdr local-table)))) (if subtable (let ((record (assoc key-2 (cdr subtable)))) (if record (cdr record) false)) false))) (define (insert! key-1 key-2 value) (let ((subtable (assoc key-1 (cdr local-table)))) (if subtable (let ((record (assoc key-2 (cdr subtable)))) (if record (set-cdr! record value) (set-cdr! subtable (cons (cons key-2 value) (cdr subtable))))) (set-cdr! local-table (cons (list key-1 (cons key-2 value)) (cdr local-table))))) &#39;ok) (define (dispatch m) (cond ((eq? m &#39;lookup-proc) lookup) ((eq? m &#39;insert-proc!) insert!) (else (error &#34;Unknown operation -- TABLE&#34; m)))) dispatch)) (define operation-table (make-table)) (define get (operation-table &#39;lookup-proc)) (define put (operation-table &#39;insert-proc!)) (define (variable? x) (symbol? x)) (define (same-variable? x v) (eq? x v)) (define (=number? x num) (and (number? x) (= x num))) (define (deriv exp var) (cond ((number? exp) 0) ((variable? exp) (if (same-variable? exp var) 1 0)) (else ((get &#39;deriv (operator exp)) (operands exp) var)))) (define (operator exp) (car exp)) (define (operands exp) (cdr exp)) (define (install-sum-package) (define (make-sum a1 a2) (cond ((=number? a1 0) a2) ((=number? a2 0) a1) ((and (number? a1) (number? a2)) (+ a1 a2)) (else (list &#39;+ a1 a2)))) (define (addend operands) (car operands)) (define (augend operands) (cadr operands)) (define (deriv-sum operands var) (make-sum (deriv (addend operands) var) (deriv (augend operands) var))) (put &#39;make &#39;+ make-sum) (put &#39;deriv &#39;+ deriv-sum) (display &#34;Install sum package done\n&#34;)) (define (make-sum a1 a2) ((get &#39;make &#39;+) a1 a2)) (define (install-product-package) (define (make-product m1 m2) (cond ((or (=number? m1 0) (=number? m2 0)) 0) ((=number? m1 1) m2) ((=number? m2 1) m1) (else (list &#39;* m1 m2)))) (define (multiplier operands) (car operands)) (define (multiplicand operands) (cadr operands)) (define (deriv-product operands var) (make-sum (make-product (multiplier operands) (deriv (multiplicand operands) var)) (make-product (deriv (multiplier operands) var) (multiplicand operands)))) (put &#39;make &#39;* make-product) (put &#39;deriv &#39;* deriv-product) (display &#34;Install product package done\n&#34;)) (define (make-product m1 m2) ((get &#39;make &#39;*) m1 m2)) (define (** base exponent) (if (= exponent 0) 1 (* base (** base (- exponent 1))))) (define (install-exponentiation-package) (define (make-exponentiation b e) (cond ((=number? e 0) 1) ((=number? e 1) b) ((and (number? b) (number? e)) (** b e)) (else (list &#39;** b e)))) (define (base operands) (car operands)) (define (exponent operands) (cadr operands)) (define (deriv-exponentiation operands var) (make-product (make-product (exponent operands) (make-exponentiation (base operands) (- (exponent operands) 1))) (deriv (base operands) var))) (put &#39;make &#39;** make-exponentiation) (put &#39;deriv &#39;** deriv-exponentiation) (display &#34;Install exponentiation package done\n&#34;)) (define (make-exponentiation b e) ((get &#39;make &#39;**) b e)) (install-sum-package) (install-product-package) (install-exponentiation-package) ;&gt;&gt;&gt; (deriv &#39;(+ (* x x) (* 2 (** x 3))) &#39;x) ;: (+ (+ x x) (* 2 (* 3 (** x 2)))) put è¿‡ç¨‹è°ƒç”¨æ—¶å‰ä¸¤ä¸ªå‚æ•°è°ƒæ¢ä¸€ä¸‹å³å¯ã€‚
ç»ƒä¹  74 Insatiable Enterprise å…¬å¸æ˜¯ä¸€ä¸ªé«˜åº¦åˆ†æ•£ç»è¥çš„è”åˆå…¬å¸ï¼Œç”±å¤§é‡åˆ†å¸ƒåœ¨ä¸–ç•Œå„åœ°çš„åˆ†æ”¯æœºæ„ç»„æˆã€‚å…¬å¸çš„è®¡ç®—æœºè®¾æ–½å·²ç»é€šè¿‡ä¸€ç§éå¸¸å·§å¦™çš„ç½‘ç»œè¿æ¥æ¨¡å¼è”ä¸ºä¸€ä½“ï¼Œå®ƒä½¿å¾—ä»ä»»ä½•ä¸€ä¸ªç”¨æˆ·çš„è§’åº¦çœ‹ï¼Œæ•´ä¸ªç½‘ç»œå°±åƒæ˜¯ä¸€å°è®¡ç®—æœºã€‚åœ¨ç¬¬ä¸€æ¬¡è¯•å›¾åˆ©ç”¨ç½‘ç»œèƒ½åŠ›ä»å„åˆ†æ”¯æœºæ„çš„æ–‡ä»¶ä¸­æå–ç®¡ç†ä¿¡æ¯æ—¶ï¼ŒInsatiable çš„æ€»ç»ç†éå¸¸æ²®ä¸§åœ°å‘ç°ï¼Œè™½ç„¶æ‰€æœ‰åˆ†æ”¯æœºæ„çš„æ–‡ä»¶éƒ½è¢«å®ç°ä¸º Scheme çš„æ•°æ®ç»“æ„ï¼Œä½†æ˜¯å„åˆ†æ”¯æœºæ„æ‰€ç”¨çš„æ•°æ®ç»“æ„å´å„ä¸ç›¸åŒã€‚å¥¹é©¬ä¸Šæ‹›é›†äº†å„åˆ†æ”¯æœºæ„çš„ç»ç†ä¼šè®®ï¼Œå¸Œæœ›å¯»æ‰¾ä¸€ç§ç­–ç•¥é›†æˆèµ·è¿™äº›æ–‡ä»¶ï¼Œä»¥ä¾¿åœ¨ç»´æŒå„ä¸ªåˆ†æ”¯æœºæ„ä¸­ç°å­˜ç‹¬ç«‹å·¥ä½œæ–¹å¼çš„åŒæ—¶ï¼Œåˆèƒ½æ»¡è¶³å…¬å¸æ€»éƒ¨ç®¡ç†çš„éœ€è¦ã€‚
è¯·è¯´æ˜è¿™ç§ç­–ç•¥å¯ä»¥å¦‚ä½•é€šè¿‡æ•°æ®å¯¼å‘çš„ç¨‹åºè®¾è®¡æŠ€æœ¯å®ç°ã€‚ä½œä¸ºä¾‹å­ï¼Œå‡å®šæ¯ä¸ªåˆ†æ”¯æœºæ„çš„äººäº‹è®°å½•éƒ½å­˜æ”¾åœ¨ä¸€ä¸ªç‹¬ç«‹æ–‡ä»¶é‡Œï¼Œå…¶ä¸­åŒ…å«äº†ä¸€é›†ä»¥é›‡å‘˜åå­—ä½œä¸ºé”®å€¼çš„è®°å½•ã€‚è€Œæœ‰å…³é›†åˆçš„ç»“æ„å´ç”±äºåˆ†æ”¯æœºæ„çš„ä¸åŒè€Œä¸åŒã€‚è¿›ä¸€æ­¥è¯´ï¼ŒæŸä¸ªé›‡å‘˜çš„è®°å½•æœ¬èº«åˆæ˜¯ä¸€ä¸ªé›†åˆï¼ˆå„åˆ†æ”¯æœºæ„æ‰€ç”¨çš„ç»“æ„ä¹Ÿä¸åŒï¼‰ï¼Œå…¶ä¸­æ‰€åŒ…å«çš„ä¿¡æ¯ä¹Ÿåœ¨ä¸€äº›ä½œä¸ºé”®å€¼çš„æ ‡è¯†ç¬¦ä¹‹ä¸‹ï¼Œä¾‹å¦‚ address å’Œ salaryã€‚ç‰¹åˆ«æ˜¯è€ƒè™‘å¦‚ä¸‹é—®é¢˜ï¼š
a) è¯·ä¸ºå…¬å¸æ€»éƒ¨å®ç°ä¸€ä¸ª get-record è¿‡ç¨‹ï¼Œä½¿å®ƒèƒ½ä»ä¸€ä¸ªç‰¹å®šçš„äººäº‹æ–‡ä»¶é‡Œæå–å‡ºä¸€ä¸ªç‰¹å®šçš„é›‡å‘˜è®°å½•ã€‚è¿™ä¸€è¿‡ç¨‹åº”è¯¥èƒ½åº”ç”¨äºä»»ä½•åˆ†æ”¯æœºæ„çš„æ–‡ä»¶ã€‚è¯·è¯´æ˜å„ä¸ªç‹¬ç«‹åˆ†æ”¯æœºæ„çš„æ–‡ä»¶åº”å…·æœ‰æ€æ ·çš„ç»“æ„ã€‚ç‰¹åˆ«æ˜¯è€ƒè™‘ï¼Œå®ƒä»¬å¿…é¡»æä¾›å“ªäº›ç±»å‹ä¿¡æ¯ã€‚
b) è¯·ä¸ºå…¬å¸æ€»éƒ¨å®ç°ä¸€ä¸ª get-salary è¿‡ç¨‹ï¼Œå®ƒèƒ½ä»ä»»ä½•åˆ†æ”¯æœºæ„çš„äººäº‹æ–‡ä»¶ä¸­å–å¾—æŸä¸ªç»™å®šé›‡å‘˜çš„è–ªé‡‘ä¿¡æ¯ã€‚ä¸ºäº†ä½¿è¿™ä¸ªæ“ä½œèƒ½å¤Ÿå·¥ä½œï¼Œè¿™äº›è®°å½•åº”å…·æœ‰æ€æ ·çš„ç»“æ„ï¼Ÿ
c) è¯·ä¸ºå…¬å¸æ€»éƒ¨å®ç°ä¸€ä¸ªè¿‡ç¨‹ find-employee-recordï¼Œè¯¥è¿‡ç¨‹éœ€è¦é’ˆå¯¹ä¸€ä¸ªç‰¹å®šé›‡å‘˜åï¼Œåœ¨æ‰€æœ‰åˆ†æ”¯æœºæ„çš„æ–‡ä»¶æŸ¥æ‰¾å¯¹åº”çš„è®°å½•ï¼Œå¹¶è¿”å›æ‰¾åˆ°çš„è®°å½•ã€‚å‡å®šè¿™ä¸€è¿‡ç¨‹çš„å‚æ•°æ˜¯ä¸€ä¸ªé›‡å‘˜åå’Œæ‰€æœ‰åˆ†æ”¯æ–‡ä»¶çš„è¡¨ã€‚
d) å½“ Insatiable è´­å¹¶æ–°å…¬å¸åï¼Œè¦å°†æ–°çš„äººäº‹æ–‡ä»¶ç»“åˆåˆ°ç³»ç»Ÿä¸­ï¼Œå¿…é¡»åšå“ªäº›ä¿®æ”¹ã€‚
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 #lang sicp (define (get-record employee-name personnel-file) (let ((record ((get &#39;get-record (type-tag personnel-file)) employee-name (contents personnel-file)))) (if record (attach-tag (type-tag personnel-file) record) #f))) (define (get-salary record) ((get &#39;get-salary (type-tag record)) (contents record))) (define (find-employee-record employee-name personnel-files) (if (null? personnel-files) #f (let ((record (get-record employee-name (car personnel-files)))) (if record record (find-employee-record employee-name (cdr personnel-files)))))) ç»ƒä¹  75 è¯·ç”¨æ¶ˆæ¯ä¼ é€’çš„é£æ ¼å®ç°æ„é€ å‡½æ•° make-from-mag-angã€‚è¿™ä¸€è¿‡ç¨‹åº”è¯¥ä¸ä¸Šé¢ç»™å‡ºçš„ make-from-real-imag è¿‡ç¨‹ç±»ä¼¼ã€‚
1 2 3 4 5 6 7 8 9 10 11 #lang sicp (define (make-from-mag-ang magnitude angle) (define (dispatch op) (cond ((eq? op &#39;real-part) (* magnitude (cos angle))) ((eq? op &#39;imag-part) (* magnitude (sin angle))) ((eq? op &#39;magnitude) magnitude) ((eq? op &#39;angle) angle) (else (error &#34;Unknown op -- MAKE-FROM-MAG-ANG&#34; op)))) dispatch) ç»ƒä¹  76 ä¸€ä¸ªå¸¦æœ‰é€šç”¨å‹æ“ä½œçš„å¤§å‹ç³»ç»Ÿå¯èƒ½ä¸æ–­æ¼”åŒ–ï¼Œåœ¨æ¼”åŒ–ä¸­å¸¸éœ€è¦åŠ å…¥æ–°çš„æ•°æ®å¯¹è±¡ç±»å‹æˆ–è€…æ–°çš„æ“ä½œã€‚å¯¹äºä¸Šé¢æå‡ºçš„ä¸‰ç§ç­–ç•¥ &mdash;&mdash; å¸¦æœ‰æ˜¾å¼åˆ†æ´¾çš„é€šç”¨å‹æ“ä½œï¼Œæ•°æ®å¯¼å‘çš„é£æ ¼ï¼Œä»¥åŠæ¶ˆæ¯ä¼ é€’çš„é£æ ¼ &mdash;&mdash; è¯·æè¿°åœ¨åŠ å…¥ä¸€ä¸ªæ–°ç±»å‹æˆ–è€…æ–°æ“ä½œæ—¶ï¼Œç³»ç»Ÿæ‰€å¿…é¡»åšçš„ä¿®æ”¹ã€‚å“ªç§ç»„ç»‡æ–¹å¼æœ€é€‚åˆå“ªäº›ç»å¸¸éœ€è¦åŠ å…¥æ–°ç±»å‹çš„ç³»ç»Ÿï¼Ÿå“ªç§ç»„ç»‡æ–¹å¼æœ€é€‚åˆå“ªäº›ç»å¸¸åŠ å…¥æ–°æ“ä½œçš„ç³»ç»Ÿï¼Ÿ
ç­–ç•¥ æ–°ç±»å‹ æ–°æ“ä½œ æ˜¾å¼åˆ†æ´¾ åˆ›å»ºæ–°çš„å‘½åä¸å†²çªçš„è¿‡ç¨‹å¹¶ä¿®æ”¹é€šç”¨å‹è¿‡ç¨‹é€‚é…æ–°ç±»å‹ åœ¨æ¯ä¸ªç±»å‹ä¸­æ·»åŠ æ–°æ“ä½œå¹¶åˆ›å»ºé€šç”¨å‹æ“ä½œ æ•°æ®å¯¼å‘ åˆ›å»ºæ–°çš„è¿‡ç¨‹å¹¶å®‰è£…åˆ°æ“ä½œè¡¨ä¸­ åœ¨æ¯ä¸ªç±»å‹ä¸­æ·»åŠ æ–°æ“ä½œå¹¶å®‰è£…åˆ°æ“ä½œè¡¨ä¸­ æ¶ˆæ¯ä¼ é€’ åˆ›å»ºæ–°çš„è¿‡ç¨‹ åœ¨æ¯ä¸ªç±»å‹ä¸­æ·»åŠ æ–°æ“ä½œ ä¸¤ç§æƒ…å†µæ¶ˆæ¯ä¼ é€’å‡æœ€ä¸ºåˆé€‚ã€‚
ç»ƒä¹  77 Louis Reasoner è¯•ç€å»æ±‚å€¼ (magnitude z)ï¼Œå…¶ä¸­çš„ z å°±æ˜¯å›¾ 2-24 é‡Œçš„é‚£ä¸ªå¯¹è±¡ã€‚ä»¤ä»–åƒæƒŠçš„æ˜¯ï¼Œä» apply-generic å‡ºæ¥çš„ä¸æ˜¯ 5 è€Œæ˜¯ä¸€ä¸ªé”™è¯¯ä¿¡æ¯ï¼Œè¯´æ²¡åŠæ³•å¯¹ç±»å‹ (complex) åšæ“ä½œ magnitudeã€‚ä»–å°†è¿™æ¬¡äº¤äº’çš„æƒ…å†µç»™ Alyssa P. Hacker çœ‹ï¼ŒAlyssa è¯´â€œé—®é¢˜å‡ºåœ¨æ²¡æœ‰ä¸º complex æ•°å®šä¹‰å¤æ•°é€‰æ‹©å‡½æ•°ï¼Œè€Œåªæ˜¯ä¸º polar å’Œ rectangular æ•°å®šä¹‰äº†å®ƒä»¬ã€‚ä½ éœ€è¦åšçš„å°±æ˜¯åœ¨ complex åŒ…é‡ŒåŠ å…¥ä¸‹é¢è¿™äº›ä¸œè¥¿â€ï¼š
1 2 3 4 5 6 7 (put &#39;real-part &#39;(complex) real-part) (put &#39;imag-part &#39;(complex) imag-part) (put &#39;magnitude &#39;(complex) magnitude) (put &#39;angle &#39;(complex) angle) è¯·è¯¦ç»†è¯´æ˜ä¸ºä»€ä¹ˆè¿™æ ·åšæ˜¯å¯è¡Œçš„ã€‚ä½œä¸ºä¸€ä¸ªä¾‹å­ï¼Œè¯·è€ƒè™‘è¡¨è¾¾å¼ (magnitude z) çš„æ±‚å€¼è¿‡ç¨‹ï¼Œå…¶ä¸­ z å°±æ˜¯å›¾ 2-24 é‡Œå±•ç¤ºçš„é‚£ä¸ªå¯¹è±¡ï¼Œè¯·è¿½è¸ªä¸€ä¸‹è¿™ä¸€æ±‚å€¼è¿‡ç¨‹ä¸­çš„æ‰€æœ‰å‡½æ•°è°ƒç”¨ã€‚ç‰¹åˆ«æ˜¯çœ‹çœ‹ apply-generic è¢«è°ƒç”¨äº†å‡ æ¬¡ï¼Ÿæ¯æ¬¡è°ƒç”¨ä¸­åˆ†æ´¾çš„æ˜¯å“ªä¸ªè¿‡ç¨‹ï¼Ÿ
å› ä¸º z çš„æœ€å¤–å±‚æ ‡å¿—ä½ complexï¼ŒåŸæœ‰æ“ä½œè¡¨ä¸­æ²¡æœ‰ magnitude ä¸ complex çš„ç»„åˆï¼Œå› æ­¤æŸ¥æ‰¾å¤±è´¥ï¼›æ·»åŠ ä¹‹åï¼Œè°ƒç”¨ (magnitude z) çš„è¯ä¼šé€å±‚ä¼ é€’åˆ° rectangular çš„ magnitude è¿‡ç¨‹ã€‚
1 2 3 4 5 6 7 (magnitude z) ; call (apply-generic &#39;magnitude z) ((get &#39;magnitude &#39;(complex)) (contents z)) (magnitude (contents z)) ; complex (apply-generic &#39;magnitude (contents z)) ((get &#39;magnitude &#39;(rectangular)) (contents (contents z))) (magnitude (contents (contents z))) ; rectangular apply-generic è¢«è°ƒç”¨äº†ä¸¤æ¬¡ï¼Œç¬¬ä¸€æ¬¡è¢«åˆ†é…ç»™ complex çš„ magnitude è¿‡ç¨‹ï¼Œç¬¬äºŒæ¬¡è¢«åˆ†é…ç»™ rectangular çš„ maginitude è¿‡ç¨‹ã€‚
ç»ƒä¹  78 åŒ… scheme-number é‡Œçš„å†…éƒ¨è¿‡ç¨‹å‡ ä¹ä»€ä¹ˆä¹Ÿæ²¡åšï¼Œåªä¸è¿‡æ˜¯å»è°ƒç”¨åŸºæœ¬è¿‡ç¨‹ +ã€- ç­‰ç­‰ã€‚ç›´æ¥ä½¿ç”¨è¯­è¨€çš„åŸºæœ¬è¿‡ç¨‹å½“ç„¶æ˜¯ä¸å¯èƒ½çš„ï¼Œå› ä¸ºæˆ‘ä»¬çš„æ•°æ®ç±»å‹æ ‡å¿—ç³»ç»Ÿè¦æ±‚æ¯ä¸ªæ•°æ®å¯¹è±¡éƒ½é™„åŠ ä¸€ä¸ªç±»å‹ã€‚ç„¶è€Œï¼Œäº‹å®ä¸Šæ‰€æœ‰ Lisp å®ç°éƒ½æœ‰è‡ªå·±çš„ç±»å‹ç³»ç»Ÿï¼Œä½¿ç”¨åœ¨ç³»ç»Ÿå®ç°çš„å†…éƒ¨ï¼ŒåŸºæœ¬è°“è¯ symbol? å’Œ number? ç­‰ç”¨äºç¡®å®šæ¯ä¸ªæ•°æ®å¯¹è±¡æ˜¯å¦å…·æœ‰ç‰¹å®šçš„ç±»å‹ã€‚è¯·ä¿®æ”¹ 2.4.2 èŠ‚ä¸­ type-tagã€contents å’Œ attach-tag çš„å®šä¹‰ï¼Œä½¿æˆ‘ä»¬çš„é€šç”¨ç®—æœ¯ç³»ç»Ÿå¯ä»¥åˆ©ç”¨ Scheme çš„å†…éƒ¨ç±»å‹ç³»ç»Ÿã€‚è¿™ä¹Ÿå°±æ˜¯è¯´ï¼Œä¿®æ”¹åçš„ç³»ç»Ÿåº”è¯¥åƒåŸæ¥ä¸€æ ·å·¥ä½œï¼Œé™¤äº†å…¶ä¸­å¸¸è§„çš„æ•°ç›´æ¥é‡‡ç”¨ Scheme çš„æ•°å½¢å¼ï¼Œè€Œä¸æ˜¯è¡¨ç¤ºä¸ºä¸€ä¸ª car éƒ¨åˆ†æ˜¯ç¬¦å· scheme-number çš„åºå¯¹ã€‚
è§ ç»ƒä¹  80 ã€‚
ç»ƒä¹  79 è¯·å®šä¹‰ä¸€ä¸ªé€šç”¨å‹ç›¸ç­‰è°“è¯ equ?ï¼Œå®ƒèƒ½æ£€æŸ¥ä¸¤ä¸ªæ•°æ˜¯å¦ç›¸ç­‰ã€‚è¯·å°†å®ƒå®‰è£…åˆ°é€šç”¨ç®—æœ¯åŒ…é‡Œã€‚è¿™ä¸€æ“ä½œåº”è¯¥èƒ½å¤„ç†å¸¸è§„çš„æ•°ã€æœ‰ç†æ•°å’Œå¤æ•°ã€‚
è§ ç»ƒä¹  80 ã€‚
ç»ƒä¹  80 è¯·å®šä¹‰ä¸€ä¸ªé€šç”¨è°“è¯ =zero?ï¼Œæ£€æŸ¥å…¶å‚æ•°æ˜¯å¦ä¸º 0ï¼Œå¹¶å°†å®ƒå®‰è£…åˆ°é€šç”¨ç®—æœ¯åŒ…é‡Œã€‚è¿™ä¸€æ“ä½œåº”è¯¥èƒ½å¤„ç†å¸¸è§„çš„æ•°ã€æœ‰ç†æ•°å’Œå¤æ•°ã€‚
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 241 242 243 244 245 246 247 248 249 250 251 252 253 254 255 256 257 258 259 260 261 262 263 264 265 266 267 268 269 270 271 272 273 274 275 276 277 278 279 280 281 282 283 284 285 286 287 288 289 290 291 292 293 294 295 296 297 298 299 300 301 302 303 304 305 306 307 308 309 310 311 312 313 314 315 316 317 318 319 320 321 322 323 324 325 #lang sicp (define (make-table) (let ((local-table (list &#39;*table*))) (define (lookup key-1 key-2) (let ((subtable (assoc key-1 (cdr local-table)))) (if subtable (let ((record (assoc key-2 (cdr subtable)))) (if record (cdr record) false)) false))) (define (insert! key-1 key-2 value) (let ((subtable (assoc key-1 (cdr local-table)))) (if subtable (let ((record (assoc key-2 (cdr subtable)))) (if record (set-cdr! record value) (set-cdr! subtable (cons (cons key-2 value) (cdr subtable))))) (set-cdr! local-table (cons (list key-1 (cons key-2 value)) (cdr local-table))))) &#39;ok) (define (dispatch m) (cond ((eq? m &#39;lookup-proc) lookup) ((eq? m &#39;insert-proc!) insert!) (else (error &#34;Unknown operation -- TABLE&#34; m)))) dispatch)) (define operation-table (make-table)) (define get (operation-table &#39;lookup-proc)) (define put (operation-table &#39;insert-proc!)) (define (attach-tag type-tag contents) (if (pair? contents) (cons type-tag contents) contents)) (define (type-tag datum) (if (pair? datum) (car datum) &#39;scheme-number)) (define (contents datum) (if (pair? datum) (cdr datum) datum)) (define (apply-generic op . args) (let ((type-tags (map type-tag args))) (let ((proc (get op type-tags))) (if proc (apply proc (map contents args)) (error &#34;No method for these types -- APPLY-GENERIC&#34; (list op type-tags)))))) (define (add x y) (apply-generic &#39;add x y)) (define (sub x y) (apply-generic &#39;sub x y)) (define (mul x y) (apply-generic &#39;mul x y)) (define (div x y) (apply-generic &#39;div x y)) (define (equ? x y) (apply-generic &#39;equ? x y)) (define (=zero? x) (apply-generic &#39;=zero? x)) (define (install-scheme-number-package) (define (tag x) (attach-tag &#39;scheme-number x)) (put &#39;equ? &#39;(scheme-number scheme-number) (lambda (x y) (tag (= x y)))) (put &#39;=zero? &#39;(scheme-number) (lambda (x) (tag (= x 0)))) (put &#39;add &#39;(scheme-number scheme-number) (lambda (x y) (tag (+ x y)))) (put &#39;sub &#39;(scheme-number scheme-number) (lambda (x y) (tag (- x y)))) (put &#39;mul &#39;(scheme-number scheme-number) (lambda (x y) (tag (* x y)))) (put &#39;div &#39;(scheme-number scheme-number) (lambda (x y) (tag (/ x y)))) (put &#39;make &#39;scheme-number (lambda (x) (tag x))) &#39;done) (define (make-scheme-number n) ((get &#39;make &#39;scheme-number) n)) (define (install-rational-package) ;; internal procedures (define (numer x) (car x)) (define (denom x) (cdr x)) (define (make-rat n d) (let ((g (gcd n d))) (cons (/ n g) (/ d g)))) (define (add-rat x y) (make-rat (+ (* (numer x) (denom y)) (* (numer y) (denom x))) (* (denom x) (denom y)))) (define (sub-rat x y) (make-rat (- (* (numer x) (denom y)) (* (numer y) (denom x))) (* (denom x) (denom y)))) (define (mul-rat x y) (make-rat (* (numer x) (numer y)) (* (denom x) (denom y)))) (define (div-rat x y) (make-rat (* (numer x) (denom y)) (* (denom x) (numer y)))) (define (equ? x y) (and (= (numer x) (numer y)) (= (denom x) (denom y)))) (define (=zero? x) (= (numer x) 0)) ;; interface to rest of the system (define (tag x) (attach-tag &#39;rational x)) (put &#39;add &#39;(rational rational) (lambda (x y) (tag (add-rat x y)))) (put &#39;sub &#39;(rational rational) (lambda (x y) (tag (sub-rat x y)))) (put &#39;mul &#39;(rational rational) (lambda (x y) (tag (mul-rat x y)))) (put &#39;div &#39;(rational rational) (lambda (x y) (tag (div-rat x y)))) (put &#39;equ? &#39;(rational rational) (lambda (x y) (tag (equ? x y)))) (put &#39;=zero? &#39;(rational) (lambda (x) (tag (=zero? x)))) (put &#39;make &#39;rational (lambda (n d) (tag (make-rat n d)))) &#39;done) (define (make-rat n d) ((get &#39;make &#39;rational) n d)) (define (square x) (* x x)) (define (install-rectangular-package) (define (real-part z) (car z)) (define (imag-part z) (cdr z)) (define (make-from-real-imag x y) (cons x y)) (define (magnitude z) (sqrt (+ (square (real-part z)) (square (imag-part z))))) (define (angle z) (atan (imag-part z) (real-part z))) (define (make-from-mag-ang r a) (cons (* r (cos a)) (* (r (sin a))))) (define (tag x) (attach-tag &#39;rectangular x)) (put &#39;real-part &#39;(rectangular) real-part) (put &#39;imag-part &#39;(rectangular) imag-part) (put &#39;magnitude &#39;(rectangular) magnitude) (put &#39;angle &#39;(rectangular) angle) (put &#39;make-from-real-imag &#39;rectangular (lambda (x y) (tag (make-from-real-imag x y)))) (put &#39;make-from-mag-ang &#39;rectangular (lambda (r a) (tag (make-from-mag-ang r a)))) &#39;done) (define (install-polar-package) (define (magnitude z) (car z)) (define (angle z) (cdr z)) (define (make-from-mag-ang r a) (cons r a)) (define (real-part z) (* (magnitude z) (cos (angle z)))) (define (imag-part z) (* (magnitude z) (sin (angle z)))) (define (make-from-real-imag x y) (cons (sqrt (+ (square x) (square y))) (atan y x))) (define (tag x) (attach-tag &#39;polar x)) (put &#39;real-part &#39;(polar) real-part) (put &#39;imag-part &#39;(polar) imag-part) (put &#39;magnitude &#39;(polar) magnitude) (put &#39;angle &#39;(polar) angle) (put &#39;make-from-real-imag &#39;polar (lambda (x y) (tag (make-from-real-imag x y)))) (put &#39;make-from-mag-ang &#39;polar (lambda (r a) (tag (make-from-mag-ang r a)))) &#39;done) (define (real-part z) (apply-generic &#39;real-part z)) (define (imag-part z) (apply-generic &#39;imag-part z)) (define (magnitude z) (apply-generic &#39;magnitude z)) (define (angle z) (apply-generic &#39;angle z)) (define (install-complex-package) (define (make-from-real-imag x y) ((get &#39;make-from-real-imag &#39;rectangular) x y)) (define (make-from-mag-ang r a) ((get &#39;make-from-mag-ang &#39;polar) r a)) (define (add-complex z1 z2) (make-from-real-imag (+ (real-part z1) (real-part z2)) (+ (imag-part z1) (imag-part z2)))) (define (sub-complex z1 z2) (make-from-real-imag (- (real-part z1) (real-part z2)) (- (imag-part z2) (imag-part z2)))) (define (mul-complex z1 z2) (make-from-mag-ang (* (magnitude z1) (magnitude z2)) (+ (angle z1) (angle z2)))) (define (div-complex z1 z2) (make-from-mag-ang (/ (magnitude z1) (magnitude z2)) (- (angle z1) (angle z2)))) (define (equ? z1 z2) (or (and (= (real-part z1) (real-part z2)) (= (imag-part z1) (imag-part z2))) (and (= (magnitude z1) (magnitude z2)) (= (angle z1) (angle z2))))) (define (=zero? z) (or (= (magnitude z) 0) (and (= (real-part z) 0) (= (imag-part z) 0)))) (define (tag z) (attach-tag &#39;complex z)) (put &#39;real-part &#39;(complex) real-part) (put &#39;imag-part &#39;(complex) imag-part) (put &#39;magnitude &#39;(complex) magnitude) (put &#39;angle &#39;(complex) angle) (put &#39;add &#39;(complex complex) (lambda (z1 z2) (tag (add-complex z1 z2)))) (put &#39;sub &#39;(complex complex) (lambda (z1 z2) (tag (sub-complex z1 z2)))) (put &#39;mul &#39;(complex complex) (lambda (z1 z2) (tag (mul-complex z1 z2)))) (put &#39;div &#39;(complex complex) (lambda (z1 z2) (tag (div-complex z1 z2)))) (put &#39;equ? &#39;(complex complex) (lambda (z1 z2) (tag (equ? z1 z2)))) (put &#39;=zero? &#39;(complex) (lambda (z) (tag (=zero? z)))) (put &#39;make-from-real-imag &#39;complex (lambda (x y) (tag (make-from-real-imag x y)))) (put &#39;make-from-mag-ang &#39;complex (lambda (r a) (tag (make-from-mag-ang r a)))) &#39;done) (define (make-complex-from-real-imag x y) ((get &#39;make-from-real-imag &#39;complex) x y)) (define (make-complex-from-mag-ang r a) ((get &#39;make-from-mag-ang &#39;complex) r a)) (install-scheme-number-package) (install-rational-package) (install-rectangular-package) (install-polar-package) (install-complex-package) ;&gt;&gt;&gt; (define r1 (make-rat 1 2)) ;&gt;&gt;&gt; (define r2 (make-rat 3 4)) ;&gt;&gt;&gt; (mul r1 r2) ;: (rational 3 . 8) ;&gt;&gt;&gt; (define s1 (make-scheme-number 2)) ;&gt;&gt;&gt; (define s2 (make-scheme-number 3)) ;&gt;&gt;&gt; (div s1 s2) ;: 2/3 ;&gt;&gt;&gt; (add 3 4) ;: 7 ;&gt;&gt;&gt; (define c1 (make-complex-from-real-imag 3 4)) ;&gt;&gt;&gt; (define c2 (make-complex-from-mag-ang 5 (/ 3.1415926 4))) ;&gt;&gt;&gt; (real-part c1) ;: 3 ;&gt;&gt;&gt; (imag-part c1) ;: 4 ;&gt;&gt;&gt; (magnitude c1) ;: 5 ;&gt;&gt;&gt; (cos (angle c1)) ;: 0.6000000000000001 ;&gt;&gt;&gt; (add c1 c2) ;: (complex rectangular 6.53553395329987 . 7.535533858565605) ;&gt;&gt;&gt; (define s1 (make-scheme-number 2)) ;&gt;&gt;&gt; (define s2 (make-scheme-number 3)) ;&gt;&gt;&gt; (equ? s1 s2) ;: #f ;&gt;&gt;&gt; (equ? 4 4) ;: #t ;&gt;&gt;&gt; (define r1 (make-rat 3 4)) ;&gt;&gt;&gt; (define r2 (make-rat 3 4)) ;&gt;&gt;&gt; (equ? r1 r2) ;: #t ;&gt;&gt;&gt; (define c1 (make-complex-from-real-imag 3 4)) ;&gt;&gt;&gt; (define c2 (make-complex-from-mag-ang 5 (/ 3.1415926 4))) ;&gt;&gt;&gt; (equ? c1 c2) ;: #f ;&gt;&gt;&gt; (define s1 (make-scheme-number 2)) ;&gt;&gt;&gt; (define s2 (make-scheme-number 0)) ;&gt;&gt;&gt; (=zero? s1) ;: #f ;&gt;&gt;&gt; (=zero? s2) ;: #t ;&gt;&gt;&gt; (=zero? 0) ;: #t ;&gt;&gt;&gt; (define r1 (make-rat 0 3)) ;&gt;&gt;&gt; (define r2 (make-rat 3 4)) ;&gt;&gt;&gt; (=zero? r1) ;: #t ;&gt;&gt;&gt; (=zero? r2) ;: #f ;&gt;&gt;&gt; (define c1 (make-complex-from-real-imag 0 0)) ;&gt;&gt;&gt; (define c2 (make-complex-from-mag-ang 5 (/ 3.1415926 4))) ;&gt;&gt;&gt; (=zero? c1) ;: #t ;&gt;&gt;&gt; (=zero? c2) ;: #f ç»ƒä¹  81 Louis Reasoner æ³¨æ„åˆ°ï¼Œç”šè‡³åœ¨ä¸¤ä¸ªå‚æ•°çš„ç±»å‹å®é™…ç›¸åŒçš„æƒ…å†µä¸‹ï¼Œapply-generic ä¹Ÿå¯èƒ½è¯•å›¾å»åšå‚æ•°é—´çš„ç±»å‹å¼ºåˆ¶ã€‚ç”±æ­¤ä»–æ¨è®ºè¯´ï¼Œéœ€è¦åœ¨å¼ºåˆ¶è¡¨æ ¼ä¸­åŠ å…¥ä¸€äº›è¿‡ç¨‹ï¼Œä»¥å°†æ¯ä¸ªç±»å‹çš„å‚æ•°â€œå¼ºåˆ¶â€åˆ°å®ƒä»¬è‡ªå·±çš„ç±»å‹ã€‚ä¾‹å¦‚ï¼Œé™¤äº†ä¸Šé¢ç»™å‡ºçš„ scheme-number-&gt;complex å¼ºåˆ¶ä¹‹å¤–ï¼Œä»–è§‰å¾—åº”è¯¥æœ‰ï¼š
1 2 3 4 5 6 7 8 (define (scheme-number-&gt;scheme-number n) n) (define (complex-&gt;complex z) z) (put-coercion &#39;scheme-number &#39;scheme-number scheme-number-&gt;scheme-number) (put-coercion &#39;complex &#39;complex complex-&gt;complex) a) å¦‚æœå®‰è£…äº† Louis çš„å¼ºåˆ¶è¿‡ç¨‹ï¼Œå¦‚æœåœ¨è°ƒç”¨ apply-generic æ—¶å„å‚æ•°çš„ç±»å‹éƒ½ä¸º scheme-number æˆ–è€…ç±»å‹éƒ½ä¸º complexï¼Œè€Œåœ¨è¡¨æ ¼ä¸­åˆæ‰¾ä¸åˆ°ç›¸åº”çš„æ“ä½œï¼Œè¿™æ—¶ä¼šå‡ºç°ä»€ä¹ˆæƒ…å†µï¼Ÿä¾‹å¦‚ï¼Œå‡å®šæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªé€šç”¨å‹çš„æ±‚å¹‚è¿ç®—ï¼š
1 (define (exp x y) (apply-generic &#39;exp x y)) å¹¶åœ¨ Scheme æ•°å€¼åŒ…é‡Œæ”¾å…¥äº†ä¸€ä¸ªæ±‚å¹‚è¿‡ç¨‹ï¼Œä½†å…¶ä»–ç¨‹åºåŒ…é‡Œéƒ½æ²¡æœ‰ï¼š
1 2 3 ;;following added to Scheme-number package (put &#39;exp &#39;(scheme-number scheme-number) (lambda (x y) (tag (expt x y)))) ; using primitive expt å¦‚æœå¯¹ä¸¤ä¸ªå¤æ•°è°ƒç”¨ exp ä¼šå‡ºç°ä»€ä¹ˆæƒ…å†µï¼Ÿ
b) Louis çœŸçš„çº æ­£äº†æœ‰å…³åŒæ ·ç±»å‹å‚æ•°çš„å¼ºåˆ¶é—®é¢˜å—ï¼Ÿapply-generic è¿˜èƒ½åƒåŸæ¥é‚£æ ·æ­£ç¡®å·¥ä½œå—ï¼Ÿ
c) è¯·ä¿®æ”¹ apply-genericï¼Œä½¿ä¹‹ä¸ä¼šè¯•ç€å»å¼ºåˆ¶ä¸¤ä¸ªåŒæ ·ç±»å‹çš„å‚æ•°ã€‚
ç¨‹åºä¼šä¸€ç›´åš complex åˆ° complex çš„ç±»å‹è½¬æ¢ï¼Œé™·å…¥æ­»å¾ªç¯ã€‚
æ²¡æœ‰è§£å†³ï¼Œå½“é‡åˆ°æ²¡æœ‰å¤„ç†ä¸¤ä¸ªç›¸åŒç±»å‹å‚æ•°çš„è¿‡ç¨‹æ—¶ï¼Œå°±ä¼šé™·å…¥æ­»å¾ªç¯ï¼Œä¿®æ”¹å¦‚ä¸‹ï¼š
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 (define (apply-generic op . args) (let ((type-tags (map type-tag args))) (let ((proc (get op type-tags))) (if proc (apply proc (map contents args)) (if (= (length args) 2) (let ((type1 (car type-tags)) (type2 (cadr type-tags)) (a1 (car args)) (a2 (cadr args))) (if (eq? type1 type2) (error &#34;No method for these types&#34; (list op type-tags)) (let ((t1-&gt;t2 (get-coercion type1 type2)) (t2-&gt;t1 (get-coercion type2 type1))) (cond (t1-&gt;t2 (apply-generic op (t1-&gt;t2 a1) a2)) (t2-&gt;t1 (apply-generic op a1 (t2-&gt;t1 a2))) (else (error &#34;No method for these types&#34; (list op type-tags))))))) (error &#34;No method for these types&#34; (list op type-tags))))))) ç»ƒä¹  82 è¯·é˜è¿°ä¸€ç§æ–¹æ³•ï¼Œè®¾æ³•æ¨å¹¿ apply-genericï¼Œä»¥ä¾¿å¤„ç†å¤šä¸ªå‚æ•°çš„ä¸€èˆ¬æ€§æƒ…å†µä¸‹çš„å¼ºåˆ¶é—®é¢˜ã€‚ä¸€ç§å¯èƒ½ç­–ç•¥æ˜¯è¯•ç€å°†æ‰€æœ‰å‚æ•°éƒ½å¼ºåˆ¶åˆ°ç¬¬ä¸€ä¸ªå‚æ•°çš„ç±»å‹ï¼Œè€Œåè¯•ç€å¼ºåˆ¶åˆ°ç¬¬äºŒä¸ªå‚æ•°çš„ç±»å‹ï¼Œå¹¶å¦‚æ­¤è¯•ä¸‹å»ã€‚è¯·ç»™å‡ºä¸€ä¸ªä¾‹å­è¯´æ˜è¿™ç§ç­–ç•¥è¿˜ä¸å¤Ÿä¸€èˆ¬ï¼ˆå°±åƒä¸Šé¢å¯¹ä¸¤ä¸ªå‚æ•°çš„æƒ…å†µç»™å‡ºçš„ä¾‹å­é‚£æ ·ï¼‰ã€‚ï¼ˆæç¤ºï¼šè¯·è€ƒè™‘ä¸€äº›æƒ…å†µï¼Œå…¶ä¸­è¡¨æ ¼é‡ŒæŸäº›åˆç”¨çš„æ“ä½œå°†ä¸ä¼šè¢«è€ƒè™‘ã€‚ï¼‰
ä¸å¤Ÿä¸€èˆ¬ï¼šå¯èƒ½å­˜åœ¨ç›¸åŒç±»å‹çš„å‚æ•°ï¼Œæ­¤æ—¶æ²¡å¿…è¦ç›¸äº’å¼ºåˆ¶ã€‚ä¸€èˆ¬åŒ–çš„ apply-generic å¦‚ä¸‹ï¼š
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 #lang sicp (define (same-type? type-tags) (let ((type (car type-tags))) (define (iter type-tags) (if (null? type-tags) true (and (eq? type (car type-tags)) (iter (cdr type-tags))))) (iter (cdr type-tags)))) (define (get-types type-tags) (define (iter types rest-type-tags) (if (null? rest-type-tags) types (if (memq (car rest-type-tags) types) (iter types (cdr rest-type-tags)) (iter (cons (car rest-type-tags) types) (cdr rest-type-tags))))) (iter &#39;() type-tags)) (define (coercion type args) (define (iter rest-args) (if (null? rest-args) &#39;() (let ((type2 (type-tag (car rest-args)))) (if (eq? type type2) (let ((proc (get-coercion type2 type))) (if proc (cons (proc (car rest-args)) (iter (cdr rest-args))) false)))))) (iter args)) (define (apply-generic op . args) (let ((type-tags (map type-tag args))) (let ((proc (get op type-tags))) (if proc (apply proc (map contents args)) (if (same-type? type-tags) (error &#34;No method for these types&#34; (list op type-tags)) (let ((types (get-types type-tags))) (define (handle types) (if (null? types) (error &#34;No method for these types&#34; (list op type-tags)) (let ((same-type-args (coercion (car types) args))) (if same-type-args (let ((proc (get op (map type-tag same-type-args)))) (if proc (apply proc same-type-args) (handle (cdr types) args))) (handle (cdr types) args))))) (handle types))))))) ç»ƒä¹  83 å‡å®šä½ æ­£åœ¨è®¾è®¡ä¸€ä¸ªé€šç”¨å‹çš„ç®—æœ¯åŒ…ï¼Œå¤„ç†å›¾ 2-25 æ‰€ç¤ºçš„ç±»å‹å¡”ï¼ŒåŒ…æ‹¬æ•´æ•°ã€æœ‰ç†æ•°ã€å®æ•°å’Œå¤æ•°ã€‚è¯·ä¸ºæ¯ä¸ªç±»å‹ï¼ˆé™¤å¤æ•°å¤–ï¼‰è®¾è®¡ä¸€ä¸ªè¿‡ç¨‹ï¼Œå®ƒèƒ½å°†è¯¥ç±»å‹çš„å¯¹è±¡æå‡åˆ°å¡”ä¸­çš„ä¸Šé¢ä¸€å±‚ã€‚è¯·è¯´æ˜å¦‚ä½•å®‰è£…ä¸€ä¸ªé€šç”¨çš„ raise æ“ä½œï¼Œä½¿ä¹‹èƒ½å¯¹å„ä¸ªç±»å‹å·¥ä½œï¼ˆé™¤å¤æ•°ä¹‹å¤–ï¼‰ã€‚
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 #lang sicp (define (raise x) (apply-generic &#39;raise x)) ;; add into scheme-number package (put &#39;raise &#39;(scheme-number) (lambda (x) (tag (make-rat x 1)))) ;; add into rational package (put &#39;raise &#39;(rational) (lambda (x) (tag (make-real (/ (numer x) (denom x)))))) ;; add into real package (put &#39;raise &#39;(real) (lambda (x) (tag (make-complex-from-real-imag x 0)))) ç»ƒä¹  84 åˆ©ç”¨ ç»ƒä¹  83 çš„ raise æ“ä½œä¿®æ”¹ apply-generic è¿‡ç¨‹ï¼Œä½¿å®ƒèƒ½é€šè¿‡é€å±‚æå‡çš„æ–¹å¼å°†å‚æ•°å¼ºåˆ¶åˆ°åŒæ ·çš„ç±»å‹ï¼Œæ­£å¦‚æœ¬èŠ‚ä¸­è®¨è®ºçš„ã€‚ä½ å°†éœ€è¦å®‰æ’ä¸€ç§æ–¹å¼ï¼Œå»æ£€æŸ¥ä¸¤ä¸ªç±»å‹ä¸­å“ªä¸ªæ›´é«˜ã€‚è¯·ä»¥ä¸€ç§èƒ½ä¸ç³»ç»Ÿä¸­å…¶ä»–éƒ¨åˆ†â€œç›¸å®¹â€ï¼Œè€Œä¸”åˆä¸ä¼šå½±å“å‘å¡”ä¸­åŠ å…¥æ–°å±‚æ¬¡çš„æ–¹å¼å®Œæˆè¿™ä¸€å·¥ä½œã€‚
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 #lang sicp (define (same-type? type-tags) (let ((type (car type-tags))) (define (iter type-tags) (if (null? type-tags) true (and (eq? type (car type-tags)) (iter (cdr type-tags))))) (iter (cdr type-tags)))) (define (get-types type-tags) (define (iter types rest-type-tags) (if (null? rest-type-tags) types (if (memq (car rest-type-tags) types) (iter types (cdr rest-type-tags)) (iter (cons (car rest-type-tags) types) (cdr rest-type-tags))))) (iter &#39;() type-tags)) (define tower &#39;(integer rational real complex)) (define (higher? type1 type2) (let ((length1 (length (memq type1 tower))) (length2 (length (memq type2 tower)))) (&lt; length1 length2))) (define (get-top types) (define (iter top rest-types) (if (null? rest-types) top (if (higher? (car rest-types) top) (iter (car rest-types) (cdr rest-types)) (iter top (cdr rest-types))))) (iter &#39;integer types)) (define (multi-raise type arg) (if (eq? (type-tag arg) type) arg (multi-raise type (raise arg)))) (define (apply-generic op . args) (let ((type-tags (map type-tag args))) (let ((proc (get op type-tags))) (if proc (apply proc (map contents args)) (if (same-type? type-tags) (error &#34;No method for these types&#34; (list op type-tags)) (let ((types (get-types type-tags))) (let ((top (get-top types))) (let ((same-type-args (map (lambda (arg) (multi-raise top arg)) args))) (let ((proc (get op (map type-tag same-type-args)))) (if proc (apply proc same-type-args) (error &#34;No method for these types&#34; (list op type-tags)))))))))))) ç»ƒä¹  85 æœ¬èŠ‚ä¸­æåˆ°äº†â€œç®€åŒ–â€æ•°æ®å¯¹è±¡è¡¨ç¤ºçš„ä¸€ç§æ–¹æ³•ï¼Œå°±æ˜¯ä½¿ä¹‹åœ¨ç±»å‹å¡”ä¸­å°½å¯èƒ½åœ°ä¸‹é™ã€‚è¯·è®¾è®¡ä¸€ä¸ªè¿‡ç¨‹ dropï¼ˆä¸‹è½ï¼‰ï¼Œä½¿å®ƒèƒ½åœ¨å¦‚ ç»ƒä¹  83 æ‰€æè¿°çš„ ç±»å‹å¡”ä¸­å®Œæˆè¿™ä¸€å·¥ä½œã€‚è¿™é‡Œçš„å…³é”®æ˜¯ä»¥æŸç§ä¸€èˆ¬æ€§çš„æ–¹å¼ï¼Œåˆ¤æ–­ä¸€ä¸ªæ•°æ®å¯¹è±¡èƒ½å¦ä¸‹é™ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œå¤æ•° $1.5 + 0i$ è‡³å¤šå¯ä»¥ä¸‹é™åˆ° realï¼Œå¤æ•° $1 + 0i$ è‡³å¤šå¯ä»¥ä¸‹é™åˆ° integerï¼Œè€Œå¤æ•° $2 + 3i$ å°±æ ¹æœ¬æ— æ³•ä¸‹é™ã€‚ç°åœ¨æå‡ºä¸€ç§ç¡®å®šä¸€ä¸ªå¯¹è±¡èƒ½å¦ä¸‹é™çš„è®¡åˆ’ï¼šé¦–å…ˆå®šä¹‰ä¸€ä¸ªè¿ç®— projectï¼ˆæŠ•å½±ï¼‰ï¼Œå®ƒå°†ä¸€ä¸ªå¯¹è±¡â€œå‹â€åˆ°å¡”çš„ä¸‹é¢ä¸€å±‚ã€‚ä¾‹å¦‚ï¼ŒæŠ•å½±ä¸€ä¸ªå¤æ•°å°±æ˜¯ä¸¢æ‰å…¶è™šéƒ¨ã€‚è¿™æ ·ï¼Œä¸€ä¸ªæ•°èƒ½å¤Ÿå‘ä¸‹è½ï¼Œå¦‚æœæˆ‘ä»¬é¦–å…ˆ project å®ƒè€Œåå°†å¾—åˆ°çš„ç»“æœ raise åˆ°å¼€å§‹çš„ç±»å‹ï¼Œæœ€ç»ˆå¾—åˆ°çš„ä¸œè¥¿ä¸å¼€å§‹çš„ä¸œè¥¿ç›¸ç­‰ã€‚è¯·é˜è¿°å®ç°è¿™ä¸€æƒ³æ³•çš„å…·ä½“ç»†èŠ‚ï¼Œå¹¶å†™å‡ºä¸€ä¸ª drop è¿‡ç¨‹ï¼Œä½¿å®ƒå¯ä»¥å°†ä¸€ä¸ªå¯¹è±¡å°½å¯èƒ½ä¸‹è½ã€‚ä½ å°†éœ€è¦è®¾è®¡å„ç§å„æ ·çš„æŠ•å½±å‡½æ•°ï¼Œå¹¶éœ€è¦æŠŠ project å®‰è£…ä¸ºç³»ç»Ÿé‡Œçš„ä¸€ä¸ªé€šç”¨å‹æ“ä½œã€‚ä½ è¿˜éœ€è¦ä½¿ç”¨ä¸€ä¸ªé€šç”¨å‹çš„ç›¸ç­‰è°“è¯ï¼Œä¾‹å¦‚ ç»ƒä¹  79 æ‰€æè¿°çš„ã€‚æœ€åï¼Œè¯·åˆ©ç”¨ drop é‡å†™ ç»ƒä¹  84 çš„ apply-genericï¼Œä½¿ä¹‹å¯ä»¥â€œç®€åŒ–â€å…¶ç»“æœã€‚
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 #lang sicp (define (project x) (apply-generic &#39;project x)) (define (droppable? x) (equ? x (raise (project x)))) (define (drop x) (if (droppable? x) (drop (project x)) x)) ;; add into rational package (put &#39;project &#39;(rational) (lambda (x) (tag (make-scheme-number (round (/ (numer x) (denom x))))))) ;; add into real package (put &#39;project &#39;(real) (lambda (x) (tag (make-rat (* x 1e9) 1e9)))) ;; add into complex package (put &#39;project &#39;(complex) (lambda (x) (tag (make-real (real-part x))))) (define (apply-generic op . args) (let ((args2 (map drop args))) (let ((type-tags (map type-tag args2))) (let ((proc (get op type-tags))) (if proc (apply proc (map contents args2)) (if (same-type? type-tags) (error &#34;No method for these types&#34; (list op (map type-tag args))) (let ((types (get-types type-tags))) (let ((top (get-top types))) (let ((same-type-args (map (lambda (arg) (multi-raise top arg)) args2))) (let ((proc (get op (map type-tag same-type-args)))) (if proc (apply proc same-type-args) (error &#34;No method for these types&#34; (list op (map type-tag args))))))))))))) ç»ƒä¹  86 å‡å®šæˆ‘ä»¬å¸Œæœ›å¤„ç†ä¸€äº›å¤æ•°ï¼Œå®ƒä»¬çš„å®éƒ¨ã€è™šéƒ¨ã€æ¨¡å’Œå¹…è§’éƒ½å¯ä»¥æ˜¯å¸¸è§„æ•°å€¼ã€æœ‰ç†æ•°ï¼Œæˆ–è€…æˆ‘ä»¬å¸Œæœ›åŠ å…¥ç³»ç»Ÿçš„ä»»ä½•å…¶ä»–æ•°å€¼ç±»å‹ã€‚è¯·æè¿°å’Œå®ç°ç³»ç»Ÿéœ€è¦åšçš„å„ç§ä¿®æ”¹ï¼Œä»¥æ»¡è¶³è¿™ä¸€éœ€è¦ã€‚ä½ åº”è®¾æ³•å°†ä¾‹å¦‚ sine å’Œ cosine ä¸€ç±»çš„è¿ç®—ä¹Ÿå®šä¹‰ä¸ºåœ¨å¸¸è§„æ•°å’Œæœ‰ç†æ•°ä¸Šçš„é€šç”¨è¿ç®—ã€‚
å°†å¤æ•°åŒ…é‡Œé¢çš„å„ç§åŸºæœ¬ç®—æœ¯æ“ä½œå…¨éƒ¨æ›¿æ¢æˆé€šç”¨å‹ç®—æœ¯æ“ä½œã€‚
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 #lang sicp (define (sine x) (apply-generic &#39;sine x)) (define (cosine x) (apply-generic &#39;cosine x)) ;; add into scheme-number package (put &#39;sine &#39;(scheme-number) (lambda (x) (tag (sin x)))) (put &#39;cosine &#39;(scheme-number) (lambda (x) (tag (cos x)))) ;; add into rational package (pur &#39;sine &#39;(rational) (lambda (x) (tag (sin (/ (numer x) (denom x)))))) (pur &#39;cosine &#39;(rational) (lambda (x) (tag (cos (/ (numer x) (denom x)))))) ç»ƒä¹  87 è¯·åœ¨é€šç”¨ç®—æœ¯åŒ…ä¸­ä¸ºå¤šé¡¹å¼å®‰è£… =zero?ï¼Œè¿™å°†ä½¿ adjoin-term ä¹Ÿèƒ½å¯¹ç³»æ•°æœ¬èº«ä¹Ÿæ˜¯å¤šé¡¹å¼çš„å¤šé¡¹å¼ä½¿ç”¨ã€‚
1 2 3 4 5 6 7 8 9 10 11 12 13 #lang sicp ;; add into polynomial package (define (=zero-poly? p) (define (iter terms) (if (empty-termlist? terms) true (and (=zero? (coeff (first-term terms))) (iter (rest-terms terms))))) (iter (term-list p))) (put &#39;=zero? &#39;(polynomial) (lambda (p) (=zero-poly? p))) ç»ƒä¹  88 è¯·æ‰©å……å¤šé¡¹å¼ç³»ç»Ÿï¼ŒåŠ ä¸Šå¤šé¡¹å¼çš„å‡æ³•ã€‚ï¼ˆæç¤ºï¼šä½ å¯èƒ½å‘ç°å®šä¹‰ä¸€ä¸ªé€šç”¨çš„æ±‚è´Ÿæ“ä½œéå¸¸æœ‰ç”¨ã€‚ï¼‰
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 #lang sicp (define (inverse x) (apply-generic &#39;inverse x)) ;; add into schme-number package (put &#39;inverse &#39;(scheme-number) (lambda (x) (tag (make-scheme-number (- x))))) ;; add into rational package (put &#39;inverse &#39;(rational) (lambda (x) (tag (make-rat (- (numer x)) (denom x))))) ;; add into real package (put &#39;inverse &#39;(real) (lambda (x) (tag (make-rat (- x ))))) ;; add into complex package (put &#39;inverse &#39;(complex) (lambda (x) (tag (make-complex-from-real-imag (- (real-part x)) (- (imag-part x)))))) ;; add into polynominal package (define (sub-poly p1 p2) (add-poly p2 (inverse p2))) (put &#39;inverse &#39;(polynominal) (lambda (p) (tag (make-poly (variable p) (map (lambda (term) (make-term (order term) (inverse (coeff term)))) (term-list p)))))) (put &#39;sub &#39;(polynominal polynominal) (lambda (p1 p2) (tag (sub-poly p1 p2)))) ç»ƒä¹  89 è¯·å®šä¹‰ä¸€äº›è¿‡ç¨‹ï¼Œå®ç°ä¸Šé¢è®¨è®ºçš„é€‚å®œç¨ å¯†å¤šé¡¹å¼çš„é¡¹è¡¨è¡¨ç¤ºã€‚
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 #lang sicp (define (adjoin-term term term-list) (if (=zero? (coeff term)) term-list (let ((order1 (order term)) (order2 (- (length term-list) 1))) (cond ((&lt; order1 order2) (cons (first-term term-list) (adjoin-term term (rest-terms term-list)))) ((= order1 order2) (cons (coeff term) (rest-terms term-list))) (else (adjoin-term term (cons 0 term-list))))))) (define (first-term term-list) (list (- (length term-list) 1) (car term-list))) ç»ƒä¹  90 å‡å®šæˆ‘ä»¬å¸Œæœ›æœ‰ä¸€ä¸ªå¤šé¡¹å¼ç³»ç»Ÿï¼Œå®ƒåº”è¯¥å¯¹ç¨ å¯†å¤šé¡¹å¼å’Œç¨€ç–å¤šé¡¹å¼éƒ½éå¸¸æœ‰æ•ˆã€‚ä¸€ç§é€”å¾„å°±æ˜¯åœ¨æˆ‘ä»¬çš„ç³»ç»Ÿé‡ŒåŒæ—¶å…è®¸ä¸¤ç§è¡¨ç¤ºå½¢å¼ã€‚è¿™æ—¶çš„æƒ…å†µç±»ä¼¼äº 2.4 èŠ‚å¤æ•°çš„ä¾‹å­ï¼Œé‚£é‡ŒåŒæ—¶å…è®¸é‡‡ç”¨ç›´è§’åæ ‡è¡¨ç¤ºå’Œæåæ ‡è¡¨ç¤ºã€‚ä¸ºäº†å®Œæˆè¿™ä¸€å·¥ä½œï¼Œæˆ‘ä»¬å¿…é¡»åŒºåˆ†ä¸åŒçš„é¡¹è¡¨ç±»å‹ï¼Œå¹¶å°†é’ˆå¯¹é¡¹è¡¨çš„æ“ä½œé€šç”¨åŒ–ã€‚è¯·é‡æ–°è®¾è®¡è¿™ä¸ªå¤šé¡¹å¼ç³»ç»Ÿï¼Œå®ç°è¿™ç§æ¨å¹¿ã€‚è¿™å°†æ˜¯ä¸€é¡¹éœ€è¦ä»˜å‡ºå¾ˆå¤šåŠªåŠ›çš„å·¥ä½œï¼Œè€Œä¸æ˜¯ä¸€ä¸ªå±€éƒ¨ä¿®æ”¹ã€‚
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 #lang sicp (define (install-sparse-term-list) (define (adjoin-term term term-list) (if (=zero? (coeff term)) term-list (cons term term-list))) (define (first-term term-list) (car term-list)) (define (rest-terms term-list) (cdr term-lists)) (define (tag term-list) (attach-tag &#39;sparse term-list)) (put &#39;adjoin-term &#39;sparse adjoin-term) (put &#39;first-term &#39;(sparse) first-term) (put &#39;rest-terms &#39;(sparse) (lambda (term-list) (tag (rest-terms term-list)))) &#39;done) (define (install-dense-term-list) (define (adjoin-term term term-list) (if (=zero? (coeff term)) term-list (let ((order1 (order term)) (order2 (- (length term-list) 1))) (cond ((&lt; order1 order2) (cons (first-term term-list) (adjoin-term term (rest-terms term-list)))) ((= order1 order2) (cons (coeff term) (rest-terms term-list))) (else (adjoin-term term (cons 0 term-list))))))) (define (first-term term-list) (list (- (length term-list) 1) (car term-list))) (define (rest-terms term-list) (cdr term-lists)) (define (tag term-list) (attach-tag &#39;dense term-list)) (put &#39;adjoin-term &#39;dense adjoin-term) (put &#39;first-term &#39;(dense) first-term) (put &#39;rest-terms &#39;(dense) (lambda (term-list) (tag (rest-terms term-list)))) &#39;done) (define (adjoin-term term term-list) ((get &#39;adjoin-term (type-tag term-list)) term term-list)) (define (first-term term-list) (apply-generic &#39;first-term term-list)) (define (rest-terms term-list) (apply-generic &#39;rest-terms term-list)) ç»ƒä¹  91 ä¸€ä¸ªå•å˜å…ƒå¤šé¡¹å¼å¯ä»¥é™¤ä»¥å¦ä¸€ä¸ªå¤šé¡¹å¼ï¼Œäº§ç”Ÿå‡ºä¸€ä¸ªå•†å¼å’Œä¸€ä¸ªä½™å¼ï¼Œä¾‹å¦‚
$$ \frac{x^5 - 1}{x^2 - 1} = x^3 + x\quad ,\quad\text{ä½™å¼ } x - 1 $$
é™¤æ³•å¯ä»¥é€šè¿‡é•¿é™¤å®Œæˆã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œç”¨è¢«é™¤å¼çš„æœ€é«˜æ¬¡é¡¹é™¤ä»¥é™¤å¼çš„æœ€é«˜æ¬¡é¡¹ï¼Œå¾—åˆ°å•†å¼çš„ç¬¬ä¸€é¡¹ï¼›è€Œåç”¨è¿™ä¸ªç»“æœä¹˜ä»¥é™¤å¼ï¼Œå¹¶ä»è¢«é™¤å¼ä¸­å‡å»è¿™ä¸ªä¹˜ç§¯ã€‚å‰©ä¸‹çš„å·¥ä½œå°±æ˜¯ç”¨å‡åå¾—åˆ°çš„å·®ä½œä¸ºæ–°çš„è¢«é™¤å¼ï¼Œä»¥ä¾¿äº§ç”Ÿå‡ºéšåçš„ç»“æœã€‚å½“é™¤å¼çš„æ¬¡æ•°è¶…è¿‡è¢«é™¤å¼çš„æ¬¡æ•°æ—¶ç»“æŸï¼Œå°†æ­¤æ—¶çš„è¢«é™¤å¼ä½œä¸ºä½™å¼ã€‚è¿˜æœ‰ï¼Œå¦‚æœè¢«é™¤å¼å°±æ˜¯ $0$ï¼Œé‚£ä¹ˆå°±è¿”å› $0$ ä½œä¸ºå•†å’Œä½™å¼ã€‚
æˆ‘ä»¬å¯ä»¥åŸºäº add-poly å’Œ mul-poly çš„æ¨¡å‹ï¼Œè®¾è®¡å‡ºä¸€ä¸ªé™¤æ³•è¿‡ç¨‹ div-polyã€‚è¿™ä¸€è¿‡ç¨‹é¦–å…ˆæ£€æŸ¥ä¸¤ä¸ªå¤šé¡¹å¼æ˜¯å¦å…·æœ‰ç›¸åŒçš„å˜å…ƒï¼Œå¦‚æœæ˜¯çš„è¯å°±å‰¥å»è¿™ä¸€å˜å…ƒï¼Œå°†é—®é¢˜é€ç»™è¿‡ç¨‹ div-termsï¼Œå®ƒæ‰§è¡Œé¡¹è¡¨ä¸Šçš„é™¤æ³•è¿ç®—ã€‚div-poly æœ€åå°†å˜å…ƒé‡æ–°é™„åŠ åˆ° div-terms è¿”å›çš„ç»“æœä¸Šã€‚å°† div-terms è®¾è®¡ä¸ºåŒæ—¶è®¡ç®—å‡ºé™¤æ³•çš„å•†å¼å’Œä½™å¼æ˜¯æ¯”è¾ƒæ–¹ä¾¿çš„ã€‚div-terms å¯ä»¥ä»¥ä¸¤ä¸ªè¡¨ä¸ºå‚æ•°ï¼Œè¿”å›ä¸€ä¸ªå•†å¼çš„è¡¨å’Œä¸€ä¸ªä½™å¼çš„è¡¨ã€‚
è¯·å®Œæˆä¸‹é¢ div-termns çš„å®šä¹‰ï¼Œå¡«å……å…¶ä¸­ç©ºç¼ºçš„è¡¨è¾¾å¼ï¼Œå¹¶åŸºäºå®ƒå®ç° div-polyã€‚è¯¥è¿‡ç¨‹åº”è¯¥ä»¥ä¸¤ä¸ªå¤šé¡¹å¼ä¸ºå‚æ•°ï¼Œè¿”å›ä¸€ä¸ªåŒ…å«å•†å’Œä½™å¼å¤šé¡¹å¼çš„è¡¨ã€‚
1 2 3 4 5 6 7 8 9 10 11 12 13 14 (define (div-terms L1 L2) (if (empty-termlist? L1) (list (the-empty-termlist) (the-empty-termlist)) (let ((t1 (first-term L1)) (t2 (first-term L2))) (if (&gt; (order t2) (order t1)) (list (the-empty-termlist) L1) (let ((new-c (div (coeff t1) (coeff t2))) (new-o (- (order t1) (order t2)))) (let ((rest-of-result &lt;é€’å½’åœ°è®¡ç®—ç»“æœçš„å…¶ä½™éƒ¨åˆ†&gt; )) &lt;å½¢æˆå®Œæ•´çš„ç»“æœ&gt; )))))) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 #lang sicp (define (div-terms L1 L2) (if (empty-termlist? L1) (list (the-empty-termlist) (the-empty-termlist)) (let ((t1 (first-term L1)) (t2 (first-term L2))) (if (&gt; (order t2) (order t1)) (list (the-empty-termlist) L1) (let ((new-c (div (coeff t1) (coeff t2))) (new-o (- (order t1) (order t2)))) (let ((rest-of-result (div-terms (sub-terms L1 (mul-terms (list (make-term new-o new-c)) L2)) L2) )) (list (adjoin-term (make-term new-o new-c) (car rest-of-result)) (cadr rest-of-result)) )))))) (define (div-poly p1 p2) (if (same-variable? (variable p1) (variable p2)) (make-poly (variable p1) (div-terms (term-list p1) (term-list p2))) (error &#34;Polys not in same var -- DIV-POLY&#34; (list p1 p2)))) ç»ƒä¹  92 é€šè¿‡åŠ å…¥å¼ºåˆ¶æ€§çš„å˜é‡åºæ‰©å……å¤šé¡¹å¼ç¨‹åºåŒ…ï¼Œä½¿å¤šé¡¹å¼çš„åŠ æ³•å’Œä¹˜æ³•èƒ½å¯¹å…·æœ‰ä¸åŒå˜é‡çš„å¤šé¡¹å¼è¿›è¡Œã€‚ï¼ˆè¿™ç»ä¸ç®€å•ï¼ï¼‰
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 #lang sicp (define types &#39;(scheme-number rational real complex)) (define (add-coercion x y) (let ((t1 (type-tag x)) (t2 (type-tag y))) (cond ((and (eq? t1 &#39;polynomial) (memq t2 types)) (add x (make-poly (variable x) (list (make-term 0 (content y)))))) ((and (memq t1 types) (eq? t2 &#39;polynominal)) (add y (make-poly (variable y) (list (make-term 0 (content x)))))) (else (add x y))))) (define (mul-coercion x y) (let ((t1 (type-tag x)) (t2 (type-tag y))) (cond ((and (eq? t1 &#39;polynomial) (memq t2 types)) (mul x (make-poly (variable x) (list (make-term 0 (content y)))))) ((and (memq t1 types) (eq? t2 &#39;polynominal)) (mul y (make-poly (variable y) (list (make-term 0 (content x)))))) (else (mul x y))))) ]]></content></entry><entry><title>Learn SICP Chapter 1</title><url>/post/sicp/learn-sicp-ch1/</url><categories><category>Learn</category></categories><tags><tag>Scheme</tag><tag>SICP</tag></tags><content type="html"><![CDATA[å¿ƒæ™ºçš„æ´»åŠ¨ï¼Œé™¤äº†å°½åŠ›äº§ç”Ÿå„ç§ç®€å•çš„è®¤è¯†ä¹‹å¤–ï¼Œä¸»è¦è¡¨ç°åœ¨å¦‚ä¸‹ä¸‰ä¸ªæ–¹é¢ï¼š1ï¼‰å°†è‹¥å¹²ç®€å•è®¤è¯†ç»„åˆä¸ºä¸€ä¸ªå¤åˆè®¤è¯†ï¼Œç”±æ­¤äº§ç”Ÿå‡ºå„ç§å¤æ‚çš„è®¤è¯†ã€‚2ï¼‰å°†ä¸¤ä¸ªè®¤è¯†æ”¾åœ¨ä¸€èµ·å¯¹ç…§ï¼Œä¸ç®¡å®ƒä»¬å¦‚ä½•ç®€å•æˆ–è€…å¤æ‚ï¼Œåœ¨è¿™æ ·åšæ—¶å¹¶ä¸å°†å®ƒä»¬åˆè€Œä¸ºä¸€ã€‚ç”±æ­¤å¾—åˆ°æœ‰å…³å®ƒä»¬çš„ç›¸äº’å…³ç³»çš„è®¤è¯†ã€‚3ï¼‰å°†æœ‰å…³è®¤è¯†ä¸é‚£äº›åœ¨å®é™…ä¸­å’Œå®ƒä»¬åŒåœ¨çš„æ‰€æœ‰å…¶ä»–è®¤è¯†éš”ç¦»å¼€ï¼Œè¿™å°±æ˜¯æŠ½è±¡ï¼Œæ‰€æœ‰å…·æœ‰æ™®éæ€§çš„è®¤è¯†éƒ½æ˜¯è¿™æ ·å¾—åˆ°çš„ã€‚
John Locke, An Essay Concerning Human Understanding
( æœ‰å…³äººç±»ç†è§£çš„éšç¬”ï¼Œ1690 ) ç»ƒä¹  1 ä¸‹é¢æ˜¯ä¸€ç³»åˆ—è¡¨è¾¾å¼ï¼Œå¯¹äºæ¯ä¸ªè¡¨è¾¾å¼ï¼Œè§£é‡Šå™¨å°†è¾“å‡ºä»€ä¹ˆç»“æœï¼Ÿå‡å®šè¿™ä¸€ç³»åˆ—è¡¨è¾¾å¼æ˜¯æŒ‰ç…§ç»™å‡ºçš„é¡ºåºé€ä¸ªæ±‚å€¼çš„ã€‚
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 10 (+ 5 3 4) (- 9 1) (/ 6 2) (+ (* 2 4) (- 4 6)) (define a 3) (define b (+ a 1)) (+ a b (* a b)) (= a b) (if (and (&gt; b a) (&lt; b (* a b))) b a) (cond ((= a 4) 6) ((= b 4) (+ 6 7 a)) (else 25)) (+ 2 (if (&gt; b a) b a)) (* (cond ((&gt; a b) a) ((&lt; a b) b) (else -1)) (+ a 1)) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 #lang sicp 10 (+ 5 3 4) (- 9 1) (/ 6 2) (+ (* 2 4) (- 4 6)) (define a 3) (define b (+ a 1)) (+ a b (* a b)) (= a b) (if (and (&gt; b a) (&lt; b (* a b))) b a) (cond ((= a 4) 6) ((= b 4) (+ 6 7 a)) (else 25)) (+ 2 (if (&gt; b a) b a)) (* (cond ((&gt; a b) a) ((&lt; a b) b) (else -1)) (+ a 1)) ;: 10 ;: 12 ;: 8 ;: 3 ;: 6 ;: 19 ;: #f ;: 4 ;: 16 ;: 6 ;: 16 ç»ƒä¹  2 è¯·å°†ä¸‹é¢è¡¨è¾¾å¼å˜æ¢ä¸ºå‰ç¼€å½¢å¼ï¼š
$$ \frac{5 + 4 + (2 - (3 - (6 + \frac{4}{5})))}{3(6 - 2)(2 - 7)} $$
1 2 3 4 5 6 #lang sicp (/ (+ 5 4 (- 2 (- 3 (+ 6 (/ 4 5))))) (* 3 (- 6 2) (- 2 7))) ;: -37/150 ç»ƒä¹  3 è¯·å®šä¹‰ä¸€ä¸ªè¿‡ç¨‹ï¼Œå®ƒä»¥ä¸‰ä¸ªæ•°ä¸ºå‚æ•°ï¼Œè¿”å›å…¶ä¸­è¾ƒå¤§çš„ä¸¤ä¸ªæ•°ä¹‹å’Œã€‚
1 2 3 4 5 6 7 8 9 10 11 12 13 #lang sicp (define (sum-of-max-two a b c) (if (&gt; a b) (if (&gt; b c) (+ a b) (+ a c)) (if (&gt; a c) (+ a b) (+ b c)))) ;&gt;&gt;&gt; (sum-of-max-two 233 752 666) ;: 1418 ç»ƒä¹  4 è¯·ä»”ç»†è€ƒå¯Ÿä¸Šé¢ç»™å‡ºçš„å…è®¸è¿ç®—ç¬¦ä¸ºå¤åˆè¡¨è¾¾å¼çš„ç»„åˆå¼çš„æ±‚å€¼æ¨¡å‹ï¼Œæ ¹æ®å¯¹è¿™ä¸€æ¨¡å‹çš„è®¤è¯†æè¿°ä¸‹é¢è¿‡ç¨‹çš„è¡Œä¸ºï¼š
1 2 (define (a-plus-abs-b a b) ((if (&gt; b 0) + -) a b)) å®Œæˆè®¡ç®—ï¼š $a+\lvert b\rvert$ ï¼Œå¦‚æœ $b\gt 0, a+b$ ï¼›å¦åˆ™ï¼Œ $a-b$ ã€‚
ç»ƒä¹  5 Ben Bitdiddle å‘æ˜äº†ä¸€ç§æ£€æµ‹æ–¹æ³•ï¼Œèƒ½å¤Ÿç¡®å®šè§£é‡Šå™¨ç©¶ç«Ÿé‡‡ç”¨å“ªç§åºæ±‚å€¼ï¼Œæ˜¯é‡‡ç”¨åº”ç”¨åºï¼Œè¿˜æ˜¯é‡‡ç”¨æ­£åˆ™åºã€‚ä»–å®šä¹‰äº†ä¸‹é¢ä¸¤ä¸ªè¿‡ç¨‹ï¼š
1 (define (p) (p)) 1 2 3 4 (define (test x y) (if (= x 0) 0 y)) è€Œåä»–æ±‚å€¼ä¸‹é¢çš„è¡¨è¾¾å¼ï¼š
1 (test 0 (p)) å¦‚æœæŸä¸ªè§£é‡Šå™¨é‡‡ç”¨çš„æ˜¯åº”ç”¨åºæ±‚å€¼ï¼ŒBen ä¼šçœ‹åˆ°ä»€ä¹ˆæ ·çš„æƒ…å†µï¼Ÿå¦‚æœè§£é‡Šå™¨é‡‡ç”¨æ­£åˆ™åºæ±‚å€¼ï¼Œä»–åˆä¼šçœ‹åˆ°ä»€ä¹ˆæƒ…å†µï¼Ÿè¯·å¯¹ä½ çš„å›ç­”åšå‡ºè§£é‡Šã€‚ï¼ˆæ— è®ºé‡‡ç”¨æ­£åˆ™åºæˆ–è€…åº”ç”¨åºï¼Œå‡å®šç‰¹æ®Šå½¢å¼ if çš„æ±‚å€¼è§„åˆ™æ€»æ˜¯ä¸€æ ·çš„ã€‚å…¶ä¸­çš„è°“è¯éƒ¨åˆ†å…ˆè¡Œæ±‚å€¼ï¼Œæ ¹æ®å…¶ç»“æœç¡®å®šéšåæ±‚å€¼çš„å­è¡¨è¾¾å¼éƒ¨åˆ†ã€‚ï¼‰
é‡‡ç”¨çš„è§£é‡Šå™¨ä¸º DrRacket çš„ SICP æ’ä»¶ç¯å¢ƒï¼Œæ‰§è¡Œä¸Šè¿°ä»£ç å¹¶æ²¡æœ‰ä»»ä½•è¾“å‡ºï¼Œä½† CPU å ç”¨è¾ƒé«˜ã€‚å› æ­¤æµ‹è¯•ç¯å¢ƒé‡‡ç”¨çš„æ˜¯åº”ç”¨åºæ±‚å€¼ã€‚
åº”ç”¨åºæ±‚å€¼æ—¶ï¼Œä¼šå…ˆè·å–æ¯ä¸ªå­è¡¨è¾¾å¼çš„å€¼ï¼Œå¯¹äº (test 0 (0)) æ¥è¯´ï¼Œç¬¬ä¸€ä¸ªå‚æ•°å€¼ä¸º 0 å·²çŸ¥ï¼Œä¼šå»æ±‚ç¬¬äºŒä¸ªå‚æ•°çš„å€¼ï¼Œè€Œç¬¬äºŒä¸ªå‚æ•°ä¼šä¸€ç›´èµ‹å€¼ï¼Œæ˜¯æ±‚ä¸å‡ºæ¥çš„ï¼Œç¨‹åºé™·å…¥æ­»å¾ªç¯ã€‚
æ­£åˆ™åºæ±‚å€¼æ—¶ï¼Œä¼šç›´æ¥å°†å‚æ•°ä»£å…¥è¿›è¡Œè®¡ç®—ï¼Œè®¡ç®— (test 0 (p))ï¼Œæ­¤æ—¶ç¬¬ä¸€ä¸ªå‚æ•° x ä¸º 0ï¼Œç›´æ¥è¿”å›ç»“æœ 0ã€‚
ç»ƒä¹  6 Alyssa P. Hacker çœ‹ä¸å‡ºä¸ºä»€ä¹ˆéœ€è¦å°† if æä¾›ä¸ºä¸€ç§ç‰¹æ®Šå½¢å¼ï¼Œå¥¹é—®ï¼šâ€œä¸ºä»€ä¹ˆæˆ‘ä¸èƒ½ç›´æ¥é€šè¿‡ cond å°†å®ƒå®šä¹‰ä¸ºä¸€ä¸ªå¸¸è§„è¿‡ç¨‹å‘¢ï¼Ÿâ€ Alyssa çš„æœ‹å‹ Eva Lu Ator æ–­è¨€ç¡®å®å¯ä»¥è¿™æ ·åšï¼Œå¹¶å®šä¹‰äº† if çš„ä¸€ä¸ªæ–°ç‰ˆæœ¬ï¼š
1 2 3 (define (new-if predicate then-clause else-clause) (cond (predicate then-clause) (else else-clause))) Eva ç»™ Alyssa æ¼”ç¤ºå¥¹çš„ç¨‹åºï¼š
1 2 (new-if (= 2 3) 0 5) 5 1 2 (new-if (= 1 1) 0 5) 0 å¥¹å¾ˆé«˜å…´åœ°ç”¨è‡ªå·±çš„ new-if é‡å†™äº†æ±‚å¹³æ–¹æ ¹çš„ç¨‹åºï¼š
1 2 3 4 5 (define (sqrt-iter guess x) (new-if (good-enough? guess x) guess (sqrt-iter (improve guess x) x))) å½“ Alyssa è¯•ç€ç”¨è¿™ä¸ªè¿‡ç¨‹å»è®¡ç®—å¹³æ–¹æ ¹æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆäº‹æƒ…å‘¢ï¼Ÿè¯·ç»™å‡ºè§£é‡Šã€‚
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 #lang sicp (define (new-if predicate then-clause else-clause) (cond (predicate then-clause) (else else-clause))) (define (sqrt-iter guess x) (new-if (good-enough? guess x) guess (sqrt-iter (improve guess x) x))) (define (improve guess x) (average guess (/ x guess))) (define (average x y) (/ (+ x y) 2)) (define (good-enough? guess x) (&lt; (abs (- (square guess) x)) 0.001)) (define (square x) (* x x)) (define (sqrt x) (sqrt-iter 1.0 x)) ;&gt;&gt;&gt; (sqrt 2) ;: Interactions disabled; out of memory ç›´æ¥æŠ¥é”™ï¼Œå†…å­˜è¶…é™ã€‚
ç”± ç»ƒä¹  5 çŸ¥ï¼Œè§£é‡Šå™¨é‡‡ç”¨åº”ç”¨åºæ±‚å€¼ï¼Œå› æ­¤å®šä¹‰çš„ new-if è¿‡ç¨‹ä¼šå…ˆè·å–æ‰€éœ€çš„ä¸‰ä¸ªå‚æ•°ï¼Œè€Œåœ¨ sqrt-iter è¿‡ç¨‹ä¸­ï¼Œnew-if çš„ else-clause ä¸ºé€’å½’è¿‡ç¨‹ï¼Œå› æ­¤è§£é‡Šå™¨ä¼šå°è¯•ä¸€ç›´è·å–è¯¥å‚æ•°çš„å€¼ï¼Œé™·å…¥æ­»å¾ªç¯ã€‚
æ³¨ï¼šè§£é‡Šå™¨æä¾›çš„ if è¿‡ç¨‹ä¸ºç‰¹æ®Šè¿‡ç¨‹ï¼Œå½¢å¼ä¸º (if &lt;predicate&gt; &lt;consequent&gt; &lt;alternative&gt;)ï¼Œä¼šå…ˆè·å– &lt;predicate&gt; çš„å€¼ï¼Œå¦‚æœä¸º #tï¼Œè¿›å…¥ &lt;consequent&gt;ï¼Œå¦åˆ™è¿›å…¥ &lt;alternative&gt;ã€‚
ç»ƒä¹  7 å¯¹äºç¡®å®šå¾ˆå°çš„æ•°çš„å¹³æ–¹æ ¹è€Œè¨€ï¼Œåœ¨è®¡ç®—å¹³æ–¹æ ¹ä¸­ä½¿ç”¨çš„æ£€æµ‹ good-enough? æ˜¯å¾ˆä¸å¥½çš„ã€‚è¿˜æœ‰ï¼Œåœ¨ç°å®çš„è®¡ç®—æœºé‡Œï¼Œç®—æœ¯è¿ç®—æ€»æ˜¯ä»¥ä¸€å®šæœ‰é™ç²¾åº¦è¿›è¡Œçš„ã€‚è¿™ä¹Ÿä¼šä½¿æˆ‘ä»¬çš„æ£€æµ‹ä¸é€‚åˆéå¸¸å¤§çš„æ•°çš„è®¡ç®—ã€‚è¯·è§£é‡Šä»¥ä¸Šè®ºæ–­ï¼Œç”¨ä¾‹å­è¯´æ˜å¯¹å¾ˆå°å’Œå¾ˆå¤§çš„æ•°ï¼Œè¿™ç§æ£€æµ‹éƒ½å¯èƒ½å¤±è´¥ã€‚å®ç° good-enough? çš„å¦ä¸€ç§ç­–ç•¥æ˜¯ç›‘æµ‹çŒœæµ‹å€¼åœ¨ä»ä¸€æ¬¡è¿­ä»£åˆ°ä¸‹ä¸€æ¬¡çš„å˜åŒ–æƒ…å†µï¼Œå½“æ”¹å˜å€¼ç›¸å¯¹äºçŒœæµ‹å€¼çš„æ¯”ç‡å¾ˆå°æ—¶å°±ç»“æŸã€‚è¯·è®¾è®¡ä¸€ä¸ªé‡‡ç”¨è¿™ç§ç»ˆæ­¢æµ‹è¯•æ–¹å¼çš„å¹³æ–¹æ ¹è¿‡ç¨‹ã€‚å¯¹äºå¾ˆå¤§å’Œå¾ˆå°çš„æ•°ï¼Œè¿™ä¸€æ–¹å¼éƒ½èƒ½å·¥ä½œå—ï¼Ÿ
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 #lang sicp (define (sqrt-iter guess x) (if (good-enough? guess x) guess (sqrt-iter (improve guess x) x))) (define (improve guess x) (average guess (/ x guess))) (define (average x y) (/ (+ x y) 2)) (define (good-enough? guess x) (&lt; (abs (- (square guess) x)) 0.001)) (define (square x) (* x x)) (define (sqrt x) (sqrt-iter 1.0 x)) ;&gt;&gt;&gt; (sqrt 0.0001) ;: 0.03230844833048122 ;&gt;&gt;&gt; (sqrt 1e45) ;: 3.1622776601683792e+022 ;&gt;&gt;&gt; (sqrt 1e46) ;: é™·å…¥æ­»å¾ªç¯ å¯¹äº (sqrt 0.0001) è§£é‡Šå™¨è®¡ç®—ç»“æœä¸ºï¼š0.03230844833048122 ï¼Œè®¡ç®—è¯¯å·®å¤ªå¤§ï¼Œåˆ†æå¯çŸ¥ 0.03230844833048122 çš„å¹³æ–¹ 0.0010438358335233748 ä¸ 0.0001 çš„å·® 0.0009438358335233748 ç¡®å®å°äº 0.001 ï¼Œç¨‹åºå¯¹æ­¤æ— èƒ½ä¸ºåŠ›ï¼Œå½’æ ¹ç»“åº•æ˜¯ good-enough? çš„ç²¾åº¦ä¸å¤Ÿï¼›è§£é‡Šå™¨æœ€å¤§å¤§æ¦‚åªèƒ½è®¡ç®— (sqrt 1e45) ï¼Œå¯¹äº (sqrt 1e46) ï¼Œç¨‹åºé™·å…¥æ­»å¾ªç¯ï¼Œä½†ç”±äºå°¾é€’å½’ä¼˜åŒ–ï¼Œå¹¶ä¸ä¼šå‡ºç°å†…å­˜è¶…é™çš„æƒ…å†µï¼Œç¨‹åºä¸€ç›´å ç”¨ç€ CPU èµ„æºï¼ŒåŸå› ä¹Ÿå¾ˆå¥½è§£é‡Šï¼Œå¦‚ä¸‹ï¼š
$$ (\sqrt{x} + \Delta)^2-x=2\sqrt{x}\Delta+\Delta^2 $$
å¦‚æœ $x$ è¶³å¤Ÿå¤§ï¼Œ $2\sqrt{x}\Delta+\Delta^2$ å¯ä»¥å¤§äºä»»æ„ç»™å®šçš„ç²¾åº¦ï¼Œä»è€Œè®¡ç®—æ— æ³•æ”¶æ•›ã€‚
åŸºäºä»¥ä¸Šçš„è€ƒè™‘ï¼Œå¯ä»¥åŠ¨æ€è°ƒæ•´ $good-enough?$ çš„ç²¾åº¦ã€‚æŒ‰ç…§é¢˜ç›®æ‰€ç»™çš„å®ç°æ–¹å¼ï¼Œä¿®æ”¹ç¨‹åºå¦‚ä¸‹ï¼š
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 #lang sicp (define (sqrt-iter guess new x) (if (dynamic-good-enough? guess new) guess (sqrt-iter new (improve new x) x))) (define (improve new x) (average new (/ x new))) (define (average x y) (/ (+ x y) 2)) (define (dynamic-good-enough? old new) (&lt; (abs (- 1 (/ new old))) 0.001)) (define (square x) (* x x)) (define (sqrt x) (sqrt-iter 1.0 (improve 1.0 x) x)) ;&gt;&gt;&gt; (sqrt 0.0001) ;: 0.010000714038711746 ;&gt;&gt;&gt; (sqrt 1e45) ;: 3.1627246890405767e+022 ;&gt;&gt;&gt; (sqrt 1e46) ;: 1.000011239171839e+023 ;&gt;&gt;&gt; (sqrt 1e100) ;: 1.000000633105179e+050 ç»ƒä¹  8 æ±‚ç«‹æ–¹æ ¹çš„ç‰›é¡¿æ³•åŸºäºå¦‚ä¸‹äº‹å®ï¼Œå¦‚æœ $y$ æ˜¯ $x$ çš„ç«‹æ–¹æ ¹çš„ä¸€ä¸ªè¿‘ä¼¼å€¼ï¼Œé‚£ä¹ˆä¸‹å¼å°†ç»™å‡ºä¸€ä¸ªæ›´å¥½çš„è¿‘ä¼¼å€¼ï¼š
$$ \frac{x/y^2+2y}{3} $$
è¯·åˆ©ç”¨è¿™ä¸€å…¬å¼å®ç°ä¸€ä¸ªç±»ä¼¼å¹³æ–¹æ ¹è¿‡ç¨‹çš„æ±‚ç«‹æ–¹æ ¹çš„è¿‡ç¨‹ã€‚
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 #lang sicp (define (cube-root-iter guess new x) (if (good-enough? guess new) guess (cube-root-iter new (improve new x) x))) (define (good-enough? guess new) (&lt; (abs (- 1 (/ new guess))) 0.00001)) (define (improve new x) (average (/ x new new) new new)) (define (average x y z) (/ (+ x y z) 3)) (define (cube-root x) (cube-root-iter 1.0 (improve 1.0 x) x)) ;&gt;&gt;&gt; (cube-root 0.001) ;: 0.10000000198565878 ;&gt;&gt;&gt; (cube-root 27) ;: 3.0000005410641766 ;&gt;&gt;&gt; (cube-root 1000) ;: 10.000000145265767 ;&gt;&gt;&gt; (cube-root 1e-99) ;: 1.0000000004754588e-033 ;&gt;&gt;&gt; (cube-root 1e300) ;: 1.000001286662801e+100 ç»ƒä¹  9 ä¸‹é¢å‡ ä¸ªè¿‡ç¨‹å„å®šä¹‰äº†ä¸€ç§åŠ èµ·ä¸¤ä¸ªæ­£æ•´æ•°çš„æ–¹æ³•ï¼Œå®ƒä»¬éƒ½åŸºäºè¿‡ç¨‹ inc ( å®ƒå°†å‚æ•°åŠ  1 ) å’Œ dec ( å®ƒå°†å‚æ•°å‡ 1 ) ã€‚
1 2 3 4 (define (+ a b) (if (= a 0) b (inc (+ (dec a) b)))) 1 2 3 4 (define (+ a b) (if (= a 0) b (+ (dec a) (inc b)))) è¯·ç”¨ä»£æ¢æ¨¡å‹å±•ç¤ºè¿™ä¸¤ä¸ªè¿‡ç¨‹åœ¨æ±‚å€¼ (+ 4 5) æ—¶æ‰€äº§ç”Ÿçš„è®¡ç®—è¿‡ç¨‹ã€‚è¿™äº›è®¡ç®—è¿‡ç¨‹æ˜¯é€’å½’çš„æˆ–è€…è¿­ä»£çš„å—ï¼Ÿ
1 2 3 4 5 6 7 8 9 10 (+ 4 5) (inc (+ 3 5)) (inc (inc (+ 2 5))) (inc (inc (inc (+ 1 5)))) (inc (inc (inc (inc (+ 0 5))))) (inc (inc (inc (inc 5)))) (inc (inc (inc 6))) (inc (inc 7)) (inc 8) 9 1 2 3 4 5 6 (+ 4 5) (+ 3 6) (+ 2 7) (+ 1 8) (+ 0 9) 9 ç¬¬ä¸€ä¸ªè¿‡ç¨‹æ˜¯é€’å½’çš„ï¼Œç¬¬äºŒä¸ªè¿‡ç¨‹æ˜¯è¿­ä»£çš„ã€‚
ç»ƒä¹  10 ä¸‹é¢è¿‡ç¨‹è®¡ç®—ä¸€ä¸ªç§°ä¸º Ackermann å‡½æ•°çš„æ•°å­¦å‡½æ•°ï¼š
1 2 3 4 5 6 (define (A x y) (cond ((= y 0) 0) ((= x 0) (* 2 y)) ((= y 1) 2) (else (A (- x 1) (A x (- y 1)))))) ä¸‹é¢å„è¡¨è¾¾å¼çš„å€¼æ˜¯ä»€ä¹ˆï¼š
1 2 3 4 5 (A 1 10) (A 2 4) (A 3 3) è¯·è€ƒè™‘ä¸‹é¢çš„è¿‡ç¨‹ï¼Œå…¶ä¸­çš„ A å°±æ˜¯ä¸Šé¢å®šä¹‰çš„è¿‡ç¨‹ï¼š
1 2 3 4 5 6 7 (define (f n) (A 0 n)) (define (g n) (A 1 n)) (define (h n) (A 2 n)) (define (k n) (* 5 n n)) è¯·ç»™å‡ºè¿‡ç¨‹ fã€g å’Œ h å¯¹ç»™å®šæ•´æ•°å€¼ $n$ æ‰€è®¡ç®—çš„å‡½æ•°çš„æ•°å­¦å®šä¹‰ã€‚ä¾‹å¦‚ï¼Œ(k n) è®¡ç®—çš„æ˜¯ $5n^2$ã€‚
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 #lang sicp (define (A x y) (cond ((= y 0) 0) ((= x 0) (* 2 y)) ((= y 1) 2) (else (A (- x 1) (A x (- y 1)))))) ;&gt;&gt;&gt; (A 1 10) ;: 1024 ;&gt;&gt;&gt; (A 2 4) ;: 65536 ;&gt;&gt;&gt; (A 3 3) ;: 65536 1 2 3 (f n) (A 0 n) 2n $$ f(n) = 2n $$
1 2 3 4 (g n) (A 1 n) (A 0 (A 1 (- n 1))) (f (g (- n 1))) $$ g(n) = f(g(n-1)) = 2g(n-1) = \ldots = 2^{n-1}g(1) = 2^n $$
1 2 3 4 (h n) (A 2 n) (A 1 (A 2 (- n 1))) (g (h (- n 1))) $$ h(n)=g(h(n-1))=2^{h(n-1)}=&hellip;=2^{2^{\cdot^{\cdot^{\cdot^{2^{h(1)}}}}}}=2^{2^{\cdot^{\cdot^{\cdot^{2^{2}}}}}} (n \text{ä¸ª} 2) $$
ä»¥ä¸Šè¿‡ç¨‹æœªè€ƒè™‘ $n=0$ çš„æƒ…å†µã€‚ ç»ƒä¹  11 å‡½æ•° $f$ ç”±å¦‚ä¸‹çš„è§„åˆ™å®šä¹‰ï¼šå¦‚æœ $n&lt;3$ï¼Œé‚£ä¹ˆ $f(n)=n$ï¼›å¦‚æœ $n\ge 3$ï¼Œé‚£ä¹ˆ $f(n)=f(n-1)+2f(n-2)+3f(n-3)$ã€‚è¯·å†™ä¸€ä¸ªé‡‡ç”¨é€’å½’è®¡ç®—è¿‡ç¨‹è®¡ç®— $f$ çš„è¿‡ç¨‹ã€‚å†å†™ä¸€ä¸ªé‡‡ç”¨è¿­ä»£è®¡ç®—è¿‡ç¨‹è®¡ç®— $f$ çš„è¿‡ç¨‹ã€‚
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 #lang sicp (define (f1 n) (if (&lt; n 3) n (+ (f1 (- n 1)) (* 2 (f1 (- n 2))) (* 3 (f1 (- n 3)))))) ;: å‡å®š n &gt;= 0 (define (f2 n) (define (f2-iter a b c n) (if (= n 2) c (f2-iter b c (+ c (* 2 b) (* 3 a)) (- n 1)))) (if (&lt; n 3) n (f2-iter 0 1 2 n))) ;&gt;&gt;&gt; (f1 30) ;: 61354575194 ;&gt;&gt;&gt; (f2 30) ;: 61354575194 ç»ƒä¹  12 ä¸‹é¢æ•°å€¼æ¨¡å¼ç§°ä¸ºå¸•æ–¯å¡ä¸‰è§’å½¢ï¼š
1 2 3 4 5 6 1 1 1 1 2 1 1 3 3 1 1 4 6 4 1 ... ä¸‰è§’å½¢è¾¹ç•Œä¸Šçš„æ•°éƒ½æ˜¯ 1ï¼Œå†…éƒ¨çš„æ¯ä¸ªæ•°æ˜¯ä½äºå®ƒä¸Šé¢çš„ä¸¤ä¸ªæ•°ä¹‹å’Œã€‚è¯·å†™ä¸€ä¸ªè¿‡ç¨‹ï¼Œå®ƒé‡‡ç”¨é€’å½’è®¡ç®—è¿‡ç¨‹è®¡ç®—å‡ºå¸•æ–¯å¡ä¸‰è§’å½¢ã€‚
1 2 3 4 5 6 7 8 9 10 11 12 13 #lang sicp (define (pascal-triangle row col) (cond ((&lt; row col) -1) ((or (= col 1) (= col row)) 1) (else (+ (pascal-triangle (- row 1) (- col 1)) (pascal-triangle (- row 1) col))))) ;&gt;&gt;&gt; (pascal-triangle 4 2) ;: 3 ;&gt;&gt;&gt; (pascal-triangle 6 4) ;: 10 ç»ƒä¹  13 è¯æ˜ $\text{Fib}(n)$ æ˜¯æœ€æ¥è¿‘ $\phi^n/\sqrt 5$ çš„æ•´æ•°ï¼Œå…¶ä¸­ $\phi=(1+\sqrt 5)/2$ã€‚æç¤ºï¼šåˆ©ç”¨å½’çº³æ³•å’Œæ–æ³¢é‚£å¥‘æ•°çš„å®šä¹‰ï¼ˆè§ 1.2.2 èŠ‚ï¼‰ï¼Œè¯æ˜ $\text{Fib}(n)=(\phi^n-\gamma^n)/\sqrt 5$ã€‚
$$ \begin{cases} \text{Fib}(0) = 0 \\ \text{Fib}(1) = 1 \\ \text{Fib}(n) = \text{Fib}(n-1) + \text{Fib}(n-2), n\ge 2 \end{cases} $$
å½“ $n\ge 2$ æ—¶ï¼Œ
$$ \begin{bmatrix} \text{Fib}(n) \\ \text{Fib}(n-1) \end{bmatrix} = \begin{bmatrix} 1 &amp; 1 \\ 1 &amp; 0 \end{bmatrix} \begin{bmatrix} \text{Fib}(n-1) \\ \text{Fib}(n-2) \end{bmatrix} $$
è®°
$$ \bm{A} = \begin{bmatrix} 1 &amp; 1 \\ 1 &amp; 0 \end{bmatrix} $$
å°† $\bm{A}$ å¯¹è§’åŒ–å¦‚ä¸‹ï¼š
$$ \bm{A} = \begin{bmatrix} 1 &amp; 1 \\ 1 &amp; 0 \end{bmatrix} = \frac{1}{\sqrt{5}} \begin{bmatrix} \phi &amp; \gamma \\ 1 &amp; 1 \end{bmatrix} \begin{bmatrix} \phi &amp; 0 \\ 0 &amp; \gamma \end{bmatrix} \begin{bmatrix} 1 &amp; -\gamma \\ -1 &amp; \phi \end{bmatrix} $$
å…¶ä¸­ï¼Œ$\phi=\frac{1+\sqrt 5}{2}, \gamma=\frac{1-\sqrt 5}{2}$ ä¸º $\bm{A}$ çš„ç‰¹å¾å€¼ã€‚å› æ­¤ï¼š
$$ \begin{aligned} \begin{bmatrix} \text{Fib}(n) \\ \text{Fib}(n-1) \end{bmatrix} &amp;= \bm{A}^{n-1} \begin{bmatrix} \text{Fib}(1) \\ \text{Fib}(0) \end{bmatrix} \\ &amp;= \frac{1}{\sqrt 5} \begin{bmatrix} \phi &amp; \gamma \\ 1 &amp; 1 \end{bmatrix} \begin{bmatrix} \phi^{n-1} &amp; 0 \\ 0 &amp; \gamma^{n-1} \end{bmatrix} \begin{bmatrix} 1 &amp; -\gamma \\ -1 &amp; \phi \end{bmatrix} \begin{bmatrix} \text{Fib}(1) \\ \text{Fib}(0) \end{bmatrix} \\ &amp;= \frac{1}{\sqrt 5} \begin{bmatrix} \phi^n - \gamma^n &amp; \phi^{n-1} - \gamma^{n-1} \\ \phi^{n-1} - \gamma^{n-1} &amp; \phi^{n-2} - \gamma^{n-2} \end{bmatrix} \begin{bmatrix} 1 \\ 0 \end{bmatrix} \end{aligned} $$
$\Rightarrow \text{Fib}(n) = \left(\phi^n-\gamma^n\right)/{\sqrt 5} \quad (n\ge 0)$ã€‚
è¦è¯æ˜ $\text{Fib}(n)$ ä¸ºæœ€æ¥è¿‘ $\phi^n/\sqrt 5$ çš„æ•´æ•°ï¼Œåªéœ€è¯æ˜ $\lvert\text{Fib}(n) - \phi^n/\sqrt 5\rvert &lt; 0.5$ å³å¯ã€‚
$\max{\lvert\gamma^n / \sqrt 5\rvert}=\gamma^0/\sqrt 5 \approx 1/2.236 &lt; 0.5$ï¼Œå¾—è¯ã€‚
ç»ƒä¹  14 è¯·ç”»å‡ºæœ‰å…³çš„æ ‘ï¼Œå±•ç¤º 1.2.2 èŠ‚çš„è¿‡ç¨‹ count-change åœ¨å°† 11 ç¾åˆ†æ¢æˆç¡¬å¸æ—¶æ‰€äº§ç”Ÿçš„è®¡ç®—è¿‡ç¨‹ã€‚ç›¸å¯¹äºè¢«æ¢ç°é‡‘é‡çš„å¢åŠ ï¼Œè¿™ä¸€è®¡ç®—è¿‡ç¨‹çš„ç©ºé—´å’Œæ­¥æ•°å¢é•¿çš„é˜¶å„æ˜¯ä»€ä¹ˆï¼Ÿ
æ—¶é—´å¤æ‚åº¦ä¸ºå¶èŠ‚ç‚¹çš„ä¸ªæ•° $T(n)=\Theta(2^n)$ï¼Œç©ºé—´å¤æ‚åº¦ä¸ºæ ‘çš„æ·±åº¦ $S(n)=\Theta(n)$ã€‚
ç»ƒä¹  15 åœ¨è§’ï¼ˆç”¨å¼§åº¦æè¿°ï¼‰$x$ è¶³å¤Ÿå°æ—¶ï¼Œå…¶æ­£å¼¦å€¼å¯ä»¥ç”¨ $\sin x\approx x$ è®¡ç®—ï¼Œè€Œä¸‰è§’æ’ç­‰å¼ï¼š
$$ \sin x =3\sin \frac{x}{3}-4\sin^3\frac{x}{3} $$
å¯ä»¥å‡å° $\sin$ çš„å‚æ•°çš„å¤§å°ï¼ˆä¸ºå®Œæˆè¿™ä¸€ç»ƒä¹ ï¼Œæˆ‘ä»¬è®¤ä¸ºä¸€ä¸ªè§’æ˜¯â€œè¶³å¤Ÿå°â€ï¼Œå¦‚æœå…¶æ•°å€¼ä¸å¤§äº 0.1 å¼§åº¦ï¼‰ã€‚è¿™äº›æƒ³æ³•éƒ½ä½“ç°åœ¨ä¸‹è¿°è¿‡ç¨‹ä¸­ï¼š
1 2 3 4 5 6 7 8 (define (cube x) (* x x x)) (define (p x) (- (* 3 x) (* 4 (cube x)))) (define (sine angle) (if (not (&gt; (abs angle) 0.1)) angle (p (sine (/ angle 3.0))))) a) åœ¨æ±‚å€¼ (sine 12.15) æ—¶ï¼Œp å°†è¢«ä½¿ç”¨å¤šå°‘æ¬¡ï¼Ÿ
b) åœ¨æ±‚å€¼ (sine a) æ—¶ï¼Œç”±è¿‡ç¨‹ sine æ‰€äº§ç”Ÿçš„è®¡ç®—è¿‡ç¨‹ä½¿ç”¨çš„ç©ºé—´å’Œæ­¥æ•°ï¼ˆä½œä¸º $a$ çš„å‡½æ•°ï¼‰å¢é•¿çš„é˜¶æ˜¯ä»€ä¹ˆï¼Ÿ
1 2 3 4 5 6 (sine 12.15) (p (sine 4.05)) (p (p (sine 1.35))) (p (p (p (sine 0.45)))) (p (p (p (p (sine 0.15))))) (p (p (p (p (p (sine 0.05)))))) å³ p å°†è¢«ä½¿ç”¨ 5 æ¬¡ã€‚
æ—¶é—´å¤æ‚åº¦å’Œç©ºé—´å¤æ‚åº¦å‡ä¸º $\Theta(\log a)$ ã€‚
ç»ƒä¹  16 è¯·å®šä¹‰ä¸€ä¸ªè¿‡ç¨‹ï¼Œå®ƒèƒ½äº§ç”Ÿå‡ºä¸€ä¸ªæŒ‰ç…§è¿­ä»£æ–¹æ³•çš„æ±‚å¹‚è®¡ç®—è¿‡ç¨‹ï¼Œå…¶ä¸­ä½¿ç”¨ä¸€ç³»åˆ—çš„æ±‚å¹³æ–¹ï¼Œå°±åƒ fast-expt ä¸€æ ·åªç”¨å¯¹æ•°ä¸ªæ­¥éª¤ã€‚ï¼ˆæç¤ºï¼šè¯·åˆ©ç”¨å…³ç³» $(b^{n/2})^2=(b^2)^{n/2}$ï¼Œé™¤äº†æŒ‡æ•° $n$ å’ŒåŸºæ•° $b$ ä¹‹å¤–ï¼Œè¿˜åº”ç»´æŒä¸€ä¸ªé™„åŠ çš„çŠ¶æ€å˜é‡ $a$ï¼Œå¹¶å®šä¹‰å¥½çŠ¶æ€å˜æ¢ï¼Œä½¿å¾—ä»ä¸€ä¸ªçŠ¶æ€è½¬åˆ°å¦ä¸€ä¸ªçŠ¶æ€æ—¶ä¹˜ç§¯ $ab^n$ ä¸å˜ã€‚åœ¨è®¡ç®—è¿‡ç¨‹å¼€å§‹æ—¶ä»¤ $a$ å–å€¼ $1$ï¼Œå¹¶ç”¨è®¡ç®—è¿‡ç¨‹ç»“æŸæ—¶ $a$ çš„å€¼ä½œä¸ºå›ç­”ï¼Œå®šä¹‰ä¸€ä¸ªä¸å˜é‡ï¼Œè¦æ±‚å®ƒåœ¨çŠ¶æ€ä¹‹é—´ä¿æŒä¸å˜ï¼Œè¿™ä¸€æŠ€æœ¯æ˜¯æ€è€ƒè¿­ä»£ç®—æ³•è®¾è®¡é—®é¢˜æ—¶çš„ä¸€ç§éå¸¸å¼ºæœ‰åŠ›çš„æ–¹æ³•ã€‚ï¼‰
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 #lang sicp (define (fast-expt b n) (define (even? n) (= (remainder n 2) 0)) (define (fast-expt-iter b n a) (cond ((= n 0) a) ((even? n) (fast-expt-iter (* b b) (/ n 2) a)) (else (fast-expt-iter b (- n 1) (* a b))))) (fast-expt-iter b n 1)) ;&gt;&gt;&gt; (fast-expt 2 100) ;: 1267650600228229401496703205376 ;&gt;&gt;&gt; (fast-expt 233 666) ;: 45608249449321071866100423887710037382242303540141549438182496242630967356498403300585939221370743856986187265422069986290709044612487508462128088040902747685554711984886626823740068936201646465998047781291323652987572772058069995728882937506140140504257008579468379228550606745974431630982019632337016417060138268413281279845384946747504381921580241753023442634271482241060649036714318755753823145401892677099489710630922556129542048609567475559465982452063135308132933429890233808122027389285277264964924176508449211662347611168698873311900571051094076138040519803386754747307362834006882626700415214993070240801167355602795521863083515955510864179778671945897290584872919146476809837434854463437229210500470054228188263808948998447343504349599004630151477655748972818647675195704034143636332250506498413404529736819404059998733172045734960927853771586844272553696657099874870677594071599776653548857867859181671154866182945261398284712070353812203899610130674220038226641618463203348208551927496079463011686468216974042125906779958011178023232859028359641660595367491457705820841014430522977930845735516248984029837510541090983353875473984466834208054543087215059040900755509408687346015160580986408670546120176406650851308895847246735091833513849520187360246621896021646937864503090202916685215137385734423173203739580955346765580955409356257020956778600570894444370471939550328033688186114752380082028841287970670450765260208489908726223588727865855828074956323657564571040074575787604331082627110258301993255187030690233848909836296781038234056763169559208345629710722769 ç»ƒä¹  17 æœ¬èŠ‚é‡Œæ±‚å¹‚ç®—æ³•çš„åŸºç¡€å°±æ˜¯é€šè¿‡åå¤åšä¹˜æ³•å»æ±‚ä¹˜å¹‚ã€‚ä¸æ­¤ç±»ä¼¼ï¼Œä¹Ÿå¯ä»¥é€šè¿‡åå¤åšåŠ æ³•çš„æ–¹å¼æ±‚å‡ºä¹˜ç§¯ã€‚ä¸‹é¢çš„ä¹˜ç§¯è¿‡ç¨‹ä¸ expt è¿‡ç¨‹ç±»ä¼¼ï¼ˆå…¶ä¸­å‡å®šæˆ‘ä»¬çš„è¯­è¨€åªæœ‰åŠ æ³•è€Œæ²¡æœ‰ä¹˜æ³•ï¼‰ï¼š
1 2 3 4 (define (* a b) (if (= b 0) 0 (+ a (* a (- b 1))))) è¿™ä¸€ç®—æ³•å…·æœ‰ç›¸å¯¹äº b çš„çº¿æ€§æ­¥æ•°ã€‚ç°åœ¨å‡å®šé™¤äº†åŠ æ³•ä¹‹å¤–è¿˜æœ‰è¿ç®— doubleï¼Œå®ƒèƒ½æ±‚å‡ºä¸€ä¸ªæ•´æ•°çš„ä¸¤å€ï¼›è¿˜æœ‰ halveï¼Œå®ƒå°†ä¸€ä¸ªï¼ˆå¶ï¼‰æ•°é™¤ä»¥ 2ã€‚è¯·ç”¨è¿™äº›è¿ç®—è®¾è®¡ä¸€ä¸ªç±»ä¼¼ fast-expt çš„æ±‚ä¹˜ç§¯è¿‡ç¨‹ï¼Œä½¿ä¹‹åªç”¨å¯¹æ•°çš„è®¡ç®—æ­¥æ•°ã€‚
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 #lang sicp (define (fast-mult-rec a b) (cond ((= b 0) 0) ((even? b) (fast-mult-rec (double a) (halve b))) (else (+ a (fast-mult-rec a (- b 1)))))) (define (fast-mult-iter a b) (define (fast-mult-iter-core a b p) (cond ((= b 0) p) ((even? b) (fast-mult-iter-core (double a) (halve b) p)) (else (fast-mult-iter-core a (- b 1) (+ p a))))) (fast-mult-iter-core a b 0)) (define (even? n) (= (remainder n 2) 0)) (define (double n) (+ n n)) (define (halve n) (/ n 2)) ;&gt;&gt;&gt; (fast-mult-rec 233 666) ;: 155178 ;&gt;&gt;&gt; (fast-mult-iter 233 666) ;: 155178 ç»ƒä¹  18 åˆ©ç”¨ ç»ƒä¹  16 å’Œ ç»ƒä¹  17 çš„ç»“æœè®¾è®¡ä¸€ä¸ªè¿‡ç¨‹ï¼Œå®ƒèƒ½äº§ç”Ÿå‡ºä¸€ä¸ªåŸºäºåŠ ã€åŠ å€å’ŒæŠ˜åŠè¿ç®—çš„è¿­ä»£è®¡ç®—è¿‡ç¨‹ï¼Œåªç”¨å¯¹æ•°çš„æ­¥æ•°å°±èƒ½æ±‚å‡ºä¸¤ä¸ªæ•´æ•°çš„ä¹˜ç§¯ã€‚
ï¼ˆè§ ç»ƒä¹  17 ä»£ç  fast-mult-iter ï¼‰
ç»ƒä¹  19 å­˜åœ¨ç€ä¸€ç§ä»¥å¯¹æ•°æ­¥æ•°æ±‚å‡ºæ–æ³¢é‚£å¥‘æ•°çš„å·§å¦™ç®—æ³•ã€‚è¯·å›å¿† 1.2.2 èŠ‚ fib-iter è®¡ç®—è¿‡ç¨‹ä¸­çŠ¶æ€é‡ $a$ å’Œ $b$ çš„å˜æ¢è§„åˆ™ï¼Œ$a\leftarrow a+b$ å’Œ $b\leftarrow a$ï¼Œç°åœ¨å°†è¿™ç§å˜æ¢ç§°ä¸º $T$ å˜æ¢ã€‚é€šè¿‡è§‚å¯Ÿå¯ä»¥å‘ç°ï¼Œä» $1$ å’Œ $0$ å¼€å§‹å°† $T$ åå¤åº”ç”¨ $n$ æ¬¡ï¼Œå°†äº§ç”Ÿå‡ºä¸€å¯¹æ•° $\text{Fib}(n+1)$ å’Œ $\text{Fib}(n)$ã€‚æ¢å¥è¯è¯´ï¼Œæ–æ³¢é‚£å¥‘æ•°å¯ä»¥é€šè¿‡å°† $T^n$ï¼ˆå˜æ¢ $T$ çš„ $n$ æ¬¡æ–¹ï¼‰åº”ç”¨äºå¯¹å¶ $(1, 0)$ è€Œäº§ç”Ÿå‡ºæ¥ã€‚ç°åœ¨å°† $T$ çœ‹åšæ˜¯å˜æ¢æ— $T_{pq}$ ä¸­ $p=0$ ä¸” $q=1$ çš„ç‰¹æ®Šæƒ…å†µï¼Œå…¶ä¸­ $T_{pq}$ æ˜¯å¯¹äºå¯¹å¶ $(a, b)$ æŒ‰ç…§ $a\leftarrow bq+aq+ap$ å’Œ $b\leftarrow bp+aq$ è§„åˆ™çš„å˜æ¢ã€‚è¯·è¯æ˜ï¼Œå¦‚æœæˆ‘ä»¬åº”ç”¨å˜æ¢ $T_{pq}$ ä¸¤æ¬¡ï¼Œå…¶æ•ˆæœç­‰åŒäºåº”ç”¨åŒæ ·å½¢å¼çš„ä¸€æ¬¡å˜æ¢ $T_{p&rsquo;q&rsquo;}$ï¼Œå…¶ä¸­çš„ $p&rsquo;$ å’Œ $q&rsquo;$ å¯ä»¥ç”± $p$ å’Œ $q$ è®¡ç®—å‡ºæ¥ã€‚è¿™å°±æŒ‡æ˜äº†ä¸€æ¡æ±‚å‡ºè¿™ç§å˜æ¢çš„å¹³æ–¹çš„è·¯å¾„ï¼Œä½¿æˆ‘ä»¬å¯ä»¥é€šè¿‡è¿ç»­æ±‚å¹³æ–¹çš„æ–¹å¼å»è®¡ç®— $T^n$ï¼Œå°±åƒ fast-expt è¿‡ç¨‹é‡Œæ‰€åšçš„é‚£æ ·ã€‚å°†æ‰€æœ‰è¿™äº›é›†ä¸­åˆ°ä¸€èµ·ï¼Œå°±å½¢æˆäº†ä¸‹é¢çš„è¿‡ç¨‹ï¼Œå…¶è¿è¡Œåªéœ€è¦å¯¹æ•°çš„æ­¥æ•°ï¼š
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 (define (fib n) (fib-iter 1 0 0 1 n)) (define (fib-iter a b p q count) (cond ((= count 0) b) ((even? count) (fib-iter a b &lt;??&gt; ; compute p&#39; &lt;??&gt; ; compute q&#39; (/ count 2))) (else (fib-iter (+ (* b q) (* a q) (* a p)) (+ (* b p) (* a q)) p q (- count 1))))) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 #lang sicp (define (fib n) (fib-iter 1 0 0 1 n)) (define (fib-iter a b p q count) (cond ((= count 0) b) ((even? count) (fib-iter a b (+ (* p p) (* q q)) (+ ( * 2 p q) (* q q)) (/ count 2))) (else (fib-iter (+ (* b q) (* a q) (* a p)) (+ (* b p) (* a q)) p q (- count 1))))) ;&gt;&gt;&gt; (fib 100) ;: 354224848179261915075 ç»ƒä¹  20 ä¸€ä¸ªè¿‡ç¨‹æ‰€äº§ç”Ÿçš„è®¡ç®—è¿‡ç¨‹å½“ç„¶ä¾èµ–äºè§£é‡Šå™¨æ‰€ä½¿ç”¨çš„è§„åˆ™ã€‚ä½œä¸ºä¸€ä¸ªä¾‹å­ï¼Œè€ƒè™‘ä¸Šé¢ç»™å‡ºçš„è¿­ä»£å¼ gcd è¿‡ç¨‹ï¼Œå‡å®šè§£é‡Šå™¨ç”¨ç¬¬ 1.1.5 èŠ‚è®¨è®ºçš„æ­£åˆ™åºå»è§£é‡Šè¿™ä¸€è¿‡ç¨‹ï¼ˆå¯¹ if çš„æ­£åˆ™åºæ±‚å€¼è§„åˆ™åœ¨ç»ƒä¹  1.5 ä¸­æè¿°ï¼‰ã€‚è¯·é‡‡ç”¨ï¼ˆæ­£åˆ™åºçš„ï¼‰ä»£æ¢æ–¹æ³•ï¼Œå±•ç¤ºåœ¨æ±‚å€¼è¡¨è¾¾å¼ (gcd 206 40) ä¸­äº§ç”Ÿçš„è®¡ç®—è¿‡ç¨‹ï¼Œå¹¶æŒ‡æ˜å®é™…æ‰§è¡Œçš„ remainder è¿ç®—ã€‚åœ¨é‡‡ç”¨æ­£åˆ™åºæ±‚å€¼ (gcd 206 40) ä¸­å®é™…æ‰§è¡Œäº†å¤šå°‘æ¬¡ remainder è¿ç®—ï¼Ÿå¦‚æœé‡‡ç”¨åº”ç”¨åºæ±‚å€¼å‘¢ï¼Ÿ
æ­£åˆ™åºï¼š
1 2 3 4 5 6 7 8 9 10 11 12 13 (gcd 206 40) (gcd 40 (remainder 206 40)) (= (remainder 206 40) 0) (gcd (remainder 206 40) (remainder 40 (remainder 206 40))) (= (remainder 40 (remainder 206 40)) 0) (gcd (remainder 40 (remainder 206 40)) (remainder (remainder 206 40) (remainder 40 (remainder 206 40)))) (= (remainder (remainder 206 40) (remainder 40 (remainder 206 40))) 0) (gcd (remainder (remainder 206 40) (remainder 40 (remainder 206 40))) (remainder (remainder 40 (remainder 206 40)) (remainder (remainder 206 40) (remainder 40 (remainder 206 40))))) (= (remainder (remainder 40 (remainder 206 40)) (remainder (remainder 206 40) (remainder 40 (remainder 206 40)))) 0) (remainder (remainder 206 40) (remainder 40 (remainder 206 40))) (remainder 6 (remainder 40 6)) (remainder 6 4) 2 å®é™…æ‰§è¡Œäº† 18 æ¬¡ remainder è¿‡ç¨‹ã€‚
åº”ç”¨åºï¼š
1 2 3 4 5 6 7 8 9 10 (gcd 206 40) (gcd 40 (remainder 206 40)) (gcd 40 6) (gcd 6 (remainder 40 6)) (gcd 6 4) (gcd 4 (remainder 6 4)) (gcd 4 2) (gcd 2 (remainder 4 2)) (gcd 2 0) 2 å®é™…æ‰§è¡Œäº† 4 æ¬¡ remainder è¿‡ç¨‹ã€‚
ç»ƒä¹  21 ä½¿ç”¨ smallest-divisor è¿‡ç¨‹æ‰¾å‡ºä¸‹é¢å„æ•°çš„æœ€å°å› å­ï¼š199ã€1999ã€19999ã€‚
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 #lang sicp (define (smallest-divisor n) (find-divisor n 2)) (define (find-divisor n test-divisor) (cond ((&gt; (square test-divisor) n) n) ((divides? test-divisor n) test-divisor) (else (find-divisor n (+ test-divisor 1))))) (define (square x) (* x x)) (define (divides? a b) (= (remainder b a) 0)) ;&gt;&gt;&gt; (smallest-divisor 199) ;: 199 ;&gt;&gt;&gt; (smallest-divisor 1999) ;: 1999 ;&gt;&gt;&gt; (smallest-divisor 19999) ;: 7 ç»ƒä¹  22 å¤§éƒ¨åˆ† Lisp å®ç°éƒ½åŒ…å«ä¸€ä¸ª runtime åŸºæœ¬è¿‡ç¨‹ï¼Œè°ƒç”¨å®ƒå°†è¿”å›ä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºç³»ç»Ÿå·²ç»è¿è¡Œçš„æ—¶é—´ï¼ˆä¾‹å¦‚ï¼Œä»¥å¾®å¦™è®¡ï¼‰ã€‚åœ¨å¯¹æ•´æ•° $n$ è°ƒç”¨ä¸‹é¢çš„ timed-prime-test è¿‡ç¨‹æ—¶ï¼Œå°†æ‰“å°å‡º $n$ å¹¶æ£€æŸ¥ $n$ æ˜¯å¦ä¸ºç´ æ•°ã€‚å¦‚æœ $n$ æ˜¯ç´ æ•°ï¼Œè¿‡ç¨‹å°†æ‰“å°å‡ºä¸‰ä¸ªæ˜Ÿå·ï¼Œéšåæ˜¯æ‰§è¡Œè¿™ä¸€æ£€æŸ¥æ‰€ç”¨çš„æ—¶é—´é‡ã€‚
1 2 3 4 5 6 7 8 9 10 11 12 (define (timed-prime-test n) (newline) (display n) (start-prime-test n (runtime))) (define (start-prime-test n start-time) (if (prime? n) (report-prime (- (runtime) start-time)))) (define (report-prime elapsed-time) (display &#34; *** &#34;) (display elapsed-time)) è¯·åˆ©ç”¨è¿™ä¸€è¿‡ç¨‹å†™ä¸€ä¸ª search-for-primes è¿‡ç¨‹ï¼Œå®ƒæ£€æŸ¥ç»™å®šèŒƒå›´å†…è¿ç»­çš„å„ä¸ªå¥‡æ•°çš„ç´ æ€§ã€‚è¯·ç”¨ä½ çš„è¿‡ç¨‹æ‰¾å‡ºå¤§äº 1000ã€å¤§äº 10000ã€å¤§äº 100000 å’Œå¤§äº 1000000 çš„ä¸‰ä¸ªæœ€å°çš„ç´ æ•°ã€‚è¯·æ³¨æ„å…¶ä¸­æ£€æŸ¥æ¯ä¸ªç´ æ•°æ‰€éœ€è¦çš„æ—¶é—´ã€‚å› ä¸ºè¿™ä¸€æ£€æŸ¥ç®—æ³•å…·æœ‰ $\Theta(\sqrt n)$ çš„å¢é•¿é˜¶ï¼Œä½ å¯ä»¥æœŸæœ›åœ¨ 10000 é™„è¿‘çš„ç´ æ•°æ£€æŸ¥çš„è€—æ—¶å¤§çº¦æ˜¯åœ¨ 1000 é™„è¿‘çš„ç´ æ•°æ£€æŸ¥çš„ $\sqrt{10}$ å€ã€‚ä½ å¾—åˆ°çš„æ•°æ®ç¡®å®å¦‚æ­¤å—ï¼Ÿå¯¹äº 100000 å’Œ 1000000 å¾—åˆ°çš„æ•°æ®ï¼Œå¯¹è¿™ä¸€ $\sqrt n$ é¢„æµ‹çš„æ”¯æŒæƒ…å†µå¦‚ä½•ï¼Ÿæœ‰äººè¯´ç¨‹åºåœ¨ä½ çš„æœºå™¨ä¸Šè¿è¡Œçš„æ—¶é—´æ­£æ¯”äºè®¡ç®—æ‰€éœ€çš„æ­¥æ•°ï¼Œä½ å¾—åˆ°çš„ç»“æœç¬¦åˆè¿™ç§è¯´æ³•å—ï¼Ÿ
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 #lang sicp (define (prime? n) (define (smallest-divisor n) (find-divisor n 2)) (define (find-divisor n test-divisor) (cond ((&gt; (square test-divisor) n) n) ((divides? test-divisor n) test-divisor) (else (find-divisor n (+ test-divisor 1))))) (define (square x) (* x x)) (define (divides? a b) (= (remainder b a) 0)) (= (smallest-divisor n) n)) (define (timed-prime-test n) (newline) (display n) (start-prime-test n (runtime))) (define (start-prime-test n start-time) (if (prime? n) (report-prime (- (runtime) start-time)))) (define (report-prime elapsed-time) (display &#34; *** &#34;) (display elapsed-time)) (define (search-for-primes start end) (cond ((&lt; start end) (timed-prime-test start) (search-for-primes (+ start 2) end)))) (search-for-primes 1001 1030) (newline) (search-for-primes 10001 10040) (newline) (search-for-primes 100001 100050) (newline) (search-for-primes 1000000001 1000000100) (newline) (search-for-primes 100000000001 100000000100) ;: åªåˆ—å‡ºäº†ç´ æ•°éƒ¨åˆ† ;: 1009 *** 0 ;: 1013 *** 0 ;: 1019 *** 0 ;: 1021 *** 0 ;: 10007 *** 0 ;: 10009 *** 0 ;: 10037 *** 0 ;: 10039 *** 0 ;: 100003 *** 0 ;: 100019 *** 0 ;: 100043 *** 0 ;: 100049 *** 0 ;: 1000000007 *** 3988 ;: 1000000009 *** 2011 ;: 1000000021 *** 1993 ;: 1000000033 *** 1995 ;: 1000000087 *** 1996 ;: 1000000093 *** 1993 ;: 1000000097 *** 1995 ;: 100000000003 *** 19947 ;: 100000000019 *** 21941 ;: 100000000057 *** 19944 ;: 100000000063 *** 19946 ;: 100000000069 *** 20945 ;: 100000000073 *** 19948 ;: 100000000091 *** 19945 ä»ä»¥ä¸Šç»“æœå¯çŸ¥ï¼Œåœ¨æ•°å­—è¾ƒå°æ—¶ï¼Œè¿è¡Œæ—¶é—´éƒ½ä¸º 0ï¼Œæ— æ³•åšå‡ºåˆ¤æ–­ã€‚è€Œåœ¨æ•°å­—è¾ƒå¤§æ—¶ï¼Œå°†æ•°å­—å¢å¤§ 100 å€ï¼Œè¿è¡Œæ—¶é—´å‡ ä¹ä¸º 10 $(\sqrt{100})$ å€ï¼ŒåŸºæœ¬ç¬¦åˆé¢˜ç›®çš„è¯´æ³•ã€‚
ç»ƒä¹  23 åœ¨æœ¬èŠ‚å¼€å§‹æ—¶ç»™å‡ºçš„é‚£ä¸ª smallest-divisor è¿‡ç¨‹åšäº†è®¸å¤šæ— ç”¨æ£€æŸ¥ï¼šåœ¨å®ƒæ£€æŸ¥äº†ä¸€ä¸ªæ•°æ˜¯å¦èƒ½è¢« 2 æ•´é™¤ä¹‹åï¼Œå®é™…ä¸Šå·²ç»å®Œå…¨æ²¡å¿…è¦å†æ£€æŸ¥å®ƒæ˜¯å¦èƒ½è¢«ä»»ä½•å¶æ•°æ•´é™¤äº†ã€‚è¿™è¯´æ˜ test-divisor æ‰€ç”¨çš„å€¼ä¸åº”è¯¥æ˜¯ 2ï¼Œ3ï¼Œ4ï¼Œ5ï¼Œ6ï¼Œ&hellip;ï¼Œè€Œåº”è¯¥æ˜¯ 2ï¼Œ3ï¼Œ5ï¼Œ7ï¼Œ9ï¼Œ&hellip;ã€‚è¯·å®ç°è¿™ç§ä¿®æ”¹ã€‚å…¶ä¸­å®šä¹‰ä¸€ä¸ªè¿‡ç¨‹ nextï¼Œç”¨ 2 è°ƒç”¨æ—¶è¿”å› 3ï¼Œå¦åˆ™å°±è¿”å›å…¶è¾“å…¥å€¼åŠ  2ã€‚ä¿®æ”¹ smallest-divisor è¿‡ç¨‹ï¼Œä½¿å®ƒå»ä½¿ç”¨ (next test-divisor) è€Œä¸æ˜¯ (+ test-divisor 1)ã€‚è®© timed-prime-test ç»“åˆè¿™ä¸ª smallest-divisor ç‰ˆæœ¬ï¼Œè¿è¡Œç»ƒä¹  1.22 é‡Œçš„ 12 ä¸ªæ‰¾ç´ æ•°æµ‹è¯•ã€‚å› ä¸ºè¿™ä¸€ä¿®æ”¹ä½¿æ£€æŸ¥çš„æ­¥æ•°å‡å°‘ä¸€åŠï¼Œä½ å¯èƒ½æœŸæœ›å®ƒçš„è¿è¡Œé€Ÿåº¦å¿«ä¸€å€ã€‚å®é™…æƒ…å†µç¬¦åˆè¿™ä¸€é¢„æœŸå—ï¼Ÿå¦‚æœä¸ç¬¦åˆï¼Œä½ æ‰€è§‚å¯Ÿåˆ°çš„ä¸¤ä¸ªç®—æ³•é€Ÿåº¦çš„æ¯”å€¼æ˜¯ä»€ä¹ˆï¼Ÿä½ å¦‚ä½•è§£é‡Šè¿™ä¸€æ¯”å€¼ä¸æ˜¯ 2 çš„äº‹å®ï¼Ÿ
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 #lang sicp (define (prime? n) (define (smallest-divisor n) (find-divisor n 2)) (define (find-divisor n test-divisor) (cond ((&gt; (square test-divisor) n) n) ((divides? test-divisor n) test-divisor) (else (find-divisor n (next test-divisor))))) (define (square x) (* x x)) (define (divides? a b) (= (remainder b a) 0)) (define (next n) (if (= n 2) 3 (+ n 2))) (= (smallest-divisor n) n)) (define (timed-prime-test n) (newline) (display n) (start-prime-test n (runtime))) (define (start-prime-test n start-time) (if (prime? n) (report-prime (- (runtime) start-time)))) (define (report-prime elapsed-time) (display &#34; *** &#34;) (display elapsed-time)) (define (search-for-primes start end) (cond ((&lt; start end) (timed-prime-test start) (search-for-primes (+ start 2) end)))) (search-for-primes 1001 1030) (newline) (search-for-primes 10001 10040) (newline) (search-for-primes 100001 100050) (newline) (search-for-primes 1000000001 1000000100) (newline) (search-for-primes 100000000001 100000000100) ;: åªåˆ—å‡ºäº†ç´ æ•°éƒ¨åˆ† ;: 1009 *** 0 ;: 1013 *** 0 ;: 1019 *** 0 ;: 1021 *** 0 ;: 10007 *** 0 ;: 10009 *** 0 ;: 10037 *** 0 ;: 10039 *** 0 ;: 100003 *** 0 ;: 100019 *** 0 ;: 100043 *** 0 ;: 100049 *** 0 ;: 1000000007 *** 996 ;: 1000000009 *** 997 ;: 1000000021 *** 997 ;: 1000000033 *** 1993 ;: 1000000087 *** 1996 ;: 1000000093 *** 998 ;: 1000000097 *** 997 ;: 100000000003 *** 12965 ;: 100000000019 *** 12969 ;: 100000000057 *** 11968 ;: 100000000063 *** 11968 ;: 100000000069 *** 12964 ;: 100000000073 *** 12966 ;: 100000000091 *** 12005 å¯¹æ¯” ç»ƒä¹  23 ï¼Œ ç»ƒä¹  22 çš„ç»“æœï¼Œæ”¹è¿›åçš„ç®—æ³•è¿è¡Œæ—¶é—´ç¡®å®å‡ ä¹ä¸ºä¹‹å‰çš„ä¸€åŠã€‚
ç»ƒä¹  24 ä¿®æ”¹ ç»ƒä¹  22 çš„ timed-prime-test è¿‡ç¨‹ï¼Œè®©å®ƒä½¿ç”¨ fast-prime?ï¼ˆè´¹é©¬æ–¹æ³•ï¼‰ï¼Œå¹¶æ£€æŸ¥ä½ åœ¨ç»ƒä¹ ä¸­æ‰¾å‡ºçš„ 12 ä¸ªç´ æ•°ã€‚å› ä¸ºè´¹é©¬æ£€æŸ¥å…·æœ‰ $\Theta(\log n)$ çš„å¢é•¿é€Ÿåº¦ï¼Œå¯¹æ¥è¿‘ 1000000 çš„ç´ æ•°æ£€æŸ¥ä¸æ¥è¿‘ 1000 çš„ç´ æ•°æ£€æŸ¥ä½œå¯¹æœŸæœ›æ—¶é—´ä¹‹é—´çš„æ¯”è¾ƒæœ‰æ€æ ·çš„é¢„æœŸï¼Ÿä½ çš„æ•°æ®ç¡®å®è¡¨æ˜è¿™ä¸€é¢„æœŸå—ï¼Ÿä½ èƒ½è§£é‡Šæ‰€å‘ç°çš„ä»»ä½•ä¸ç¬¦åˆé¢„æœŸçš„åœ°æ–¹å—ï¼Ÿ
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 #lang sicp (define (fast-prime? n times) (cond ((= times 0) true) ((fermat-test n) (fast-prime? n (- times 1))) (else false))) (define (fermat-test n) (define (try-it a) (= (expmod a n n) a)) (try-it (+ 1 (random (- n 1))))) (define (expmod base exp m) (cond ((= exp 0) 1) ((even? exp) (remainder (square (expmod base (/ exp 2) m)) m)) (else (remainder (* base (expmod base (- exp 1) m)) m)))) (define (square x) (* x x)) (define (timed-prime-test n) (newline) (display n) (start-prime-test n (runtime))) (define (start-prime-test n start-time) (if (fast-prime? n 10) (report-prime (- (runtime) start-time)))) (define (report-prime elapsed-time) (display &#34; *** &#34;) (display elapsed-time)) (define (search-for-primes start end) (cond ((&lt; start end) (timed-prime-test start) (search-for-primes (+ start 2) end)))) (search-for-primes 1001 1030) (newline) (search-for-primes 10001 10040) (newline) (search-for-primes 100001 100050) (newline) (search-for-primes 1000000001 1000000100) ; è¿™ä¸€ç»„è¶…å‡ºäº† random èŒƒå›´ ; (newline) ; (search-for-primes 100000000001 100000000100) ;: åªåˆ—å‡ºäº†ç´ æ•°éƒ¨åˆ† ;: 1009 *** 0 ;: 1013 *** 0 ;: 1019 *** 0 ;: 1021 *** 0 ;: 10007 *** 0 ;: 10009 *** 0 ;: 10037 *** 0 ;: 10039 *** 0 ;: 100003 *** 0 ;: 100019 *** 0 ;: 100043 *** 0 ;: 100049 *** 0 ;: 1000000007 *** 0 ;: 1000000009 *** 0 ;: 1000000021 *** 0 ;: 1000000033 *** 0 ;: 1000000087 *** 0 ;: 1000000093 *** 0 ;: 1000000097 *** 0 è¿è¡Œæ—¶é—´éƒ½ä¸º 0ï¼Œæ— æ³•æ¯”è¾ƒï¼Œä½†ä¹Ÿç¡®å®è¯´æ˜äº† fast-prime? è¿è¡Œæ—¶é—´æ›´çŸ­ï¼ˆå¯¹äºè¾ƒå¤§çš„æ•°æ®ï¼‰ã€‚
ç»ƒä¹  25 Alyssa P. Hacker æå‡ºï¼Œåœ¨å†™ expmod æ—¶æˆ‘ä»¬åšäº†è¿‡å¤šçš„é¢å¤–å·¥ä½œã€‚å¥¹è¯´ï¼Œæ¯•ç«Ÿæˆ‘ä»¬å·²ç»çŸ¥é“æ€æ ·è®¡ç®—ä¹˜å¹‚ï¼Œå› æ­¤åªéœ€è¦ç®€å•åœ°å†™ï¼š
1 2 (define (expmod base exp m) (remainder (fast-expt base exp) m)) å¥¹è¯´çš„å¯¹å—ï¼Ÿè¿™ä¸€è¿‡ç¨‹èƒ½å¾ˆå¥½åœ°ç”¨äºæˆ‘ä»¬çš„å¿«é€Ÿç´ æ•°æ£€æŸ¥ç¨‹åºå—ï¼Ÿè¯·è§£é‡Šè¿™äº›é—®é¢˜ã€‚
è¿™ä¸€è¿‡ç¨‹èƒ½æ­£å¸¸å·¥ä½œï¼Œä½†æ˜¯æ•ˆç‡å¤ªä½ï¼Œå› ä¸ºåœ¨æ±‚æ¨¡è¿‡ç¨‹ä¸­ï¼Œå®Œå…¨æ²¡å¿…è¦æŠŠéå¸¸å¤§çš„å¹‚æ¬¡ç®—å‡ºæ¥ï¼Œè€Œè¿™ä¸€è¿‡ç¨‹å´ä¼šè®¡ç®—éå¸¸é«˜çš„å¹‚æ¬¡ï¼Œè¿˜ä¼šå¯¹å…¶æ±‚ä½™ï¼Œå¯¼è‡´æ¯”è¾ƒå¤§çš„è®¡ç®—å¼€é”€ã€‚
ç»ƒä¹  26 Louis Reasoner åœ¨åš ç»ƒä¹  24 æ—¶é‡åˆ°äº†å¾ˆå¤§å›°éš¾ï¼Œå®ƒçš„ fast-prime? æ£€æŸ¥çœ‹èµ·æ¥è¿è¡Œå¾—æ¯”ä»–çš„ prime? æ£€æŸ¥è¿˜æ…¢ã€‚Louis è¯·ä»–çš„æœ‹å‹ Eva Lu Ator è¿‡æ¥å¸®å¿™ã€‚åœ¨æ£€æŸ¥ Louis çš„ä»£ç æ—¶ï¼Œä¸¤ä¸ªäººå‘ç°ä»–é‡å†™äº† expmod è¿‡ç¨‹ï¼Œå…¶ä¸­ç”¨äº†ä¸€ä¸ªæ˜¾å¼çš„ä¹˜æ³•ï¼Œè€Œæ²¡æœ‰è°ƒç”¨ squareï¼š
1 2 3 4 5 6 7 8 9 (define (expmod base exp m) (cond ((= exp 0) 1) ((even? exp) (remainder (* (expmod base (/ exp 2) m) (expmod base (/ exp 2) m)) m)) (else (remainder (* base (expmod base (- exp 1) m)) m)))) â€œæˆ‘çœ‹ä¸å‡ºæ¥è¿™ä¼šé€ æˆä»€ä¹ˆä¸åŒï¼Œâ€ Louis è¯´ã€‚â€œæˆ‘èƒ½çœ‹å‡ºï¼Œâ€ Eva è¯´ï¼Œâ€œé‡‡ç”¨è¿™ç§æ–¹å¼å†™å‡ºè¯¥è¿‡ç¨‹æ—¶ï¼Œä½ å°±æŠŠä¸€ä¸ª $\Theta(\log n)$ çš„è®¡ç®—è¿‡ç¨‹å˜æˆ $\Theta(n)$ çš„äº†ã€‚â€ è¯·è§£é‡Šè¿™ä¸€é—®é¢˜ã€‚
å¦‚æœé‡‡ç”¨ä»¥ä¸Šè¿‡ç¨‹ï¼Œå½“ exp ä¸ºå¶æ•°æ—¶ï¼Œä¼šæ‰§è¡Œä¸¤é (expmod base (/ exp 2) m) è¿‡ç¨‹ï¼Œè¾¾ä¸åˆ°â€œæŠ˜åŠâ€çš„æ•ˆæœï¼Œè€Œ $\Theta(\log n)$ å¤æ‚åº¦æ­£æ˜¯ç”±äºæ¯æ¬¡ä½¿è®¡ç®—é‡â€œæŠ˜åŠâ€å¾—åˆ°çš„ï¼Œä¸Šè¿°è¿‡ç¨‹å°†â€œæŠ˜åŠâ€çš„æ•ˆæœâ€œæŠµæ¶ˆâ€äº†ï¼Œå˜æˆäº†åŸæœ¬çš„çº¿æ€§å¤æ‚åº¦ã€‚
ç»ƒä¹  27 è¯æ˜è„šæ³¨ 47 ä¸­åˆ—å‡ºçš„ Carmichael æ•°ç¡®å®èƒ½éª—è¿‡è´¹é©¬æ£€æŸ¥ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå†™ä¸€ä¸ªè¿‡ç¨‹ï¼Œå®ƒä»¥æ•´æ•° $n$ ä¸ºå‚æ•°ï¼Œå¯¹æ¯ä¸ª $a\lt n$ æ£€æŸ¥ $a^n$ æ˜¯å¦ä¸ $a$ æ¨¡ $n$ åŒä½™ã€‚ç”¨ä½ çš„è¿‡ç¨‹å»æ£€æŸ¥å‰é¢ç»™å‡ºçš„é‚£äº› Carmichael æ•°ã€‚
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 #lang sicp (define (prime? n) (define (smallest-divisor n) (find-divisor n 2)) (define (find-divisor n test-divisor) (cond ((&gt; (square test-divisor) n) n) ((divides? test-divisor n) test-divisor) (else (find-divisor n (+ test-divisor 1))))) (define (square x) (* x x)) (define (divides? a b) (= (remainder b a) 0)) (= (smallest-divisor n) n)) (define (expmod base exp m) (define (square x) (* x x)) (cond ((= exp 0) 1) ((even? exp) (remainder (square (expmod base (/ exp 2) m)) m)) (else (remainder (* base (expmod base (- exp 1) m)) m)))) (define (carmichael-test n) (if (prime? n) false (fake-fermat-test n 2))) (define (fake-fermat-test n test) (cond ((= test n) true) ((= (expmod test n n) test) (fake-fermat-test n (+ test 1))) (else false))) ; carmichael numbers: ; 561 1105 1729 2465 2821 6601 ... (carmichael-test 561) (carmichael-test 1105) (carmichael-test 1729) (carmichael-test 2465) (carmichael-test 2821) (carmichael-test 6601) (newline) (carmichael-test 2333) (carmichael-test 752) ;: #t ;: #t ;: #t ;: #t ;: #t ;: #t ;: #f ;: #f ç»ƒä¹  28 è´¹é©¬æ£€æŸ¥çš„ä¸€ç§ä¸ä¼šè¢«æ¬ºéª—çš„å˜å½¢æˆä¸º Miller-Rabin æ£€æŸ¥ï¼ˆMiller 1976ï¼›Rabin 1980ï¼‰ï¼Œå®ƒæ¥æºäºè´¹é©¬å°å®šç†çš„ä¸€ä¸ªå˜å½¢ã€‚è¿™ä¸€å˜å½¢æ–­è¨€ï¼Œå¦‚æœ $n$ æ˜¯ç´ æ•°ï¼Œ$a$ æ˜¯ä»»ä½•å°äº $n$ çš„æ•´æ•°ï¼Œåˆ™ $a$ çš„ $(n-1)$ æ¬¡å¹‚ä¸ $1$ æ¨¡ $n$ åŒä½™ã€‚è¦ç”¨ Miller-Rabin æ£€æŸ¥è€ƒå¯Ÿ $n$ çš„ç´ æ€§ï¼Œæˆ‘ä»¬åº”éšæœºåœ°å–ä¸€ä¸ªæ•° $a\lt n$ å¹¶ç”¨è¿‡ç¨‹ expmod æ±‚ $a$ çš„ $(n-1)$ æ¬¡å¹‚å¯¹ $n$ çš„æ¨¡ã€‚ç„¶è€Œï¼Œåœ¨æ‰§è¡Œ expmod ä¸­çš„å¹³æ–¹æ­¥éª¤æ—¶ï¼Œæˆ‘ä»¬éœ€è¦æŸ¥çœ‹æ˜¯å¦é‡åˆ°äº†â€œ$1$ å–æ¨¡ $n$ çš„éå¹³å‡¡å¹³æ–¹æ ¹â€ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ˜¯ä¸æ˜¯å­˜åœ¨ä¸ç­‰äº $1$ æˆ–è€… $n-1$ çš„æ•°ï¼Œå…¶å¹³æ–¹å–æ¨¡ $n$ ç­‰äº $1$ ã€‚å¯ä»¥è¯æ˜ï¼Œå¦‚æœ $1$ çš„è¿™ç§éå¹³å‡¡å¹³æ–¹æ ¹å­˜åœ¨ï¼Œé‚£ä¹ˆ $n$ å°±ä¸æ˜¯ç´ æ•°ã€‚è¿˜å¯ä»¥è¯æ˜ï¼Œå¦‚æœ $n$ æ˜¯éç´ æ•°çš„å¥‡æ•°ï¼Œé‚£ä¹ˆï¼Œè‡³å°‘æœ‰ä¸€åŠçš„æ•° $a\lt n$ ï¼ŒæŒ‰ç…§è¿™ç§æ–¹å¼è®¡ç®— $a^{n-1}$ ï¼Œå°†ä¼šé‡åˆ° $1$ å–æ¨¡ $n$ çš„éå¹³å‡¡å¹³æ–¹æ ¹ã€‚è¿™ä¹Ÿæ˜¯ Miller-Rabin æ£€æŸ¥ä¸ä¼šå—éª—çš„åŸå› ã€‚è¯·ä¿®æ”¹ expmod è¿‡ç¨‹ï¼Œè®©å®ƒåœ¨å‘ç° $1$ çš„éå¹³å‡¡å¹³æ–¹æ ¹æ—¶æŠ¥å‘Šå¤±è´¥ï¼Œå¹¶åˆ©ç”¨å®ƒå®ç°ä¸€ä¸ªç±»ä¼¼äº fermat-test çš„è¿‡ç¨‹ï¼Œå®Œæˆ Miller-Rabin æ£€æŸ¥ã€‚é€šè¿‡æ£€æŸ¥ä¸€äº›å·²çŸ¥ç´ æ•°å’Œéç´ æ•°çš„æ–¹å¼è€ƒéªŒä½ çš„è¿‡ç¨‹ã€‚æç¤ºï¼šé€å‡ºå¤±è´¥ä¿¡å·çš„ä¸€ç§ç®€å•æ–¹å¼å°±æ˜¯è®©å®ƒè¿”å› 0ã€‚
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 #lang sicp (define (remainder-square-checked x m) (if (and (not (or (= x 1) (= x (- m 1)))) (= (remainder (* x x) m) 1)) 0 (remainder (* x x) m))) (define (expmod-checked base exp m) (cond ((= exp 0) 1) ((even? exp) (remainder-square-checked (expmod-checked base (/ exp 2) m) m)) (else (remainder (* base (expmod-checked base (- exp 1) m)) m)))) (define (miller-rabin-test n) (define (try-it a) (= (expmod-checked a (- n 1) n) 1)) (try-it (+ 1 (random (- n 1))))) (define (miller-rabin-prime? n times) (cond ((= times 0) #t) ((miller-rabin-test n) (miller-rabin-prime? n (- times 1))) (else #f))) (define (assert-result test-name actual expected) (display (if (eq? actual expected) &#34;pass: &#34; &#34;fail: &#34;)) (display test-name) (newline)) (assert-result &#34; 2 is prime&#34; (miller-rabin-prime? 2 10) #t) (assert-result &#34;1009 is prime&#34; (miller-rabin-prime? 1009 10) #t) (assert-result &#34; 4 is not prime&#34; (miller-rabin-prime? 4 10) #f) (assert-result &#34; 99 is not prime&#34; (miller-rabin-prime? 99 10) #f) (assert-result &#34; 561 is not prime &#34; (miller-rabin-prime? 561 10) #f) ; (Carmichael number) ;: pass: 2 is prime ;: pass: 1009 is prime ;: pass: 4 is not prime ;: pass: 99 is not prime ;: pass: 561 is not prime ç»ƒä¹  29 è¾›æ™®æ£®è§„åˆ™æ˜¯å¦ä¸€ç§æ¯”ä¸Šé¢æ‰€ç”¨è§„åˆ™æ›´ç²¾ç¡®çš„æ•°å€¼ç§¯åˆ†æ–¹æ³•ã€‚é‡‡ç”¨è¾›æ™®æ£®è§„åˆ™ï¼Œå‡½æ•° $f$ åœ¨èŒƒå›´ $a$ å’Œ $b$ ä¹‹é—´çš„å®šç§¯åˆ†çš„è¿‘ä¼¼å€¼æ˜¯ï¼š
$$ \frac{h}{3}\left[y_0+4y_1+2y_2+4y_3+2y_4+\cdots+2y_{n-2}+4y_{n-1}+y_n\right] $$
å…¶ä¸­ $h=(b-a)/n$ , $n$ æ˜¯æŸä¸ªå¶æ•°ï¼Œè€Œ $y_k=f(a+kh)$ ï¼ˆå¢å¤§ $n$ èƒ½æé«˜è¿‘ä¼¼å€¼çš„ç²¾åº¦ï¼‰ã€‚è¯·å®šä¹‰ä¸€ä¸ªå…·æœ‰å‚æ•° $f$ ã€$a$ ã€$b$ å’Œ $n$ ï¼Œé‡‡ç”¨è¾›æ™®æ£®è§„åˆ™è®¡ç®—å¹¶è¿”å›ç§¯åˆ†å€¼çš„è¿‡ç¨‹ã€‚ç”¨ä½ çš„å‡½æ•°æ±‚å‡º cube åœ¨ $0$ å’Œ $1$ ä¹‹é—´çš„ç§¯åˆ†ï¼ˆç”¨ $n=100$ å’Œ $n=1000$ ï¼‰ï¼Œå¹¶å°†å¾—åˆ°çš„å€¼ä¸ä¸Šé¢ç”¨ integral è¿‡ç¨‹æ‰€å¾—åˆ°çš„ç»“æœæ¯”è¾ƒã€‚
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 #lang sicp (define (cube x) (* x x x)) (define (sum term a next b) (if (&gt; a b) 0 (+ (term a) (sum term (next a) next b)))) (define (integral f a b dx) (define (add-dx x) (+ x dx)) (* (sum f (+ a (/ dx 2.0)) add-dx b) dx)) (define (simpson-integral f a b n) (let ((h (/ (- b a) n))) (define (next a) (+ a h h)) (* (/ h 3) (+ (f a) (* 4 (sum f (+ a h) next b)) (* 2 (sum f (+ a h h) next b)) (f b))))) (integral cube 0 1.0 0.01) (simpson-integral cube 0 1.0 100) (integral cube 0 1.0 0.001) (simpson-integral cube 0 1.0 1000) ;: 0.24998750000000042 ;: 0.25000000000000044 ;: 0.249999875000001 ;: 0.25000000000000083 é‡‡ç”¨è¾›æ™®æ£®è§„åˆ™çš„ç²¾åº¦æ˜æ˜¾æ›´é«˜ã€‚
ç»ƒä¹  30 ä¸Šé¢çš„è¿‡ç¨‹ sum å°†äº§ç”Ÿå‡ºä¸€ä¸ªçº¿æ€§é€’å½’ã€‚æˆ‘ä»¬å¯ä»¥é‡å†™è¯¥è¿‡ç¨‹ï¼Œä½¿ä¹‹èƒ½å¤Ÿè¿­ä»£åœ°æ‰§è¡Œã€‚è¯·è¯´æ˜åº”è¯¥æ€æ ·é€šè¿‡å¡«å……ä¸‹é¢å®šä¹‰ä¸­ç¼ºå°‘çš„è¡¨è¾¾å¼ï¼Œå®Œæˆè¿™ä¸€å·¥ä½œã€‚
1 2 3 4 5 6 (define (sum term a next b) (define (iter a result) (if &lt;??&gt; &lt;??&gt; (iter &lt;??&gt; &lt;??&gt;))) (iter &lt;??&gt; &lt;??&gt;)) æ„å»ºè¿­ä»£è¿‡ç¨‹ï¼Œå…³é”®åœ¨äºè®°å½•ä¸­é—´ç»“æœå¹¶å®ŒæˆçŠ¶æ€è½¬æ¢ï¼Œè¿‡ç¨‹ (iter a result) ä¸­çš„ result å³å®Œæˆä¸­é—´ç»“æœçš„è®°å½•ï¼Œå½“è¿­ä»£ç»“æŸæ—¶ï¼Œå…¶è®°å½•å€¼ä¸ºæœ€ç»ˆç»“æœï¼›a ä¾¿æ˜¯è¿‡ç¨‹è½¬æ¢å˜é‡ï¼Œå°†éœ€è¦çš„é¡¹ç´¯åŠ åˆ° result åï¼Œa è½¬æ¢åˆ°ä¸‹ä¸€ä¸ªå€¼ï¼Œä¿è¯æœ€ç»ˆæ±‚å’Œä¸å˜ã€‚å…·ä½“ä»£ç å¦‚ä¸‹ï¼š
1 2 3 4 5 6 7 8 9 10 #lang sicp (define (sum term a next b) (define (iter a result) (if (&gt; a b) result (iter (next a) (+ result (term a))))) (iter a 0)) ç»ƒä¹  31 aï¼‰è¿‡ç¨‹ sum æ˜¯å¯ä»¥ç”¨é«˜é˜¶è¿‡ç¨‹è¡¨ç¤ºçš„å¤§é‡ç±»ä¼¼æŠ½è±¡ä¸­æœ€ç®€å•çš„ä¸€ä¸ªã€‚è¯·å†™å‡ºä¸€ä¸ªç±»ä¼¼çš„æˆä¸º product çš„è¿‡ç¨‹ï¼Œå®ƒè¿”å›åœ¨ç»™å®šèŒƒå›´ä¸­å„ç‚¹çš„æŸä¸ªå‡½æ•°å€¼çš„ä¹˜ç§¯ã€‚è¯·è¯´æ˜å¦‚ä½•ç”¨ product å®šä¹‰ factorial ã€‚å¦è¯·æŒ‰ç…§ä¸‹é¢å…¬å¼è®¡ç®— $\pi$ çš„è¿‘ä¼¼å€¼ï¼š
$$ \frac{\pi}{4}=\frac{2\cdot4\cdot4\cdot6\cdot6\cdot8\cdots}{3\cdot3\cdot5\cdot5\cdot7\cdot7\cdots} $$
bï¼‰å¦‚æœä½ çš„ product è¿‡ç¨‹ç”Ÿæˆçš„æ˜¯ä¸€ä¸ªé€’å½’è®¡ç®—è¿‡ç¨‹ï¼Œé‚£ä¹ˆè¯·å†™å‡ºä¸€ä¸ªç”Ÿæˆè¿­ä»£è®¡ç®—è¿‡ç¨‹çš„è¿‡ç¨‹ã€‚å¦‚æœå®ƒç”Ÿæˆä¸€ä¸ªè¿­ä»£è®¡ç®—è¿‡ç¨‹ï¼Œè¯·å†™å‡ºä¸€ä¸ªç”Ÿæˆé€’å½’è®¡ç®—è¿‡ç¨‹çš„è¿‡ç¨‹ã€‚
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 #lang sicp (define (product term a next b) (if (&gt; a b) 1 (* (term a) (product term (next a) next b)))) (define (factorial n) (define (next i) (+ i 1)) (define (term x) x) (product term 1 next n)) (define (calc-pi n) (define (next i) (+ i 2)) (define (term i) (/ (* (- i 1) (+ i 1)) i i)) (* 4.0 (product term 3 next n))) (define (product-iter term a next b) (define (iter a result) (if (&gt; a b) result (iter (next a) (* (term a) result)))) (iter a 1)) (define (factorial-iter n) (define (next i) (+ i 1)) (define (term x) x) (product-iter term 1 next n)) (define (calc-pi-iter n) (define (next i) (+ i 2)) (define (term i) (/ (* (- i 1) (+ i 1)) i i)) (* 4.0 (product-iter term 3 next n))) (factorial 10) (calc-pi 100) (calc-pi 10000) (factorial-iter 10) (calc-pi-iter 100) (calc-pi-iter 10000) ;: 3628800 ;: 3.157339689217565 ;: 3.1417497371492673 ;: 3628800 ;: 3.157339689217565 ;: 3.1417497371492673 ç»ƒä¹  32 aï¼‰è¯·è¯´æ˜ï¼Œsum å’Œ productï¼ˆç»ƒä¹  1.31ï¼‰éƒ½æ˜¯å¦ä¸€ç§°ä¸º accumulate çš„æ›´ä¸€èˆ¬æ¦‚å¿µçš„ç‰¹æ®Šæƒ…å†µï¼Œaccumulate ä½¿ç”¨æŸäº›ä¸€èˆ¬æ€§çš„ç´¯ç§¯å‡½æ•°ç»„åˆèµ·ä¸€ç³»åˆ—é¡¹ï¼š
1 (accumulate combiner null-value term a next b) accumulate å–çš„æ˜¯ä¸ sum å’Œ product ä¸€æ ·çš„é¡¹å’ŒèŒƒå›´æè¿°å‚æ•°ï¼Œå†åŠ ä¸Šä¸€ä¸ªï¼ˆä¸¤ä¸ªå‚æ•°çš„ï¼‰combiner è¿‡ç¨‹ï¼Œå®ƒæè¿°å¦‚ä½•å°†å½“å‰é¡¹ä¸å‰é¢å„é¡¹çš„ç§¯ç´¯ç»“æœç»„åˆèµ·æ¥ï¼Œå¦å¤–è¿˜æœ‰ä¸€ä¸ª null-value å‚æ•°ï¼Œå®ƒæè¿°åœ¨æ‰€æœ‰çš„é¡¹éƒ½ç”¨å®Œæ—¶çš„åŸºæœ¬å€¼ã€‚è¯·å†™å‡º accumulate ï¼Œå¹¶è¯´æ˜æˆ‘ä»¬èƒ½æ€æ ·åŸºäºç®€å•åœ°è°ƒç”¨ accumulate ï¼Œå®šä¹‰å‡º sum å’Œ product æ¥ã€‚
bï¼‰å¦‚æœä½ çš„ accumulate è¿‡ç¨‹ç”Ÿæˆçš„æ˜¯ä¸€ä¸ªé€’å½’è®¡ç®—è¿‡ç¨‹ï¼Œé‚£ä¹ˆè¯·å†™å‡ºä¸€ä¸ªç”Ÿæˆè¿­ä»£è®¡ç®—è¿‡ç¨‹çš„è¿‡ç¨‹ã€‚å¦‚æœå®ƒç”Ÿæˆä¸€ä¸ªè¿­ä»£è®¡ç®—è¿‡ç¨‹ï¼Œè¯·å†™å‡ºä¸€ä¸ªç”Ÿæˆé€’å½’è®¡ç®—è¿‡ç¨‹çš„è¿‡ç¨‹ã€‚
å¦‚ä¸‹è¿°ä»£ç æ‰€ç¤ºï¼šsum è¿‡ç¨‹çš„ combiner ä¸º + ï¼Œnull-value ä¸º 0ï¼Œproduct è¿‡ç¨‹çš„ combiner ä¸º * ï¼Œnull-value ä¸º 1ã€‚
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 #lang sicp (define (accumulate combiner null-value term a next b) (if (&gt; a b) null-value (combiner (term a) (accumulate combiner null-value term (next a) next b)))) (define (accumulate-iter combiner null-value term a next b) (define (iter a result) (if (&gt; a b) result (iter (next a) (combiner (term a) result)))) (iter a null-value)) (define (sum term a next b) (accumulate + 0 term a next b)) (define (product term a next b) (accumulate-iter * 1 term a next b)) (define (term x) x) (define (next n) (+ n 1)) (sum term 1 next 10) (product term 1 next 10) ;: 55 ;: 3628800 ç»ƒä¹  33 ä½ å¯ä»¥é€šè¿‡å¼•è¿›ä¸€ä¸ªå¤„ç†è¢«ç»„åˆé¡¹çš„è¿‡æ»¤å™¨ï¼ˆfilterï¼‰æ¦‚å¿µï¼Œå†™å‡ºä¸€ä¸ªæ¯” accumulateï¼ˆç»ƒä¹  1.32ï¼‰æ›´ä¸€èˆ¬çš„ç‰ˆæœ¬ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨è®¡ç®—è¿‡ç¨‹ä¸­ï¼Œåªç»„åˆèµ·ç”±ç»™å®šèŒƒå›´å¾—åˆ°çš„é¡¹é‡Œçš„é‚£äº›æ»¡è¶³ç‰¹å®šæ¡ä»¶çš„é¡¹ã€‚è¿™æ ·å¾—åˆ°çš„ filtered-accumulate æŠ½è±¡å–ä¸ä¸Šé¢ç´¯ç§¯è¿‡ç¨‹åŒæ ·çš„å‚æ•°ï¼Œå†åŠ ä¸Šä¸€ä¸ªå¦å¤–çš„æè¿°æœ‰å…³è¿‡æ»¤å™¨çš„è°“è¯å‚æ•°ã€‚è¯·å†™å‡º filtered-accumulate ä½œä¸ºä¸€ä¸ªè¿‡ç¨‹ï¼Œè¯´æ˜å¦‚ä½•ç”¨ filtered-accumulate è¡¨è¾¾ä»¥ä¸‹å†…å®¹ï¼š
aï¼‰æ±‚å‡ºåœ¨åŒºé—´ $a$ åˆ° $b$ ä¸­æ‰€æœ‰ç´ æ•°ä¹‹å’Œï¼ˆå‡å®šä½ å·²ç»å†™å‡ºäº†è°“è¯ prime? ï¼‰ã€‚
bï¼‰å°äº $n$ çš„æ‰€æœ‰ä¸ $n$ äº’ç´ çš„æ­£æ•´æ•°ï¼ˆå³æ‰€æœ‰æ»¡è¶³ $\text{GCD}(i, n)=1$ çš„æ•´æ•° $i\lt n$ï¼‰ä¹‹ä¹˜ç§¯ã€‚
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 #lang sicp (define (filtered-accumulate combiner null-value term a next b filter) (if (&gt; a b) null-value (combiner (if (filter a) (term a) null-value) (filtered-accumulate combiner null-value term (next a) next b filter)))) (define (prime? n) (define (square x) (* x x)) (define (divides? a b) (= (remainder b a) 0)) (define (find-divisor n test-divisor) (cond ((&gt; (square test-divisor) n) n) ((divides? test-divisor n) test-divisor) (else (find-divisor n (+ test-divisor 1))))) (define (smallest-divisor n) (find-divisor n 2)) (= n (smallest-divisor n))) (define (coprime? n m) (define (gcd a b) (if (= b 0) a (gcd b (remainder a b)))) (= (gcd n m) 1)) (define (sum-of-primes a b) (define (term x) x) (define (next x) (+ x 1)) (filtered-accumulate + 0 term a next b prime?)) (define (product-of-coprimes n) (define (term x) x) (define (next x) (+ x 1)) (define (filter a) (coprime? n a)) (filtered-accumulate * 1 term 1 next n filter)) (sum-of-primes 2 10) (product-of-coprimes 10) ;: 17 ;: 189 ç»ƒä¹  34 å‡å®šæˆ‘ä»¬å®šä¹‰äº†ï¼š
1 2 (define f g) (g 2)) è€Œåå°±æœ‰ï¼š
1 2 3 4 5 (f square) 4 (f (lambda (z) (* z (+ z 1)))) 6 å¦‚æœæˆ‘ä»¬ï¼ˆåšæŒï¼‰è¦æ±‚è§£é‡Šå™¨å»æ±‚å€¼ (f f) ï¼Œé‚£ä¼šå‘ç”Ÿä»€ä¹ˆæƒ…å†µå‘¢ï¼Ÿè¯·ç»™å‡ºè§£é‡Šã€‚
1 2 3 4 5 6 7 8 9 10 11 12 13 #lang sicp (define (f g) (g 2)) (f f) ;: æŠ¥é”™ ;: application: not a procedure; ;: expected a procedure that can be applied to arguments ;: given: 2 ;: arguments...: ;: 2 ç¨‹åºè¿è¡Œè¿‡ç¨‹å¦‚ä¸‹ï¼š
1 2 (f f) (f 2) è€Œ f çš„å®šä¹‰ä¸­è¦æ±‚ f çš„å‚æ•°æ˜¯ä¸€ä¸ªè¿‡ç¨‹ï¼Œå› æ­¤æŠ¥é”™ï¼ŒæœŸæœ›ä¸€ä¸ªè¿‡ç¨‹ä½œä¸ºå‚æ•°ï¼Œä½†æä¾›çš„æ˜¯æ•°å­— 2 ã€‚
ç»ƒä¹  35 è¯·è¯æ˜é»„é‡‘åˆ†å‰²ç‡ $\phi$ ï¼ˆ1.2.2 èŠ‚ï¼‰æ˜¯å˜æ¢ $x\mapsto 1+1/x$ çš„ä¸åŠ¨ç‚¹ã€‚è¯·åˆ©ç”¨è¿™ä¸€äº‹å®ï¼Œé€šè¿‡è¿‡ç¨‹ fixed-point è®¡ç®—å‡º $\phi$ çš„å€¼ã€‚
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 #lang sicp (define tolerance 0.00001) (define (fixed-point f first-guess) (define (close-enough? v1 v2) (&lt; (abs (- v1 v2)) tolerance)) (define (try guess) (let ((next (f guess))) (if (close-enough? guess next) next (try next)))) (try first-guess)) (define golden-ratio (fixed-point (lambda (x) (+ 1 (/ 1 x))) 1.0)) golden-ratio ;: 1.6180327868852458 ç»ƒä¹  36 è¯·ä¿®æ”¹ fixed-point ï¼Œä½¿å®ƒèƒ½æ‰“å°å‡ºè®¡ç®—ä¸­æ‰€äº§ç”Ÿçš„è¿‘ä¼¼å€¼åºåˆ—ï¼Œç”¨ ç»ƒä¹  22 å±•ç¤ºçš„ newline å’Œ display åŸºæœ¬è¿‡ç¨‹ã€‚è€Œåé€šè¿‡æ‰¾å‡º $x\mapsto \log(1000)/\log(x)$ çš„ä¸åŠ¨ç‚¹çš„æ–¹å¼ï¼Œç¡®å®š $x^x=1000$ çš„ä¸€ä¸ªæ ¹ï¼ˆè¯·åˆ©ç”¨ Scheme çš„åŸºæœ¬è¿‡ç¨‹ log ï¼Œå®ƒè®¡ç®—è‡ªç„¶å¯¹æ•°å€¼ï¼‰ã€‚è¯·æ¯”è¾ƒä¸€ä¸‹é‡‡ç”¨å¹³å‡é˜»å°¼å’Œä¸ç”¨å¹³å‡é˜»å°¼æ—¶çš„è®¡ç®—æ­¥æ•°ã€‚ï¼ˆæ³¨æ„ï¼Œä½ ä¸èƒ½ç”¨çŒœæµ‹ 1 å»å¯åŠ¨ fixed-point ï¼Œå› ä¸ºè¿™å°†å¯¼è‡´é™¤ä»¥ $\log(1)=0$ ã€‚ï¼‰
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 #lang sicp (define tolerance 0.00001) (define (fixed-point f first-guess) (define (close-enough? v1 v2) (&lt; (abs (- v1 v2)) tolerance)) (define (try guess) (display guess) (newline) (let ((next (f guess))) (if (close-enough? guess next) next (try next)))) (try first-guess)) (fixed-point (lambda (x) (/ (log 1000) (log x))) 2.0) (newline) (fixed-point (lambda (x) (/ (+ (/ (log 1000) (log x)) x) 2)) 2.0) ;: 2.0 ;: 9.965784284662087 ;: 3.004472209841214 ;: 6.279195757507157 ;: 3.759850702401539 ;: 5.215843784925895 ;: 4.182207192401397 ;: 4.8277650983445906 ;: 4.387593384662677 ;: 4.671250085763899 ;: 4.481403616895052 ;: 4.6053657460929 ;: 4.5230849678718865 ;: 4.577114682047341 ;: 4.541382480151454 ;: 4.564903245230833 ;: 4.549372679303342 ;: 4.559606491913287 ;: 4.552853875788271 ;: 4.557305529748263 ;: 4.554369064436181 ;: 4.556305311532999 ;: 4.555028263573554 ;: 4.555870396702851 ;: 4.555315001192079 ;: 4.5556812635433275 ;: 4.555439715736846 ;: 4.555599009998291 ;: 4.555493957531389 ;: 4.555563237292884 ;: 4.555517548417651 ;: 4.555547679306398 ;: 4.555527808516254 ;: 4.555540912917957 ;: 4.555532270803653 ;: 2.0 ;: 5.9828921423310435 ;: 4.922168721308343 ;: 4.628224318195455 ;: 4.568346513136242 ;: 4.5577305909237005 ;: 4.555909809045131 ;: 4.555599411610624 ;: 4.5555465521473675 ;: 4.555537551999825 ç»ƒä¹  37 aï¼‰ä¸€ä¸ªæ— ç©·è¿åˆ†å¼æ˜¯ä¸€ä¸ªå¦‚ä¸‹å½¢å¼çš„è¡¨è¾¾å¼ï¼š
$$ f=\frac{N_1}{D_1+\frac{N_2}{D_2+\frac{N_3}{D_3+\cdots}}} $$
ä½œä¸ºä¸€ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥è¯æ˜åœ¨æ‰€æœ‰çš„ $N_i$ å’Œ $D_i$ éƒ½ç­‰äº $1$ æ—¶ï¼Œè¿™ä¸€æ— ç©·è¿åˆ†å¼äº§ç”Ÿå‡º $1/\phi$ ï¼Œå…¶ä¸­çš„ $\phi$ å°±æ˜¯é»„é‡‘åˆ†å‰²ç‡ï¼ˆè§ 1.2.2 èŠ‚çš„æè¿°ï¼‰ã€‚é€¼è¿‘æŸä¸ªæ— ç©·è¿åˆ†å¼çš„ä¸€ç§æ–¹æ³•æ˜¯åœ¨ç»™å®šæ•°ç›®çš„é¡¹ä¹‹åæˆªæ–­ï¼Œè¿™æ ·çš„ä¸€ä¸ªæˆªæ–­ç§°ä¸º $k$ é¡¹æœ‰é™è¿åˆ†å¼ï¼Œå…¶å½¢å¼æ˜¯ï¼š
$$ \frac{N_1}{D_1+\frac{N_2}{\ddots+\frac{N_k}{D_k}}} $$
å‡å®š $n$ å’Œ $d$ éƒ½æ˜¯åªæœ‰ä¸€ä¸ªå‚æ•°ï¼ˆé¡¹çš„ä¸‹æ ‡ $i$ ï¼‰çš„è¿‡ç¨‹ï¼Œå®ƒä»¬åˆ†åˆ«è¿”å›è¿åˆ†å¼çš„é¡¹ $N_i$ å’Œ $D_i$ ã€‚è¯·å®šä¹‰ä¸€ä¸ªè¿‡ç¨‹ cont-frac ï¼Œä½¿å¾—å¯¹ (cont-frac n d k) çš„æ±‚å€¼è®¡ç®—å‡º k é¡¹æœ‰é™è¿åˆ†å¼çš„å€¼ã€‚é€šè¿‡å¦‚ä¸‹è°ƒç”¨æ£€æŸ¥ä½ çš„è¿‡ç¨‹å¯¹äºé¡ºåºçš„ k å€¼æ˜¯å¦é€¼è¿‘ $1/\phi$ ï¼š
1 2 3 (cont-frac (lambda (i) 1.0) (lambda (i) 1.0) k) ä½ éœ€è¦å–å¤šå¤§çš„ k æ‰èƒ½ä¿è¯å¾—åˆ°çš„è¿‘ä¼¼å€¼å…·æœ‰åè¿›åˆ¶çš„ 4 ä¸ºç²¾åº¦ï¼Ÿ
bï¼‰å¦‚æœä½ çš„è®¡ç®—è¿‡ç¨‹äº§ç”Ÿä¸€ä¸ªé€’å½’è®¡ç®—è¿‡ç¨‹ï¼Œé‚£ä¹ˆè¯·å†™å‡ºå¦ä¸€ä¸ªäº§ç”Ÿè¿­ä»£è®¡ç®—çš„è¿‡ç¨‹ã€‚å¦‚æœå®ƒäº§ç”Ÿè¿­ä»£è®¡ç®—ï¼Œè¯·å†™å‡ºå¦ä¸€ä¸ªè¿‡ç¨‹ï¼Œä½¿ä¹‹äº§ç”Ÿä¸€ä¸ªé€’å½’è®¡ç®—è¿‡ç¨‹ã€‚
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 #lang sicp (define (cont-frac n d k) (define (rec i) (if (&gt; i k) 0 (/ (n i) (+ (d i) (rec (+ i 1)))))) (rec 1)) (define (cont-frac-iter n d k) (define (iter i res) (if (= i 0) res (iter (- i 1) (/ (n i) (+ (d i) res))))) (iter k 0)) ;: exact value: ;: 0.6180339887498948 (cont-frac (lambda (i) 1.0) (lambda (i) 1.0) 10) (cont-frac-iter (lambda (i) 1.0) (lambda (i) 1.0) 11) ;: 0.6179775280898876 ;: 0.6180555555555556 ç»ƒä¹  38 åœ¨ 1737 å¹´ï¼Œç‘å£«æ•°å­¦å®¶è±æ˜‚å“ˆå¾· $\cdot$ æ¬§æ‹‰å‘è¡¨äº†ä¸€ç¯‡è®ºæ–‡Â De Fractionibus Continuisï¼Œæ–‡ä¸­åŒ…å«äº† $e-2$ çš„ä¸€ä¸ªè¿åˆ†å¼å±•å¼€ï¼Œå…¶ä¸­çš„ $e$ æ˜¯è‡ªç„¶å¯¹æ•°çš„åº•ã€‚åœ¨è¿™ä¸€åˆ†å¼ä¸­ï¼Œ$N_i$ å…¨éƒ½æ˜¯ $1$ ï¼Œè€Œ $D_i$ ä¾æ¬¡ä¸º $1, 2, 1, 1, 4, 1, 1, 6, 1, 1, 8, \cdots$ ã€‚è¯·å†™å‡ºä¸€ä¸ªç¨‹åºï¼Œå…¶ä¸­ä½¿ç”¨ä½ åœ¨ç»ƒä¹  1.37 ä¸­æ‰€åšçš„ cont-frac è¿‡ç¨‹ï¼Œå¹¶èƒ½åŸºäºæ¬§æ‹‰çš„å±•å¼€å¼æ±‚å‡º $e$ çš„è¿‘ä¼¼å€¼ã€‚
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 #lang sicp (define (cont-frac n d k) (define (iter i res) (if (= i 0) res (iter (- i 1) (/ (n i) (+ (d i) res))))) (iter k 0)) (+ (cont-frac (lambda (i) 1.0) (lambda (i) (if (= (remainder (+ i 1) 3) 0) (* (/ (+ i 1) 3) 2) 1)) 10) 2) (+ (cont-frac (lambda (i) 1.0) (lambda (i) (if (= (remainder (+ i 1) 3) 0) (* (/ (+ i 1) 3) 2) 1)) 1000) 2) ;: 2.7182817182817183 ;: 2.7182818284590455 ç»ƒä¹  39 æ­£åˆ‡å‡½æ•°çš„è¿åˆ†å¼è¡¨ç¤ºç”±å¾·å›½æ•°å­¦å®¶ J. H. Lambert åœ¨ 1770å¹´å‘è¡¨ï¼š
$$ \tan x=\frac{x}{1-\frac{x^2}{3-\frac{x^2}{5-\ddots}}} $$
å…¶ä¸­çš„ $x$ ç”¨å¼§åº¦è¡¨ç¤ºã€‚è¯·å®šä¹‰è¿‡ç¨‹ (tan-cf x k) ï¼Œå®ƒåŸºäº Lambert å…¬å¼è®¡ç®—æ­£åˆ‡å‡½æ•°çš„è¿‘ä¼¼å€¼ã€‚k æè¿°çš„æ˜¯è®¡ç®—çš„é¡¹æ•°ï¼Œå°±åƒç»ƒä¹  1.37 ä¸€æ ·ã€‚
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 #lang sicp (define (cont-frac n d k) (define (iter i res) (if (= i 0) res (iter (- i 1) (/ (n i) (+ (d i) res))))) (iter k 0)) (define (tan-cf x k) (cont-frac (lambda (i) (if (= i 1) x (- (* x x)))) (lambda (i) (- (+ i i) 1)) k)) (tan-cf 0.0 10) (tan-cf (/ 3.1415926 4) 100) ;: 0.0 ;: 0.9999999732051038 ç»ƒä¹  40 è¯·å®šä¹‰ä¸€ä¸ªè¿‡ç¨‹ cubic ï¼Œå®ƒå’Œ newtons-method è¿‡ç¨‹ä¸€èµ·ä½¿ç”¨åœ¨ä¸‹é¢å½¢å¼çš„è¡¨è¾¾å¼é‡Œï¼š
1 (newtons-method (cubic a b c) 1) èƒ½é€¼è¿‘ä¸‰æ¬¡æ–¹ç¨‹ $x^3+ax^2+bx+c$ çš„é›¶ç‚¹ã€‚
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 #lang sicp (define tolerance 0.00001) (define (fixed-point f first-guess) (define (close-enough? v1 v2) (&lt; (abs (- v1 v2)) tolerance)) (define (try guess) (let ((next (f guess))) (if (close-enough? guess next) next (try next)))) (try first-guess)) (define dx 0.00001) (define (deriv g) (lambda (x) (/ (- (g (+ x dx)) (g x)) dx))) (define (newton-transform g) (lambda (x) (- x (/ (g x) ((deriv g) x))))) (define (newtons-method g guess) (fixed-point (newton-transform g) guess)) (define (cubic a b c) (lambda (x) (+ (* x x x) (* a x x) (* b x) c))) (newtons-method (cubic -2.0 -2.0 3.0) 1) (newtons-method (cubic 2 3 3) 1) ;: 1.0 ;: -1.3926467817024144 ç»ƒä¹  41 è¯·å®šä¹‰ä¸€ä¸ªè¿‡ç¨‹ double ï¼Œå®ƒä»¥ä¸€ä¸ªæœ‰ä¸€ä¸ªå‚æ•°çš„è¿‡ç¨‹ä½œä¸ºå‚æ•°ï¼Œdouble è¿”å›ä¸€ä¸ªè¿‡ç¨‹ã€‚è¿™ä¸€è¿‡ç¨‹å°†åŸæ¥é‚£ä¸ªå‚æ•°è¿‡ç¨‹åº”ç”¨ä¸¤æ¬¡ã€‚ä¾‹å¦‚ï¼Œè‹¥ inc æ˜¯ä¸ªç»™å‚æ•°åŠ  1 çš„è¿‡ç¨‹ï¼Œ(double inc) å°†ç»™å‚æ•°åŠ  2 ã€‚ä¸‹é¢è¡¨è¾¾å¼è¿”å›ä»€ä¹ˆå€¼ï¼š
1 (((double (double double)) inc) 5) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 #lang sicp (define (double f) (lambda (x) (f (f x)))) (((double (double double)) inc) 5) (((lambda (x) ((double double) ((double double) x))) inc) 5) (((lambda (x) ((lambda (x) (double (double x))) ((lambda (x) (double (double x))) x))) inc) 5) (((lambda (x) ((lambda (x) (double (double x))) (double (double x)))) inc) 5) (((lambda (x) (double (double (double (double x))))) inc) 5) ((double (double (double (double inc)))) 5) (inc (inc (inc (inc (inc (inc (inc (inc (inc (inc (inc (inc (inc (inc (inc (inc 5)))))))))))))))) ;: 21 ;: 21 ;: 21 ;: 21 ;: 21 ;: 21 ;: 21 ç»ƒä¹  42 ä»¤ $f$ å’Œ $g$ æ˜¯ä¸¤ä¸ªå•å‚æ•°çš„å‡½æ•°ï¼Œ$f$ å’Œ $g$ ä¹‹åçš„å¤åˆå®šä¹‰ä¸ºå‡½æ•° $x\mapsto f\left(g(x)\right)$ ã€‚è¯·å®šä¹‰ä¸€ä¸ªå‡½æ•° compose å®ç°å‡½æ•°å¤åˆã€‚ä¾‹å¦‚ï¼Œå¦‚æœ inc æ˜¯å°†å‚æ•°åŠ  1 çš„å‡½æ•°ï¼Œé‚£ä¹ˆï¼š
1 2 ((compose square inc) 6) 49 1 2 3 4 5 6 7 8 #lang sicp (define (compose f g) (lambda (x) (f (g x)))) ((compose (lambda (x) (* x x)) inc) 6) ;: 49 ç»ƒä¹  43 å¦‚æœ $f$ æ˜¯ä¸€ä¸ªæ•°å€¼å‡½æ•°ï¼Œ$n$ æ˜¯ä¸€ä¸ªæ­£æ•´æ•°ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æ„é€ å‡º $f$ çš„ $n$ æ¬¡é‡å¤åº”ç”¨ï¼Œå°†å…¶å®šä¹‰ä¸ºä¸€ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°åœ¨ $x$ çš„å€¼æ˜¯ $f(f(\cdots(f(x))\cdots))$ ã€‚ä¸¾ä¾‹è¯´ï¼Œå¦‚æœ $f$ æ˜¯å‡½æ•° $x\mapsto x+1$ ï¼Œ$n$ æ¬¡é‡å¤åº”ç”¨ $f$ å°±æ˜¯å‡½æ•° $x\mapsto x+n$ ã€‚å¦‚æœ $f$ æ˜¯æ±‚ä¸€ä¸ªæ•°çš„å¹³æ–¹çš„æ“ä½œï¼Œ$n$ æ¬¡é‡å¤åº”ç”¨ $f$ å°±æ±‚å‡ºå…¶å‚æ•°çš„ $2^n$ æ¬¡å¹‚ã€‚è¯·å†™å‡ºä¸€ä¸ªè¿‡ç¨‹ï¼Œå®ƒçš„è¾“å…¥æ˜¯ä¸€ä¸ªè®¡ç®— $f$ çš„è¿‡ç¨‹å’Œä¸€ä¸ªæ­£æ•´æ•° $n$ ï¼Œè¿”å›çš„æ˜¯èƒ½è®¡ç®— $f$ çš„ $n$ æ¬¡é‡å¤åº”ç”¨çš„é‚£ä¸ªå‡½æ•°ã€‚ä½ çš„è¿‡ç¨‹åº”è¯¥èƒ½ä»¥å¦‚ä¸‹æ–¹å¼ä½¿ç”¨ï¼š
1 2 ((repeated square 2) 5) 625 æç¤ºï¼šä½ å¯èƒ½å‘ç°ä½¿ç”¨ ç»ƒä¹  42 çš„ compose èƒ½å¸¦æ¥ä¸€äº›æ–¹ä¾¿ã€‚
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 #lang sicp (define (compose f g) (lambda (x) (f (g x)))) (define (repeated f n) (if (= n 1) f (compose (repeated f (- n 1)) f))) ((repeated (lambda (x) (* x x)) 2) 5) ((repeated (lambda (x) (+ x 1)) 100) 100) ;: 625 ;: 200 ç»ƒä¹  44 å¹³æ»‘ä¸€ä¸ªå‡½æ•°çš„æƒ³æ³•æ˜¯ä¿¡å·å¤„ç†ä¸­çš„ä¸€ä¸ªé‡è¦æ¦‚å¿µã€‚å¦‚æœ $f$ æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œ$dx$ æ˜¯æŸä¸ªå¾ˆå°çš„æ•°å€¼ï¼Œé‚£ä¹ˆ $f$ çš„å¹³æ»‘ä¹Ÿæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒåœ¨ç‚¹ $x$ çš„å€¼å°±æ˜¯ $f(x-dx)$ ã€$f(x)$ å’Œ $f(x+dx)$ çš„å¹³å‡å€¼ã€‚è¯·å†™å‡ºä¸€ä¸ªè¿‡ç¨‹ smooth ï¼Œå®ƒçš„è¾“å…¥æ˜¯ä¸€ä¸ªè®¡ç®— $f$ çš„è¿‡ç¨‹ï¼Œè¿”å›ä¸€ä¸ªè®¡ç®—å¹³æ»‘åçš„ $f$ çš„è¿‡ç¨‹ã€‚æœ‰æ—¶å¯èƒ½å‘ç°ï¼Œé‡å¤åœ°å¹³æ»‘ä¸€ä¸ªå‡½æ•°ï¼Œå¾—åˆ°ç»è¿‡ $n$ æ¬¡å¹³æ»‘çš„å‡½æ•°ï¼ˆä¹Ÿå°±æ˜¯è¯´ï¼Œå¯¹å¹³æ»‘åçš„å‡½æ•°å†åšå¹³æ»‘ï¼Œç­‰ç­‰ï¼‰ä¹Ÿå¾ˆæœ‰ä»·å€¼ã€‚è¯´æ˜æ€æ ·åˆ©ç”¨ smooth å’Œç»ƒä¹  1.43 çš„ repeated ï¼Œå¯¹ç»™å®šçš„å‡½æ•°ç”Ÿæˆ $n$ æ¬¡å¹³æ»‘å‡½æ•°ã€‚
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 #lang sicp (define (repeated f n) (if (= n 1) f (lambda (x) ((lambda (f g) (f (g x))) (repeated f (- n 1)) f)))) (define dx 0.00001) (define (smooth f) (lambda (x) (/ (+ (f (- x dx)) (f x) (f (+ x dx))) 3))) (define (multi-smooth f n) (repeated (smooth f) n)) ((smooth (lambda (x) (* x x))) 1) ((smooth (lambda (x) (* x x x))) 0) ((multi-smooth (lambda (x) (* x x)) 1) 1) ((multi-smooth (lambda (x) (* x x)) 10) 1) ;: 1.0000000000666667 ;: 0.0 ;: 1.0000000000666667 ;: 1.0000000682000072 ç»ƒä¹  45 åœ¨ 1.3.3 èŠ‚é‡Œï¼Œæˆ‘ä»¬çœ‹åˆ°ä¼å›¾ç”¨æœ´ç´ çš„æ–¹æ³•å»æ‰¾ $y\mapsto x/y$ çš„ä¸åŠ¨ç‚¹ï¼Œä»¥ä¾¿è®¡ç®—å¹³æ–¹æ ¹çš„æ–¹å¼ä¸æ”¶æ•›ï¼Œè¿™ä¸ªç¼ºé™·å¯ä»¥é€šè¿‡å¹³å‡é˜»å°¼çš„æ–¹å¼å¼¥è¡¥ã€‚åŒæ ·æ–¹æ³•ä¹Ÿç”¨äºæ‰¾ç«‹æ–¹æ ¹ï¼Œå°†å®ƒçœ‹åšæ˜¯å¹³å‡é˜»å°¼åçš„ $y\mapsto x/y^2$ çš„ä¸åŠ¨ç‚¹ã€‚é—æ†¾çš„æ˜¯ï¼Œè¿™ä¸€è®¡ç®—è¿‡ç¨‹å¯¹äºå››æ¬¡æ–¹æ ¹å´è¡Œä¸é€šï¼Œä¸€æ¬¡å¹³å‡é˜»å°¼ä¸è¶³ä»¥ä½¿å¯¹ $y\mapsto x/y^3$ çš„ä¸åŠ¨ç‚¹æœå¯»æ”¶æ•›ã€‚è€Œåœ¨å¦ä¸€æ–¹é¢ï¼Œå¦‚æœæˆ‘ä»¬æ±‚ä¸¤æ¬¡å¹³å‡é˜»å°¼ï¼ˆå³ï¼Œç”¨ $y\mapsto x/y^3$ çš„å¹³å‡é˜»å°¼çš„å¹³å‡é˜»å°¼ï¼‰ï¼Œè¿™ä¸€ä¸åŠ¨ç‚¹æœå¯»å°±ä¼šæ”¶æ•›äº†ã€‚è¯·åšä¸€äº›è¯•éªŒï¼Œè€ƒè™‘å°†è®¡ç®— $n$ æ¬¡æ–¹æ ¹ä½œä¸ºåŸºäº $y\mapsto x/y^{n-1}$ çš„åå¤åšå¹³å‡é˜»å°¼çš„ä¸åŠ¨ç‚¹æœå¯»è¿‡ç¨‹ï¼Œè¯·è®¾æ³•ç¡®å®šå„ç§æƒ…å†µä¸‹éœ€è¦åšå¤šå°‘æ¬¡å¹³å‡é˜»å°¼ã€‚å¹¶è¯·åŸºäºè¿™ä¸€è®¤è¯†å®ç°ä¸€ä¸ªè¿‡ç¨‹ï¼Œå®ƒä½¿ç”¨ fixed-point ã€average-damp å’Œ ç»ƒä¹  43 çš„ repeated è¿‡ç¨‹è®¡ç®— $n$ æ¬¡æ–¹æ ¹ã€‚å‡å®šä½ æ‰€éœ€è¦çš„æ‰€æœ‰ç®—æœ¯è¿ç®—éƒ½æ˜¯åŸºæœ¬è¿‡ç¨‹ã€‚
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 #lang sicp (define (average-damp f) (lambda (x) (/ (+ x (f x)) 2))) (define tolerance 0.00001) (define (fixed-point f first-guess) (define (close-enough? a b) (&lt; (abs (- a b)) tolerance)) (define (try guess) (let ((next (f guess))) (if (close-enough? guess next) next (try next)))) (try first-guess)) (define (repeated f n) (if (= n 1) f (lambda (x) (f ((repeated f (- n 1)) x))))) (define (damp-times n) (define (iter power k) (if (&lt; n power) (- k 1) (iter (+ power power) (+ k 1)))) (iter 1 0)) (define (n-th-root x n) (fixed-point ((repeated average-damp (damp-times n)) (lambda (y) (/ x ((repeated (lambda (xx) (* y xx)) (- n 1)) 1.0)))) 1.0)) (n-th-root 32 5) (n-th-root 2 20) ;: 2.0000015129957607 ;: 1.0352662146623808 ç»ƒä¹  46 æœ¬ç« æè¿°çš„ä¸€äº›æ•°å€¼ç®—æ³•éƒ½æ˜¯è¿­ä»£å¼æ”¹è¿›çš„å®ä¾‹ã€‚è¿­ä»£å¼æ”¹è¿›æ˜¯ä¸€ç§éå¸¸å…·æœ‰ä¸€èˆ¬æ€§çš„è®¡ç®—ç­–ç•¥ï¼Œå®ƒè¯´çš„æ˜¯ï¼šä¸ºäº†è®¡ç®—å‡ºæŸäº›ä¸œè¥¿ï¼Œæˆ‘ä»¬å¯ä»¥ä»å¯¹ç­”æ¡ˆçš„æŸä¸ªåˆå§‹çŒœæµ‹å¼€å§‹ï¼Œæ£€æŸ¥è¿™ä¸€çŒœæµ‹æ˜¯å¦è¶³å¤Ÿå¥½ï¼Œå¦‚æœä¸è¡Œå°±æ”¹è¿›è¿™ä¸€çŒœæµ‹ï¼Œå°†æ”¹è¿›ä¹‹åçš„çŒœæµ‹ä½œä¸ºæ–°çš„çŒœæµ‹ç»§ç»­è¿™ä¸€è®¡ç®—è¿‡ç¨‹ã€‚è¯·å†™ä¸€ä¸ªè¿‡ç¨‹ iterative-improve ï¼Œå®ƒä»¥ä¸¤ä¸ªè¿‡ç¨‹ä¸ºå‚æ•°ï¼šå…¶ä¸­ä¹‹ä¸€è¡¨ç¤ºå‘ŠçŸ¥æŸä¸€çŒœæµ‹æ˜¯å¦è¶³å¤Ÿå¥½çš„æ–¹æ³•ï¼Œå¦ä¸€ä¸ªè¡¨ç¤ºæ”¹è¿›çŒœæµ‹çš„æ–¹æ³•ã€‚iterative-improve çš„è¿”å›å€¼åº”è¯¥æ˜¯ä¸€ä¸ªè¿‡ç¨‹ï¼Œå®ƒä»¥æŸä¸€ä¸ªçŒœæµ‹ä¸ºå‚æ•°ï¼Œé€šè¿‡ä¸æ–­æ”¹è¿›ï¼Œç›´è‡³å¾—åˆ°çš„çŒœæµ‹è¶³å¤Ÿå¥½ä¸ºæ­¢ã€‚åˆ©ç”¨ iterative-improve é‡å†™ 1.1.7 èŠ‚çš„ sqrt è¿‡ç¨‹å’Œ 1.3.3 èŠ‚çš„ fixed-point è¿‡ç¨‹ã€‚
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 #lang sicp (define (iterative-improve good-enough? improve) (define (iter guess) (if (good-enough? guess) guess (iter (improve guess)))) (lambda (guess) (iter guess))) (define (sqrt x) ((iterative-improve (lambda (y) (&lt; (abs (- x (* y y))) 0.00001)) (lambda (y) (/ (+ y (/ x y)) 2))) x)) (define (fixed-point f first-guess) ((iterative-improve (lambda (y) (&lt; (abs (- y (f y))) 0.00001)) (lambda (y) (f y))) first-guess)) (sqrt 2.0) (fixed-point cos 1.0) ;: 1.4142156862745097 ;: 0.7390893414033927 ]]></content></entry></search>